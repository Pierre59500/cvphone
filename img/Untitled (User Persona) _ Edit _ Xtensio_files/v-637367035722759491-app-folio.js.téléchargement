function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)}return a}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(a),!0).forEach(function(e){_defineProperty(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(){for(var e,t=function(){},a=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],n=a.length,o=window.console=window.console||{};n--;)o[e=a[n]]||(o[e]=t)}(),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";if(e instanceof RegExp)throw TypeError("first argument must not be a RegExp");return void 0===t&&(t=0),-1!==this.indexOf(e,t)}),Array.prototype.includes||(Array.prototype.includes=function(e){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),a=parseInt(t.length,10)||0;if(0===a)return!1;var n,o,i=parseInt(arguments[1],10)||0;for(0<=i?n=i:(n=a+i)<0&&(n=0);n<a;){if(e===(o=t[n])||e!=e&&o!=o)return!0;n++}return!1});var app={core:{},plugin:{},charts:{},setup:{},menu:{},factory:{},mods:{},canvas:{},popup:{},managers:{},modHelper:{},share:{},home:{},dash:{},editor:{},common:{},lib:{},acl:{},strings:{},consts:{},styleGuide:{}};dayjs.extend(dayjs_plugin_relativeTime),dayjs.extend(dayjs_plugin_localizedFormat),dayjs.extend(dayjs_plugin_advancedFormat),dayjs.extend(dayjs_plugin_utc),dayjs.extend(dayjs_plugin_customParseFormat),app.consts={freePersonaLimit:1,subscriptions:{Plus:{10:"PlusMonthly",11:"PlusYearly",16:"ManualPlus"},Pro:{1:"Monthly",2:"Yearly",4:"Manual"},Business:{14:"BusinessYearlyGrandFather",19:"BusinessMonthlyGrandFather",22:"BusinessYearly",25:"BusinesMonthly"},Team:{12:"TeamMemberYearlyGrandFather",13:"TeamPremiumGuestYearlyGrandFather",20:"TeamMemberMonthlyGrandFather",21:"TeamPremiumGuestMonthlyGrandFather",15:"TeamEarlyAccess",23:"TeamMemberYearly",24:"TeamPremiumGuestYearly",26:"TeamMemberMonthly",27:"TeamPremiumGuestMonthly"},Other:{3:"VersionUpgrade",5:"Campaign",6:"Referral",7:"SignUpViaReferral",8:"Failed",9:"DiscountYearly",34:"FreeUserWithCreditPurchase"},ProBusiness:{28:"ProYearly",31:"ProMonthly"}},roles:["None","Owner","Admin","TeamMember","PremiumGuest","SingleFolioGuest"],xtensioLabelSortArray:["Marketing","Sales","Business Development","Strategy","Reporting","Investor Relations","Product Management","Project Management","UX Design","Operations","Customer Success","Social Media Marketing","Public Relations"]},app.strings.general={lockedFeatureTip:"Needs more access",homeUrl:"https://xtensio.com",freeSharedFolioMsg:'<p class="showAbove768">Upgrade your account to remove Xtensio branding and access premium features.</p><p class="showBelow767">Upgrade to access premium features and remove Xtensio branding.</p><p class="showBelow640">Upgrade to remove Xtensio branding.</p>',freeSharedFolioCTA:'<a class="btn popup-cta see-plans" href="#seeplans">See Plans</a>',freeSharedFolioCTAWM:'<a class="btn popup-cta see-plans" href="https://xtensio.com/pricing">See Plans</a>'},app.strings.popups={imgForBgMessage:"Please use an image for background.",imgLimitHeading:"The file is too big",cannotPerformAction:"You Cannot Perform this Action",pleaseUpgradeAccount:"Please Upgrade Your Account",folioStatsMsgPG:"Premium Guests cannot view Folio Stats. Please contact the admin for more access.",templateStatsMsgPG:"Premium Guests cannot view Template Stats. Please contact the admin for more access.",styleGuideMsgOwner:"Managing the shared style guide is a Business feature. Please upgrade to a Business plan.",styleGuideMsgAdmin:"Managing the shared style guide is a Business feature. Please reach out to the team owner to upgrade your account.",styleGuideMsgMember:"Only team admins can manage the style guide. Please contact the admin for more access.",styleGuidePreviewMsgOwner:"Managing the shared style guide is a Business feature. Please upgrade to a Business plan.",styleGuidePreviewMsgAdmin:"Managing the shared style guide is a Business feature. Please reach out to the team owner to upgrade your account.",uploadCustomFontsMsgOwner:"Uploading custom fonts requires more access.",uploadCustomFontsMsgAdmin:"Uploading custom fonts requires more access.",saveCustomTemplatesMsgMember:"Saving custom templates requires more access. Please contact the team owner to upgrade your account.",saveCustomTemplatesMsgPG:"Sorry, Guests are not allowed to create custom templates. Please contact your admin for more access.",saveCustomTemplatesMsgOwner:"Saving custom templates requires more access. Please upgrade.",saveteamTemplateMsgOwner:"Saving shared team templates is a Business feature. Please upgrade.",saveteamTemplateMsgMember:"Saving shared team templates is a Business feature. Please contact the team owner to upgrade your account.",leaveFolioMsgGuest:"Sorry, Guests are not allowed to Leave Folio. Please contact your admin.",passwordProtectionMsgOwner:"Password protection requires more access. Please upgrade.",passwordProtectionMsgMember:"Password protection requires more access. Please contact your team owner to upgrade your account.",customLinksMsgOwner:"Customizing links requires more access. Please upgrade your account to edit this URL.",customLinksMsgMember:"Customizing links requires more access. Please contact your team owner to upgrade your account.",customLinksMsgPG:"Premium Guests cannot customize shared links. Please contact the admin for more access.",minUsersMsg:function(e,t){return"Your ".concat(e," supports a minimum of ").concat(t," users on the team.")},maxImgLimitMessage:function(e){return"The image is too big. <br/>Maximum size for uploads is ".concat(e,"MB.")},imgLimitMsgOwner:function(e,t){return"This image size exceeds the ".concat(e,"MB limit. Please compress the file or upgrade to a ").concat(t," plan for a larger image upload limit.")},imgLimitMsgMember:function(e){return"This image size exceeds the ".concat(e,"MB limit. Please compress the file or reach out to the team owner to upgrade the account.")},statsNextPlanType:function(e){return"Pro"==e?"the Team plan":"Business plans"},folioStatsMsgOwner:function(){return"Folio stats require more access. Please upgrade."},folioStatsMessageTM:function(){return"Folio Stats require more access. Please contact your team owner to upgrade your account."},templateStatsMsgOwner:function(e){return"Template stats are available on ".concat(app.strings.popups.statsNextPlanType(e),". Please upgrade to access stats and other premium features.")},templateStatsMessageTM:function(e){return"Template stats are available on ".concat(app.strings.popups.statsNextPlanType(e),". Please contact your team owner to upgrade your account.")},linkNextPlanType:function(e){return"".concat("Free"==e?"premium":"higher")},changeLinkToPublicMsgOwner:function(e,t){return"You cannot change link privacy settings on the ".concat(t," plan. To make this ").concat(e," public, please upgrade your account to make this folio public.")},changeLinkToPrivateMsgOwner:function(e,t){return"All ".concat(e,"s are public on the ").concat(t," plan. If you would like to make ").concat(e,"s private, please upgrade your account to a ").concat(app.strings.popups.linkNextPlanType(t)," plan.")},changeLinkPrivacyMsgMember:function(e,t){return"You cannot change link privacy settings on the ".concat(t," plan. To make this ").concat(e," private, please reach out to the team owner to upgrade your team.")},createLinkPrivacyMsgMember:function(e,t){return"All ".concat(e,"s are public on the ").concat(t," plan. If you would like to make ").concat(e,"s private, please contact the team owner to upgrade your account.")},passwordProtectionMsgNotOwner:function(e){return"Only the ".concat("channel"==e?"channel":"folio"," owner can set/remove the password. Get in touch with the owner of this ").concat("channel"==e?"channel":"folio"," to add a password.")},collabNotAvailableMsg:function(e,t){return"Collaboration is not available on the "+e+" plan. </br>Please upgrade to a "+t+" plan to add collaborators and access other premium features."},collabNotAvailableMsgMember:"Only admins can add/remove team members and guests. Please contact the admin for more access.",maxUsersMsgOwner:function(e,t,a){return"The "+e+" plan supports up to "+t+" users on the team. Please upgrade to the "+a+" plan to add more users."},maxUsersMsgAdmin:function(e,t){return"The "+e+" plan supports up to "+t+" users on the team. To add more users, please reach out to your team owner to upgrade."}},app.acl.helper=function(t){var e,i=app.acl,a=function(){var e;return(null===(e=t.Team)||void 0===e?void 0:e.Role)||!1},s=function(){return 1==a()},n=function(){return 4==a()},o=function(){return 5==a()},r=function(){return a()<=2},l=function(){return a()<=3},d=function(){return"plan_free"==i.data.planId},c=function(){var e=i.data.planDisplayName.replace(/monthly|yearly|grand|father|team member|premium guest/gi,"").trim();return""===e?i.data.planDisplayName:e},u=function(){return-1<i.data.planName.search(/month/gi)},m=function(){return-1<i.data.planName.search(/year/gi)},p={Pro:"Team",Team:"Agency",Agency:"Enterprise",Free:"Business",Basic:"Business",Plus:"Business",Edu:"Business"};return _defineProperty(e={minUsers:function(){return parseInt(i.data.minUsers)},maxUsers:function(){return parseInt(i.data.maxUsers)},maxFolios:function(){return parseInt(i.data.maxFolios)},newFolioAllowed:function(e){return e<i.data.maxFolios&&l()},imgUploadLimit:function(){return parseInt(i.data.maxUploadLimit)},maxFreeGuests:function(){return parseInt(i.data.freeUsers)},maxRetentionDays:function(){return i.data.maxRetentionDays},brandingRemoved:function(){return i.data.removeBranding},uploadCustomFontsAllowed:function(){return i.data.uploadCustomFonts},privateLinksAllowed:function(){return i.data.privacyControlsActive},downloadPdfAllowed:function(){return i.data.pdfDownloadActive},modCanSecDownloadAllowed:function(){return i.data.downloadModCanSecActive},planDisplayName:function(){return i.data.planDisplayName},planName:function(){return i.data.planName},collabActive:function(){return i.data.collabActive},legacyPlan:function(){return i.data.legacyPlan},uploadImgAllowed:function(e){return e<=i.data.maxUploadLimit},getBasePrice:function(){return i.data.priceCents},imgAboveLimit:function(e){return e/1048576>i.data.maxUploadLimit},styleGuideAllowed:function(){var e;return(null===(e=i.data)||void 0===e?void 0:e.styleguideActive)&&r()},styleGuidePreviewAllowed:function(){return r()},addUsersAllowed:function(){return i.data.collabActive&&r()}},"newFolioAllowed",function(e){return e<i.data.maxFolios&&l()}),_defineProperty(e,"styleGuideAllowed",function(){var e;return(null===(e=i.data)||void 0===e?void 0:e.styleguideActive)&&r()}),_defineProperty(e,"customLinksAllowed",function(){return i.data.curlActive&&l()}),_defineProperty(e,"passwordProtectionAllowed",function(){return i.data.passwordProtectionActive&&!o()&&!n()}),_defineProperty(e,"personalTemplatesAllowed",function(){return i.data.mytemplatesActive&&l()}),_defineProperty(e,"teamTemplatesAllowed",function(){return i.data.teamtemplatesActive&&l()}),_defineProperty(e,"statsAllowed",function(){return i.data.folioStatsActive&&l()}),_defineProperty(e,"transferFolioOutsideTeamAllowed",function(){return r()}),_defineProperty(e,"billingManagementAllowed",function(){return s()}),_defineProperty(e,"isFreePlan",d),_defineProperty(e,"isIndividualPlan",function(){return!d()&&!i.data.collabActive}),_defineProperty(e,"isBusinessPlan",function(){return!d()&&i.data.collabActive}),_defineProperty(e,"teamSettingsAllowedInMenu",function(){return r()}),_defineProperty(e,"getMainPlanName",c),_defineProperty(e,"getNextPlanToUpgrade",function(){return void 0===p[c()]?"Business":p[c()]}),_defineProperty(e,"isMonthlyPlan",u),_defineProperty(e,"isYearlyPlan",m),_defineProperty(e,"getMonthlyYearly",function(){return"Edu"==i.data.planName||d()?"":-1<i.data.planName.search(/year/gi)?"year":"month"}),_defineProperty(e,"getAddMemberPrice",function(){if(!i.data.legacyPlan)return i.data.extraSeatPriceCents;if("Pro"==c()){if(u())return 20;if(m())return 180}else if("Business"==c()){if(u())return 30;if(m())return 300}}),_defineProperty(e,"isAdmin",function(){return 2==a()}),_defineProperty(e,"isPremiumGuest",n),_defineProperty(e,"isTeamMember",function(){return 3==a()}),_defineProperty(e,"isFreeGuest",o),_defineProperty(e,"isOwner",s),_defineProperty(e,"isMemberOrLess",function(){return 2<a()}),_defineProperty(e,"imgErrorString",function(){var e=app.strings.popups,t=e.imgLimitMsgOwner,a=e.imgLimitMsgMember,n=d()?"premium":"business",o=i.data.maxUploadLimit;return s()?t(o,n):a(o)}),_defineProperty(e,"getPlanObjFromAllPlansAclData",function(e,t){var a=e.toString().toLowerCase();return t.find(function(e){return e.PlanName.toString().toLowerCase()===a})}),_defineProperty(e,"getRuleValueFromPlanObj",function(t,e){if(e.AclList){var a=e.AclList.find(function(e){return e.RuleName===t});return null==a?void 0:a.RuleValue}}),_defineProperty(e,"aclLock",function(e){var t=setInterval(function(){app.acl.data&&(clearInterval(t),e())},200)}),e},app.acl.update=function(e,t,a,n){var i=["minUsers","maxUsers","maxFolios","maxUploadLimit","maxRetentionDays","freeUsers"],o={success:function(e){console.log("getAclData response",e);var t=JSON.parse(e.Message),o={legacyPlan:t.LegacyPlan,planId:t.PlanId,planName:t.PlanName,planDisplayName:t.PlanDisplayName,extraSeatPriceCents:isNaN(parseInt(t.ExtraSeatPriceCents))?0:parseInt(t.ExtraSeatPriceCents)/100,priceCents:isNaN(parseInt(t.PriceCents))?0:parseInt(t.PriceCents)/100};t.AclList.forEach(function(e){var t,a=e.RuleName,n=(t=a,i.includes(t)?parseInt(e.RuleValue):!!parseInt(e.RuleValue));o[a]=n}),console.log("final acldata ",o),app.acl.data=_objectSpread({},o),n.raiseEvent("aclDataLoaded")},error:function(e){console.log("getAclData error",e)}};e.tryMode?t.getPlanAclListAnon(o):!0===e.pedit?t.getPlanAclListPEdit(o):t.getAclData(o)},$("body").addClass("folio-view"),app.common.main=function(e,t,a,n,o,i,s,r,l,d){var c=this;c.notification(e,t,a,n,i,s,o,r,d),c.menu(e,t,a,o,i,r,l,s,d,n),c.session(a,o),c.undrop(a),c.urlHash(e,o,d,n,a)},app.common.menu=function(o,n,i,s,e,r,t,a,l,d){var c=$('<div id="logo-bar" class="header-edit container-fluid"></div>'),u=$('<div id="top-bar"></div>'),m=o.isHome?"#tmp-dash-topbar":"#tmp-primary-bar",p=$(m),f=p.find(o.isHome?".menu-tile .inside":".menu-tile"),h=$("#tmp-user-menu"),g=$("#tmp-try-user-menu"),v=$("#tmp-user-menu .upgrade-btn, "+m+" .user-menu-popup .upgrade-btn");$setbut=h.find(".gear-button"),lockedTip=app.plugin.lockedTip(o,i),$userBar=p.find(".user-info"),topBarNavSelector="#top-bar .nav-setmenu",$templateSubnav=$($("#tmp-template-nav").html());var b=app.strings.general.lockedFeatureTip,T=!0,y=!0,C="",k="",w='<div class="new">New</div> ',x=' <i class="fa fa-lock" data-tip="'+b+'"></i> ',P=app.core.padlocks(l,lockedTip,o,i),S=$('<div class="tipped-icon teamtemplatestab-icon"><i class="fa fa-info-circle"></i></div>'),D=$('<div class="tipped-icon mytemplatestab-icon"><i class="fa fa-info-circle"></i></div>'),F=!1,I=app.acl.helper(o),M=$('<div id="app-load-animation" style="top: 0; left: 0; position: fixed;height: 100%;width: 100%;"><div class="loading-animation"></div></div>').hide();function E(){0==F&&0<$("#top-bar .template-subnav .tipped-icon").length&&(F=!0,app.plugin.tipped(o,n,d,!1,!0))}M.find(".loading-animation").html(s.spinner),$("body").append(M),u.append(c),$userBar.css("position","relative").append($("#tmp-user-menu-popup").html());function A(e){e.preventDefault(),l.getData(1,function(e,t,a,n){l.isFreeWithTeam()?s.universalBlocker():!0===l.isOldFreeUserNeverOnTrialOrPlan()?window.location.href="/teams/create":(1==e.ST||2==e.ST||9==e.ST||10==e.ST||11==e.ST||t||o.Team.Id,s.universalBlocker()),o.isTrial&&s.universalBlocker()},!0)}function U(){l.getData(1,function(e,t,a,n){(l.isFree()||l.isFreeWithTeam())&&l.isOwner()?(v.show(),p.find(".plus-menu").addClass("move-left")):(v.hide(),p.addClass("hide-upgrade-btn")),null!==e&&(e.Count||e.Referrals.length)&&$(topBarNavSelector+" li.item.billing").text("Billing"),(l.isFree()||l.isPlus()||l.isPro()||!I.isOwner())&&($(topBarNavSelector+" li.item.upgrade").hide(),$(topBarNavSelector+" li.item.billing").hide()),I.isFreePlan()&&I.isOwner()&&$(topBarNavSelector+" li.item.billing").show(),o.isTrial&&$(topBarNavSelector+" li.item.upgrade").show()},!0)}var N,L,O,R,B=function(){if(o.fullName)try{var e=o.fullName.toUpperCase().match(/\b\w/g);e=1<e.length?e.shift()+e.pop():e.shift(),$setbut.find(".initials").text(e)}catch(e){$setbut.find(".initials").text("")}};if(u.append($templateSubnav),setTimeout(function(){$("#tmp-my-labels-container .item:eq(0)").hide(),$("#all-temps-button").hide(),$("#team-temps-button").hide(),$("#my-temps-button").hide();var e=u.find(".template-subnav"),a=e.find(".nav-menu a");function t(e){var t=[];t["xtensio-temp"]="#all-temps-button",t["my-temp"]="#my-temps-button",t["team-temp"]="#team-temps-button",a.removeClass("active"),$("#tmp-temp-sidebar .sidebar > .item").removeClass("active"),$(t[e.attr("class")]).addClass("active"),e.addClass("active")}o.Team&&0===o.Team.Id&&(T=!1,l.isFree()&&(y=!1)),C=T?w+"Team Templates":w+x+"Team Templates",k=y?"My Templates":x+"My Templates",e.find(".team-temp").html(C).append(S),e.find(".my-temp").html(k).append(D),E(),app.plugin.tooltip(),e.find(".my-temp, .team-temp").click(function(e){e.preventDefault(),$(this).find("i.fa-lock").length?s.message({heading:"You Cannot Perform this Action",message:"Templates are only available on premium plans. Please upgrade or switch to your team dashboard.",btnText:"See Plans",cancelText:"Nevermind",enterAsOK:!0,notMini:!0,bodyCentered:!0,handleOK:function(){s.universalBlocker()}}):($(this).hasClass("team-temp")&&$("#team-temps-button").click(),$(this).hasClass("my-temp")&&$("#my-temps-button").click(),t($(this)))}),e.find(".xtensio-temp").click(function(e){e.preventDefault(),$("#all-temps-button").click(),t($(this))})},500),i.addListener("aclDataLoaded",function(){!function(){if(o.fullName)try{var e=o.fullName.toUpperCase().match(/\b\w/g);e=1<e.length?e.shift()+e.pop():e.shift(),$(topBarNavSelector).find(".initials span").text(e),$(topBarNavSelector).find(".fullname").text(o.fullName)}catch(e){console.log("error on userDetails",e),$usrmenu.find(".initials span").text("")}}();var e=d.isOnMultipleTeams(o,l);if(e||$(topBarNavSelector+" .li-sep.team-item").hide(),o.Team&&0==o.Team.Id&&$(topBarNavSelector+" .li-sep.team-menu").remove(),o.Team&&0<o.Team.Id)d.updateTeamsInMenu(o,l,P,I);else if(l.isPlus()||l.isPro()?$(topBarNavSelector).find(".user-role").text("Paid Account"):$(topBarNavSelector).find(".user-role").text("Free Account"),I.isPremiumGuest()||I.isTeamMember()?P.menu.teamLockedItems():P.menu.freeOldLockedItems(),o.UserTeams&&0<o.UserTeams.length){$(topBarNavSelector).find(".user-role").text("Free Account");for(var t=0;t<o.UserTeams.length;t++){var a=o.UserTeams[t];l.isTeamActive(a)&&(I.isOwner()||I.isAdmin())?($("#top-bar .nav-setmenu .li-sep.free-menu").remove(),e||$("#top-bar .user-menu-popup .li-sep.team-item.workspace").hide()):!l.isTeamActive(a)||I.isOwner()||I.isAdmin()||$(topBarNavSelector+" .li-sep.free-menu").remove()}}$(topBarNavSelector).on("click",".team-settings",function(){s.teamSettingPopup()}),$(topBarNavSelector+" .invite-people").click(function(){if(3===o.Team.Role){s.teamUserActionBlocked("invite-member","Team Members")}else s.teamManagePopup(!0)}),$(topBarNavSelector).on("click",".team-edit",function(){console.log(".team-edit manage team menu click "),s.teamManagePopup()}),$(topBarNavSelector).on("click",".style-guide",function(){s.styleGuidePopup()}),$(topBarNavSelector+" .import-folios").click(function(){s.importFolioPopup()}),$("#tmp-dash-topbar .nav-setmenu li.item.explore a").click(function(e){e.preventDefault(),$("#tmp-dash-topbar a.explore").trigger("click")}),U(),$(topBarNavSelector+" li.item.upgrade").click(A),$("#logo-bar .app-title").removeClass("hidden"),P.setMenuLocks()}),$(m).on("click",".upgrade-btn",A),i.addListener("plusUnlocked",function(){U()}),i.addListener("plusCancelled",function(){U()}),o.plusInfo&&o.plusInfo.End>Date.now()&&i.raiseEvent("plusUnlocked"),i.addListener("nameChanged",B),B(),function(){if(o.editMode||o.tryMode){l.getData(1,function(e,t,a,n){o.UserTeams&&0<o.UserTeams.length&&l.isTeamActive(o.Team)&&o.Team&&0!=o.Team.Id&&(l.hasTeam()||l.isTeamMember()||l.isSingleFolioGuest()||l.isPremiumGuest()||l.isOwner()||l.ownsATeam())&&!l.isFreeWithTeam()&&$(m+" .upgrade-btn").remove()},!0);var e=$('<div id="folio-bar" class="header-edit container-fluid"></div>'),t=r.FolioName;l.isTryMode()&&(t=t.replace(/template/gi,"")),console.log("setting folio name ",t);var a=p.find(".folio-name").val(t);u.append(e),1<r.Role&&a.on("blur",function(){var e=$.trim(a.val());2<e.length?($(".folio-name-error").fadeOut(500),o.tryMode?n.renameTempFolio({name:e}):n.renameFolio({name:e})):$(".folio-name-error").fadeIn(500)}),i.addListener("folioRename",function(e){r.Token==e.Token&&(r.FolioName=e.NewFolioName,a.val(e.NewFolioName))})}else p.find(".fa-angle-right").remove(),p.find(".folio-name").remove()}(),c.append(p),"preview"==$.trim(window.location.hash.substr(1))&&u.hide(),$("body").prepend(u),E(),p.find(".folio-name").scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",ellips:0,wrapperWidth:"274px",animBack:!0,minScrollWidth:272,wrap:!0,callback:function(){$("#tmp-collaborators").css({"margin-left":"300px"})}}),o.ShowGdprConsent&&app.dash.globalAlert(o,n),t.popupMenu("#tmp-user-menu .gear-button","#top-bar .user-menu-popup"),s.getUserMenu(o,s,i,l),function(){if(o.Team&&0!=o.Team.Id){var e=$("#logo-bar .app-title a"),t=e.find(".icon-Logo");if($("#tmp-dash-topbar .menu-tile .nav-main-menu a:eq(0)").contents().first().replaceWith("Folios"),o.Team.LogoUrl){var a=$("<img />").attr("src",o.Team.LogoUrl).addClass("team-logo-img");e.addClass("team-logo-wrap").append(a).css({textAlign:"center"}),t.remove()}else if(o.Team.Name&&"5"!=o.Team.Role){var n='style="color: #4c7ba0; font-weight: bold;"';45<o.Team.Name.length&&!0!==o.editMode?e.addClass("team-name-wrap").attr("title",o.Team.Name).append('<h4 class="multiLine-title" '+n+">"+function(e){for(var t=e.split(" "),a=t.length,n="<span>",o=!0,i=0,s=0;s<a;s++)25<=(i+=t[s].length)&&o?(n=(n+="</span><span>")+t[s]+" ",o=!1):n=n+t[s]+(s==a-1?"":" ");return n+="</span>"}(o.Team.Name)+"</h4>"):e.addClass("team-name-wrap").append("<h4 "+n+">"+o.Team.Name+"</h4>"),t.remove()}I.isFreeGuest()&&e.attr("href","#")}}(),o.Team&&0<o.Team.Id&&1==o.Team.Role&&"nadeem@fakecrow.com"==o.userEmail){$('<li class="item team-item add-mem" style="text-decoration: underline;">Add Member</li>').insertBefore(topBarNavSelector+" .li-sep.team-item"),$(topBarNavSelector+" .team-item.add-mem").click(function(){s.addTeamMember()})}if(o.Team&&o.Team&&0<o.Team.Id){L=$('<li class="item style-guide">Style Guide</li>'),O=$(topBarNavSelector+" .item.team-edit"),R=0<O.length,0!==(null===(N=o.Team)||void 0===N?void 0:N.Id)&&0==$("#top-bar .nav-setmenu .item.style-guide").length&&(R?$(L).insertAfter(O):$(L).insertBefore(topBarNavSelector+" .li-sep.team-menu"));$('<li class="item team-menu team-edit">Manage Team Members</li>').insertBefore("#top-bar .nav-setmenu .item.style-guide");$('<li class="item team-menu team-settings">Team Settings</li>').insertAfter("#top-bar .nav-setmenu .item.style-guide"),console.log("in menu",(new Date).getTime()),$("#top-bar .nav-setmenu .team-menu").show()}o.tryMode?(g.find(".signin-link").click(function(e){e.preventDefault(),d.toggleExitIntent(!1,o),window.location.href="/account/signin?tf="+o.token}),c.find(".icon-Logo").parent().css({pointerEvents:"none"}),f.append(g),g.find(".signup-link").click(function(e){e.preventDefault(),s.universalBlocker()}),f.removeClass("col-md-4 col-sm-3 col-xs-3").addClass("col-md-6 col-sm-5 col-xs-12"),p.find(".col-md-8").removeClass("col-md-8 col-xs-9").addClass("col-md-6 col-sm-7 col-xs-12")):f.append(h)},app.common.notification=function(T,y,C,k,e,t,w,r,x){var a,P,S,n,l=[],d=[],D=[],c=[],F=$("#notify-btn"),I=$("#n-panel"),M=$("#folio-items-container"),E=I.find(".contents"),A=I.find(".load-more"),o=I.find(".loading-notifs"),U=T.msgType,N=T.nType,L=($("#trans-folio-tile").html(),$("#plus-news").html()),O=$("#data-news").html(),R=$("#transfer-news").html(),B=$("#accept-news").html(),_=$("#reject-news").html(),G=$("#receive-news").html(),H=$("#decline-news").html(),Y=$("#plus-added-news").html(),j=$("#plus-started-news").html(),z=$("#billing-saved-news").html(),q=$("#card-updated-news").html(),V=$("#plus-cancel-news").html(),K=$("#delinquent-downgraded-news").html(),J=$("#plus-expire-news").html(),W=$("#added-to-team").html(),X=$("#team-owner-changed").html(),Z=$("#removed-from-team").html(),Q=$("#added-to-team-for-owner").html(),ee=$("#removed-from-team-for-owner").html(),te=$("#team-access-changed").html(),ae=($("#section-copy-moved").html(),$("#team-role-changed").html()),ne=$("#team-created").html(),oe=[],ie=null,se=99,re=!1,le=!1,u=$("#collaboration-news").html(),m=$("#collaboration-accept-news").html(),p=$("#collaboration-reject-news").html(),f=$("#collaboration-left-news").html(),h=$("#collaboration-receive-news").html(),g=$("#collaboration-decline-news").html(),v=$("#collaboration-removed-news").html(),b=$("#collaboration-archived-news").html(),de=$("#collaboration-reverted-news").html(),ce=$("#user-joined-channel").html(),ue=$("#user-joined-channel-self").html(),me=$("#joined-channel-for-owner").html(),pe=$("#joined-channel-for-TO").html(),fe=$("#user-left-channel").html(),he=$("#user-left-channel-self").html(),ge=$("#left-channel-for-owner").html(),ve=$("#left-channel-for-TO").html(),be=$("#folio-added-to-channel").html(),Te=$("#folio-added-for-owner").html(),ye=$("#folio-added-for-TO").html(),Ce=$("#folio-removed-from-channel").html(),ke=$("#folio-removed-for-owner").html(),we=$("#folio-removed-for-TO").html(),xe=$("#channel-created-for-owner").html(),$e=$("#channel-created-for-TO").html(),Pe=$("#channel-created-for-member").html(),Se=$("#channel-privacy-changed-teamvisible").html(),De=$("#channel-privacy-changed-private").html(),Fe=$("#channel-privacy-changed-private-owners").html(),Ie=$("#channel-deleted").html(),Me=$("#channel-deleted-for-owner").html(),Ee=$("#channel-deleted-for-TO").html(),Ae=app.acl.helper(T),i=app.core.padlocks(x,app.plugin.lockedTip(T,C),T,C);function Ue(e){if(Array.isArray(e)){var t=e.filter(function(e){return e.New&&e.Kind!=N.teamFirstTimeSignin}).length,a=$("#n-panel").find(".new").length,n=$("#n-panel").find(".item").length,o=a<t&&a==n?t:a;F.attr("data-original-title",0==o?"No new notifications":1==o?"1 new notification":o+" new notifications")}}function Ne(e){for(var t=k.standardizeEmail(e),a=0;a<r.Collaborators.length;a++)if(k.standardizeEmail(r.Collaborators[a].Email)===t&&0<r.Collaborators[a].Privilege&&1==r.Collaborators[a].Accepted)return!0;return!1}function Le(){n&&clearTimeout(n),n=setTimeout(function(){k.updateTeamsInMenu(T,x,i,Ae)},1e3)}function Oe(e){for(var t=!1,a=0;a<T.UserTeams.length;a++)e.Data.TeamID==T.UserTeams[a].Id&&(t=!0);if(!t){var n={Id:e.Data.TeamID,Name:e.Data.TeamName,LogoUrl:null,TeamUrl:e.Data.TeamURL,Status:1,Role:e.Data.Role};T.UserTeams.push(n)}Le()}function Re(e,t){for(var a=0;a<T.UserTeams.length;a++)if(T.UserTeams[a].Id==e){T.UserTeams.splice(a,1);break}$("#top-bar .nav-setmenu .team-item a[href*='"+t+"']").parent().remove(),Le()}function s(){A.addClass("hidden"),o.removeClass("hidden")}function Be(){A.removeClass("hidden"),o.addClass("hidden")}function _e(e,t){s(),t?y.loadNotifications({data:{userEmail:e,nextCount:t},success:function(){},error:function(e){Be()}}):Be()}function Ge(e){return function(){w.signupPerformance(e.Data.ModId)}}function He(e){t.send(U.bRead,{Arr:e})}function Ye(e,t,a,n,o,i){var s;console.log("in processTransfer func"),s={verb:e,secret:t,teamId:a},y.processTransfer({data:s,success:function(){n.parent().find(".yes, .no").remove(),"accept"===e?y.getFolioCollaborators({token:o,success:function(t){console.log("response collaborators",t),y.getWorkspaceChannels({teamId:a,success:function(e){console.log("response channels",e),T.saveFolioTransferWithTeam={FolioName:i,Token:o,collaborators:JSON.parse(t.Data),labels:JSON.parse(e.Data)},console.log("saveFolioTransferWithTeam",T.saveFolioTransferWithTeam),w.saveFolio()},error:function(e){console.log("error in getWorkspaceChannels",e)}})},error:function(e){console.log("error in getFolioCollaborators",e)}}):T.isHome&&(window.location="/")},error:function(e){5==e.StatusCode?w.plusPrompt("create",null,!0):10==e.StatusCode?w.plusPrompt("create",null,!1,!0):w.error(e.Message)}})}function je(e,t,a){t.verb=e,1==t.Data.AllowOutside?T.UserTeams&&0<T.UserTeams.length&&t.Data.UserDefinedTeam<0?w.transferFolioToSpace(t):T.UserTeams&&0<T.UserTeams.length&&-1<t.Data.UserDefinedTeam?T.Team&&T.Team.Id==t.Data.UserDefinedTeam&&w.transferFolioToSpace(t):t.Process&&T.isHome&&Ye(e,t.Key,0,a,t.Data.Token,t.Data.Folio):Ye(e,t.Key,t.Data.TeamID,a,t.Data.Token,t.Data.Folio)}function ze(e,t){console.log("getProcessTransferFunc request",e);var a=t.hasClass("yes")?"accept":"reject";console.log("$this",t),"accept"===a?x.checkFoliosLimitReached(y,w,function(){je(a,e,t)}):je(a,e,t)}function qe(t){y.processSFG({data:{id:t.Id},success:function(e){window.location="https://"+t.teamURL},error:function(e){1002!=e.StatusCode&&2!=e.StatusCode&&w.error(e.Message,"Error Accepting Folio")}})}function Ve(o){return function(){var t=$(this),n=t.hasClass("yes")?"accept":"reject";if("accept"!=n)return y.processCollaborator({data:{verb:n,id:o.Data.Id},success:function(){t.parent().find(".yes, .no").remove(),console.log("request",o);var e,a="https://"+o.Data.TeamURL;console.log("url",a),"accept"===n?y.getFolioCollaborators({token:o.Data.Token,success:function(t){console.log("response",t),y.getWorkspaceChannels({teamId:T.Team.Id,success:function(e){console.log("response channels",e),T.saveFolioCollabItem={FolioName:o.Data.Folio,Token:o.Data.Token,TeamID:o.Data.TeamID,TeamUrl:a,collaborators:JSON.parse(t.Data),labels:JSON.parse(e.Data)},console.log("saveFolioCollabItem",T.saveFolioCollabItem),w.saveFolio()},error:function(e){console.log("in error, getWorkspaceChannels",e)}})},error:function(e){console.log("in error, processCollaborator",e)}}):(e=o,T.isHome&&(e.Data.TeamID!=T.Team.Id?0<e.Data.TeamID?window.location="https://"+e.Data.TeamURL+"/edit/"+e.Data.Token:window.location=k.getAppUrl(T.Environment)+"/edit/"+e.Data.Token:window.location="/"))},error:function(e){5==e.StatusCode?w.plusPrompt("create",null,!0):10==e.StatusCode?w.plusPrompt("create",null,!1,!0):w.error(e.Message)}}),!1;window.location.href=window.location.protocol+"//"+o.Data.TeamURL+"#acceptcollab"}}function Ke(t,a){return function(){var e=a?"edit":"folio";0<t.Data.TeamID?window.open("https://"+t.Data.TeamURL+"/"+e+"/"+t.Data.Token):window.open(k.getAppUrl(T.Environment)+"/"+e+"/"+t.Data.Token)}}function Je(t){return function(){var e=t.indexOf("http")<0?"https://":"";window.location=e+t}}function We(){window.location="/"}function Xe(){w.billing(1)}function Ze(e,t,a,n){w.message({heading:e||"Folio Deleted",message:t||"This folio has been deleted by its owner. You can no longer view or edit it.",btnText:a||"Go To Dashboard",noClose:!0,enterAsOK:!0,handleOK:n||We})}function Qe(){w.billing()}function et(t){return Faltu(c).filter(function(e){return e.Data.Token&&e.Data.Token==t.Data.Token&&e.Kind==t.Kind&&e.Time>=t.Time&&e.Id!=t.Id}).get()}function tt(e){return r&&r.Token==e||!T.isHome?r:Faltu(T.folios).find({Token:e}).get()[0]}function at(e){var a,n,o;a=tt(e.Data.Token),n=e,a&&(clearTimeout(l[n.Kind]),l[n.Kind]=setTimeout(function(){0<et(n).length||$.each(a.Collaborators,function(e,t){(n.User||n.Data.Email)==t.Email&&(a.Collaborators[e].Accepted=!o,a.Collaborators[e].Privilege=n.Data.Privilege||n.Data.Role||0,C.raiseEvent("collabChange",a))})},1e3))}function nt(e){return 1<window.location.href.indexOf(e.Data.Token)}function ot(t){c.push(t);var e,a,n,o=T.nType;if(t.Data.Folio=t.Data.Folio||"Untitled",t.Kind==o.collaboratorRequest)return(e=$(u)).find(".name").text(t.Data.Name),e.find(".role").text(1===parseInt(t.Privilege)?"view":"edit"),e.find(".folio").text(t.Data.Folio),t.Process&&d.indexOf(t.Data.Id)<0?(d.push(t.Data.Id),e.on("click",".yes, .no",Ve(t))):e.find(".yes, .no").remove(),e;if(t.Kind!=o.collaboratorReceive&&t.Kind!=o.collaboratorChange)return t.Kind==o.collaboratorAccept?((e=$(m)).find(".name").text(t.Data.Name),e.find(".folio").text(t.Data.Folio),t.New&&at(t),e.addClass("notification-clickable").click(Ke(t,!0)),e):t.Kind==o.collaboratorDecline?((e=$(g)).find(".name").text(t.Data.Name),e.find(".folio").text(t.Data.Folio),e):t.Kind==o.collaboratorReject?((e=$(p)).find(".name").text(t.Data.Name),e.find(".folio").text(t.Data.Folio),e.addClass("notification-clickable").click(Ke(t,!0)),e):t.Kind==o.collaboratorRemoveHimself?(e=$(f),t.Data.Email==T.userName?e.html('You have left "<span class="bold folio">'+t.Data.Folio+'</span>".'):(e.find(".name").text(t.Data.Name),e.find(".folio").text(t.Data.Folio),e.addClass("notification-clickable").click(Ke(t,!0))),e):t.Kind==o.collaboratorRemove?((e=$(v)).find(".folio").text(t.Data.Folio),t.New&&P&&nt(t)&&Ze("Access Changed","You no longer have access to this folio.",null,function(){He([t.Id]),We()}),e):t.Kind==o.collaboratorRemoveToAllCollaborators?((e=$(f)).find(".name").text(t.Data.Name),e.find(".folio").text(t.Data.Folio),r=tt(t.Data.Token),e.addClass("notification-clickable").click(Ke(t,!0)),e):t.Kind==o.collaboratorAddedToAllCollaborators?((e=$(m)).find(".name").text(t.Data.Name),e.find(".folio").text(t.Data.Folio),e.addClass("notification-clickable").click(Ke(t,!0)),e):t.Kind==o.sendCollaboratorFolioArchived?((e=$(b)).find(".folio").text(t.Data.Folio),e):t.Kind==o.folioReverted?(e=$(de),t.Data.Email==T.userName?e.html('You have reverted to a different version of "<span class="bold folio">'+t.Data.Folio+'</span>".'):(e.find(".name").text(t.Data.Name),e.find(".folio").text(t.Data.Folio),clearTimeout(l[t.Kind]),l[t.Kind]=setTimeout(function(){var e=et(t);nt(t)&&t.New&&e.length<1&&t.Data.CurrentVersion&&r.CurrentVersion!==t.Data.CurrentVersion&&Ze("Folio Reverted",t.Data.Name+' has reverted to a different version of "'+t.Data.Folio+'".',"Refresh Page",function(){He([t.Id]),location.reload()})},1e3)),e.addClass("notification-clickable").click(Ke(t,!0)),e):void 0;e=$(h);var i=1===parseInt(t.Data.Role||t.Data.Privilege);if(t.New&&(a=t,n=1e3,Date.now()-a.Time<=(n||1e4))&&nt(t)){var s=1===t.Data.Role?"edit":"view";Ze("Access Changed","The owner of this folio has changed your access to ".concat(s,"."),"Reload Folio",function(){He([t.Id]),location.reload()})}return e.find(".role").text(i?"view-only access to":"access to edit"),e.find(".folio").text(t.Data.Folio),e.addClass("notification-clickable").click(Ke(t,!0)),e}I.find(".loading-notifs > .loading-animation").html(w.spinner),s(),$(function(){$('[data-toggle="tooltip"]').tooltip()});var it=[11,12,14,15,16,24,25,27,28,29,30,31,32,36,37],st=function(e){for(var t=0;t<oe.length;t++)oe[t].Data.Token==e&&1==oe[t].New&&it.indexOf(oe[t].type)&&(k.removeFromList(D,oe[t].Id),oe[t].New=!1)};function rt(a){if(T.Team.Id==a.Data.TeamID&&a.New)if(T.userEmail==a.Data.Email)app.popup.message({heading:"Access Revoked",message:"You have been removed from this team<br>If you think this was a mistake please contact the team owner.",btnText:"Close",noClose:!0,handleOK:function(){0===T.UserTeams.length?window.location=k.getAppUrl(T.Environment)+"teams/create":window.location=k.getAppUrl(T.Environment)}});else if(T.editMode)for(var e=0;e<r.Collaborators.length;e++)r.Collaborators[e].Email==a.Data.Email&&(r.Collaborators[e].Accepted=!1,r.Collaborators[e].Privilege=0,C.raiseEvent("collabChange",r));else T.folios&&$.each(T.folios,function(e,t){for(e=0;e<t.Collaborators.length;e++)t.Collaborators[e].Email==a.Data.Email&&(t.Collaborators[e].Accepted=!1,t.Collaborators[e].Privilege=0,C.raiseEvent("collabChange",t))})}function lt(e){for(var t=0;t<T.TeamRoles.length;t++)if(T.TeamRoles[t].Id==e)return T.TeamRoles[t].Name}function dt(e){var t=$("#all-labels-container .item").length;if(e.Data.Folios&&0<e.Data.Folios.length&&T.Team&&T.Team.Id==e.Data.TeamID&&T.isHome){for(var a=[],n=0,o=[],i={Name:e.Data.LabelName,Token:e.Data.LabelToken,FolioTokens:a,Private:!0,HasPass:!1,Indexed:!1,isLabel:!0,color:T.colors[t%T.colors.length]},s=0;s<e.Data.Folios.length;s++){for(var r=!1,l=0;l<T.folios.length;l++)T.folios[l].Token==e.Data.Folios[s].Token&&(r=!0);r||(n++,a.push(e.Data.Folios.Token),e.Data.Folios[s].Role=3,e.Data.Folios[s].Labels.push(i.Token),o.push(s))}if(0<n){T.labels.push(i),C.raiseEvent("addlabel",t);for(s=0;s<o.length;s++)C.raiseEvent("foliosRecieved",e.Data.Folios[o[s]],!0)}}}function ct(e){$("#all-labels-container [data-name='"+e+"']").click()}C.addListener("hubMsg",function(e,t){var a,n,o,i,s,r,l,d,c=[],u=dayjs(),m=t.Notifications&&t.Notifications.filter(function(e){return!e.Data.hasOwnProperty("Id")||null!=e.Data.Id})||t;if(Be(),S=t.TotalNotificationCount||null,ie=null==ie?t.Notifications.length:ie+(t.Notifications?10:1),0==m.length&&se<10&&0<ie?(se+=1,_e(T.userEmail,ie)):c=m,S&&S<=ie&&(A.remove(),Be(),I.find(".no-more-notifs").removeClass("hidden")),"",le=re=!1,e==U.bRead)for(f=0;f<c.Arr.length;f++)k.removeFromList(D,c.Arr[f]);else if(e==U.bell||e==U.loadMore){if(0<c.length)for(6<c.length&&I.find(".load-more").removeClass("hidden"),E.find(".empty").remove(),e==U.bell&&F.addClass("active"),Ue(c),f=0;f<c.length;f++)if(n=c[f],console.log("notification item",n),l=null,-1<it.indexOf(n.Kind)&&st(c[f].Data.Token),oe.push(c[f]),n.Kind!=N.transferFolioRequest||n.Process){switch(n.Data&&n.Data.Data&&(n.Data.Data=JSON.parse(n.Data.Data)),n.New&&n.Kind!=N.teamFirstTimeSignin&&D.push(n.Id),n.End>T.plusExpireTime&&(T.plusExpireTime=n.End),s=dayjs(n.Time),o=u.isSame(s,"day"),r=E.find('[data-time="'+s.format("YYYY-MM-DD")+'"]'),i=o?"Today":s.format("MMMM DD"),a=o?s.fromNow():s.format("hh:mm A"),o&&E.find(".block").each(function(){var e=$(this),t=e.data("tobj");t&&e.find(".date").text(t.format("MMMM DD"))}),r.length<1&&((r=$('<div class="block" data-time="'+s.format("YYYY-MM-DD")+'"><div class="date">'+i+"</div></div>")).data("tobj",s),null==S?E.prepend(r):E.append(r)),n.Kind){case N.teamFirstTimeSignin:if(n.New&&x.isOwner()&&T.folios&&1==T.folios.length){if(He([n.Id]),T.signUpFromFolio=!0,Ae.privateLinksAllowed()){var p={Private:!0,Indexed:!1,Token:T.folios[0].Token};y.updatePrivacy(p,{success:function(){T.folios[0].Private=!0,T.folios[0].Indexed=!1},error:function(){},complete:function(){}})}w.saveFolio()}He([n.Id]);break;case N.referralSignup:(l=$(L)).find(".name").text(n.Data.Name),l.addClass("notification-clickable").click(w.plusInfo);break;case N.transferFolioRequest:case N.transferFolioAccept:case N.transferFolioReject:case N.folioReceive:case N.folioDecline:n.Kind==N.transferFolioRequest?((l=$(R)).addClass("notificationItemToken-"+n.Data.Token),l.find(".yes, .no").click(function(){var e=$(this);ze(n,e)}),1==n.Data.AllowOutside?n.Process&&T.isHome&&C.raiseEvent("transferRequestArrived",n.Data):n.Data.TeamID==T.Team.Id&&C.raiseEvent("transferRequestArrived",n.Data)):n.Kind==N.transferFolioAccept?(l=$(B),P&&n.Owner!=T.userName&&!Ne(T.userName)&&(d=n.Data.Token,T.isHome&&M.find(".folio-item-shell[data-token='"+d+"']").remove(),0<window.location.href.indexOf(n.Data.Token)&&w.message({heading:"Folio Transferred",message:"This folio has been transferred. You no longer have access to edit.",btnText:"Return to Dashboard",noClose:1,handleOK:We})),n.New&&(He([n.Id]),-1==window.location.hash.search(/accepttransfer/)&&setTimeout(function(){We()},200))):l=n.Kind==N.transferFolioReject?$(_):n.Kind==N.folioReceive?$(G):$(H),l.find(".name").text(n.Data.Name),l.find(".folio").text(n.Data.Folio||"Untitled"),n.Data.Token||l.addClass("simple");break;case N.plusExpiring1Week:case N.plusExpiringToday:break;case N.subscribed:"DiscountYearly"==n.Data.Plan&&(n.Data.Plan="Pro"),"Month"==n.Data.Plan&&(n.Data.Plan="Pro"),"Year"==n.Data.Plan&&(n.Data.Plan="Pro"),"PlusMonth"==n.Data.Plan&&(n.Data.Plan="Plus"),"PlusYear"==n.Data.Plan&&(n.Data.Plan="Plus"),"BusinessYearly"==n.Data.Plan&&(n.Data.Plan="Business"),"ExportCredits"==n.Data.Plan?(n.Data.Plan="Export Credits",(l=$("<div class='item'>You have purchased 5 credits. <div class='links'><a href='#' class='textlink'>See billing for details</a></div></div>")).addClass("notification-clickable").click(Qe)):(l=$("<div class='item'>You've successfully upgraded to Xtensio "+n.Data.Plan+". <div class='links'><a target='_blank' href='#' class='textlink'>See Xtensio "+n.Data.Plan+" features</a></div></div>")).find("a").attr("href","https://xtensio.com/"+n.Data.Plan+"/");break;case N.plusStarted:(l=$(j)).addClass("notification-clickable").click(Qe);break;case N.billingSaved:(l=$(z)).addClass("notification-clickable").click(Xe);break;case N.cardUpdate:(l=$(q)).addClass("notification-clickable").click(Xe);break;case N.planChange:"DiscountYearly"==n.Data.Plan&&(n.Data.Plan="DiscountYear"),"Month"==n.Data.Plan&&(n.Data.Plan="ProMonth"),"Year"==n.Data.Plan&&(n.Data.Plan="ProYear"),(l=$('<div class="item">You switched to '+n.Data.Plan+" plan.</div>")).addClass("notification-clickable").click(Qe);break;case N.planCancel:(l=$(V)).find(".cancel-end-date").text(dayjs(n.Data.Expire).format("MMMM Do, YYYY")),l.addClass("notification-clickable").click(Qe);break;case N.delinquentUserDowngraded:(l=$(K)).addClass("notification-clickable").click(Qe);break;case N.plusExpire:l=$(J),10==n.Data.PlanName||11==n.Data.PlanName?l.find("pname").text("Plus"):l.find("pname").text("Pro"),l.addClass("notification-clickable").click(Qe);break;case N.plusTimeAdded:(l=$(Y)).find(".via").text(n.Data.Via),l.addClass("notification-clickable").click(w.plusInfo);break;case N.dataCollectionSignup:l=$(O),n.Folio=(n.Folio||"Untitled")+".",40<n.Folio.length&&(n.Folio=n.Folio.substr(n.Folio,37)+" ..."),n.Data.Count&&1<n.Data.Count&&l.find(".count").text(n.Data.Count+" form responses"),l.find(".folio").text(n.Folio),l.addClass("notification-clickable").click(Ge(n)),P&&C.raiseEvent("newSignUp",n);break;case N.collaboratorAccept:case N.collaboratorDecline:case N.collaboratorReceive:n.Kind==N.collaboratorReceive&&0!=n.Data.TeamID&&I.find(".item.sfg-accept").each(function(){$this=$(this);$this.data("team");c.teamId==n.Data.TeamID&&$this.find(".yes, .no, br").remove()});case N.collaboratorReject:l=ot(n);break;case N.collaboratorRequest:(l=ot(n)).attr("data-token",n.Data.Token);break;case N.collaboratorChange:case N.collaboratorRemove:l=ot(n);break;case N.folioReverted:case N.collaboratorRemoveHimself:case N.sendCollaboratorFolioArchived:case N.collaboratorRemoveToAllCollaborators:case N.collaboratorAddedToAllCollaborators:case N.folioUpgraded:l=ot(n);break;case N.teamMemberAdded:l=1==n.Data.Role?$(X):$(W),1==n.Data.Role?l.find(".user").text("You").removeClass("bold"):T.userEmail==n.Data.Email?(l.find(".user").text("You have").removeClass("bold"),l.addClass("notification-clickable").click(Je(n.Data.TeamURL))):T.userEmail!=n.Data.Email&&(l.find(".user").text((n.Data.Name||n.Data.Email)+" has"),l.addClass("notification-clickable").click(Je(n.Data.TeamURL))),l.find(".role").text(lt(n.Data.Role)),l.find(".team").text(n.Data.TeamName),l.find("a").attr("href","https://"+n.Data.TeamURL),T.Team&&T.Team.Id==n.Data.TeamID&&l.find(".links").remove(),l.attr("data-teamaddid",n.Data.TeamID),5==n.Data.Role&&(l.addClass("sfg-accept"),l.find("a").text("Accept"),l.find("a").data("team",{teamURL:n.Data.TeamURL,Id:n.Data.Id,teamId:n.Data.TeamID,notifId:n.Id}),n.New?l.find("a").on("click",function(e){e.preventDefault();var t=$(this).data("team");return He([t.notifId]),qe(t),$(this).parent().find(".yes, .no, br").remove(),!1}):(l.find(".yes, .no, br").remove(),l.addClass("notification-clickable").click(Je(n.Data.TeamURL))),T.Team&&T.Team.Id==n.Data.TeamID&&n.New&&(He([n.Id]),qe({teamURL:n.Data.TeamURL,Id:n.Data.Id,teamId:n.Data.TeamID}),l.find(".yes, .no, br").remove(),l.addClass("notification-clickable").click(Je(n.Data.TeamURL)))),T.Team.Id!=n.Data.TeamID&&P&&Oe(n),re=!0;break;case N.teamMemberAddedToTO:l=$(W),1==n.Data.Role?l.find(".user").text("You").removeClass("bold"):T.userEmail==n.Data.Email?l.find(".user").text("You have").removeClass("bold"):T.userEmail!=n.Data.Email&&l.find(".user").text((n.Data.Name||n.Data.Email)+" has"),l.find(".role").text(lt(n.Data.Role)),l.find(".team").text(n.Data.TeamName),l.find("a").attr("href","https://"+n.Data.TeamURL),T.Team&&T.Team.Id==n.Data.TeamID&&l.find(".links").remove(),l.attr("data-teamaddid",n.Data.TeamID),re=!0;break;case N.teamMemberRemoved:(l=$(Z)).find(".team").text(n.Data.TeamName),1==n.Data.Role?l.find(".user").text("You").removeClass("bold"):T.userEmail==n.Data.Email?l.find(".user").text("You have").removeClass("bold"):T.userEmail!=n.Data.Email&&l.find(".user").text((n.Data.Name||n.Data.Email)+" has"),T.userEmail==n.Data.Email&&P&&(r.find('.item[data-teamaddid="'+n.Data.TeamID+'"]').find(".links").remove(),Re(n.Data.TeamID,n.Data.TeamURL)),P&&rt(n),re=!0;break;case N.teamMemberRemovedToTO:T.userEmail==n.Data.Email&&n.New&&(r.find('.item[data-teamaddid="'+n.Data.TeamID+'"]').find(".links").remove(),Re(n.Data.TeamID,n.Data.TeamURL)),(l=$(Z)).find(".team").text(n.Data.TeamName),1==n.Data.Role?l.find(".user").text("You").removeClass("bold"):T.userEmail==n.Data.Email?l.find(".user").text("You have").removeClass("bold"):T.userEmail!=n.Data.Email&&l.find(".user").text((n.Data.Name||n.Data.Email)+" has"),n.New&&(He([n.Id]),rt(n)),re=!0;break;case N.folioRecievedToTO:dt(n);break;case N.teamMemberAddedToTO:(l=$(Q)).find(".team").text(n.Data.TeamName),l.find(".user").text(n.Data.Name);break;case N.teamMemberRemovedToTO:(l=$(ee)).find(".team").text(n.Data.TeamName),l.find(".user").text(n.Data.Name),re=!0;break;case N.teamMemberAccessChanged:n.New&&(x.updateConfig(n),$("#top-bar .nav-setmenu").find(".user-role").text(lt(n.Data.Role)),Le(),C.raiseEvent("userTeamRoleChanged",n),He([n.Id])),(l=$(te)).find(".team").text(n.Data.TeamName),l.find(".role").text(lt(n.Data.Role));break;case N.copyMoveSectionToFolio:T.editMode&&T.token==n.Data.Token&&app.popup.message({heading:"Section Added",message:"A section from another folio has been copied or moved to this folio. Please reload to get the latest changes.",btnText:"Reload",noClose:!0,handleOK:function(){permDisc=!0,window.location.reload()}}),n.New&&He([n.Id]);break;case N.teamMemberAccessChanged:case N.teamMemberAccessChangedToTO:l=$(ae),T.userEmail==n.Data.Email?l.find(".user").text("Your").removeClass("bold"):l.find(".user").text((n.Data.Name||n.Data.Email)+"'s"),l.find(".role").text(lt(n.Data.Role)),l.find(".team").text(n.Data.TeamName),l.find("a").attr("href","https://"+n.Data.TeamURL),T.Team&&T.Team.Id==n.Data.TeamID&&l.find(".links").remove(),T.userEmail==n.Data.Email&&T.Team.Id==n.Data.TeamID&&n.New&&(He([n.Id]),app.popup.message({heading:"Team Access Changed",message:"Your Access to team has been updated. Please reload.",btnText:"Reload",noClose:!0,handleOK:function(){window.location.reload()}})),re=!0;break;case N.transferredFolios:if(0==T.Team.Id)for(var f=0;f<n.Data.Folios.length;f++){var h=$('#folio-items-container .folio-item-shell[data-token="'+n.Data.Folios[f].Token+'"]');h.animate({width:0,opacity:0,padding:0},500,"linear",function(){h.remove()})}else if(T.Team.Id==n.Data.TeamID)for(f=0;f<n.Data.Folios.length;f++)C.raiseEvent("foliosRecieved",n.Data.Folios[f],!0);n.New&&He([n.Id]);break;case N.addedFromEditTemplate:n.New&&(w.addFolioToSpace(n.Data.FToken,""),He([n.Id]));break;case N.teamPurchased:(l=$(ne)).find(".team").text(n.Data.TeamName),l.addClass("notification-clickable").click(Je(n.Data.TeamURL)),T.Team&&T.Team.Id==n.Data.TeamID&&l.find(".links").remove(),n.New&&He([n.Id]);break;case N.channelCreated:(l=$(Pe)).find(".owner").text(n.Data.ChannelOwner.FullName),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){ct(n.Data.LabelToken)});break;case N.channelCreatedOwner:(l=$(xe)).find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){ct(n.Data.LabelToken)});break;case N.channelCreatedTO:(l=$($e)).find(".owner").text(n.Data.ChannelOwner.FullName),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){ct(n.Data.LabelToken)});break;case N.channelDeletedTO:(l=$(Ee)).find(".channel").text(n.Data.LabelName);break;case N.channelDeletedOwner:(l=$(Me)).find(".channel").text(n.Data.LabelName);break;case N.channelDeleted:(l=$(Ie)).find(".channel").text(n.Data.LabelName);break;case N.userJoinedChannel:l=$(ce);var g=T.userEmail===n.Data.Email?"You have been":n.Data.FullName;l.find(".user").text(g),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){ct(n.Data.LabelToken)});break;case N.userJoinedChannelSelf:(l=$(ue)).find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){ct(n.Data.LabelToken)});break;case N.userJoinedChannelOwner:l=$(me);g=void 0===n.Data.User?"User(s)":n.Data.User;l.find(".user").text(g),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){ct(n.Data.LabelToken)});break;case N.userJoinedChannelTO:l=$(pe);g=void 0===n.Data.User?"User(s)":n.Data.User;l.find(".user").text(g),l.find(".channel").text(n.Data.LabelName);break;case N.userLeftChannel:l=$(fe);g=T.userEmail===n.Data.Email?"You have been":n.Data.FullName;l.find(".user").text(g),l.find(".channel").text(n.Data.LabelName);break;case N.userLeftChannelSelf:(l=$(he)).find(".channel").text(n.Data.LabelName);break;case N.userLeftChannelOwner:l=$(ge);g=void 0===n.Data.User?"User(s)":n.Data.User;l.find(".user").text(g),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){ct(n.Data.LabelToken)});break;case N.userLeftChannelTO:l=$(ve);g=void 0===n.Data.User?"User(s)":n.Data.User;l.find(".user").text(g),l.find(".channel").text(n.Data.LabelName);break;case N.folioAddedToChannel:(l=$(be)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(Ke(n,!0));break;case N.folioAddedToChannelOwner:(l=$(Te)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(Ke(n,!0));break;case N.folioAddedToChannelTO:(l=$(ye)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName);break;case N.folioRemovedFromChannel:(l=$(Ce)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName);break;case N.folioRemovedFromChannelOwner:(l=$(ke)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName);break;case N.folioRemovedFromChannelTO:(l=$(we)).find(".folio").text(n.Data.FolioData.Name),l.find(".channel").text(n.Data.LabelName);break;case N.channelPrivacyChangedTeamVisible:(l=$(Se)).find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){ct(n.Data.LabelToken)});break;case N.channelPrivacyChangedPrivate:(l=$(De)).find(".channel").text(n.Data.LabelName);break;case N.channelPrivacyChangedPrivateOwners:(l=$(Fe)).find(".channel").text(n.Data.LabelName),l.addClass("notification-clickable").click(function(){ct(n.Data.LabelToken)});break;case N.subscriptionUpgrade:break;case N.upgradeToPaidPlan:"DiscountYearly"==n.Data.Plan&&(n.Data.Plan="DiscountYear"),"Month"==n.Data.Plan&&(n.Data.Plan="ProMonth"),"Year"==n.Data.Plan&&(n.Data.Plan="ProYear"),(l=$("<div class='item'>You've successfully started your "+n.Data.Plan+" subscription. <div class='links'><a href='#' class='textlink'>View plan details and invoices</a></div></div>")).addClass("notification-clickable").click(Qe);break;case N.teamTemplateCreated:case N.teamTemplateRemoved:var v=89===n.Kind?n.Data.Name+" has created a new team template: <b>"+n.Data.FolioName+"</b>":n.Data.Name+" has deleted the team template: <b>"+n.Data.FolioName+"</b>",b="<a href='"+("https://"+n.Data.TeamURL+"#teamtemplates")+"' class='link yes'>Go to "+n.Data.TeamName+" Templates</a>";l=$("<div class='item'>"+v+"<div class='links' style='margin-top: 10px'>"+b+"</div></div>"),n.New&&(C.raiseEvent("teamTemplateUpdate",{item:n,refreshType:"teamTemplateUpdate"}),He([n.Id]),le=!0);break;case N.manualPlanUpgrade:"DiscountYearly"==n.Data.Plan&&(n.Data.Plan="DiscountYear"),"Month"==n.Data.Plan&&(n.Data.Plan="ProMonth"),"Year"==n.Data.Plan&&(n.Data.Plan="ProYear"),(l=$("<div class='item'>Your plan has been updated to "+n.Data.Plan+".</div>")).addClass("notification-clickable").click(Qe)}l&&(-1<l.html().search(/undefined/g)&&(l.removeClass("notification-clickable").find("a").remove(),l.html(l.html().replace(/undefined|\:/g,""))),l.toggleClass("new",n.New),l.find(".time").text(a),l.wrapInner("<span data-id='"+n.Id+"' class='notification_wrap'></span>"),null==S?l.insertAfter(r.find(".date")):r.append(l))}P=1,function(){for(var e=E.find(".block"),t=[],a=0;a<e.length;a++)0==$(e[a]).find(".item").length&&t.push($(e[a]));t.forEach(function(e){e.remove()})}()}void 0===c.Arr&&F.toggleClass("active",0<D.length),Ue(c),re&&le&&setTimeout(function(){F.addClass("active"),Ue(c)},300)}),F.add(I.find(".close-btn")).click(function(){return a?(I.find(".new").removeClass("new"),F.tooltip("hide").attr("data-original-title","No new notifications")):(F.removeClass("active"),0<D.length&&(He(D),F.tooltip("hide").attr("data-original-title","No new notifications"))),a=!a,I.toggle(),!1}),A.click(function(){return se=0,_e(T.userEmail,ie),!1}),C.addListener("docClick",function(e){a&&I.find(".close-btn").click()}),w.failedPaymentAddUser()},app.common.session=function(e,t){e.addListener("loggedOut",function(e){t.message({heading:"Signin Required",message:"Session expired. Please sign in again.",btnText:"Sign In",noClose:!0,handleOK:function(){t.signIn(!0,function(){t.close(),e()})}})})},app.common.undrop=function(e){e.addListener("docClick",function(t){$(".top-comp").removeClass("top-comp"),$(".drop-down-container").each(function(){var e=$(this);0===e.closest(".keep-open").length&&0===e.has(t.target).length&&(e.find(".drop-down").slideUp(150),e.find(".drop-down-open").removeClass("drop-down-open"),e.removeClass("showing"))}),$(".two-state-container.editing").each(function(){var e=$(this);0===e.has(t.target).length&&e.removeClass("editing")}),$(".edit-content.active").each(function(){var e=$(this);0===e.has(t.target).length&&e.removeClass("active")}),$(".gear-drop-down").each(function(){var e=$(this);0!==e.has(t.target).length||e.is(t.target)||e.find(".drop-down").slideUp(150)})})},app.common.urlHash=function(r,l,d,c,u){function t(){var e=$.trim(window.location.hash.substr(1).toLowerCase());if("styleguide"==e)u.addListener("aclDataLoaded",function(){l.styleGuidePopup()});else if("invitepeople"==e)l.teamManagePopup();else if("managepeople"==e)u.addListener("aclDataLoaded",function(){l.teamManagePopup()});else if("teamsettings"==e)d.isAdmin()||d.isOwner()?l.teamSettingPopup():window.location="/";else if("managecolors"==e)u.addListener("aclDataLoaded",function(){l.styleGuidePopup()}),setTimeout(function(){$("#tmp-style-guide .popup-header .tabs span:eq(1)").trigger("click")},1e3);else if("billing"==e)d.isOwner()&&l.billing();else if("signup-plans"===e)l.signupPlansPopup();else if("compareplans"===e||"seeplans"===e)d.isAdmin()||d.isTeamMember()||d.isPremiumGuest()||d.isSingleFolioGuest()?window.location="/":l.universalBlocker();else if("plus"==e)l.plusInfo();else if("manage-notifications"==e)l.emailSettings();else if(0<=e.indexOf("res-"))e=e.replace("res-",""),l.signupPerformance(e);else if("active"==e)app.dash.changeView(0);else if("shared"==e)app.dash.changeView(1);else if("archived"==e)app.dash.changeView(2);else if("mytemplates"===e)setTimeout(function(){$("#tmp-dash-topbar .nav-main-menu .template").trigger("click"),setTimeout(function(){$("#top-bar").find(".my-temp").trigger("click")},100)},2e3);else if("teamtemplates"===e)setTimeout(function(){$("#tmp-dash-topbar .nav-main-menu .template").trigger("click"),setTimeout(function(){$("#top-bar").find(".team-temp").trigger("click")},100)},2e3);else if(_.startsWith(e,"xtensiotemplates"))setTimeout(function(){var t=setInterval(function(){if($("#tmp-dash-topbar .nav-main-menu .template").length){clearInterval(t),$("#tmp-dash-topbar .nav-main-menu .template").trigger("click");var e=setInterval(function(){$("#top-bar").find(".xtensio-temp").length&&(clearInterval(e),$("#top-bar").find(".xtensio-temp").trigger("click"))},50)}},50)},2e3);else if("examples"===e)setTimeout(function(){$("#tmp-dash-topbar .nav-main-menu .examples-link").trigger("click")},2e3);else if("use-template"===e)try{var t=c.getUrlVars();""!==(a=t.token?t.token:"")&&r.dashboardMode&&(console.log("--- params ---",a),setTimeout(function(){d.processTemplateCopy(a,l,!1)},2e3))}catch(e){console.log("=== use-template error === ",e)}else if(-1!==e.indexOf("unarchive")){var a=e.replace("unarchive-","");console.log("token",a),u.addListener("aclDataLoaded",function(){l.unarchive(a,function(){window.location.href="/"})})}else if(-1!==e.indexOf("checkout")){var n=e.replace("checkout-","").split("-"),o=n[0],i=n[1];if(console.log("plan",o),console.log("duration",i),r.checkoutMode){var s=$(".checkout-loader-container");setTimeout(function(){l.close(),l.universalBlocker({plan:o,duration:i},!0),setTimeout(function(){clearTimeout(r.checkLoadTimeout),$("#app-load-animation").hide(),s.hide()},3e3)},3e3)}else r.userEmail&&l.universalBlocker({plan:o,duration:i},!1)}r.pendingFolioFromSignup&&""!==r.pendingFolioFromSignup&&r.dashboardMode&&(app.acl.data?d.processTemplateCopy(r.pendingFolioFromSignup,l,!1):u.addListener("aclDataLoaded",function(){d.processTemplateCopy(r.pendingFolioFromSignup,l,!1)}))}window.onpopstate=function(){var e=document.location.href;-1<(e=e.toLowerCase()).indexOf("account/teamsignup")?l.signUp():-1<e.indexOf("account/signup")?l.signUp():-1<e.indexOf("account/signin")?l.signIn():-1<e.indexOf("teams/create")?l.signUpTeam():-1<e.indexOf("#")&&t()},t(),r.tryMode&&r.ShowWelcome&&setTimeout(function(){l.close(),l.tryWelcome()},1e3)},app.menu.bgPanel=function(e,a){e.apiHelper,e.eventManager;var n,o,i,t=$("#tmp-change-bg-panel").html(),s=$("<div>"),r=$(t),l=r.find(".gallery-container"),d=r.find(".img-btn"),c=r.find(".gallery-btn"),u=r.find(".color-btn"),m=r.find(".color-buttons"),p=r.find(".reset-btn"),f=r.find(".adjust-btn"),h=r.find(".adjust-btn + .sep");return d.uploader({type:"bg",success:function(e){a.add(e)},imageLoaded:function(e){}}),u.on("click",function(){a.$node.hide(),n.$node.toggle()}),c.on("click",function(){n.$node.hide(),a.$node.toggle()}),p.on("click",function(){o()}),f.on("click",function(){i()}),{$node:r,detach:function(){r.hide(),$("body").append(r)},setCallback:a.setCallback,mount:function(e,t){"none"!==e.parent().css("backgroundImage")?(f.show(),h.show()):(f.hide(),h.hide()),t.bgUrl,o=t.reset,n=t.colorPanel,i=t.adjustBgFn,s.append(m.find("> div")),m.append(n.$node),a.mount(l,t),e.append(r),n.$node.hide(),a.$node.hide(),r.hide()}}},app.menu.getColorPanelFunc=function(h,g){var a=$("#tmp-color-buttons").html(),v=["#66d7c4","#ffd271","#fd9f4d","#f67157","#e95f5e","#ffffff","#dcbb9f","#76d5e5","#6486a5","#2e5668","#d45d77","#9d557c","#7e8589","#000000","#052b3e"];function e(e){var a=[];return e.forEach(function(e,t){a.push(e.HexCode.toString().toLowerCase())}),a}return console.log("config",h),h.Team&&0!==h.Team.Id&&void 0!==h.StyleGuides?v=e(h.StyleGuides[0].TeamColors):void 0!==h.DefaultColors&&(v=e(h.DefaultColors)),function(d,c){var u=$(a),m=u.find(".text-box"),p=u.find(".sample"),e=u.find(".btn"),f=u.find(".color-list");$.each(v,function(e,t){var a=$('<div class="color-btn col-sm-3 col-xs-3"><i class="icon-CheckMark"></i></div>').css("background-color",t).data("color",t).addClass(t==d?"selected":"");f.append(a)});var t=function(e){var t=m.val(),a=null,n=u.parent().hasClass("module-buttons")?"scheme":"bg",o=u.closest(".module-container").attr("id");if(void 0===o){var i=u.closest(".section-settings").index();o="edit-sections .section-settings:nth-child(".concat(i+1,")")}-1===(t=t.toString().trim().toLowerCase()).indexOf("#")&&(t="#"+t),m.val(t);var s=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t);if(m.toggleClass("error",!s),s&&d!=t){if(p.css("background-color",t),-1!==v.indexOf(t)){var r=g.utility.hex2Rgb?g.utility.hex2Rgb(t):null;r=r.r?"rgb(".concat(r.r,", ").concat(r.g,", ").concat(r.b,")"):null;var l=f.find(".color-btn").filter(function(){var e=$(this).css("background-color");return e===t||e===r});l&&(l.addClass("selected"),a=l.index()),f.find('[data-color="'.concat(t,'"]')).addClass("selected")}else f.find(".color-btn").removeClass("selected");g.eventManager.raiseEvent("sendUpdateColorPalette",{token:h.token,hex:t,data:{elm:o,pickerType:n,listMatch:a}}),e&&(c(t),u.hide(),d=t)}};return f.on("click",".color-btn",function(){var e=$(this);$(".color-btn.selected").removeClass("selected"),e.addClass("selected"),m.val(e.data("color")),c(e.data("color")),t()}),u.find(".sample").colorPicker({opacity:!1,doRender:!0,forceAlpha:!1,positionCallback:function(e){var t=this.$UI;return e.hasClass("btn-picker")?t.appendTo("#picker-container"):t.appendTo(e.parent().find(".picker-container")),{left:0,top:0}},renderCallback:function(e,t){var a=e.parent().find("input[type=text]");!0!==t&&a.val("#"+this.color.colors.HEX)}}),m.on("change",function(){t()}),e.on("click",function(){t(!0)}),m.val(d),p.css("background-color",d),{$node:u}}},app.menu.getColumnPicker=function(){var e=["One","Two","Three","Four","Five","Six"];return function(o,t){var i=$('<div class="column-picker child drop-down">');return $.each(e,function(e,t){var a=e+1,n=$('<div class="btn num-btn settings-btn" data-num="'+a+'"><span>'+t+"</span></div>").addClass(a==o?"selected":"");i.append(n)}),i.on("click",".num-btn",function(){var e=$(this);i.find(".selected").removeClass("selected"),e.addClass("selected"),t(e.data("num"))}),{$node:i}}},app.menu.getFolioButtonsFunc=function(e,t,a,n){var o=t.appHub,i=$("#tmp-secondary-bar").find(".nav-settings");var s=a(e.Modules[0].Data.Theme,function(t){e.Modules.forEach(function(e){e.applyStyle&&(n.clearHeaderColors(e),e.applyStyle(t),e.editObj&&e.editObj.applyStyle&&e.editObj.applyStyle(t,!0)),e.Data.Theme=t,o.sync(e,"Theme",t)})}),r=$("#tmp-secondary-bar").find(".folio-color-scheme");i.append(s.$node),r.on("click",function(e){s.$node.toggle()}),i.find(".theme-picker .color-picker .sample").colorPicker({opacity:!1,doRender:!0,forceAlpha:!1,positionCallback:function(e){var t=this.$UI;return e.hasClass("btn-picker")?t.appendTo("#picker-container"):t.appendTo(e.parent().find(".picker-container")),{left:0,top:0}},renderCallback:function(e,t){var a=e.parent().find("input[type=text]");!0!==t&&a.val("#"+this.color.colors.HEX)}})},app.menu.gallery=function(e,t,a){var o,s,r=e.imageLibrary,n=a.apiHelper,l=a.utility,i=a.appHub,d=$('<div class="cover-image-preview"></div>'),c=l.obtain(t.Modules,"Type","DataModule"),u=t.UserBgImages||[],m=[];function p(e){return-1<m.indexOf(e.Id)||e.isLibraryItem}function f(e,t){var a=t&&t.length?t:d.find("[data-id='"+e+"']");d.find(".cover-image-thumb").each(function(){var e=$(this),t=l.obtain(r,"Id",e.data("id"));e.removeClass("selected used"),p(t)&&e.addClass("used")}),a.addClass("used selected")}0<r.length&&r.unshift(r.pop()),$.each(r,function(e,t){t.isLibraryItem=!0}),r=u.concat(r);var h=function(t,e){var a=$('<div class="cover-image-thumb" data-id="'+t.Id+'"><span class="fi-x close-btn"></span><img src="'+t.ThumbUrl+'"/></div>');p(t)&&a.addClass("used"),e?d.prepend(a):d.append(a),a.on("click",function(e){a.hasClass("selected")||$(e.target).hasClass("close-btn")||(o&&o(t.ImageUrl),f(null,a))}),e&&a.click()};function g(a){var n=d.find("[data-id="+a+"]");$.each(r,function(e,t){if(t.Id==a)return p(t)||(n.remove(),r.splice(e,1)),!1})}d.on("click",".close-btn",function(){var e=$(this).closest(".cover-image-thumb").data("id");n.deleteImage(e,function(){g(e)},function(){}),i.sync(c,"ImageRemove",e)});var v=function(e){d.find('[data-id="'+e.Id+'"]').toggleClass("used",p(e))},b=!0;function T(e){r.unshift(e),h(e,!0),v(e)}return i.reg(c,"ImageAdd",function(e,t){T(t)}),i.reg(c,"ImageRemove",function(e,t){g(t)}),{$node:d,add:function(e){var t={Id:e.Data,ThumbUrl:e.Message,ImageUrl:e.Message};T(t),i.sync(c,"ImageAdd",t)},mount:function(e,t){if(b){for(var a=0;a<r.length;a++)d.find("[data-id='"+r[a].Id+"']").length<1&&h(r[a]);b=!1}var n=l.obtain(r,"ImageUrl",t.url);o=t.bgUrl,d.find(".selected").removeClass("selected"),n&&f(n.Id),e.append(d)},setCallback:function(e){o=e},changeImage:function(e,t){e=e!=t?e:s;var a,n,o,i=l.obtain(r,"ImageUrl",e);i&&(a=i.Id,-1<(n=m.indexOf(a))&&m.splice(n,1),v(i)),(i=l.obtain(r,"ImageUrl",t))&&(o=i.Id,m.push(o),f(i.Id),v(i)),s=t}}},app.menu.main=function(e,t,a,n){console.log(e);var o=app.menu,i=o.getColorPanelFunc(e,a),s=o.getColumnPicker(),r=o.getVertGraphType(),l=o.getTaskListModSettings(),d=o.gallery(e,t,a),c=o.bgPanel(a,d),u=o.getModButtonsFunc(t,a,n,i,c,s,r,l,e,a.utility),m=o.getSectionButtonsFunc(a,i,c,n,app,e,a.apiHelper,a.utility,a.plusHelper,t);return o.getFolioButtonsFunc(t,a,i,a.utility),{changeImage:d.changeImage,setCallback:d.setCallback,colorPicker:i,bgPanel:c,modButtons:u,sectionButtons:m,detach:function(){c.detach()}}},app.menu.getModButtonsFunc=function(se,e,re,le,de,ce,ue,me,pe,fe){var he=e.appHub,ge=e.eventManager,ve=e.plusHelper,be=$("#tmp-mod-settings").html();return function(n,o,e){function a(e,t){r.Theme=e,fe.clearHeaderColors(o),o.applyStyle(e),o.editObj&&o.editObj.applyStyle&&o.editObj.applyStyle(e,!0),t||he.sync(o,"Theme",e)}var t,i,s,r=o.Data,l=$(be),d=e.changeColumns,c=e.addModule,u=e.align,m=e.addItem,p=le(r.Theme,a),f=l.find(".drop-down .btn"),h=l.find(".button-panel"),g=l.find(".add-mod-btn"),v=h.find(".col-btn"),b=h.find(".theme-btn"),T=h.find(".bg-panel-btn"),y=h.find(".share-btn"),C=h.find(".exp-btn"),k=h.find(".dup-btn"),w=h.find(".del-btn"),x=h.find(".adv-btn"),P=h.find(".cls-btn"),S=l.find(".mod-setting-btn"),D=l.find(".mod-top-buttons"),F=D.find(".plus"),I=D.find(".align"),M=l.find(".adv-panel"),E=l.find(".border-btn").text((1==r.Border?"Hide":"Show")+" Border"),A=l.find(".header-btn").text((1==r.Head?"Hide":"Show")+" Header"),U=l.find(".txt-btn").text((1==r.Txt?"Hide":"Show")+" Text"),N=M.add(de.$node).add(p.$node),L=D.find(".add"),O=D.find(".column"),R=D.find(".color"),B=D.find(".background"),_=D.find(".more"),G=D.find(".vertBarLine"),H=l.find(".taskListShowItemStatus"),Y=l.find(".taskListShowProgress"),j=l.find(".taskListHideItemStatus"),z=l.find(".taskListHideProgress"),q=l.find(".taskListModBtns"),V=e.changeGraphType,K=e.toggleItemStatus,J=e.toggleProgress,W=!1,X=!0;function Z(e,t,a){var n=$(window).width()-(t.offset().left+t.outerWidth());e.css({left:n<210?"unset":"164px",right:n<210?a+"px":"unset"})}function Q(e){N.not(e.toggle()).hide()}if(t=le(r.BgColor,function(e){n.bgColor(o,e)}),l.append(p.$node),l.append(de.$node),l.find(".border-btn").on("click",function(){$(this).toggleClass("is-present")}),f.on("click",function(){var e=$(this);e.closest(".drop-down").find(".btn").not(e).removeClass("active"),e.toggleClass("active")}),b.on("click",function(){Z(p.$node,$(this),5),Q(p.$node)}),T.on("click",function(){Z(de.$node,$(this),5),Q(de.$node)}),x.on("click",function(){Z(M,$(this),164),Q(M)}),c?g.click(c):g.remove(),u&&"Text"!=o.Type?(I.attr("class","align icon-Align"+r.Align),I.find(".align-btn").on("click",function(){var e=$(this).data("align");I.attr("class","align icon-Align"+e),r.Align=e,u(),he.sync(o,"Align",e)})):I.remove(),m){var ee=-1<o.Type.search(/image/gi)?"Image":-1<o.Type.search(/chart|scale/gi)?"Segment":-1<o.Type.search(/vertical/gi)?"Data Point":o.Type;F.data("tip","Add "+ee),F.click(function(){m(),he.sync(o,"Items",r.Items)})}else F.remove();function te(){console.log("module.clone",o.clone);var e=he.getModuleCount("persona-canvas"),t=app.consts.freePersonaLimit,a=ve.isFreeWithTeam()||ve.isTryMode();console.log("isPersonaLimmited",a),"persona-canvas"==o.Data.FormatClass&&a&&t<=e?ve.showFreePersonaBlocker(re):o.clone?o.clone():n.modManager.duplicateModule(o)}function ae(e){e.css("position","absolute"),e.css("left","-9999px"),e.css("opacity","0")}function ne(e){void 0!==e?e?h.slideDown(150):h.slideUp(150):h.slideToggle(150),S.toggleClass("drop-down-open"),S.closest(".drop-down-container").toggleClass("showing"),S.closest(".edit-content").addClass("active"),Q($("<p>")),oe(),setTimeout(function(){l.closest(".module-container, .edit-div").addClass("top-comp")},0)}function oe(){de.mount(l,{url:r.BgUrl,colorPanel:t,bgUrl:function(t){re.bgImageAdjust(o.$editNode,t,function(e){n.bgUrl(o,t),n.bgPositionY(o,e),n.bgPositionX(o,e),n.bgSize(o,e)})},adjustBgFn:function(){re.bgImageAdjust(o.$editNode,r.BgUrl,function(e){n.bgUrl(o,r.BgUrl),n.bgPositionY(o,e),n.bgPositionX(o,e),n.bgSize(o,e)})},reset:function(){n.resetBg(o)}})}d?(i=ce(r.Arr.length,d),l.append(i.$node),N=N.add(i.$node),v.on("click",function(){Q(i.$node)})):v.remove(),E.on("click",function(){r.Theme;r.Border=1==r.Border?2:1,E.text((1==r.Border?"Hide":"Show")+" Border"),he.sync(o,"Border",r.Border),o.$editNode.css({borderWidth:1==r.Border?"1px":"0"})}),A.on("click",function(){r.Theme;r.Head=1==r.Head?2:1,o.editObj.$node.find("> .header-container").css({display:1==r.Head?"":"none"}).toggleClass("hide-header-container",1!=r.Head),A.text((1==r.Head?"Hide":"Show")+" Header"),he.sync(o,"Head",r.Head)}),U.remove(),w.on("click",function(){h.slideToggle(150),n.removeModule(o,!1,function(){he.sync(o,"RemoveModule"),setTimeout(function(){ge.raiseEvent("moduleRemoved",o)},100)})}),k.on("click",function(){h.slideToggle(150),n.modManager.currentAction("dup"),te(),he.sync(o,"DuplicateModule")}),o.menuCb=function(e,t){"Head"==e?(A.text((1==r.Head?"Hide":"Show")+" Header"),o.editObj.$node.find("> .header-container").css({display:1==r.Head?"":"none"}).toggleClass("hide-header-container",1!=r.Head)):"Txt"==e?U.text((1==r.Txt?"Hide":"Show")+" Text"):"Col"==e||("Theme"==e?a(r.Theme,!0):"BgColor"==e?n.bgColor(o,r.BgColor,!0):"BgUrl"==e?(de.showAdjustBg(),de.setCallback(null),n.bgUrl(o,r.BgUrl,!0)):"BgPositionY"==e?n.bgPositionY(o,r.BgPositionY,!0):"BgPositionX"==e?n.bgPositionX(o,r.BgPositionX,!0):"BgSize"==e?n.bgSize(o,r.BgSize,!0):"ResetBg"==e?n.resetBg(o,!0):"Border"==e?(E.text((1==r.Border?"Hide":"Show")+" Border"),o.$editNode.css({borderWidth:1==r.Border?"1px":"0"})):"DuplicateModule"==e?te():"RemoveModule"==e&&n.removeModule(o,!0))},P.on("click",function(){re.message({heading:"Format Class",message:"One or more css class names for the module. You can use these class names to provide custom styles under Folio Settings.",btnText:"Save",showInput:1,enterAsOK:1,input:r.CssClass||r.FormatClass,handleOK:function(e){o.$editNode.add(o.$previewNode).removeClass(r.CssClass).addClass(e),r.CssClass=e,he.sync(o,"CssClass",e)}})}),S.on("click",function(){ne()}),l.find(".theme-picker .color-picker .sample").colorPicker({opacity:!1,doRender:!0,forceAlpha:!1,positionCallback:function(e){var t=this.$UI;return e.hasClass("btn-picker")?t.appendTo("#picker-container"):t.appendTo(e.parent().find(".picker-container")),{left:0,top:0}},renderCallback:function(e,t){var a=e.parent().find("input[type=text]");!0!==t&&a.val("#"+this.color.colors.HEX)}}),k.css("padding-top","10px"),R.click(function(){Q(p.$node),h.hide()}),B.click(function(){oe();var e=$(this).position();l.find(".bg-panel").css({top:0,left:"".concat(e.left,"px")}),Q(de.$node),h.hide()}),l.find(".theme-picker").css({top:0,left:"38px"}),ae(T),ae(b),"RowBreak"==o.Type&&(B.remove(),b.remove(),T.remove(),y.remove(),C.remove(),x.remove(),R.remove()),"Canvas"===o.Type?(ae(g),ae(v),h.find(".sep").first().hide(),l.find(".column-picker").css({top:0,left:"54px"}),l.find(".theme-picker").css({top:0,left:"83px"}),L.click(function(){var e;e=g,ne(!1),setTimeout(function(){e.trigger("click")},200)}),O.click(function(){Q(i.$node),$(this)}),D.find(".move").click(function(){})):(L.remove(),O.remove(),_.remove()),"Vertical Bar"===o.Type?V&&(s=ue(r.graphType,V),l.append(s.$node),N=N.add(s.$node),G.on("click",function(){Q(s.$node)})):G.remove(),"TaskList"===o.Type?(k.css("padding-top",""),1==r.showItemStatus?(H.removeClass("hideItemStatus"),j.removeClass("hideItemStatus"),Y.removeClass("hideItemStatus"),z.removeClass("hideItemStatus")):(H.addClass("hideItemStatus"),j.addClass("hideItemStatus"),Y.addClass("hideItemStatus"),z.addClass("hideItemStatus")),1==r.showProgress?(Y.removeClass("hideProgress"),z.removeClass("hideProgress")):(Y.addClass("hideProgress"),z.addClass("hideProgress")),K&&me(q,K,J)):q.remove(),ve.isTryMode()?(ve.doTryOverride("<span>Share</span> ",y,'<i class="icon-Share"></i>',null,!0),ve.doTryOverride("<span>Export</span> ",C,'<i class="icon-Export"></i>',null,!0),y.on("click",function(){return re.universalBlocker()}),C.on("click",function(){return re.universalBlocker()})):(!function(){var e=app.strings.general.lockedFeatureTip;W=pe.Team&&1===pe.Team.Role;var t="icon-Export";(X=!ve.isFreeWithTeam())?(C.removeClass("locked"),C.removeAttr("data")):(t="fa fa-lock",C.attr("data-content",e),C.addClass("locked")),C.find("i").attr("class",t)}(),C.on("click",function(){X?(h.slideToggle(150),n.handleExport(o)):ve.doExportBlocker(re,W)}),y.on("click",function(){h.slideToggle(150),n.shareModule(se,o)}));var ie="".concat("Canvas"===o.Type?"Canvas":"Module"," Background");return C.find("span").html("Export ".concat("Canvas"===o.Type?"Canvas":"Module")),k.find("span").html("Duplicate ".concat("Canvas"===o.Type?"Canvas":"Module")),T.find("span").html(ie),B.data("tip",ie),y.find("span").html("Share ".concat("Canvas"===o.Type?"Canvas":"Module")),app.plugin.tooltip(),{$node:l}}},window.jQuery?function(i){i.fn.passwordify=function(e){var o=i.extend({maxLength:8,numbersOnly:!1,alphaOnly:!1,alNumOnly:!1,enterKeyCallback:null,ccInputHandler:null,charToShow:4},e),t="\\s\\S";o.numbersOnly&&(t="0-9"),o.alphaOnly&&(t="A-z"),o.alNumOnly&&(t="0-9A-z");for(var a="",n=0;n<o.maxLength;n++)a+="Z";return this.on("input",function(e){var t=-1===i(this).val().indexOf("*"),a=t?i(this).val():i(this).data("val"),n=i(this).val().length-i(this).data("val").length;t?(i(this).data("val",i(this).val()),"function"==typeof o.ccInputHandler&&o.ccInputHandler(i(this).val())):0<n?i(this).data("val",a+i(this).val().substring(a.length,a.length+n)):n<0&&i(this).data("val",a.substring(0,a.length+n)),a=i(this).data("val"),"function"==typeof o.ccInputHandler&&o.ccInputHandler(i(this).data("val")),i(this).val(a.substring(0,a.length>o.charToShow?a.length-o.charToShow:0).replace(/./g,"*")+a.slice(-o.charToShow))}).mask(a,{translation:{Z:{pattern:"["+t+"*]"}}})}}(jQuery):console.log("Passwordify.js: $(this) class requires jQuery > v3!"),function(u){u.fn.scrollText=function(e){var a,n,o,t,s=u.extend({speed:4e3,minScrollWidth:0,startEvent:"mouseenter",stopEvent:"mouseleave",wrap:!1,ellips:0,wrapperWidth:0,animBack:!1,callback:!1},e);function i(e){if(s.minScrollWidth||(s.minScrollWidth=e.outerWidth()+s.ellips),n=function(e,t,a){a||(a="");var n=e.get(0).tagName;"input"==n.toLowerCase()&&(n="div");var o=u("<"+n+">");o.css({visibility:"hidden",position:"absolute","white-space":"pre","text-overflow":"unset","font-family":e.css("font-family"),"font-weight":e.css("font-weight"),"font-size":e.css("font-size")}).addClass(a+" tmp-calc").html(e.is("input")?e.val():e.html()),t.append(o);var i=t.find(".tmp-calc").outerWidth();return o.remove(),s.ellips&&(i+=s.ellips),i}(e,u("body")),e.attr("text-width",n),e.hasClass("animate")?l(e):(s.wrap&&e.wrap('<span class="animation-wrapper" style="position:fixed; width: '+s.wrapperWidth+'">'),e.addClass("animate"),a=e.outerWidth(),e.attr("elem-width",a),e.css({"text-overflow":"unset"}),e.parent().css({overflow:"hidden"}),s.callback&&s.callback()),a=parseInt(e.attr("elem-width")),(n=parseInt(e.attr("text-width")))>s.minScrollWidth){e.css("width",n+"px"),e.css("max-width",n+"px");var t=(n-s.minScrollWidth)/100*s.speed;t<2e3&&(t=2e3),o=t,d(e,n-s.minScrollWidth,o)}else l(e)}function r(e){e.stop()}function l(e){r(e),e.animate({"margin-left":"-="+e.css("margin-left")},{duration:o,step:function(e,t){},progress:function(e,t,a){}})}function d(a,n,o){if(!a.length)return!1;r(a);var e=parseInt(a.css("margin-left"));if(e<0){e=n-Math.abs(e);var t=o;return a.animate({"margin-left":"-="+e+"px"},{duration:t,step:function(e,t){},progress:function(e,t,a){},done:function(e,t){c(a,n,o)}}),!1}a.animate({"margin-left":"-="+n+"px"},{duration:o,step:function(e,t){},progress:function(e,t,a){},done:function(e,t){c(a,n,o)}})}function c(a,n,o){a.animate({"margin-left":"+="+n+"px"},{duration:o,step:function(e,t){},progress:function(e,t,a){},done:function(e,t){d(a,n,o)}})}this.each(function(){var a=u(this);s.startEvent&&"all"!=s.startEvent?a.on(s.startEvent,function(){i(a),s.stopEvent&&a.on(s.stopEvent,function(){r(a)})}):i(a),s.stopEvent&&a.on(s.stopEvent,function(){if(s.animBack){clearTimeout(t);var e=(n-s.minScrollWidth)/100*s.speed*.5;t=setTimeout(function(){a.animate({"margin-left":"0"},{duration:e,step:function(e,t){},progress:function(e,t,a){},done:function(e,t){l(a)}})},300)}else r(a)})})}}(jQuery),app.menu.getSectionButtonsFunc=function(e,S,D,F,I,M,E,A,U){var N=$("#tmp-section-settings").html();return function(e,t){var a=$(N),n=a.find(".drop-down .btn"),o=a.find(".button-panel"),i=a.find(".move-menu"),s=a.find(".more-menu"),r=a.find(".add-mod-btn"),l=o.find(".bg-panel-btn"),d=s.find(".exp-btn"),c=s.find(".del-sec-btn"),u=s.find(".dup-btn"),m=o.find(".move-sec-btn"),p=o.find(".more-sec-btn"),f=s.find(".copy-to-folio-btn"),h=s.find(".move-to-folio-btn"),g=a.find(".sec-btn"),v=a.find(".adjust-btn"),b=a.find(".adjust-btn + .sep"),T=!1,y=!1,C=!1;v.hide(),b.hide();var k=S(e.BgColor,t.bgColor),w=function(e){return e.closest(".section-settings").find(".bg-panel.drop-down")},x=function(){o.slideToggle(150),g.toggleClass("drop-down-open"),g.closest(".drop-down-container").toggleClass("showing"),g.closest(".edit-content").addClass("active"),i.hide(),s.hide()},P=function(){D.mount(a,{url:e.BgUrl,colorPanel:k,bgUrl:t.bgUrl,adjustBgFn:t.adjustBgFn,reset:t.resetBg})};return n.on("click",function(){var e=$(this);e.closest(".drop-down").find(".btn").not(e).removeClass("active"),e.toggleClass("active")}),i.on("click","button",function(){x(),t.move($(this).data("action"))}),s.on("click","button",function(){x(),t.move($(this).data("action"))}),l.on("click",function(){var e=$(this);i.hide(),s.hide(),0===w(e).length&&P(),w(e).css("top","").css("left","").toggle(),Tipped.hideAll()}),c.on("click",function(){x(),t.del()}),u.on("click",function(){x(),t.dup()}),m.on("click",function(){w($(this)).hide(),s.hide(),i.toggle(),Tipped.hideAll()}),p.on("click",function(){w($(this)).hide(),i.hide(),s.toggle(),Tipped.hideAll()}),r.on("click",function(){t.addModule(),I.plugin.tipped(M,E,A,null,null,!0)}),g.on("click",function(){o.fadeToggle(200),g.toggleClass("drop-down-open"),g.closest(".drop-down-container").toggleClass("showing"),g.closest(".edit-content").addClass("active"),i.hide(),s.hide(),w($(this)).hide(),C||(I.plugin.tipped(M,E,A,!0),C=!0),P()}),U.isTryMode()?(U.doTryOverride("<span>Export Section</span> ",d,'<i class="icon-Export"></i>',null,!0),U.doTryOverride("<span>Copy to folio</span> ",f,'<svg class="svg-icon svg-icon-copy-section"><use xlink:href="#svg-icon-copy-section"></use></svg>',null,!0),U.doTryOverride("<span>Move to folio</span> ",h,' <svg class="svg-icon svg-icon-move-section"><use xlink:href="#svg-icon-move-section"></use></svg>',null,!0),d.on("click",function(){return F.universalBlocker()}),f.on("click",function(){return F.universalBlocker()}),h.on("click",function(){return F.universalBlocker()})):(f.on("click",function(){x(),F.copySectionPopup($(this).closest(".edit-div").index(),"Copy Section")}),h.on("click",function(){x(),F.copySectionPopup($(this).closest(".edit-div").index(),"Move Section",function(){t.del(!0)})}),d.on("click",function(e){e.preventDefault(),T?(x(),t.handleExport()):U.doExportBlocker(F,y)}),d.find("span").html("Export Section"),function(){var e=I.strings.general.lockedFeatureTip;y=M.Team&&1===M.Team.Role;var t="icon-Export";(T=!U.isFreeWithTeam())?(d.removeClass("locked-sec"),d.find("i").removeAttr("data")):(t="fa fa-lock",d.attr("data-content",e),d.addClass("locked")),d.find("i").attr("class",t)}()),{$node:a}}},app.menu.getTaskListModSettings=function(){return function(e,t,a){var n=e.filter(".taskListShowItemStatus"),o=e.filter(".taskListShowProgress"),i=e.filter(".taskListHideItemStatus"),s=e.filter(".taskListHideProgress");n.on("click",function(){t("1"),n.removeClass("hideItemStatus"),i.removeClass("hideItemStatus"),o.removeClass("hideItemStatus"),s.removeClass("hideItemStatus")}),i.on("click",function(){t("0"),n.addClass("hideItemStatus"),i.addClass("hideItemStatus"),o.addClass("hideItemStatus"),s.addClass("hideItemStatus")}),o.on("click",function(){a("1"),o.removeClass("hideProgress"),s.removeClass("hideProgress")}),s.on("click",function(){a("0"),o.addClass("hideProgress"),s.addClass("hideProgress")})}},app.menu.getVertGraphType=function(){var e=["Bar","Line"];return function(n,t){var o=$('<div class="vert-graph-type-picker child drop-down">');return $.each(e,function(e,t){var a=$('<div class="btn vert-graph-type-btn settings-btn" data-vertgraphtype="'+t+'">'+("<span>"+t+"</span>")+("<div class='graph-type-"+t+"-icon'></div>")+"</div>").addClass(t==n?"selected":"");o.append(a)}),o.on("click",".vert-graph-type-btn",function(){var e=$(this);o.find(".selected").removeClass("selected"),e.addClass("selected"),t(e.data("vertgraphtype"))}),{$node:o}}},app.menu.xSelect=function(){var e=$(".x-select");function o(e,t){t.siblings().removeClass("active"),t.addClass("active");var a=t.data("name")||t.text(),n=t.data("value")||a;e.data("value",n).find(".text").text(a)}$.each(e,function(e,t){var n=$(t),a=n.find(".popup-menu");n.on("click",".item",function(e){var t=$(this);n.hasClass("no-select")||t.hasClass("active")||(o(n,t),n.trigger("change"))}),n.on("val",function(e,t,a){o(n,n.find(".item[data-"+t+'="'+a+'"]'))}),a.length&&app.plugin.popupMenu(n,a)})},function(g){g.fn.xautocomplete=function(e){var m,p=this,t=e.container.find(".search-font-clear"),f=g.extend({minLength:2},e);function a(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),m>=e.length&&(m=0),m<0&&(m=e.length-1),e[m].classList.add("autocomplete-active")}function h(e){if(e==p.get(0))return!1;var t=g(".autocomplete-items");return!!t.length&&(f.close?(!g(e).parents("#autocomplete-list").length&&g(e).hasClass("autocomplete-items"),f.close(e,t),!1):void t.each(function(){e!=g(this).get(0)&&g(this).remove()}))}return f.source(function(u){p.get(0).addEventListener("input",function(e){var t,o,a,n=this.value;if(h(),!n||n.length<f.minLength)return!1;m=-1,(t=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),t.setAttribute("class","autocomplete-items"),t.style.width=p.css("width"),t.style.position="absolute",t.style.backgroundColor="#ffffff",this.parentNode.appendChild(t);var i=!1;for(a=0;a<u.length;a++){var s=u[a].label,r=u[a].value,l=u[a].data;if(s.substr(0,n.length).toUpperCase()==n.toUpperCase()){i=!0,o=document.createElement("DIV");var d="<strong>"+s.substr(0,n.length)+"</strong>";if(d+=s.substr(n.length),f.addElement){var c=f.addElement(e,o,d,s,r,l);c.append("<input type='hidden' title='"+s+"' value='"+r+"'>"),c.on("click",function(e){var t=g(this).get(0),a=t.getElementsByTagName("input")[0].value,n=t.getElementsByTagName("input")[0].getAttribute("title");f.select?(p.val(n),f.select(e,o,a,l)):(p.val(a),h())}),g(t).append(c)}else d+="<input type='hidden' title='"+s+"' value='"+r+"'>",o.innerHTML=d,o.addEventListener("click",function(e){var t=this.getElementsByTagName("input")[0].value,a=this.getElementsByTagName("input")[0].getAttribute("title");f.select?(p.val(a),f.select(e,o,t,l)):(p.val(t),h())}),t.appendChild(o)}}return!i&&f.errorMsg?((o=document.createElement("DIV")).innerHTML=f.errorMsg,t.appendChild(o),!1):void 0})}),p.get(0).addEventListener("keydown",function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(m++,a(t)):38==e.keyCode?(m--,a(t)):13==e.keyCode&&(e.preventDefault(),-1<m&&t&&t[m].click())}),g(document).on("click",function(e){h(e.target)}),t.on("click",function(e){h(e.target),p.val("")}),p.closest(".app-popup .paper").on("click",function(e){h(e.target)}),this}}(jQuery),function(o){o.fn.extend({addTimedClass:function(t,e,a){var n=this;return setTimeout(function(e){n.removeClass(t),a&&a(e,n)},e),this.each(function(){o(this).addClass(t)})}})}(jQuery),function(a){a.fn.xpassword=function(e){var t=a.extend({preview:!1,previewFontClass:"eye"},e);function r(e){for(var t="",a=0;a<e;a++)t+="*";return t}return this.each(function(){var o=a(this),i="",s=a('<input type="hidden" />');if(o.before(s),t.preview){var e=a('<i class="'+t.previewFontClass+'"></i>');o.after(e),e.css({cursor:"pointer"}),e.on("click",function(){o.val(s.val()),setTimeout(function(){o.val(r(o.val().length))},2e3)})}s.attr("name",o.attr("name")),s.attr("id",o.attr("id")),s.addClass(o.attr("class")),s.addClass("hiddenpass"),o.attr("type","text").removeAttr("name").removeAttr("id"),o.on("keypress",function(e){var t,a=e.which;if(32<=a&&a<=127){var n=String.fromCharCode(a);(t="",void 0!==window.getSelection?t=window.getSelection().toString():void 0!==document.selection&&"Text"==document.selection.type&&(t=document.selection.createRange().text),t).length?s.val(n):s.val(s.val()+n)}}),o.on("keyup",function(e){var t=e.which;if(8==t){var a=o.val().length;s.val(s.val().substring(0,a))}else if(37==t);else{var n=o.val().length;o.val(r(n-1)+o.val().substring(n-1))}i&&clearTimeout(i),i=setTimeout(function(){o.val(r(o.val().length))},2e3)})}),this}}(jQuery),app.core.apiHelper=function(f,n,h,e,t){var a,u=!1;app.acl.helper(f);function o(s){var t,r=0,l=s.maxAttempts||100,d=100,c=0;return function o(i){var e;s.noPause||!u?(i=i||2,r++<l?t=$.ajax({type:"POST",url:s.url,data:(e=s.data,"__RequestVerificationToken="+f.verificationToken+(e?"&"+e:"")),success:function(e,t,a){if($("#saving-popup").removeClass("error").hide(),r=l,1==e.StatusCode)s.success&&s.success(e);else if(401==e.StatusCode)u=!0,r--,h.raiseEvent("loggedOut",function(){u=!1});else if(1001==e.StatusCode){$("#saving-popup").show().addClass("error").find(".popup-text").text("Not logged in."),console.log("Status 1001 Detected"),console.log("tokenRefresh",c),console.log("maxTokenRefresh",d);var n="dev"===f.Environment?"tech":"com";window.location.href="https://app.xtensio.".concat(n,"/account/signin?notice=addusers")}else s.appError&&s.appError(e)},error:function(e,t,a){if("abort"!=t)if(r===l)s.error&&s.error(e,t,a);else{var n=Math.min(6e4,1e3*(i+i));setTimeout(o,n)}},complete:function(e,t){var a=e.getResponseHeader("Content-Type");if(200===e.status&&a&&0<=a.toString().toLowerCase().indexOf("text/html")){var n="dev"===f.Environment?"tech":"com";window.location.href="https://app.xtensio.".concat(n,"/account/signin?notice=addusers")}r===l&&s.complete&&s.complete(e,t)}}):(t=null,console.log("ABORTING: Maximum attempts of "+l+" has been exhausted"))):setTimeout(function(){o(i)},3e3)}(),{abort:function(){r=l,t&&4!=t.readystate&&t.abort()}}}function g(e,t,a,n){(0,app.acl.helper(f).isBusinessPlan)()?(t.addClass("error"),a.html(n),setTimeout(function(){t.fadeOut("slow")},8e3)):t.fadeOut(),e.error()}function r(n){o({maxAttempts:n.maxAttempts||1,url:n.url,data:n.data&&$.param(n.data),success:n.success,appError:n.error,noPause:n.noPause,error:function(e,t,a){n.error&&n.error({Message:"Failed to connect. Please try again."})},complete:n.complete})}function i(e){return e.replace(/[<>]/gi,"")}function s(e,t){r({url:e,data:t.data,success:t.success,error:t.error,complete:t.complete})}function l(e){r({url:"/labels/AddRemoveChannelCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})}function l(e){r({url:"/labels/AddRemoveChannelCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})}function d(e,t,a){var n=app.strings.popups,o=n.maxImgLimitMessage,i=n.imgForBgMessage,s=app.acl.helper(f),r=s.isBusinessPlan,l=s.imgUploadLimit,d=s.imgAboveLimit,c=s.imgErrorString,u=l(),m=a.type.indexOf("image")<0;try{if(m)return void(t.isProgress?g(t,e,$uploadStatus,i):t.error(i));if(d(a.size)){var p=r()?c():o(u);return void(r()?t.isProgress?g(t,e,$uploadStatus,p):t.error(p):h.raiseEvent("free-exceedsize"))}}catch(e){}}return $("#saving-popup").append($("#spinner-container > .loading-animation").clone().addClass("size-30")),_defineProperty(a={signIn:function(e,t,a,n,o,i,s){console.log(i),r({url:"/Account/LoginAJAX",noPause:!0,data:{Email:e,Password:t,RememberMe:a,returnUrl:f.returnUrl+"#"+window.location.hash.substr(1),FolioToken:i,showAddUsers:s},success:n,error:o})},signUp:function(e,t,a){r({url:"/Account/RegisterAJAX",data:$.extend({refToken:f.refToken,returnUrl:f.returnUrl+"#"+window.location.hash.substr(1)},e),success:function(e){try{ga("send","event",{eventCategory:"Signup",eventAction:"Form Fill",eventLabel:"app.xtensio.com"})}catch(e){console.log(e)}t()},error:a})},TeamSignUp:function(e,t,a){r({url:"/Account/RegisterTeamAJAX",data:$.extend({refToken:f.refToken},e),success:function(e){try{ga("send","event",{eventCategory:"Signup",eventAction:"Form Fill",eventLabel:"app.xtensio.com"})}catch(e){console.log(e)}t()},error:a})},deleteModule:function(e){e&&e.ID&&0<e.ID&&o({url:"/Apiv1/DeleteModule",maxAttempts:999,data:$.param({token:f.token,moduleId:e.ID})})},deleteModules:function(e){e&&o({url:"/Apiv1/DeleteModules",maxAttempts:999,data:$.param({token:f.token,moduleIds:e})})},sendShareEmail:function(e){r({url:"/Apiv1/ShareFolioByEmail",data:{token:e.token||f.token,modId:e.modId,message:e.message,emails:e.addresses&&$.trim(e.addresses)},success:e.success,error:e.error,complete:e.complete})},sendLabelEmail:function(e){r({url:"/Labels/ShareByEmail",data:{token:e.token,message:e.message,emails:e.addresses&&$.trim(e.addresses)},success:e.success,error:e.error,complete:e.complete})},uploadImage:function(e,t,n){var a=new FormData(e),o=$("#uploading-popup"),i=o.find(".popup-text"),s=$('<span class="upload-progress"></span>');o.removeClass("error").show(),d(o,n,t),o.find(".upload-progress").length||i.text("Uploading image").after(s),s.show(),a.append("token",f.token),a.append("type",n.type||"image"),a.append("custom",n.custom),a.append("__RequestVerificationToken",f.verificationToken);var r={type:"POST",data:a,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return o.show(),e.upload.onprogress=function(e){s.text((e.loaded&&1/e.total*100).toFixed(0)+"%")},e.upload.onload=function(){i.text("Processing image .."),s.hide()},e},success:function(e,t,a){console.log("apiObject.url",r.url),o.show(),1==e.StatusCode?(i.text("Image uploaded"),s.hide(),setTimeout(function(){i.text("Downloading image")},300),n.success&&n.success(e),$("<img>").attr("src",e.Message).on("load",function(){o.fadeOut(),n.imageLoaded&&n.imageLoaded(e.Message),$(this).remove()})):g(n,o,i,e.Message)},error:function(e,t,a){console.log("apiObject.url",r.url),n.error(),i.text("Image Failed to process."),s.hide(),setTimeout(function(){o.hide(),s.show(),i.text("Uploading image")},2e3)}};f.tryMode?r.url="/Apiv1/UploadTempFolioImage":r.url="/Apiv1/UploadImage",$.ajax(r)},deleteImage:function(e,t,n){$("#saving-popup").show().find(".popup-text").text("Deleting image"),o({maxAttempts:1,url:"/Apiv1/DeleteBgImage",data:$.param({token:f.token,imageId:e}),success:function(){$("#saving-popup").show().find(".popup-text").text("Done"),t()},appError:function(e){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n(e)},error:function(n){function e(e,t,a){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(e,t,a){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n("Failed to connect. Please try again.")}),complete:function(){setTimeout(function(){$("#saving-popup").fadeOut()},500)}})},saveModuleRecord:function(e){o({url:"/Apiv1/SaveModuleRecord",maxAttempts:1,data:$.param({token:f.token,moduleId:e.moduleId,data:JSON.stringify(e.dataObj)}),success:e.success,appError:e.error,error:e.error})},resendEmail:function(e){r({url:"/Account/ResendConfirmationEmailAJAX",data:{Email:e.email},success:e.success,error:e.error})},forgotPassword:function(e){r({url:"/Account/ForgotPassword",data:{Email:e.email},success:e.success,error:e.error,appError:e.error})},changePassword:function(e){r({url:"/Account/ChangePassword",data:{OldPassword:e.oldPassword,NewPassword:e.newPassword,ConfirmPassword:e.confirmPassword},success:e.success,error:e.error})},changeEmail:function(e){r({url:"/Account/ChangeEmail",data:{email:e.email},success:e.success,error:e.error})},changeFullName:function(e){r({url:"/Account/ChangeName",data:{name:e.fullName},success:e.success,error:e.error})},sanitizeText:i,cleanAmp:function(e){return e.replace(new RegExp("&amp;","g"),"&")},renameFolio:function(t){if(!t.isAuto||!f.renameAutoSaveDisabled){var a=$("#tmp-secondary-bar").find(".nav-save-section");a.addClass("saving"),r({url:"/Apiv1/RenameFolio",data:{token:t.token||f.token,name:i(t.name),isAuto:t.isAuto||!1},success:function(e){a.removeClass("saving").addClass("saved"),setTimeout(function(){a.removeClass("saved")},1500),f.renameAutoSaveDisabled=!0,n&&(n.FolioName=t.name),t.success&&t.success(e)},error:t.error})}},renameTempFolio:function(t){if(!t.isAuto||!f.renameAutoSaveDisabled){var a=$("#tmp-secondary-bar").find(".nav-save-section");a.addClass("saving"),r({url:"/Apiv1/RenameTempFolio",data:{token:t.token||f.token,name:i(t.name),isAuto:t.isAuto||!1},success:function(e){a.removeClass("saving").addClass("saved"),setTimeout(function(){a.removeClass("saved")},1500),f.renameAutoSaveDisabled=!0,n&&(n.FolioName=t.name),t.success&&t.success(e)},error:t.error})}},setSlug:function(e){r({url:"/Apiv1/SetSlug",data:{token:e.token||f.token,slug:e.slug},success:e.success,error:e.error})},duplicateFolio:function(e){var t=e.teamId||0;0!==e.teamId&&f.Team&&0<f.Team.Id&&(t=e.teamId||f.Team.Id),r({url:"/Apiv1/Duplicate",data:{token:e.token,name:e.name,CopiedFromTemplate:e.fToken,teamId:t},success:e.success,error:e.error,complete:e.complete})},exportFolio:function(t){r({url:f.tryMode?"/Apiv1/ExportTempFolio":"/Apiv1/Export",data:{token:f.token,html:t.html,format:t.format,settings:t.settings&&JSON.stringify(t.settings)},success:t.success,error:function(e){6==e.StatusCode&&(f.plusExpireTime=Date.now()),t.error(e)},complete:t.complete})},setObjPass:function(t){r({url:t.isLabel?"/labels/SetPass":"/Apiv1/SetFolioPass",data:{token:t.token,pass:t.pass},success:t.success,error:function(e){6==e.StatusCode&&(f.plusExpireTime=Date.now()),t.error(e)},complete:t.complete})},removeObjPass:function(t){r({url:t.isLabel?"/labels/RemovePass":"/Apiv1/RemoveFolioPass",data:{token:t.token},success:t.success,error:function(e){6==e.StatusCode&&(f.plusExpireTime=Date.now()),t.error(e)},complete:t.complete})},getFreePlusInfo:function(n){var e=f.tryMode?f.token:"";o({maxAttempts:1,url:"/Apiv1/GetFreePlusInfo",data:$.param({token:e}),success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})},getFolioByToken:function(e){r({url:"/Apiv1/GetFolioByToken",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})},getFolioFullByToken:function(e){r({url:"/Apiv1/GetFolioFullByToken",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})},getTooltips:function(e){r({url:"/Apiv1/GetTooltips",data:{},success:e.success,error:e.error,complete:e.complete})},getTooltipsAnon:function(e){r({url:"/Apiv1/GetTooltipsAnon",data:{},success:e.success,error:e.error,complete:e.complete})},deleteFolio:function(e){r({url:"/Apiv1/DeleteFolio",data:e.data,success:e.success,error:e.error,complete:e.complete})},submitFolio:function(e){r({url:"/Apiv1/SubmitFolio",data:{token:e.token||f.token},success:e.success,appError:e.appError,error:e.error})},updatePrivacy:function(e,t){r({url:e.isLabel?"/labels/ChangePrivacy":"/Apiv1/ChangeFolioPrivacy",data:{token:e.Token,isPrivate:e.Private,isIndexed:e.Indexed},success:t.success,error:t.error,complete:t.complete})},getMaxTag:function(e){r({url:"/Apiv1/GetMaxTag",data:{count:e.count,token:e.token},success:e.success,error:e.error,complete:e.complete})},templateMods:function(e){var t=f.tryMode?"GetTemplateMods2Temp":"GetTemplateMods2";r({url:"/Apiv1/".concat(t),data:{name:e.name,id:e.token},success:e.success,error:e.error,complete:e.complete})},addCollaborator:function(e){r({url:"/Apiv1/AddCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})},changeCollaborator:function(e){r({url:"/Apiv1/ChangeCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})},transfer:function(e){e.teamId=0,f.Team&&0<f.Team.Id&&(e.teamId=f.Team.Id),r({url:"/Apiv1/TransferFolio",data:e.data,success:e.success,error:e.error,complete:e.complete})},upgradeFolio:function(e){r({url:"/Apiv1/UpgradeFolio",data:{token:f.token||e.token},success:e.success,error:e.error,complete:e.complete})},getRecords:function(e){r({url:"/Apiv1/GetModRecords",data:{id:e.id},success:e.success,error:e.error,complete:e.complete})},emailSettings:function(e){r({url:"/Apiv1/EmailSettings",data:e.data||{},success:e.success,error:e.error,complete:e.complete})},findUser:function(e){r({url:"/Apiv1/FindUser",data:{email:e.email},success:e.success,error:e.error,complete:e.complete})},getUserFolioCountFromTeam:function(e){r({url:"/Apiv1/GetUserFolioCountFromTeam",data:{username:e.username,teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})},processTransfer:function(e){e.teamId=e.teamId||0,f.Team&&0<f.Team.Id&&(e.teamId=e.teamId||f.Team.Id),r({url:"/Apiv1/ProcessTransfer",data:e.data,success:e.success,error:e.error,complete:e.complete})},processCollaborator:function(e){r({url:"/Apiv1/ProcessCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})},modStore:function(e){s("/Apiv1/ModStore",e)},folioStore:function(e){s("/Apiv1/FolioStore",e)},card:function(e){r({url:"/billing/changecard/",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})},buy:function(e){r({url:"/billing/purchase/",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})},changePlan:function(e){r({url:"/billing/CancelPlanAtPeriodEnd/",data:e.data,success:e.success,error:e.error,complete:e.complete})},cancelPlan:function(e){r({url:"/billing/cancelplan/",data:e.data,success:e.success,error:e.error,complete:e.complete})},createLabel:function(e){r({url:"/labels/create",data:{name:e.name,title:e.title||"",desc:e.desc||""},success:e.success,error:e.error,complete:e.complete})},changeLabels:function(e){r({url:"/labels/change",data:{token:e.token,list:e.list},success:e.success,error:e.error,complete:e.complete})},changeCollabChan:function(e){r({url:"/labels/ChangeCollabChan",data:{token:e.token,labelToken:e.labelToken},success:e.success,error:e.error,complete:e.complete})},removeFromCollabChan:function(e){r({url:"/labels/RemoveLableFromFolioCollabChan",data:{token:e.token,labelId:e.id},success:e.success,error:e.error,complete:e.complete})},changeLabelProps:function(e,t){r({url:"/labels/ChangeLabelProps",data:{labelId:e.Token,title:e.Title,desc:e.Description},success:t.success,error:t.error,complete:t.complete})},renameLabel:function(e){r({url:"/labels/ChangeLabelName",data:{labelId:e.token,name:e.name},success:e.success,error:e.error,complete:e.complete})},removeLabel:function(e){r({url:"/labels/remove",data:{labelId:e.token},success:e.success,error:e.error,complete:e.complete})},removeCollabChan:function(e){r({url:"/labels/RemoveCollabChan",data:{labelId:e.token},success:e.success,error:e.error,complete:e.complete})},setLastChannel:function(e){r({url:"/apiv1/SetLastChannel",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})},getChannelsOfAFolio:function(e){r({url:"/Apiv1/GetChannelsOfAFolio",data:e.data,success:e.success,error:e.error,complete:e.complete})},makeLabelDefault:function(e){r({url:"/labels/MakeDefault",data:{labelId:e.token},success:e.success,error:e.error,complete:e.complete})},getChannelOwner:function(e){r({url:"/labels/getLabelOwner",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})},getChannelCollaborators:function(e){r({url:"/labels/GetChannelCollaborators",data:e.data,success:e.success,error:e.error,complete:e.complete})},addMultipleChannelCollaborators:function(e){r({url:"/labels/AddMultipleChannelCollaborators",data:e.data,success:e.success,error:e.error,complete:e.complete})},addRemoveChannelCollaborator:l,getLabelOwner:function(e){r({url:"/labels/GetLabelOwner",data:e.data,success:e.success,error:e.error,complete:e.complete})},getWorkspaceChannels:function(e){f.Team&&0<f.Team.Id&&f.Team.Id,r({url:"/labels/GetWorkspaceChannels",data:{teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})},createCollabChan:function(e){r({url:"/labels/CreateCollabChan",data:e.data,success:e.success,error:e.error,complete:e.complete})},saveFolioHtml:function(e){if(console.log("baseURL indexof",f.baseUrl.toString().indexOf("localhost.com")),f&&-1!==f.baseUrl.toString().indexOf("localhost.com"))r({url:"/apiv1/SaveFolioHtml",data:e.data,success:e.success,error:e.error,complete:e.complete});else{var t=-1!==f.baseUrl.toString().indexOf("xtensio.com")?"live":"dev",a=e.data,n=a.token,o=a.html;$.ajax({url:"https://xtensiofoliohtmlsave.azurewebsites.net/api/SaveFolioHtml?code=".concat("VgTGe32x48eAOexiNk/tzws/CTas7KhfNmjtt1StEMXxNhLS62u77g=="),type:"POST",data:JSON.stringify({token:n,html:o,env:t}),contentType:"application/json",success:e.success,error:e.error,complete:e.complete})}},saveChannelCollaborators:function(e){r({url:"/labels/SaveChannelCollaborators",data:e.data,success:e.success,error:e.error,complete:e.complete})},changeChannelAccess:function(e){r({url:"/labels/ChangeChannelAccess",data:e.data,success:e.success,error:e.error,complete:e.complete})}},"addRemoveChannelCollaborator",l),_defineProperty(a,"getDashboardData",function(e){r({url:"/apiv1/GetDashboardData",data:e.data,success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getExampleData",function(e){r({url:"/apiv1/GetExampleData",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getFolioCollaborators",function(e){r({url:"/Apiv1/GetFolioCollaborators",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"folioVersion",function(e){r({url:"/apiv1/version",data:e.data,success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getTagStore",function(e){r({url:"/apiv1/GetTagStore",data:{token:n.Token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getTempTagStore",function(e){r({url:"/apiv1/GetTempTagStore",data:{token:n.Token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"changePresentMode",function(e){r({url:"/Apiv1/ChangePresentationMode",data:{token:e.token||f.token,isPresentable:e.present},success:e.success,appError:e.appError,error:e.error})}),_defineProperty(a,"saveFolioSnapShot",function(e){r({url:"/apiv1/SaveFolio",data:{data:e.data,token:n.Token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"makeFolioFromSnapshot",function(e){r({url:"/apiv1/MakeFolioFromSnapshot",data:{folioToken:e.token,data:JSON.stringify(e.data),verb:e.verb,name:e.name,channels:e.channels},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getRemovedFolioData",function(e){r({url:"/apiv1/GetRemovedFolioData",data:{folioToken:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"removeFromLabels",function(e){r({url:"/labels/RemoveLableFromFolio",data:{token:e.token,labelId:e.id},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"loadNotifications",function(e){r({url:"/Apiv1/UserInAppNotifications",data:{email:e.data.userEmail,nextCount:e.data.nextCount},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getRecentMessages",function(e){r({url:"/Apiv1/Pull",data:{timestamp:e.data.timestamp,token:e.data.token,connectionId:e.data.connecId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"checkTeamURL",function(e){r({url:"/TeamApi/CheckTeamURL",data:{data:e.data.teamUrl},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"uploadTeamImage",function(e,t,n){var a=new FormData(e),o=$("#uploading-popup"),i=o.find(".popup-text"),s=$('<span class="upload-progress"></span>');o.removeClass("error").show(),d(o,n,t),n.isProgress&&(o.find(".upload-progress").length||i.text("Uploading image").after(s),s.show()),a.append("token",f.teamId),a.append("type",n.type||"image"),a.append("custom",n.custom),a.append("__RequestVerificationToken",f.verificationToken),a.append("file",t),$.ajax({url:"/TeamApi/UploadTeamImage",type:"POST",data:a,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){},e.upload.onload=function(){},e},success:function(e,t,a){n.isProgress?(o.show(),1==e.StatusCode?(i.text("Image uploaded"),s.hide(),setTimeout(function(){i.text("Downloading image")},300),n.success&&n.success(e),$("<img>").attr("src",e.Message).on("load",function(){o.fadeOut(),n.imageLoaded&&n.imageLoaded(e.Message),$(this).remove()})):g(n,o,i,"Error. Please try again.")):1==e.StatusCode?n.success(e):n.error("Error. Please try again.")},error:function(e,t,a){n.isProgress?n.error():n.error(a)}})}),_defineProperty(a,"deleteTeamImage",function(e,t,n){$("#saving-popup").show().find(".popup-text").text("Deleting image"),o({maxAttempts:1,url:"/TeampApi/DeleteTeamImage",data:$.param({teamId:f.teamId,imageId:e}),success:function(){$("#saving-popup").show().find(".popup-text").text("Done"),t()},appError:function(e){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n(e)},error:function(n){function e(e,t,a){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(e,t,a){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n("Failed to connect. Please try again.")}),complete:function(){setTimeout(function(){$("#saving-popup").fadeOut()},500)}})}),_defineProperty(a,"saveTeam",function(e){r({url:"/TeamApi/SaveTeam",data:{email:e.data.email,teamMem:JSON.stringify(e.data.members),teamId:e.data.teamId,imageID:e.data.imageID,data:JSON.stringify(e.data.data)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"deleteTeam",function(e){r({url:"/TeamApi/DeleteTeam",data:{email:e.data.email,teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"listTeamMembers",function(e){r({url:"/TeamApi/GetTeamMembers",data:{teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"listALLMembers",function(e){r({url:"/TeamApi/GetAllMembers",data:{teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getTeamSetCount",function(e){r({url:"/TeamApi/GetTeamSetCount",data:{teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getMember",function(e){r({url:"/TeamApi/GetTeamUser",data:{teamId:e.data.teamId,email:e.data.email},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getExportCreditsLeft",function(e){r({url:"/Apiv1/GetExportCreditsLeft",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getCreditsLeft",function(e){r({url:"/Apiv1/GetCreditsLeft",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getUserActiveFoliosCount",function(e){r({url:"/Apiv1/GetUserActiveFolios",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getStripInvoiceData",function(e){r({url:"/Apiv1/GetInvoiceTabData",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getFolioDataPoints",function(e){r({url:"/Apiv1/GetFolioDataPoints",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getUserFolios",function(e){r({url:"/Apiv1/GetUserFolios",data:{teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getUserOwnFolios",function(e){r({url:"/Apiv1/GetUserOwnFolios",data:{teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getCopySections",function(e){r({url:"/Apiv1/CopySections",data:{sourceToken:e.sourceToken,destinationToken:e.destinationToken,sectionTag:e.sectionTag,order:e.order,action:e.action},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"moveUserFolios",function(e){r({url:"/TeamApi/MoveFolios",data:{userEmail:e.userEmail,source:e.source,destination:e.destination,folios:e.folios},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"addSingleFolioGuest",function(e){r({url:"/TeamApi/AddSingleFolioGuest",data:{members:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"removeSingleFolioGuest",function(e){r({url:"/TeamApi/RemoveSingleFolioGuest",data:e.data,success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"setUserDefinedTeam",function(e){r({url:"/Apiv1/UpdateNotification",data:{id:e.notificationId,teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"resendSFGEmailNotification",function(e){r({url:"/TeamApi/ReSendEmailNotificationSFG",data:e.data,success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"processSFG",function(e){r({url:"/TeamApi/ProcessSingleFolioGuest",data:e.data,success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"saveAsTemplate",function(e){r({url:"/Apiv1/SaveAsTemplate",data:{token:e.token,name:e.name,teamId:e.teamId,CopiedFromTemplate:e.CopiedFromTemplate,isTeamTemplate:e.isTeamTemplate,isIndexed:e.isIndexed,isPrivate:e.isPrivate},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"switchTemplateTypes",function(e){r({url:"/Apiv1/SwitchTemplateTypes",data:{token:e.token,op:e.op},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"deleteUserTemplate",function(e){r({url:"/Apiv1/DeleteTemplate",data:{token:e.token,op:e.op},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getUserTemplateCount",function(e){r({url:"/Apiv1/GetUserTemplateCount",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"resendTeamUser",function(e){r({url:"/TeamApi/AddResendUser",data:{userEmail:e.userEmail,userRole:e.userRole,teamId:e.teamId,folioToken:e.folioToken||"",accessType:e.accessType||""},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"changeMemberAccess",function(e){r({url:"/billing/ChangeAccess",data:{userEmail:e.userEmail,userRole:e.userRole,teamId:e.teamId,folioToken:e.folioToken||"",accessType:e.accessType||""},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"createTeam",function(e){r({url:"/Billing/CreateTeam",data:{teamInfo:JSON.stringify(e.data.teamInfo),billingInfo:JSON.stringify(e.data.billingInfo)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"addMembers",function(e){r({url:"/Billing/AddTeamMembers/",data:{teamMembers:JSON.stringify(e.data.teamMembers)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"removeMember",function(e){r({url:"/Billing/RemoveTeamMember/",data:{userEmail:e.userEmail},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"removeTeamMemberReactivation",function(e){r({url:"/Billing/RemoveTeamMemberReactivation/",data:{userEmail:e.userEmail},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getTemplateData",function(e){r({url:"/apiv1/GetTemplateData",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"emptyTrash",function(e){r({url:"/Apiv1/EmptyTrash",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"searchFonts",function(n){o({maxAttempts:1,type:"GET",url:"/Apiv1/SearchFont",data:$.param(n.data),success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"getAllFonts",function(n){o({maxAttempts:1,type:"GET",url:"/Apiv1/GetAllFonts",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"makeDefault",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/MakeDefault",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"addFont",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/AddFont",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"removeFont",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/RemoveFont",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"savePalette",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/SavePalette",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"updateColor",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/UpdateColor",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"addColor",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/AddColor",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"removeColor",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/RemoveColor",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"makeColorDefault",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/MakeColorDefault",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"restoreDefaultFonts",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/RestoreDefaultFonts ",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"restoreDefaultColors",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/RestoreDefaultColors",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"uploadSwatch",function(e,t,n,a){var o=new FormData(e);o.append("token",f.teamId),o.append("__RequestVerificationToken",f.verificationToken),o.append("file",t),o.append("swatchSource",n.source||1),$.ajax({url:"/Apiv1/UploadSwatch",type:"POST",data:o,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){},e.upload.onload=function(){},e},success:function(e,t,a){n.success(e)},error:function(e,t,a){n.error(a)}})}),_defineProperty(a,"getDefaultStyleTeamCreation",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/GetDefaultStyleGuideForTeamCreation",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"getStyleGuides",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/GetStyleGuides",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"saveLog",function(e){r({url:"/Apiv1/SaveFrontEndLog",data:{data:JSON.stringify(e.data.data)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"setGdprConsent",function(n){o({maxAttempts:1,type:"POST",url:"/Apiv1/SetGdprConsent",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"updateFolioCurl",function(e){r({url:"/Apiv1/UpdateFoliosCurl",data:{curl:e.curl,token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"checkCurlAvailability",function(e){r({url:"/Apiv1/CheckCurlIsAvailable",data:{curl:e.curl,token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getFolioCurl",function(e){r({url:"/Apiv1/GetFoliosCurl",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getFolioData",function(e){r({url:"/apiv1/GetFolioData",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getLabelData",function(e){r({url:"/apiv1/GetLabelData",data:{},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"removeFoliosCurl",function(n){o({maxAttempts:1,data:$.param(n.data),type:"GET",url:"/Apiv1/RemoveFoliosCurl",success:n.success,appError:n.error,error:function(e,t,a){n.error&&n.error("Failed to connect. Please try again.")},complete:n.complete})}),_defineProperty(a,"saveFolio",function(e){r({url:"/Apiv1/CreateFolio",data:{teamId:e.teamId,token:e.folioToken,data:JSON.stringify(e),id:e.templateId},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getFolioLastSaveTimestamp",function(e){r({url:"/apiv1/GetFolioLastSaveTimestamp",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"uploadCustomFont",function(e,t,n){var a=new FormData(e);a.append("__RequestVerificationToken",f.verificationToken),a.append("fontFile",t),$.ajax({url:"/Apiv1/UploadCustomFont",type:"POST",data:a,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){},e.upload.onload=function(){},e},success:function(e,t,a){n.success(e)},error:function(e,t,a){n.error(a)}})}),_defineProperty(a,"setOnboardingStatus",function(e){r({url:"/Apiv1/SetOnboardingStatus",data:{step:e.step,onboardingType:e.onboardingType},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"upgrade",function(e){r({url:"/billing/Upgrade",data:{plan:e.plan,count:e.count,data:e.data?JSON.stringify(e.data):null,teamMembers:JSON.stringify(e.teamMembers)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"changeTeamPlan",function(e){r({url:"/billing/ChangeTeamPlan",data:{plan:e.plan},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"buyCredits",function(e){r({url:"/billing/PurchaseCredits",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getUserTeamsAndFolios",function(e){r({url:"/TeamApi/GetUserTeamsAndFolios",data:{userEmail:e.userEmail},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getUserCurrentTeamDataAndFolios",function(e){r({url:"/TeamApi/GetUserCurrentTeamDataAndFolios",data:{userEmail:e.userEmail},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"buyCreditsWithoutCard",function(e){r({url:"/billing/PurchaseCreditsWithoutCard",data:{data:JSON.stringify(e)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"removeUnpaidMembers",function(e){r({url:"/billing/RemoveUnpaidMembers",data:{userEmails:e.data},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"setTooltipUserClick",function(e){r({url:"/Apiv1/SetUserClick",data:{objectId:e.tooltipId,clickType:e.type},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"renameFoliowithPrivacySettings",function(e){r({url:"/Apiv1/RenameFoliowithPrivacySettings",data:{token:e.token,name:e.name,format:e.format,isPrivate:e.isPrivate,isIndexed:e.isIndexed},success:e.success,error:e.error})}),_defineProperty(a,"getAclData",function(e){r({url:"/apiv1/GetPlanAclList",success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getPlanAclListPEdit",function(e){r({url:"/apiv1/GetPlanAclListPEdit",success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getPlanAclListAnon",function(e){r({url:"/apiv1/GetPlanAclListAnon",success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getAllPlansAclData",function(e){r({url:"/apiv1/GetAllPlansAclList",success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getAllPlansAclListAnon",function(e){r({url:"/apiv1/GetAllPlansAclListAnon",success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"isEduEmail",function(e){r({url:"/apiv1/IsEduEmail/",data:{email:e.email},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getXtensioStats",function(n){$.getJSON("/stats",{}).done(function(e){n.success(e)}).fail(function(e,t,a){n.error(a)})}),_defineProperty(a,"setImageData",function(e){r({url:"/apiv1/SetImageData",data:{imageUrl:e.imageUrl,imageDesc:e.imageDesc,imageTags:e.imageTags},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"fetchImageData",function(n){$.ajax({url:"https://xtensioai.cognitiveservices.azure.com/vision/v2.1/analyze?visualFeatures=Categories,Description&details=Landmarks&language=en",type:"POST",headers:{"Ocp-Apim-Subscription-Key":"9d55858a948041639b746dec547dd3c3"},data:JSON.stringify({url:n.url}),processData:!1,contentType:"application/json",xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){},e.upload.onload=function(){},e},success:function(e,t,a){n.success(e)},error:function(e,t,a){n.error(a)}})}),_defineProperty(a,"setUserType",function(e){r({url:"/apiv1/SetUserType",data:e.data,success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getTemplateExampleFolioName",function(e){r({url:"/apiv1/GetTemplateExampleFolioName",data:{tokenOrSlug:e.tokenOrSlug},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getFoliosLastSavedTime",function(e){r({url:"/apiv1/GetFoliosLastSavedTime",data:{folioToken:e.token},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"saveTempMod",function(e){r({url:"/apiv1/SaveTempMod",data:{token:e.token,modType:e.modType,data:e.data,tag:e.tag},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"saveTempMods",function(e){r({url:"/apiv1/SaveTempMods",data:{token:e.token,data:e.data},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"register",function(e){var t={url:"/Account/Register",data:_objectSpread({},e.accountData,{},e.teamData,{plan:e.plan}),success:e.success,error:e.error,complete:e.complete};e.data&&(t.data.data=JSON.stringify(e.data)),r(t)}),_defineProperty(a,"purchasePDFExports",function(e){r({url:"/billing/PurchasePDFExports",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"reportTempExportSuccessAnon",function(e){r({url:"/ReportTempExportSuccessAnon",data:{id:e.exportKey,param1:e.yesno},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"getTempExportCount",function(e){r({url:"/Apiv1/GetTempExportCount",data:{id:e.exportKey},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"setTempExportCount",function(e){r({url:"/Apiv1/SetTempExportCount",data:{id:e.exportKey},success:e.success,error:e.error,complete:e.complete})}),_defineProperty(a,"setWelcomeMessageSeen",function(e){r({url:"/apiv1/SetWelcomeMessageSeen",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}),a},app.core.appHub=function(s,r,e,l,d,c,t){var o,u,m,a,n,p=s.timeStamp,f=(Date.now(),{}),h=[],g={},v=[],b=[],i=[],T=[],y=app.editor.saveSpinner,C=(s.msgType,$("#notify-popup")),k=!1,w=null,x=!1,P=!1,S=!1,D=[],F=[],I=null,M=null,E=!1,A=0,U=!1,N=!1,L=!1,O=1e4,R=6e4,B=100,_=0,G=[],H=5,Y=0,j=!1,z=s.lastSavedTimestamp,q=function(t){return t?d.Modules.filter(function(e){return e.Data.FormatClass==t}).length:d.Modules.length},V=($(".add-module-button, .module-button.dup-btn, .module-button.del-btn, .module-button.del-sec-btn, .preview-bottom .white-blue-btn,.empty-module .add-btn, .settings-btn.add-mod-btn, .tag-module .tag-close, .slider-outer .item-close-btn, .images-module .close-btn, .donut-module .breakup-row .item-close-btn"),$(".settings-btn.gallery-btn, .settings-btn.img-btn"),null),K=null,J=null;function W(){var a=[];return $.each(d.Modules,function(e,t){"EmptyModule"!==t.Type&&a.push({Tag:t.Tag||0,ModType:t.Type||null,ModId:t.ID||0,Data:JSON.stringify(t.Data)})}),a}function X(e){L=!0;var t=W();ve(),s.editMode&&c.saveFolioSnapShot({data:JSON.stringify(t),success:function(e){console.log("saveFolioSnapShot response",e)},error:function(e){console.log("saveFolioSnapshot error",e)},complete:function(){L=!1,e&&"function"==typeof e&&e()}})}C.find(".btn-manual-save").click(function(e){e.preventDefault(),app.popup.folioVersion(s,s.token)});var Z=function e(t,a){var n;U||(s.editMode||s.userName)&&(C.hasClass("logged-in")||C.hasClass("unable")||C.hasClass(t)||(!C.hasClass("off")||"synclost"!=t&&"stilltrying"!=t)&&(C.hasClass("stilltrying")&&"synclost"==t||"stilltrying"==t&&C.hasClass("savingdelayed")||C.hasClass("savingdelayed")&&"on"==t&&a||C.hasClass("savingdelayed")&&"synclost"==t||(clearTimeout(I),("on"!=t||7==o)&&(C.removeClass("off on unable synclost stilltrying savingdelayed gettingchanges logged-in "),"on"!==t&&C.addClass(t).show(),"synclost"==t&&(I=setTimeout(function(){s.editMode&&e("stilltrying")},15e3)),"off"!=t&&"stilltrying"!=t&&"savingdelayed"!=t||($("body").addClass("no-internet"),ue(!1),s.editMode&&(E=!0,M=setTimeout(function(){E&&s.editMode&&e("unable")},12e4))),"on"==t&&$("body").hasClass("no-internet")&&(n=function(){E=!1,clearTimeout(M),$("body").removeClass("no-internet"),$("body").removeClass("block-reload"),ue(!0),C.addClass(t).show(),I=setTimeout(function(){C.fadeOut(500)},2500)},s.editMode&&c.getFoliosLastSavedTime({token:s.token,success:function(e){var t=e.Data;if(console.log("getFoliosLastSavedTime res",e.Data),console.log("lastSavedTimestamp",z),console.log("lastSavedFromDb",t),isNaN(t))Q("error");else{var a=dayjs(t).diff(z,"millisecond");console.log("msDifference",a),20<a?Q("save-lapse"):n&&"function"==typeof n?n():console.log("checkFolioTime cb is not a function!")}},error:function(e){console.log("getFoliosLastSavedTime error",e),Q("error")}})),"unable"==t&&(console.trace(),$.connection.hub.stop(),k=!0,$("body").addClass("block-reload"))))))};function Q(e){clearTimeout(M),$("#notify-popup").hide(),k=!0,app.popup.message({heading:"error"===e?"Error":"There is a newer folio version available",message:"error"===e?"We were unable to sync changes while you were disconnected. Kindly reload to continue editing.":"Someone else has made edits while you were disconnected. Please reload to continue editing the latest folio version.",btnText:"Reload",noClose:!0,bodyCentered:!0,notMini:!0,handleOK:function(){window.location.reload()}})}var ee=function(e){s.editMode&&(1===e?(x=!1,w=setTimeout(function(){x||(console.trace(),s.editMode&&Z("savingdelayed"),w=setTimeout(function(){x||s.editMode&&Z("unable")},12e4))},15e3)):2===e&&(clearTimeout(w),x=!0,s.editMode&&Z("on")))};function te(e){switch(e.EventType){case 24:e.Data.TeamID===s.Team.Id&&r.raiseEvent("collabRequestArrived",e);break;case 27:case 32:case 36:ae(ne(e.Data.Token),e,!0);break;case 31:case 37:ae(ne(e.Data.Token),e,!1);break;case 30:case 34:r.raiseEvent("folioArchived",e.Data);break;case 58:r.raiseEvent("folioRename",e.Data);break;case 61:r.raiseEvent("userJoinedChannel",e.Data);break;case 62:r.raiseEvent("userJoinedChannelOwner",e.Data);break;case 64:r.raiseEvent("userLeftChannel",e.Data);break;case 65:r.raiseEvent("userLeftChannelOwner",e.Data);break;case 67:case 68:r.raiseEvent("folioAddedToChannel",e.Data);break;case 70:case 71:r.raiseEvent("folioRemovedFromChannel",e.Data);break;case 73:r.raiseEvent("channelDelete",e.Data);break;case 76:r.raiseEvent("channelAdd",e.Data);break;case 80:r.raiseEvent("channelChangedTeamVisible",e.Data);break;case 81:case 82:r.raiseEvent("channelChangedPrivate",e.Data)}console.log("appHub markEventDelivered: ",e.Id),m.server.markEventDelivered(e.Id)}function ae(a,n,o){a&&(clearTimeout(G[n.EventType]),G[n.EventType]=setTimeout(function(){$.each(a.Collaborators,function(e,t){(n.User||n.Data.Email)==t.Email&&(a.Collaborators[e].Accepted=!o,a.Collaborators[e].Privilege=n.Data.Privilege||n.Data.Role||0,r.raiseEvent("collabChange",a))})},1e3))}function ne(e){return Faltu(s.folios).find({Token:e}).get()[0]}function oe(){for(var e=[],t=0;t<s.folios.length;t++)e.push(s.folios[t].Token);return e=e.join(",")}function ie(a){$.connection.hub.logging=!0,$.connection.hub.start({transport:"webSockets"}).done(function(){var e;if(console.log("Connected, transport = "+$.connection.hub.transport.name),console.log("$.connection.hub.id",$.connection.hub.id),s.editMode&&d&&se(),s.editMode&&!j&&(j=!0,lscache.setBucket(s.userEmail),e=s.token,c.getFolioLastSaveTimestamp({token:e,success:function(e){var t,a;console.log("getFolioLastSaveTimestamp response",e),(a=be())&&dayjs(a.timestamp).isAfter(dayjs(t))?app.popup.message({heading:"You have a newer version",message:"Locally saved data is newer than the currently loaded folio data. Do you want to load the local version?",btnText:"Load",cancelText:"Nevermind",noClose:!0,bodyCentered:!0,notMini:!0,handleOK:function(){Te("overwrite",function(e){window.location.reload()})}}):ge()},error:function(e){console.log("getFolioLastSaveTimestamp error",e),ge()},complete:function(){}})),s.isDashboard&&s.folios&&0<s.folios.length){var t=oe();console.log("appHub.server.editorOnDashPing joined ",s.userEmail,s.fullName,t),"function"==typeof m.server.editorOnDashPing&&(console.log("ping interval"),m.server.editorOnDashPing(s.userEmail,s.fullName,t))}f[$.connection.hub.id]={},o=7,a&&a(),$.connection.hub.id}).fail(function(e){console.error("connection failed SignalR",e),o=0,s&&""!==s.userEmail&&(_<B?setTimeout(ie,2e3):app.popup.message({heading:"Signalr Connection Failed",message:"Could not establish connection, kindly reload.",btnText:"Reload",handleOK:function(){window.location.reload()}})),s.editMode&&Z("synclost"),S=!0})}function se(){var e=q();console.log("folio module count: ",e),$(".fr-embedly").each(function(){$(this).data().originalEmbed&&$(this).html($(this).data().originalEmbed)}),n=app.acl.helper(s),setTimeout(function(){n&&n.isFreePlan()&&$("#tmp-secondary-bar").find(".preview-available").addClass("free")},50)}function re(){setTimeout(function(){N=!(S=!1),pe()},1e3)}function le(e){d.LastSavedUtc=Date.now(),y(2,d.LastSavedUtc),ee(2),$.each(e,function(e,t){var a=l.obtain(h,"Tag",t.Tag);if(a){a.ID=t.Id,g[a.Key]=0,a.lastSavedData=a.dataToSave,l.removeFromList(T,null,"Tag",a.Tag),l.removeFromList(h,a);var n=b[a.Tag];n&&n()}}),++Y===H&&(de(),Y=0)}function de(){if(s.newFolioViewActive&&0!=s.newFolioViewActive){var e=$("#home-page"),t="",a="";e.css("width",Math.max($(window).width(),1367)+"px"),setTimeout(function(){r.raiseEvent("activatePreview"),a+=e.find(".container-fluid").html(),$("style").each(function(){t+=$(this).prop("outerHTML")}),a=encodeURIComponent(t+a),r.raiseEvent("revertPreview"),e.css("width",""),c.saveFolioHtml({data:{token:s.token,html:a},success:function(e){console.log("saveHtml res",e)},error:function(e){console.log("saveHtml error",e)}})},300)}}function ce(e,t){clearTimeout(u),l.pushUnique(T,{Tag:e.Tag||0,ModType:e.Type,ModId:e.ID||0,Data:e.dataToSave}),u=setTimeout(function(){!function(t,a){if(!!0,y(1),ee(1),!k)try{m.server.saveMods(d.Token,JSON.stringify(t)).always(function(){!1}).fail(function(e){console.error("save error (apphub fail)",e),fe()}).done(function(e){console.log("data sent to server, waiting for result",JSON.stringify(t)),console.log("res: from server : ",e),1==e.Status?(z=e.Timestamp,a&&a(e.TagMap)):console.error("save error (on res status)",e)})}catch(e){console.error("save error (on catch):",e),fe()}}(T,t)},3e3)}function ue(e){$("#edit-sections div[contentEditable]").attr("contentEditable",e)}function me(e,t){if(S){var a={type:"processSave",mod:e,success:t};F.push(a)}else{var n,o;if(e.Tag)N=!0,g[e.Key]||e.suspend?setTimeout(function(){me(e,t)},1e3):(e.dataToSave=JSON.stringify(e.Data),e.Syncd||e.dataToSave==e.lastSavedData||d.Role<2?(e.Syncd&&(e.Syncd=null),d.LastSavedUtc=Date.now(),y(2,d.LastSavedUtc),ee(2),l.removeFromList(h,e),t&&t()):(l.pushUnique(h,e),o=t,g[(n=e).Key]=1,b[n.Tag]=o,ce(n,le)))}}function pe(){console.log("initiating save"),$.each(d.Modules,function(e,t){"EmptyModule"!==t.Type&&me(t,!1)})}setTimeout(function(){de()},1e3);var fe=function t(){var e,a;k||(e=function(e){P&&(P=!1),e?(o=7,s.editMode&&Z("on"),re()):setTimeout(t,2e3)},(a=new Image).src="https://app.xtensio.com/img/v-"+Date.now()+"-xtensio-icon.jpg",a.onload=function(){e(!0)},a.onerror=function(){e(!1),!0})};var he=function(e,t,a){if(S){if("Editor"!=t){var n={type:"syncSend",mod:e,prop:t,val:a};F.push(n)}}else"Editor"!=t&&(N=!0),5<o&&0<e.Tag&&m.server.syncMod(d.Token,e.Tag,t,a),e.save&&e.save()};function ge(){setInterval(function(){ve()},O)}function ve(){var e=W();lscache.set(s.token,{timestamp:Date.now(),data:e})}function be(){var e=lscache.get(s.token)||!1;return console.log("localStorage data",e),e}function Te(e,t){var a=be(),n=s.token;console.log("token",n),console.log("data",a.data),console.log("verb",e),a&&("overwrite"===e?c.makeFolioFromSnapshot({data:a.data,token:n,verb:e,name:"",channels:[],success:function(e){console.log("makeFolioFromSnapshot res",e),window.location.reload()},error:function(e){console.log("makeFolioFromSnapshot error",e),app.popup.error(e.Message)}}):(s.saveFolioFromSnapshot={token:n,data:a.data,channels:t,verb:e,fromLocalStorage:!0},app.popup.saveFolio()))}function ye(e,t){var a,n,o,i;e.Tag&&(N=!0,g[e.Key]||e.suspend?setTimeout(function(){ye(e,t)},1e3):(e.dataToSave=JSON.stringify(e.Data),e.Syncd||e.dataToSave==e.lastSavedData||d.Role<2?(e.Syncd&&(e.Syncd=null),d.LastSavedUtc=Date.now(),y(2,d.LastSavedUtc),ee(2),l.removeFromList(h,e),t&&t()):(l.pushUnique(h,e),n=t,g[(a=e).Key]=1,b[a.Tag]=n,o=a,i=le,clearTimeout(u),l.pushUnique(T,{Tag:o.Tag||0,ModType:o.Type,ModId:o.ID||0,Data:o.dataToSave}),u=setTimeout(function(){var a,n;a=T,n=i,!!0,y(1),ee(1),c.saveTempMods({token:d.Token,data:encodeURIComponent(JSON.stringify(a)),success:function(e){console.log("data sent to server, waiting for result",JSON.stringify(a)),console.log("saveTempMods response",e),z=e.Timestamp;try{var t=JSON.parse(e.Data);n&&n(t.TagMap)}catch(e){console.log("saveTempMods res parse error",e)}},error:function(e){console.log("saveTempMods error",e)},complete:function(){}})},3e3))))}function Ce(){console.log("initiating save"),$.each(d.Modules,function(e,t){"EmptyModule"!==t.Type&&ye(t,!1)})}var ke,we={reg:function e(t,a,n){var o=t.Tag||0;0<o?(t["onReg"+a]&&t["onReg"+a](),v[o+a]=n):"EmptyModule"!=t.Type&&setTimeout(function(){e(t,a,n)},500)},loadFolioDataFromLocal:be,saveFolioDatatoLocal:ve,loadLocalToFolio:Te,getModuleCount:q};if((s.editMode||s.isDashboard||s.tryMode)&&s.perSaveApiCall&&0!=s.perSaveApiCall&&(H=parseInt(s.perSaveApiCall,10)),setTimeout(function(){console.log("config.subCancelledDate",s.subCancelledDate),(s.editMode||s.isDashboard)&&s.subCancelledDate&&""!==s.subCancelledDate&&!s.IsDelinquent&&Date.now()>=s.subCancelledDate&&app.popup.downgradeNoticePopup()},2e3),s.tryMode){var xe={saveMod:ye,sync:function(e,t,a){"Editor"!==t&&(N=!0),e.save&&e.save()},addListener:function(){},raiseEvent:function(){}};return l.toggleExitIntent(!0,s),se(),ke=R,void 0!==s.saveInterval&&l.isNumber(s.saveInterval)?ke=parseInt(s.saveInterval,10):console.log("config.saveInterval is undefined or not set properly. Defaulting interval to 60 secs"),console.log("saveTimer",ke),a=setInterval(function(){N&&(Ce(),X(function(){console.log("saveSnapShot called at timerSaveInterval")}))},ke),lscache.setBucket(s.token),window.addEventListener("beforeunload",function(e){s.tryMode&&!1!==s.exitIntent&&(Ce(),X(function(){console.log('saveSnapShot called from window.on("beforeunload")')}))}),_objectSpread({},we,{},xe)}return s.anonymousTemplatesPage||s.anonymousExamplesPage?_objectSpread({},we):s.editMode||s.isDashboard||s.folioMode?(function(){if(m=$.connection.appHub,(s.editMode||s.isDashboard)&&(m.client.update=function(e,t){console.log("update");try{var a=JSON.parse(t);s.isDashboard?s.isFollioDataInit?r.raiseEvent("hubMsg",e,a):s.pendingUpdateNotifications.push({event:"update",messageType:e,parsedData:a}):r.raiseEvent("hubMsg",e,a)}catch(e){console.log("appHub update error: ",e)}},m.client.feed=function(e,t){console.log("feed");try{var a=JSON.parse(t);console.log("appHub feed: "+e,a),Array.isArray(a)&&a.forEach(function(e){console.log(e),s.isFollioDataInit?te(e):s.pendingUpdateNotifications.push({event:"feed",parsedData:e,messageType:"eventHub"})})}catch(e){console.log("appHub feed error: ",e)}},m.client.editorOnDash=function(e,t,a,n,o){console.log("editorOn Dash ",e,t,a,n,o),r.raiseEvent("editorStatusOnDash",{email:t,status:2==e?2:1,folioToken:o})},m.client.editorSendBackStatus=function(e,t,a,n,o){console.log("editorSendBackOnStatus"),s.userEmail,s.fullName,m.server.sendEditorStatusUpdateToUser(s.userEmail,s.fullName,o,n)},m.client.sendEditorStatusToUser=function(e,t,a){console.log("updateEditor Status"),r.raiseEvent("editorStatusOnDash",{email:e,status:1,folioToken:a})},m.client.editor=function(e,t,a,n,o){if(console.log("appHub editor event arrived ",e,t,a,n,o),f[n]={email:t,name:a,time:Date.now(),folioToken:o},r.raiseEvent("editorStatus",{email:t,status:2==e?2:1,folioToken:o}),r.raiseEvent("editorStatusOnDash",{email:t,status:2==e?2:1,folioToken:o}),1==e){console.log("appHub.server.editorPing "),s.userEmail,s.fullName,d.Token,m.server.editorPing(s.userEmail,s.fullName,d.Token);var i=s.currentlyEditing[s.userEmail];i&&Date.now()-i.time<=6e4&&he(i,"Editor",s.userEmail)}else 2==e&&delete f[n]},m.client.onEvent=function(e,t){var a=i[e];a&&a(t)},$.connection.hub.error(function(e){console.log("SignalR error: "+e)}),$.connection.hub.connectionSlow(function(){o=6,s.editMode&&Z("synclost"),re()}),$.connection.hub.disconnected(function(){o=0,setTimeout(ie,3e3),s.editMode&&Z("synclost"),S=!0}),$.connection.hub.reconnecting(function(){s.editMode&&Z("off"),S=!0,o=1}),$.connection.hub.reconnected(function(){console.log("==== reconnected to signalR ===="),o=7,s.editMode&&Z("on",!0),re()})),s.editMode&&(m.client.updatecolorpalette=function(e,t){try{var a=JSON.parse(e),n=a.elm,o=a.listMatch,i=a.pickerType,s=$("#".concat(n)),r="scheme"===i?".module-buttons .theme-picker:first":".bg-panel";console.log("updateColorPalette client event",{elm:n,listMatch:o,hex:t}),s.find("".concat(r," .sample")).css("background-color",t),s.find("".concat(r," input.text-box")).val(t),s.find("".concat(r," .color-list .color-btn")).removeClass("selected"),null!==o&&s.find("".concat(r," .color-list .color-btn")).eq(o).addClass("selected")}catch(e){console.log("updateColorPalette client event error",e)}},m.client.syncMod=function(e,t,a,n,o){var i=!1,s=!1;o&&(i=0!=o,s=2==o);var r=v[e+t];if(S&&!i){var l={tag:e,prop:t,val:a,ts:n};D.indexOf(l)<0&&D.push(l)}else if(r){if(n<p&&!s)return;if(p==n&&e==V&&t==K&&a==J)return;V=e,J=a,"Editor"==(K=t)||s||(p=n),Date.now(),y(2,p),r(e,a)}},setInterval(function(){if(0==A)A=Date.now();else{var e=Date.now();13e4<e-A?s.editMode&&Z("unable"):A=Date.now()}},1e4)),s.pendingUpdateNotifications||(s.pendingUpdateNotifications=[]),s.editMode||s.isHome){if(s.isHome&&s.isDashboard&&s.folios&&0<s.folios.length){var e=oe();$.connection.hub.qs={dashFids:e}}ie(),function(){if(s.editMode){var e=R;void 0!==s.saveInterval&&l.isNumber(s.saveInterval)?(e=parseInt(s.saveInterval,10),console.log("config.saveInterval",s.saveInterval)):console.log("config.saveInterval is undefined or not set properly. Defaulting interval to 60 secs"),console.log("saveTimer",e),a=setInterval(function(){console.log(N,S,L,k),!N||S||L||k?k&&(console.log("Quit trying to save."),clearInterval(a)):(pe(),X(function(){console.log("saveSnapShot called at timerSaveInterval")}))},e)}}(),$(window).on("offline",function(){k||(s.editMode&&Z("off"),S=!0,fe())}),$(window).on("online",function(){console.log("window online, event received "),fe()})}}(),r.addListener("processPendingNotifications",function(){if(s.pendingUpdateNotifications&&0<s.pendingUpdateNotifications.length){console.log("processing pending notifs: ",s.pendingUpdateNotifications);for(var e=s.pendingUpdateNotifications.length;e--;){var t=s.pendingUpdateNotifications[e],a=t.event,n=t.messageType,o=t.parsedData;"update"===a&&r.raiseEvent("hubMsg",n,o),"feed"===a&&te(o),s.pendingUpdateNotifications.splice(e,1)}}}),r.addListener("folioDataLoading",function(){setTimeout(function(){C.find(".logged-in .text").html("Loading your folios..."),C.removeClass("on").addClass("logged-in").show(),setTimeout(function(){C.hide("slow").removeClass("logged-in")},2e3)},1e3)}),r.addListener("moduleRemoved",function(e){console.log("folio module count: ",q())}),r.addListener("sendUpdateColorPalette",function(e){var t=e.token,a=e.hex,n=e.data;console.log("updateColorPalette server invoke",{token:t,hex:a,data:n}),m.server.updateColorPalette(t,a,JSON.stringify(n))}),r.addListener("markNotificationAsRefreshed",function(e){console.log("markNotificationAsRefreshed notif id",e),m.server.markNotificationAsRefreshed(e)}),r.addListener("saveCurrentRevision",function(){console.log("saving snapshot..."),X(function(){setTimeout(function(){r.raiseEvent("doneSavingRevision")},1e3)})}),window.addEventListener("beforeunload",function(e){s.editMode&&!1!==s.exitIntent&&(U=!0,pe(),X(function(){console.log('saveSnapShot called from window.on("beforeunload")')}),de())}),s.editMode&&d&&(y(2,d.LastSavedUtc),ee(2),$.connection.hub.qs={fid:d.Token},r.addListener("saveBeforeExport",function(e){return X(e)}),r.addListener("docClick",function(a){var e=$("#edit-page .section-settings .more-menu"),t=$("#edit-page .section-settings .move-menu"),n=$("#edit-page .section-settings .bg-panel");e.each(function(){var e=$(this),t=e.parent().find(".section-side-panel .more-sec-btn");0===e.has(a.target).length&&0===t.has(a.target).length&&e.hide()}),t.each(function(){var e=$(this),t=e.parent().find(".section-side-panel .move-sec-btn");0===e.has(a.target).length&&0===t.has(a.target).length&&e.hide()}),n.each(function(){var e=$(this),t=e.parent().find(".section-side-panel .bg-panel-btn");0===e.has(a.target).length&&0===t.has(a.target).length&&e.hide()})})),_objectSpread({},we,{},{send:function e(t,a,n){5<o?(console.log("send"),m.server.send(t,JSON.stringify(a)).done(function(e){n&&n(e)})):setTimeout(function(){e(t,a,n)},3e3)},saveMod:me,sync:he,addListener:function(e,t){i[e]=t},getBrowserDC:function(){return S},raiseEvent:function(e,t){m.server.raise(d.Token,e,t)}})):void 0},app.core.configStore=function(n){var o,i,s;return n.localStorage||(n.localStorage={}),{folioStorage:function(e){return function(e,t){switch(s=t,e){case"folio":n.localStorage.folios||(n.localStorage.folios=[]),i=n.localStorage.folios}var a=function(){for(var e=0;e<i.length;e++)if(i[e]&&i[e][s])return i[e];return!1}();a||((a={})[s]={},i.push(a)),o=a}("folio",e),this},store:function(e,t){o[e]=t,i[s]=o},fetch:function(e){return o[e]}}},app.core.eventManager=function(){var s={},a={reset:function(){$(s).each(function(e,t){t.listeners=[]})},addEvent:function(e){s[e]={listeners:[]}},addListener:function(e,t,a,n){if("string"==typeof e)s[e].listeners.push({method:t,once:a,data:n});else for(var o=0;o<e.length;o++)s[e[o]].listeners.push({method:t,once:a,data:n})},removeListener:function(e,t){for(var a=s[e].listeners.length-1;0<=a;a--)s[e].listeners[a].method===t&&s[e].listeners.splice(a,1)},raiseEvent:function(e,t,a,n){for(var o=s[e].listeners.length-1;0<=o;o--){var i=s[e].listeners[o];i.data?i.method(i.data,t,a,n):i.method(t,a,n),i.once&&s[e].listeners.splice(o,1)}}};return $.each(["resize","loggedOut","tokenRenewed","docClick","donutError","nameChanged","plusUnlocked","hubMsg","newSignUp","labelChange","transferRequestArrived","duplicateFolio","collabChange","editorStatus","collabRequestArrived","getFolio","removeCollabs","beforeunload","collabreqaccpt","plusCancelled","foliosRecieved","addlabel","fontAdded","froalaClick","froalaCmdAfter","froalaCmdBefore","userTeamRoleChanged","folioRename","folioArchived","collabChanUdate","collabChanFolioUpdate","collabChanFolioMixItUp",,"teamTemplateUpdate","editorStatusOnDash","moduleRemoved","reInitMixerTemplates","xtensioTemplateSearch","reInitChannelMixers","updateStatsSaveAsTempLocks","saveCurrentRevision","doneSavingRevision","markNotificationAsRefreshed","processPendingNotifications","folioDataLoading","processPendingTransfers","sendUpdateColorPalette","channelAdd","channelDelete","updateFolioData","refreshLabelData","channelChangedTeamVisible","channelChangedPrivate","userJoinedChannel","userJoinedChannelOwner","userLeftChannel","userLeftChannelOwner","folioAddedToChannel","folioRemovedFromChannel","refreshMemberData","saveBeforeExport","revertPreview","clearTemplateSubmenu","initToolTips","showExamplesTab","activatePreview","useCopyTemplate","refreshFoliosOnDash","free-exceedsize","aclDataLoaded","runTryWizard"],function(e,t){a.addEvent(t)}),$(document).on("click",function(e){a.raiseEvent("docClick",e)}),$(window).on("resize",function(){var e=$(this);a.raiseEvent("resize",e.width(),e.height())}),a},app.core.folioStore=function(a,n){var o=JSON.parse(n.Store||"{}");return{get:function(e){return o[e]},set:function(e,t){o[e]=t,a.folioStore({data:{id:n.Token,data:JSON.stringify(o)}})}}},app.core.main=function(e,t){console.log("app core",app.core);var a,n=this,o=n.eventManager(),i=n.store(),s=n.utility(),r=n.apiHelper(e,t,o,i,s),l=n.plusHelper(e,r,o,s),d=n.appHub(e,o,i,s,t,r,l),c=n.pageManager(e,t,d),u=n.modStore(r),m=n.configStore(e);return t&&(a=n.folioStore(r,t)),app.acl.update(e,r,l,o),{eventManager:o,pageManager:c,store:i,utility:s,apiHelper:r,appHub:d,modStore:u,folioStore:a,configStore:m,plusHelper:l}},app.core.modStore=function(o){var i={},n={reg:function(e,t){e&&!i[e]&&(i[e]=t||{})},get:function(t,a,n,e){i[t]?n(i[t][a]):o.modStore({data:{id:t},maxAttempts:99,success:function(e){i[t]=JSON.parse(e.Message||"{}"),n(i[t][a])},error:e})},set:function(e,t,a){n.get(e,t,function(){i[e][t]=a,o.modStore({data:{id:e,data:JSON.stringify(i[e])}})})}};return n},app.core.padlocks=function(t,o,f,e){var h=app.acl.helper(f),n=h.aclLock;function g(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=app.strings.general.lockedFeatureTip;e?o.remove(t):o.add(t,n,a)}var a=function(){n(function(){if(app.acl.data){var e=$(".user-menu-popup .team-edit"),t=$(".user-menu-popup .style-guide"),a=h.styleGuideAllowed();g(h.addUsersAllowed(),e),g(a,t)}})},i=function(e){g(h.statsAllowed(),e)},s=function(e){g(h.personalTemplatesAllowed(),e,500)};function r(e,t){var a="Manage/Add Colors";e.html(a),t&&e.html(a+' <i class="icon-Color-Scheme"></i>')}var l=function(t,a){n(function(){a(),e.addListener("userTeamRoleChanged",function(e){f.userEmail==e.Data.Email&&(console.log("access changed, updating "+t+" locks"),a())})})};return{menu:{freeOldLockedItems:function(){if($("#top-bar .nav-setmenu .style-guide").remove(),t.isFree()||t.isPlus()||t.isPro()){$('<li class="item free-menu team-settings">Team Settings</li>').insertBefore("#top-bar .nav-setmenu .li-sep.free-menu");$('<li class="item free-menu team-edit">Manage Team Members</li>').insertBefore("#top-bar .nav-setmenu .li-sep.free-menu");var e=$('<li class="item free-menu style-guide">Style Guide</li>');$(e).insertBefore("#top-bar .nav-setmenu .item.free-menu.team-edit")}$("#top-bar .nav-setmenu .free-menu").removeClass("hidden"),$("#top-bar .nav-setmenu .free-menu").show(),a()},teamLockedItems:function(){(0,h.isPremiumGuest)()&&($("#top-bar .nav-setmenu li.item.upgrade").hide(),$("#top-bar .nav-setmenu li.item.billing").hide()),a()}},setMenuLocks:function(){l("menu",function(){a()})},setTemplateStatsLock:function(){l("template stats",function(){var e;i($("#templates-items-container").find(".show-stats")),e=$("#templates-items-container").find(".move-to-team"),g(h.teamTemplatesAllowed(),e)})},setFolioStatsLock:function(){f.tryMode||l("folio stats",function(){var e=$("#folio-items-container").find(".show-stats"),t=$("#folio-items-container").find(".save-template-btn");i(e),s(t)})},setLockStyleGuide:function(){f.tryMode||l("style guide",function(){var e=h.styleGuideAllowed,t=$(".froala-styleguide-link"),a=$(".theme-picker").find(".manage-color-link"),n=$(".froala-manage-color-link"),o=e();r(a,o),r(n,o),g(o,t),g(o,a),g(o,n),$("#edit-page").on("click",".bg-panel-btn",function(){var e=$("#edit-page .manage-color-link");r(e,o),g(o,e)}),$("#edit-page").on("click",".background",function(){var e=$("#edit-page .manage-color-link");r(e,o),g(o,e)})})},setNewFolioLock:function(e){l("new folio",function(){var e=$("#tmp-save-folio").find(".share-with-people");g(h.privateLinksAllowed(),e,1e3)})},setLockStatsSaveAsTemplate:function(){f.tryMode||l("lock stats save as template",function(){var e=$("#tmp-secondary-bar").find(".navs-stats"),t=$("#tmp-secondary-bar").find(".save-as-template");i(e),s(t)})},setShareFolioLinkLock:function(m,p){l("share folio link",function(){var e=h.privateLinksAllowed,t=h.passwordProtectionAllowed,a=h.customLinksAllowed;if(!_.isEmpty(m)&&(f.editMode||f.isDashboard||f.tryMode)){var n=3<f.Team.Role,o=$("#tmp-popup-folio-share-link"),i=o.find(".pass-select > .pass-protect"),s=o.find(".button-bg"),r=o.find(".change-indexed + span"),l=o.find(".btn-edit-link"),d=m.IsTeamTemplate?t()&&!n:t()&&p,c=a(),u=e();g(d,i,1e3),g(u,s,1e3),g(u,r,1e3),g(c,l,1e3),e()||(o.find(".tipped-icon.share-folio-heading-icon").hide(),o.find(".tipped-icon.share-label-heading-icon").hide(),o.find(".tipped-icon.index-folio-icon").hide())}})},teamAddLocks:function(e,t,a){if(2<a.Team.Role){if(3!==a.Team.Role)return void t.teamUserActionBlocked("invite-member",4===a.Team.Role?"Premium Guests":"Team Members");e.find(".r1").addClass("locked"),e.find(".r2").addClass("locked")}else e.find(".r1").removeClass("locked"),e.find(".r2").removeClass("locked")},setShareFolioAddPeopleLock:function(a,e){l("share folio link",function(){var e=h.isFreeGuest,t=h.isPremiumGuest;e()||t()?a.addClass("locked"):a.removeClass("locked")})},setCollaboratorLocks:function(e,t){l("collaborator",function(){g(t,e.find(".search-btn"))})},setTeamTemplateLock:function(t){l("team template",function(){var e=(0,h.teamTemplatesAllowed)();e||t.find(".tipped-icon").remove(),g(e,t)})},setStyleGuidePreviewLocks:function(){l("styleguide preview",function(){var t=$("#tmp-style-guide"),a=h.styleGuideAllowed,e=h.uploadCustomFontsAllowed;[".manage-fonts-tab .popup-cta.search",".manage-colors-tab .btn.save-color",".btn.update-color-palette",".btn.btn-upload"].forEach(function(e){g(a(),t.find(e))}),g(e(),t.find(".btn.upload-font")),a()||t.addClass("styleguide-preview")})},setCopyFolioLock:function(){f.tryMode||l("duplicate folio",function(){var e,t,a,n,o,i;e=!(h.isPremiumGuest()||h.isFreeGuest()),t=$("#folio-items-container"),a=$("#tmp-secondary-bar"),n=".copy-folio-btn",o=t.find(n),i=a.find(n),g(e,o),g(e,i)})}}},app.core.pageManager=function(e,t,i){var s,r={home:"home-page",edit:"edit-page"},l=e.editMode&&1<t.Role?r.edit:r.home;return e.tryMode&&(l=r.edit),{pages:r,showPage:function(e){$("#"+l).hide(),$("#"+e).show(),l=e,s.activatePreview()},hidePage:function(e){$("#"+e).hide()},setupEditPage:function(e,t,a){s=a;var n=$('<button type="button" class="btn btn-lg white-blue-btn edit-add-new-section trymode-tip addsection-icon">+ Add New Section</button>');function o(e){var t=a.createSection({Tag:e});return a.addModule("EmptyModule"),a.saveLayout(),t}$("#edit-sections").after($('<div class="preview-bottom" style="text-align: center; padding: 20px 0; margin-bottom: 100px;"></div>').append(n).append($('<div class="tipped-icon addsection-icon"><i class="fa fa-info-circle"></i></div>'))),n.on("click",function(){var e=o();i.raiseEvent("NewSection",e[0].data("Tag"))}),i.addListener("NewSection",o),l!=r.home?this.hidePage(r.home):(this.showPage(r.home),s.activatePreview())},isCurrent:function(e){return l==e},toggle:function(){l==r.home&&1<t.Role?this.showPage(r.edit):(this.showPage(r.home),s.activatePreview())},hideCurrent:function(){$("#"+l).hide()},restore:function(){$("#"+l).show()},getCurrentPage:function(){return l}}},app.core.plusHelper=function(u,m,n,r){var e,o,i,s,l=null,t=Date.now(),d=!1,a=!1,c=!1,p=!1,f=app.consts.subscriptions,h=app.acl.helper(u);function g(){return!(!u.Team||!u.Team.Role)&&u.Team.Role}function v(){return!!(l&&l.End&&Date.now()<l.End)}function b(){if(!1===a&&l&&l.ST)for(var e in console.log("data.ST",l.ST),f)for(var t in f[e])if(t==l.ST){a=e;break}return!!v()&&a}function T(e,t,a){u.tryMode||(d?setTimeout(function(){T(1,t)},2e3):l?y(t):(d=!0,m.getFreePlusInfo({success:function(e){l=JSON.parse(e.Message),u.plusExpireTime=l.End,d=!1,y(t)},error:function(){d=!1,y(t)},complete:function(){d=!1}})))}function y(e,t){var a,n="";C(),l&&l.End&&(n=dayjs(l.End).format("MMMM Do, YYYY"),(a=l.AR)||(a=34==l.ST)),void 0!==e&&e(l,i,a,n)}function C(){i=!1,t=Date.now(),l&&l.End&&(i=new Date(l.End)>t)}function k(e,a,n,t){t=void 0!==t&&t,console.log("exec checkFoliosLimitReached");var o=!1,i=!1,s=h.maxFolios(),r=w(),l=h.getMainPlanName(),d=h.legacyPlan();if(console.log("userType planName isLegacy",r,l,d),u.IsDelinquent&&1===Faltu(u.folios).find({Status:0}).count())return S(a,"plus"),void(i=!0);if(!u.Team||0===u.Team.Id&&0===u.lastTeamId)u.Team&&0===u.Team.Id&&("Free"===r||F()||M())&&(o=!0,e.getUserActiveFoliosCount({success:function(e){if(console.log("getUserActiveFoliosCount response",e),1<=e.Data){var t=r;return"ProBusiness"===r&&(t="Pro"),S(a,"personal",t),void(i=!0)}i||"function"!=typeof n||n()},error:function(e){console.log("getUserActiveFoliosCount error",e)}}));else{0!==u.Team.Id?u.Team.Id:u.lastTeamId;if(h.isPremiumGuest()&&!1===t)return S(a,"pg-sfg","Premium Guests"),void(i=!1);if(h.isFreePlan()&&!1===t){var c=u.userEmail;(h.isAdmin()||h.isTeamMember())&&(c=u.Team.ownerEmail),o=!0,e.getUserCurrentTeamDataAndFolios({userEmail:c,success:function(e){console.log(r," getUserCurrentTeamDataAndFolios response ",e);var t=JSON.parse(e.Data);if(void 0!==t){if(t.TotalFolios>=s)return S(a,"Free"),void(i=!0)}else console.log("getUserCurrentTeamDataAndFolios teamDetails ERR",u.Team.Id);i||"function"!=typeof n||n()},error:function(e){console.log("getUserCurrentTeamDataAndFolios error",e)}})}else!0!==d||"ProBusiness"!==r&&!0!==I()||!1!==A()?!1===d&&(o=!0,e.getUserCurrentTeamDataAndFolios({userEmail:u.userEmail,success:function(e){console.log("getUserCurrentTeamDataAndFolios response new plans ",e);var t=JSON.parse(e.Data);if(void 0!==t){if(t.TotalFolios>=s)return S(a,l),void(i=!0)}else console.log("getUserCurrentTeamDataAndFolios teamDetails new plans ERR",u.Team.Id);i||"function"!=typeof n||n()},error:function(e){console.log("getUserCurrentTeamDataAndFolios new plans error",e)}})):(o=!0,e.getUserCurrentTeamDataAndFolios({userEmail:u.userEmail,success:function(e){console.log("getUserCurrentTeamDataAndFolios response",e);var t=JSON.parse(e.Data);if(void 0!==t){if(t.TotalFolios>=s)return S(a,"pro"),void(i=!0)}else console.log("getUserCurrentTeamDataAndFolios teamDetails ERR",u.Team.Id);i||"function"!=typeof n||n()},error:function(e){console.log("getUserCurrentTeamDataAndFolios error",e)}}))}i||"function"!=typeof n||!1!==o||n()}function w(){var e="Free";if(!D()&&l&&l.ST)for(var t in console.log("data.ST",l.ST),f)for(var a in f[t])if(a==l.ST){e=t;break}return e}function x(e,t,a,n,o){t="string"==typeof t&&"Students and Educators"!=t?t.toLowerCase():t,o=void 0===o?g():o;var i=t;switch(!1===h.legacyPlan()&&(t="new-plans"),t){case"new-plans":1==o?e.message({heading:"Please Upgrade Your Account",message:"Folio Limit reached for "+r.capitalizeFirstLetter(i)+" Plan."+n+" Please upgrade to "+h.getNextPlanToUpgrade()+" Plan for more folios and other premium features, or delete active folios/templates to make room for a new folio.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){e.universalBlocker()}}):4==o?e.teamUserActionBlocked("create","Premium Guests"):e.message({heading:"You Cannot Perform this Action",message:"Folio Limit reached for "+r.capitalizeFirstLetter(i)+" Plan."+n+" Please reach out to your team owner to upgrade the account for more access, or delete active folios/templates to make room for a new folio.",btnText:"Ok",bodyCentered:!0,notMini:!0});break;case"pg-sfg":a&&"Premium Guests"===a?e.teamUserActionBlocked("create","Premium Guests"):e.teamUserActionBlocked("create");break;case"plus":e.plusPrompt("create",null,!0);break;case"pro":1==o?e.message({heading:"Please Upgrade Your Account",message:"Folio Limit reached for Pro Team."+n+"Please upgrade to Business for unlimited folios and other premium features, or delete active folios/templates to make room for a new folio.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){e.universalBlocker()}}):e.message({heading:"You Cannot Perform this Action",message:"Folio Limit reached for Pro Team."+n+" Please reach out to your team owner to upgrade the account for more access, or delete active folios/templates to make room for a new folio.",btnText:"Ok",bodyCentered:!0,notMini:!0});break;case"personal":var s={heading:"Please Upgrade Your Account",message:"Folio Limit reached for Free User."+n+" Please upgrade to a premium plan for more folios and other premium features, or delete active folios/templates to make room for a new folio.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){e.universalBlocker()}};"Free"!==a&&(s={heading:"Switch to your team dashboard",message:"Folio Limit reached for "+a+" User on personal dashboard. Please switch to your team dashboard.",btnText:"Ok",bodyCentered:!0,notMini:!0}),e.message(s);break;case"free":1==o?e.message({heading:"Please Upgrade Your Account",message:"Folio Limit reached for Free User."+n+" Please upgrade to a premium plan for more folios and other premium features, or delete active folios/templates to make room for a new folio.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){e.universalBlocker()}}):e.message({heading:"You Cannot Perform this Action",message:"Folio Limit reached for Free User."+n+" Please reach out to your team owner to upgrade the account for more access, or delete active folios/templates to make room for a new folio.",btnText:"Ok",bodyCentered:!0,notMini:!0})}}function P(e,t){return 1==t?e:e+"s"}function S(n,o,i,e){console.log("doUpgradePopup type",o,i);var d=void 0===e?u.Team.Id:e.Id,c=void 0===e?void 0:e.Role;0<d?m.listALLMembers({data:{teamId:d},success:function(e){var t=e.Data.Data.members,a=0,r=[],l=[];console.log("memberList ",t),t.forEach(function(s){m.getUserFolioCountFromTeam({username:s.Email,teamId:d,success:function(e){var t=JSON.parse(e.Data),a=t.TotalOwnedTeamTemplates,n=t.TotalOwnedUserTemplates,o=t.TotalOwnedFolios,i=s.Email==u.userEmail?"You have ":s.FullName+" has ";0<o&&r.push(i+"<strong>"+o+" "+P("folio",o)+"</strong>"),0<a+n&&l.push(i+"<strong>"+a+" saved team "+P("template",a)+"</strong> and <strong>"+n+" saved personal "+P("template",n)+"</strong>")},complete:function(){++a>=t.length&&x(n,o,i,'<ul class="folio-and-template-numbers">'+r.concat(l).map(function(e){return"<li>"+e+"</li>"}).join("")+"</ul>",c)}})})}}):x(n,o,i,"")}function D(){var e=!v();return l&&(e=0===l.ST||34===l.ST),e}function F(){return"ProBusiness"==b()}function I(){return 28===u.Team.ST||31===u.Team.ST}function M(){return 22===l.ST||25===l.ST}function E(){return u.Team&&0!==u.Team.Id&&0<u.Team.Role}function A(){return 4==g()}function U(t,a,n){m.getWorkspaceChannels({teamId:0,success:function(e){console.log("response from getWorkspaceChannels on copytemplatemenu",e),u.saveFolioTransferItem={FolioName:t,Token:a,labels:JSON.parse(e.Data),template:u.FolioName,isUseTemplate:!0},console.log("saveFolioTransferItem",u.saveFolioTransferItem),n.saveFolio()},error:function(e){console.log("error",e)}})}function N(){var e="https://app.xtensio.com/account/signup?t="+u.t,t=r.getUrlVars()._ga;t&&(e=e+"&_ga="+t),window.location.href=e}function L(e){return e+' <div class="premium-icon"></div>'}function O(){return u.tryMode}return setInterval(function(){C(),l&&l.End&&t>l.End&&!c&&(n.raiseEvent("plusCancelled"),c=p=!0)},2e3),_defineProperty(e={checkFolioRestrictions:function(l,d,c){$("#folio-items-container"),T(0,function(e,t,a,n){var i=0,s={},o=e.ST;if(a&&(10!=e.ST&&11!=e.ST||u.IsDelinquent||(i=5,s.currUser="Plus",s.limit=5)),t&&10!=e.ST&&11!=e.ST&&3!=e.ST&&16!=e.ST&&(ispro=!0),t||(i=1,s.currUser="Free",s.limit=1),u.IsDelinquent&&(i=1,s.currUser="Free",s.limit=1),!t||10!=e.ST&&11!=e.ST&&16!=e.ST&&3!=e.ST||(isplus=!0,i=5,s.currUser="Plus",s.limit=5),28===o||31===o){var r=0<u.Team.Id?10:1;i=r,s.currUser="ProBusiness",s.limit=r}console.log("limit",i,a,t,u.IsDelinquent),console.log("params",s),u.Team&&(u.IsDelinquent||u.Team.IsDelinquent)?d(s):0<i&&l.getUserActiveFoliosCount({success:function(e){var o=e.Data;console.log("user active folios:::",o),l.getUserTemplateCount({success:function(e){var t=e.Data;if(0===u.Team.Id){if(u.IsDelinquent||i<o||0<t){var a=$(".folio-item-shell.active"),n=$("#templates-items-container .folio-item.own");s.foliosCount=e.Data,(u.IsDelinquent||a.length>s.limit||0<n.length)&&0==u.Team.Id&&d(s)}}else"ProBusiness"===s.currUser&&l.getUserCurrentTeamDataAndFolios({userEmail:u.userEmail,success:function(e){console.log("getUserCurrentTeamDataAndFolios response",e);var t=JSON.parse(e.Data);void 0!==t?(t.TotalFolios>i||p)&&d(s):console.log("getUserCurrentTeamDataAndFolios teamDetails ERR",u.Team.Id)},error:function(e){console.log("getUserTeamsAndFolios error",e)},complete:function(){c&&"function"==typeof c&&c()}})},error:function(e){c&&"function"==typeof c&&c(),console.log("error: ",e)}})},error:function(e){c&&"function"==typeof c&&c(),console.log("error: ",e)}})})},checkFoliosLimitReached:k,updateConfig:function(e){u.userEmail==e.Data.Email&&u.Team.Id==e.Data.TeamID&&(u.Team.Role=e.Data.Role)},getData:T,isFree:D,isFreeOnPersonalDash:function(){return u.Team&&0===u.Team.Id},isFreeWithTeam:function(){return u.Team&&0<u.Team.Id&&(0===u.Team.ST||34===u.Team.ST)},isProBusiness:F,isProTeamMember:I,isBusinessTeamMember:function(){return 22===u.Team.ST||25===u.Team.ST},isNewBusiness:M,hasTeam:E,getUserPlan:w,getPlan:b,doUpgradePopup:S,isOldFreeUserNeverOnTrialOrPlan:function(){return!1===u.isTrial&&!1===u.isTrialCanceled&&0===u.Team.Id&&0===u.autoRenew&&null===u.ReActivationData.LastPlan},isBusinessTeam:function(){return 14===u.Team.ST||19===u.Team.ST||22===u.Team.ST||25===u.Team.ST},doExportBlocker:function(e,t){var a={heading:"You Cannot Perform this Action",message:"To download folio elements and/or PDF files, please contact your team owner to upgrade your account.",btnText:"Ok",enterAsOK:!0,notMini:!0,bodyCentered:!0};t&&(t=!0,a.heading="Please Upgrade Your Account",a.message="To download folio elements and/or PDF files, please upgrade to a premium plan.",a.cancelText="Nevermind",a.btnText="See Plans",a.handleOK=function(){e.universalBlocker()}),e.message(a)},getUserPlanByST:function(e){var t="Free";if(e)for(var a in f)for(var n in f[a])if(n==e){t=a;break}return t},loadStripe:function(e){var t,a,n;o?e&&e():(t="https://js.stripe.com/v2/",a=function(){o=1,Stripe.setPublishableKey(u.stripePublic),e&&e()},(n=document.createElement("script")).addEventListener("load",a),n.src=t,n.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(n))},refresh:function(){l=null,c=!1,this.getData(1,function(e,t){var a=t?"plusUnlocked":"plusCancelled";n.raiseEvent(a)})},isPlus:function(){return"Plus"==b()},isPro:function(){return"Pro"==b()}},"isProBusiness",function(){return"ProBusiness"===b()}),_defineProperty(e,"isBusiness",function(){return"Business"===b()}),_defineProperty(e,"isTeam",function(){return"Team"==b()}),_defineProperty(e,"isTeamActive",function(e){return!!e.Status}),_defineProperty(e,"ownsATeam",function(){return function(){var e=!1;for(var t in u.UserTeams)if(1==u.UserTeams[t].Role){e=!0;break}return!!v()&&e}()}),_defineProperty(e,"isOwner",function(){return 1==g()}),_defineProperty(e,"isAdmin",function(){return 2==g()}),_defineProperty(e,"isTeamMember",function(){return 3==g()}),_defineProperty(e,"isPremiumGuest",A),_defineProperty(e,"isSingleFolioGuest",function(){return 5==g()}),_defineProperty(e,"isFreeGuest",function(){return 5==g()}),_defineProperty(e,"getRoleName",function(){return function(){var e=u.Team.Role;for(var t in u.TeamRoles)if(u.TeamRoles[t].Id==e)return u.TeamRoles[t].Name}()}),_defineProperty(e,"isSubscriptionExpired",function(){return p}),_defineProperty(e,"setLock",function(o,e){if(u.userName){var i="https://xtensio.com/pricing/";s&&o&&!e?o(s,i):this.getData(1,function(e,t,a,n){s=e,o&&o(e,i)},!0)}}),_defineProperty(e,"isTeamPlan",function(){var e=w();return"Business"===e||"ProBusiness"===e}),_defineProperty(e,"getExpirationDate",function(){return E()?!!(u.Team.IsTeamOwnerTrial&&u.Team.plusExpireTime>Date.now())&&u.Team.plusExpireTime:!!(u.isTrial&&u.plusExpireTime>Date.now())&&u.plusExpireTime}),_defineProperty(e,"getActiveUserTeams",function(e){return void 0===e?[]:e.filter(function(e){return 1==e.Status})}),_defineProperty(e,"isFolioOwner",function(e,t){if(t.isLabel)return!t.Email||t.Email==e;if(t.Collaborators)for(var a=0;a<t.Collaborators.length;a++)if(t.Collaborators[a].Email==e&&2<t.Collaborators[a].Privilege&&1==t.Collaborators[a].Accepted)return!0;return!1}),_defineProperty(e,"showUpgradePopup",function(e){if(A())popup.teamUserActionBlocked("guest-collab");else{var t=e?"OK":"See Plans",a=e?null:"Nevermind";popup.push($comp),popup.message({heading:"Please Upgrade Your Account",message:"Collaboration is available only on premium plans. Please upgrade or switch to your team dashboard to add people",btnText:t,cancelText:a,bodyCentered:!0,notMini:!e,handleOK:function(){e?popup.close():popup.universalBlocker()}})}}),_defineProperty(e,"showFreeModuleBlocker",function(e,t){var a={heading:"Cannot Add New Module",message:"You've reached the limit for the number of modules you can add to this folio. On free accounts, each folio can have up to ".concat(t," modules, canvases and sections. <br><br>To add more modules, please delete other modules, create a new folio or upgrade your current plan."),btnText:"Ok",enterAsOK:!0,notMini:!0,bodyCentered:!0};u.Team&&1===u.Team.Role&&(a.btnText="See Plans",a.cancelText="Nevermind",a.handleOK=function(){e.universalBlocker()}),e.message(a)}),_defineProperty(e,"showFreePersonaBlocker",function(e){var t=app.consts.freePersonaLimit,a={heading:app.strings.popups.cannotPerformAction,message:"There is a limit of <strong>".concat(t,"</strong> user persona").concat(1<t?"s":""," per folio on the free plan.<br>If you'd like to add more personas, please create a new folio").concat(this.isOwner()?"<br>":""," from the ").concat(this.isTeamMember()?"<br>":"",'<a href="https://library.xtensio.com/user-persona-template-and-examples">persona template</a> or').concat(this.isTeamMember()?" reach out to the team owner to":""," upgrade your account."),btnText:"Ok",enterAsOK:!0,notMini:!0,bodyCentered:!0};u.Team&&1===u.Team.Role&&(a.btnText="See Plans",a.cancelText="Nevermind",a.handleOK=function(){e.universalBlocker()}),e.message(a)}),_defineProperty(e,"processTemplateCopy",function(a,n,e){if(u.redirectToTeamSignup)console.log("popup.signupPlansPopup"),n.signupPlansPopup();else if(u.userName){var o=!!u.UserTeams&&0<u.UserTeams.length;m.getTemplateExampleFolioName({tokenOrSlug:a,success:function(e){console.log("response from getTemplateExampleFolioName",e);var t=e.Data?"Untitled ("+e.Data+")":"Untitled";o?u.UserTeams&&0<u.UserTeams.length&&k(m,n,function(){console.log("token name",a,t),n.addFolioToSpace(a,t)}):k(m,n,function(){U(t,a)})},error:function(e){console.log("error",e)}})}else!u.t||"library@xtensio.com"!=u.folioUserName&&"template@xtensio.com"!=u.folioUserName?($("body").addClass("signupPopupOpen"),e&&"function"==typeof e&&e(),n.signUp(!0)):N()}),_defineProperty(e,"redirectFromContent",N),_defineProperty(e,"doPersonalTemplateCopy",U),_defineProperty(e,"doPremiumAppend",L),_defineProperty(e,"isTryMode",O),_defineProperty(e,"doTryOverride",function(e,t,a,n,o){if(O()){var i=L(e)+a;return t.removeClass("locked").html(i),o&&t.find(".premium-icon").css({float:"left",marginLeft:"10px"}),t}return n}),_defineProperty(e,"getCardType",function(e){var t=new RegExp("^4");return null!=e.match(t)?"visa":(t=new RegExp("^5[1-5]"),null!=e.match(t)?"mastercard":(t=new RegExp("^3[47]"),null!=e.match(t)?"amex":(t=new RegExp("^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)"),null!=e.match(t)?"discover":(t=new RegExp("^36"),null!=e.match(t)?"diners":(t=new RegExp("^30[0-5]"),null!=e.match(t)?"diners-carte":(t=new RegExp("^35(2[89]|[3-8][0-9])"),null!=e.match(t)?"jcb":(t=new RegExp("^(4026|417500|4508|4844|491(3|7))"),null!=e.match(t)?"visa-electron":"unknown")))))))}),_defineProperty(e,"getCardIconClass",function(e){return-1<e.search(/visa/gi)?"fa-cc-visa":-1<e.search(/diners/gi)?"fa-cc-diners-club":-1<e.search(/mastercard/gi)?"fa-cc-mastercard":-1<e.search(/amex/gi)?"fa-cc-amex":-1<e.search(/discover/gi)?"fa-cc-discover":-1<e.search(/jcb/gi)?"fa-cc-jcb":"fa-cc"}),_defineProperty(e,"getTeamFullUrl",function(e){var t=u.baseUrl.toString(),a=-1!==t.indexOf("localhost")?"localhost.com:44301":"xtensio",n="";return"xtensio"===a&&(n=-1!==t.indexOf("xtensio.com")?".com":".tech"),e+"."+a+n}),e},app.core.store=function(){var a={},n=function(e){return a[e]||"undefined"==typeof Storage||(a[e]=localStorage.getItem(e)),a[e]};return{keys:{showSignupPropmt:"ssp",refCount:"refcount"},get:n,getNumber:function(e,t){return+(n(e)||t||0)},set:function(e,t){a[e]=t,"undefined"!=typeof Storage&&localStorage.setItem(e,t)},remove:function(e){delete a[e],"undefined"!=typeof Storage&&localStorage.removeItem(e)}}},app.core.utility=function(){var e;var t,a=(t=0,function(e){return t++,e?t:"_"+t});var o=$("body"),i=$("<div>").css({position:"absolute",width:"100%",height:"100%",left:0,top:0});function n(e){return e=e.replace("#",""),(299*parseInt(e.substring(0,2),16)+587*parseInt(e.substring(2,4),16)+114*parseInt(e.substring(4,6),16))/1e3}function s(e){var a=[];return e.forEach(function(e,t){a.push(e.HexCode)}),a}function r(){return'<div class="module empty-module empty-canvas-cont"><p>No modules added yet.</p><button class="btn add-btn blue-btn">+ Add</button></div>'}function l(e,t,a){if(""===e.find(a).html()){e.find(a).html('<div class="module empty-module empty-canvas-cont"><p>No modules added yet.</p><button class="btn add-btn blue-btn">+ Add</button></div>'),e.find(a+" button").click(function(){t.find(".add-mod-btn:eq(0)").trigger("click")})}}var C=function(e){return function(){return window.location=e,!1}};function s(){return["#66D7C4","#FFD271","#D45D77","#9D557C","#3C688F","#1ab9d3","#fd9f4c","#c93555","#7e8589","#dcbc9f"]}function d(e){""===e.attr("style")&&e.removeAttr("style")}function c(e){if(e.StyleGuides){if(""===e.userEmail)return e.StyleGuides[0];for(var t=0;t<e.StyleGuides.length;t++){var a=e.StyleGuides[t];if(a.TeamId==e.Team.Id)return a}}return!1}function u(e){e.preventDefault(),e.returnValue="Your latest edits may not be saved."}return _defineProperty(e={sort:function(e,a,n){e&&(n=n||1,e.sort(function(e,t){return e[a]>t[a]?1*n:e[a]<t[a]?-1*n:0}))},contains:function(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return!0;return!1},obtain:function(e,t,a,n,o){if(a){for(var i=0;i<e.length;i++)if(e[i][t]==a)return e[i];for(i=0;i<e.length;i++)if(n&&e[i][n]==a)return e[i];for(i=0;i<e.length;i++)if(o&&e[i][o]==a)return e[i]}return null},findIndex:function(e,t,a){for(var n=-1,o=0;o<a.length;o++)if(a[o][t]===e){n=o;break}return n},createEventFunc:function(t,a){var n=!0;return function(e){n&&(n=!1,t.call(this,e),setTimeout(function(){n=!0},a||1e3))}},uniqueId:a,isPointInRect:function(e,t){return t.x>=e.left&&t.y>=e.top&&t.x<=e.right&&t.y<=e.bottom},pushUnique:function(e,t,a){for(var n=!1,o=0;o<e.length;o++)if(a&&e[a]==t||e[o]==t){n=!0;break}n||e.push(t)},getInitials:function(t){var a;try{a=1<(a=t.toString().toUpperCase().match(/\b\w/g)).length?a.shift()+a.pop():a.shift()}catch(e){a=t.charAt(0)}return a},removeFromList:function(e,t,a,n){for(var o=0;o<e.length;o++)if(a&&e[o][a]==n||e[o]==t)return e.splice(o,1),t},indexOf:function(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return a;return-1},changeBg:function(e,t,a){e.busy();var n=new Image;n.onload=function(){t.prepend(i.attr("class",t.attr("class")).hide()),i.css("backgroundImage","url("+a+")"),i.show(),t.css("backgroundImage","url("+a+")"),o.append(i.hide()),e.close()},n.src=a},standardizeEmail:function(e){return e.toString().trim().toLowerCase()},getUrlVars:function(){var n={};return window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,a){a=a.replace(/\#|\//g,""),n[t]=a}),n},valToProp:function(e,a){var n=null;return $.each(e,function(e,t){if(t==a)return n=e,!1}),n},isValidURL:function(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)},replaceHttp:function(e){return-1===e.indexOf("https://")&&-1===e.indexOf("http://")&&(e="https://"+e),e.replace("http://","https://")},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},rgb2hex:function(e){if(-1==e.search("rgb"))return e;var t=function(e){return("0"+parseInt(e).toString(16)).slice(-2)};return"#"+t((e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/))[1])+t(e[2])+t(e[3])},hex2Rgb:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},generateRandomColor:function(){return"#"+("00000"+(Math.random()*(1<<24)|0).toString(16)).slice(-6)},trimLowercase:function(e){return e.toString().toLowerCase().trim()},trimUppercase:function(e){return e.toString().toUpperCase().trim()},getColorBrightness:n,getColorContrast:function(e){return n(e)<=123?"#ffffff":"#000000"},compareArrays:function n(e,t){var a=Object.prototype.toString.call(e);if(a!==Object.prototype.toString.call(t))return!1;if(["[object Array]","[object Object]"].indexOf(a)<0)return!1;var o="[object Array]"===a?e.length:Object.keys(e).length;if(o!==("[object Array]"===a?t.length:Object.keys(t).length))return!1;var i=function(e,t){var a=Object.prototype.toString.call(e);if(0<=["[object Array]","[object Object]"].indexOf(a)){if(!n(e,t))return!1}else{if(a!==Object.prototype.toString.call(t))return!1;if("[object Function]"===a){if(e.toString()!==t.toString())return!1}else if(e!==t)return!1}};if("[object Array]"===a){for(var s=0;s<o;s++)if(!1===i(e[s],t[s]))return!1}else for(var r in e)if(e.hasOwnProperty(r)&&!1===i(e[r],t[r]))return!1;return!0},sortObjArray:function(a){var n=1;return"-"===a[0]&&(n=-1,a=a.substr(1)),function(e,t){return(e[a]<t[a]?-1:e[a]>t[a]?1:0)*n}},devWarnOnID:function(e,t,a){console.log("%c Did not find "+e+" on "+t+". Exec at "+a,"color: red")},devHighlightConsole:function(e,t){console.log("%c "+e.toString().toUpperCase(),"color: red; font-weight: bold"),console.log(t)},toggleElementViz:function(e,t){e?t.hide():t.show()},capitalizeFirstLetter:function(e){return e.toString().substr(0,1).toUpperCase()+e.toString().substr(1)},reloadWithoutHash:function(){window.location.hash="",setTimeout(function(){window.location.reload()},10)},doSetFocus:function(e,t){setTimeout(function(){e.focus(),console.log("setting focus to ",e)},1e3*(t||.5))},isSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},isIE9orLess:function(){return/MSIE\s/.test(navigator.userAgent)&&parseFloat(navigator.appVersion.split("MSIE")[1])<10},getColors:s,canvasHasChildren:function(e){var t=!1;return e&&e.find(".edit-content .col").each(function(e){0<$(this).children().length&&(t=!0)}),t},getEmptyCanvasCont:r,generateEmptyCanvasModule:function(e,t){e&&(e.find(".edit-content .mods .resize-bars .resize-grip:eq(0)").css("left","calc(24.99% - 0px)"),e.find(".edit-content .mods .resize-bars .resize-grip:eq(1)").css("left","calc(74.97% - 0px)"),e.find(".edit-content .mods .mods-inner .col:eq(1)").removeClass("col-sm-7").addClass("col-sm-6"),e.find(".edit-content .mods .mods-inner .col:eq(2)").removeClass("col-sm-2").addClass("col-sm-3"),l(e,e,".edit-content .col:eq(1)")),t&&(t.find(".mods .mods-inner .col:eq(1)").removeClass("col-sm-7").addClass("col-sm-6"),t.find(".mods .mods-inner .col:eq(2)").removeClass("col-sm-2").addClass("col-sm-3"))},addEmptyMod:l,swapElementsInArray:function(e,t,a){if(t<0||t>e.length-1||a<0||a>e.length-1)return!1;var n=e[t];e[t]=e[a],e[a]=n},getAppUrl:function(e){var t="";return"live"==e?t="https://app.xtensio.com/":"dev"==e?t="https://app.xtensio.tech/":"local"==e&&(t="https://www.localhost.com:44301/"),t},getLocationOrigin:function(){var e=window.location;return e.protocol+"//"+e.host},addParamToUrl:function(e,t){var a=e.search(/\#/g),n=-1<a,o=e.search(/\?/g),i=-1<o&&(!(-1<a)||o<a);if(i&&!n)return e+"&"+t;if(i&&n){var s=e.substring(0,o),r=e.substring(a,e.length-1);return s+e.substring(o,a)+"&"+t+r}return i||!n?e+"?"+t:(s=e.substring(0,a))+"?"+t+(r=e.substring(a,e.length-1))},updateTeamsInMenu:function(e,t,a,n){$(".nav-setmenu .item.team-name").remove();var o,i=this.isOnMultipleTeams(e,t),s="#top-bar .nav-setmenu";if(n.teamSettingsAllowedInMenu,0<e.UserTeams.length){var r;if(i){$("#top-bar .user-menu-popup .section-title.workspace").show(),$("#top-bar .user-menu-popup .li-sep.team-item.workspace").show();for(var l=[],d=0;d<e.UserTeams.length;d++){var c=e.UserTeams[d];if(t.isTeamActive(c)){var u=e.Team.Id===c.Id?' <i class="icon-CheckMark"></i>':"",m=e.Team.Id===c.Id?"#7d858b":"#ccc",p=e.Team.Id===c.Id?"":"normal",f=e.Team.Id===c.Id?"auto":"",h='<li style="display: list-item; color:'.concat(m,"!important; font-weight:").concat(p,"!important; cursor:").concat(f,'!important;" class="item team-name ').concat("light"," team-item teamind-").concat(d,'">').concat(e.UserTeams[d].Name+u,"</li>");l.push(h)}$("#top-bar .nav-setmenu .team-item").show()}o=e,$(l.join("")).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),o.UserTeams.forEach(function(e,t){if(o.Team.Id!=e.Id){var a=e.TeamUrl.indexOf("http")<0?"https://":"";$("#top-bar .nav-setmenu .team-item.teamind-"+t).click(C(a+e.TeamUrl))}})}else{for(d=0;d<e.UserTeams.length;d++){if(c=e.UserTeams[d],t.isTeamActive(c)&&e.Team.Id!=c.Id){var g=c.TeamUrl.indexOf("http")<0?"https://":"",v=c.TeamUrl,b='<li class="item team-name team-item teamind-'.concat(d,'"><a  href="').concat(g+v,'">').concat(e.UserTeams[d].Name,"</a></li>");$("#top-bar .nav-setmenu .team-item a[href*='"+v+"']").length<1&&($(b).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),$("#top-bar .nav-setmenu .team-item.teamind-"+d).click(C(g+v)))}$("#top-bar .nav-setmenu .team-item").show()}$("#top-bar .user-menu-popup .li-sep.team-item.workspace").hide(),$("#top-bar .user-menu-popup .section-title.workspace").hide()}0<(null===(r=e.Team)||void 0===r?void 0:r.Id)&&((0,n.teamSettingsAllowedInMenu)()?$("#top-bar .nav-setmenu .item.team-settings").show():$("#top-bar .nav-setmenu .item.team-settings").hide(),console.log("in menu",(new Date).getTime()))}if(e.Team&&0<e.Team.Id)if(e.PersonalSpaceFolios<=0||e.DisableP);else{var T='<li class="item team-menu import-folios">Import Folios</li>';$(T).insertBefore("#top-bar .nav-setmenu .li-sep.team-menu"),$("#top-bar .nav-setmenu .team-menu").show()}else e.PersonalSpaceFolios<=0||(T='<li class="item team-menu import-folios">Import Folios</li>',$(T).insertBefore("#top-bar .nav-setmenu .li-sep.free-menu"),$("#top-bar .nav-setmenu .free-menu").show());if(t.isTeamActive(e.Team)){if($(s).find(".user-role").text(function(e){for(var t=e.Team.Role,a=0;a<e.TeamRoles.length;a++)if(e.TeamRoles[a].Id==t)return e.TeamRoles[a].Name}(e)),!i){var y=$('<li class="item team-name single-team" style="color:#000">'+e.Team.Name+"</li>");$(y).insertAfter(s+" .item.upgrade")}a.menu.teamLockedItems()}else a.setMenuLocks()},isOnMultipleTeams:function(e,t){if(e.UserTeams&&0<e.UserTeams.length){var a=0;return e.UserTeams.forEach(function(e){t.isTeamActive(e)&&a++}),console.log("countActive",a),1<a}return!1},isElementInViewport:function(e){var t=e.offset().top,a=t+e.outerHeight(),n=$(window).scrollTop(),o=n+$(window).height();return n<a&&t<o}},"getColors",s),_defineProperty(e,"moveElementToPosInArr",function(e,t,a){var n=e.length;-1<a&&a<n&&-1<t&&t<n&&(removedElement=e.splice(t,1)[0],e.splice(a,0,removedElement))}),_defineProperty(e,"arrayDiff",function(e,t){var a=[];if(!("object"!==_typeof(e)&&"string"!=typeof e||"object"!==_typeof(t)&&"string"!=typeof t)&&null!==e&&null!==t)if(e.length>t.length)for(var n=0;n<e.length;n++)-1===t.indexOf(e[n])&&a.push(e[n]);else if(t.length>e.length)for(n=0;n<t.length;n++)-1===e.indexOf(t[n])&&a.push(t[n]);return a}),_defineProperty(e,"getHideShowChannelOptions",function(e,t){var a=!0,n=!0,o=e.IsDefault,i=!0;return e.IsDefault?n=!1:t.Team&&0<t.Team.Id?e.CanDelete&&4!==t.Team.Role&&5!==t.Team.Role?n=a=!1:2!==e.AccessType&&(i=!1):o=n=a=!1,{hideDelete:a,hideRename:n,hideDefault:o,hideLeave:i}}),_defineProperty(e,"getPriceFromCents",function(e){return parseInt(e,10)/100}),_defineProperty(e,"toggleSelectRole",function(e){var t="Team Member";switch(e){case 2:t="Admin";break;case 3:t="Team Member";break;case 4:t="Premium Guest";break;case 5:t="Free Guest"}return t}),_defineProperty(e,"numberWithCommas",function(e){return e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}),_defineProperty(e,"isJsLink",function(e){return console.log(e),!e.search("javascript:")}),_defineProperty(e,"clearHeaderColors",function(e){var t,a,n=".header span, h1 > span, h2 > span, h3 > span, h4 > span, h5 > span, h6 > span",o=e.Type;if(null===(t=e.Data)||void 0===t?void 0:t.Header){var i=$("<div></div>").html(e.Data.Header);i.find("span").css("color",""),d(i.find("span")),e.Data.Header=i.html()}if("Text"==o){var s=$("<div></div>").html(e.Data.Html);s.find(n).css("color",""),d(s.find(n)),e.Data.Html=s.html()}else if("DataCollection"==o){var r=$("<div></div>").html(e.Data.ButtonText),l=$("<div></div>").html(e.Data.Message);r.find(n).css("color",""),l.find(n).css("color",""),d(r.find(n)),d(l.find(n)),e.Data.ButtonText=r.html(),e.Data.Message=l.html()}else["DonutChart","Scale","Bar","Tag","TaskList"].includes(o)&&e.Data.Items.forEach(function(e){var t=$("<div></div>").html(e.Val);t.find(n).css("color",""),d(t.find(n)),e.Val=t.html()});null===(a=e.$editNode)||void 0===a||a.find(n).css("color","")}),_defineProperty(e,"implementDefaultFont",function(e){var t="",a=c(e);if(e&&a&&(a.TeamFonts.forEach(function(e){e.SourceIdentifier===a.DefaultFontFamily&&(t=e.FontJson.FontLocalName||e.FontJson.Name)}),""!==t&&!$("#defaultFont").length)){var n=document.createElement("style");n.setAttribute("id","defaultFont"),n.appendChild(document.createTextNode('#edit-sections, #modules-preview-main {\n                font-family: "'.concat(t,'", "proxima-light", Helvetica, sans-serif\n            }'))),document.head.appendChild(n)}}),_defineProperty(e,"getTeamStyleGuide",c),_defineProperty(e,"toggleExitIntent",function(e,t){e?(window.addEventListener("beforeunload",u),t.exitIntent=!0):(window.removeEventListener("beforeunload",u),t.exitIntent=!1)}),e},app.lib.googleFonts=function(e){var i={},t=[];return t.push("https://www.googleapis.com/webfonts/v1/webfonts"),t.push("?key=AIzaSyDrznrgWCKE_p-WP93QvFvpPeAynvQpakY"),{query:function(a,n){if(i[a])return console.log("cache called"),n?n(i[a]):i[a];t.push("&"+a);var o=new XMLHttpRequest;o.timeout=15e3,o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var e=JSON.parse(o.responseText);if(i[a]=e,console.log("added to cache"),!n)return e;n(e)}else if(0==XMLHttpRequest.readyState){var t={error:"Network error"};if(!n)return t;n(t)}},o.ontimeout=function(e){var t={error:"Network error"};if(console.log(e),!n)return t;n(t)},o.open("GET",t.join(""),!0),o.send(null)}}},app.dash.archivedFolioTopBanner=function(e,t,a,n){a&&1==a.Status&&($("body").addClass("archivedFolio"),$("#home-page").prepend($("#tmp-archived-topbar")).on("click",".unarchive",function(){return(!n.hasTeam()||e.IsDelinquent)&&1<=e.UserFolios?t.plusPrompt("create",null,!0):t.unarchive(a,function(){window.location.href="/"}),!1}),$("#tmp-power-by-footer").hide())},app.dash.archiveFolio=function(a,e,n){var o=$("#folio-items-container");o.on("click",".delete-folio",function(){var t=$(this).closest(".folio-item-shell");return n.archive(t.data("folio"),function(){t.animate({width:0,opacity:0,padding:0},500,"linear",function(){n.close();var e=t.toggleClass("active archived").removeClass("locked").attr("style","");$("#folio-arch-container").prepend(e),e.find(".collabs .initials:not(.add)").remove(),e.find(".edit").each(function(){console.log($(this),$(this).attr("href")),$(this).attr("href")&&$(this).attr("href",$(this).attr("href").replace("edit","folio"))}).eq(1).text("View Folio"),o.find(".folio-item-shell.active").length<1&&app.dash.emptyState(a,n).addNoFolio()})}),!1})},app.dash.changeView=function(e){"complete"==document.readyState?(0==e||2==e?(e=0==e?0:1,$(".filter-bar .filter-popup-menu .item").eq(e).click(),$(".filter-bar .filter").removeClass("menu-active"),$(".filter-bar .filter-popup-menu").hide()):1==e&&$("#tmp-sidebar .popup-menu .item").eq(2).click(),window.location.hash=""):setTimeout(function(){app.dash.changeView(e)},1e3)},app.dash.copyFolio=function(e,l,d,c,u,m,t){var s,a=$("#folio-items-container");app.core.padlocks(m,t,u,c).setCopyFolioLock(),a.on("click",".copy-folio-btn",function(){var i=$(this);return console.log("on copyFolio"),m.isSingleFolioGuest()?d.teamUserActionBlocked("create","Free Guests"):m.isPremiumGuest()?d.teamUserActionBlocked("create","Premium Guests"):(m.getData(1,function(e,t,a,n){var o=0,i={},s=e.ST;if(console.log("inside getData:::",e,t,a,n),a&&(10!=e.ST&&11!=e.ST||u.IsDelinquent||(o=5,i.currUser="Plus",i.limit=5)),t&&10!=e.ST&&11!=e.ST&&3!=e.ST&&16!=e.ST&&(ispro=!0),t||(o=1,i.currUser="Free",i.limit=1),u.IsDelinquent&&(o=1,i.currUser="Free",i.limit=1),m.isFreeWithTeam()&&(o=2,i.currUser="Free",i.limit=2),!t||10!=e.ST&&11!=e.ST&&16!=e.ST&&3!=e.ST||(isplus=!0,o=5,i.currUser="Plus",i.limit=5),28===s||31===s){var r=0<u.Team.Id?10:1;o=r,i.currUser="ProBusiness",i.limit=r}console.log("limit",o,a,t,u.IsDelinquent),u.Team&&u.Team.IsDelinquent?app.dash.downgrade(u,d,i,l,m,c):0<o&&(console.log("user limit:::",o),l.getUserActiveFoliosCount({success:function(e){var n=e.Data;console.log("user active folios:::",n),l.getUserTemplateCount({success:function(e){var t=e.Data,a=n+t;if(0===u.Team.Id&&(m.isProBusiness()||m.isProTeamMember()||m.isBusiness())||m.isFreeWithTeam()){if((u.IsDelinquent||o<=n||0<t)&&(i.foliosCount=e.Data,1===a))return void d.message({heading:"Please Upgrade Your Account",message:"Folio Limit reached for Free User. Please upgrade to a premium plan for more folios and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){d.universalBlocker()}})}else"ProBusiness"===i.currUser&&l.getUserTeamsAndFolios({userEmail:u.userEmail,success:function(e){console.log("getUserTeamsAndFolios response",e);var t=_.find(JSON.parse(e.Data),{Id:u.Team.Id});void 0!==t?(t.TotalFolios>o||m.isSubscriptionExpired())&&app.dash.downgrade(u,d,i,l,m,c):console.log("getUserTeamsAndFolios teamDetails ERR",u.Team.Id)},error:function(e){console.log("getUserTeamsAndFolios error",e)}})},error:function(e){$comp.removeClass("busy"),console.log("error: ",e)}})},error:function(e){console.log("error: ",e)}}))}),m.checkFoliosLimitReached(l,d,function(){var e=i.data("token"),t=i.closest(".folio-item-shell"),a=t.find("h4"),n=t.data("copy-count")||1;t.data("copy-count",n+1);var o="Copy "+n+" - "+a.text();t.prepend($("#spinner-container > .loading-animation").clone()),u.duplicateFolioItem={FolioName:o,Token:e,IsDuplicate:!0},d.saveFolio(void 0,void 0,!0),u.saveFolioSuccess&&(s=u.saveFolioSuccess),"undefined"!==s&&""!==s?t.find(".loading-animation").remove():t.prepend($("#spinner-container > .loading-animation").clone())})),!1})},app.dash.createFolio=function(a,e,n,o,i,t){$("body").on("click",".folio-item .create-btn",function(e){if(console.log(".create-btn clicked..."),i.isSingleFolioGuest()||i.isPremiumGuest())o.teamUserActionBlocked("create","Premium Guests");else{var t=$(this);i.checkFoliosLimitReached(n,o,function(){a.saveFolioTemplate={id:t.closest(".folio-item").data("template"),name:t.closest(".folio-item").data("name")},o.saveFolio()})}}),$("body").on("click",".folio-item .create-ex-btn",function(e){if(console.log(".create-ex-btn clicked..."),i.isSingleFolioGuest()||i.isPremiumGuest())o.teamUserActionBlocked("create","Premium Guests");else{var t=$(this);i.checkFoliosLimitReached(n,o,function(){a.saveFolioExample={id:t.closest(".folio-item").data("template"),Token:t.closest(".folio-item").data("token"),name:t.closest(".folio-item").data("name")},o.saveFolio()})}})},app.dash.createNewMenu=function(t,a){$(".ribbon-button").on("click",function(){if(a.isPremiumGuest()||a.isSingleFolioGuest())return t.teamUserActionBlocked("create",a.getRoleName()+"s"),!1;var e=$(this).parent(".plus-menu");e.toggleClass("active"),e.hasClass("active")&&setTimeout(function(){$("body").on("click.remover",function(){e.removeClass("active"),$("body").off(".remover")})},100)})},app.dash.defaultLabel=function(e,t,a,n,o){var i=function(e){o.message({heading:"Are you sure?",message:"Set this channel as your default channel?",btnText:"Yes",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){a.makeLabelDefault({token:e.Token,success:function(){o.close(),setTimeout(function(){window.location="/"},500)},error:function(e){o.error(e.Message)}})}})};$("#all-labels-container").on("click",".default-btn",function(){return i($(this).data("label")),!1}),$(".label-details").on("click",".default",function(){return i($(this).closest(".label-details").data("label")),!1})},app.dash.delFolio=function(a,n){$("#folio-arch-container .warning #empty-trash").click(function(){var e=$("#folio-arch-container .folio-item-shell"),t=[];e.each(function(e){t.push($(this).data("token"))}),0<e.length?n.message({heading:'Are you sure you want to delete </br>all folios in trash forever?<p style="padding-bottom:20px;"></p>',message:"All information, image assets, and form submissions will be deleted. Any links to this folio or its images will not be accessible.<br/>You won't be able to undo this action.",btnText:"Yes, Delete All",cancelText:"Cancel",enterAsOK:!0,notMini:!0,handleOK:function(){n.busy(),a.emptyTrash({success:function(){n.close(),$("#folio-arch-container .warning").hide(),e.each(function(e){$(this).animate({width:0,opacity:0,padding:0},500,"linear",function(){$(this).remove()})})},error:function(){n.error("There was an error. Please refresh page and try again.")}})}}):n.error("There is no folios in archived list.")}),$(".folios-container").on("click",".archived-options .delete",function(){var e=$(this).closest(".folio-item-shell");return n.message({heading:'Are you sure you want to <br/>delete forever?<p style="padding-bottom:20px;"></p>',message:"All information, image assets, and form submissions will be deleted. Any links to this folio or its images will not be accessible.<br/>You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){a.deleteFolio({data:{op:"del",token:e.data("token")},success:function(){e.animate({width:0,opacity:0,padding:0},500,"linear",function(){e.remove()})},error:function(){n.error("There was an error. Please refresh page and try again.")}})}}),!1}),$(".folios-container").find(".link").click(function(){n.universalBlocker()})},app.dash.delLabel=function(o,i,s,r,l){var e=function(t,a){console.log("selected channel data",t);var e={heading:"Are you sure?",message:"All folios will be removed and the channel will be deleted. If you had any channel collaborators, they will no longer have access to this channel and may lose access to some folios. No folios will be deleted.",btnText:"Yes, Delete Channel",cancelText:"Cancel",bodyCentered:!0,notMini:!0,enterAsOK:!0},n={success:function(e){console.log(a.toString().toUpperCase()+" API response",e),$("#all-folios-button").hasClass("active")||setTimeout(function(){$("#all-folios-button").removeClass("active"),$("#all-folios-button").click()},500),$("#all-labels-container").find(".item[data-name="+t.Token+"]").remove(),i.removeFromList(o.labels,t),r.raiseEvent("labelChange")},error:function(e){console.log(a.toString().toUpperCase()+" API error",e),l.error(e.Message)}};"delete"===a?(n.token=t.Token,o.Team&&0<o.Team.Id?t.CanDelete?(e.handleOK=function(){s.removeCollabChan(n)},l.message(e)):l.message({heading:"Upgrade your privileges",message:"Channel members are not allowed to perform this action",btnText:"Ok",enterAsOK:!0,notMini:!0}):(e.handleOK=function(){s.removeLabel(n)},l.message(e))):o.Team&&0<o.Team.Id&&(n.data={labelToken:t.Token,memberEmail:o.userEmail,remove:!0},e.message="Leaving this channel will only remove the channel name.<br/> No folios will be deleted.",e.btnText="Yes, Leave Channel",e.handleOK=function(){s.addRemoveChannelCollaborator(n)},l.message(e))};$("#all-labels-container").on("click",".delete-btn",function(){return e($(this).data("label"),"delete"),!1}),$(".label-details").on("click",".delete",function(){return e($(this).closest(".label-details").data("label"),"delete"),!1}),$("#all-labels-container").on("click",".leave-btn",function(){return e($(this).data("label"),"leave"),!1}),$(".label-details").on("click",".leave",function(){return e($(this).closest(".label-details").data("label"),"leave"),!1})},app.dash.downgrade=function(n,o,i,s,r,e){var t=$(".folio-item-shell.active"),a=$("#templates-items-container .folio-item.own"),l=$("#tmp-downgrade-bar");n.IsDelinquent||n.Team&&n.Team.IsDelinquent?n.trialConverted?o.trialExpirePopup(!1,!1,!0):n.isTrialCanceled?o.downgradeNoticePopup():"Free"==i.currUser&&1==i.limit?o.trialExpirePopup(!0):o.trialExpirePopup():!n.IsDelinquent&&Date.now()>=n.plusInfo.End&&("Free"==i.currUser&&1==i.limit?o.trialExpirePopup(!0):0===n.autoRenew?o.downgradeNoticePopup():o.expiredBlocker(i)),(r.isFreeWithTeam()||r.isFree()&&n.Team&&0===n.Team.Id)&&((l=0==l.length?$("#tmp-downgrade-bar"):l).find(".downgrade-bar .plan").text(i.currUser),l.find(".downgrade-bar .limit").text(i.limit),l.find(".downgrade-bar .s").text(2<i.limit?"s":""),$("#logo-bar").after(l),$("#dashboard-page").addClass("downgrade"),$(".upgrade-btn, .plus-menu").remove(),$(".sidebar #add-label").remove(),$(".folio-item.as-template .cta-btn.primary").addClass("visible-hidden"),l.find(".link").click(function(){var e=r.getActiveUserTeams(n.UserTeams).find(function(e){return 1==e.Role});0!==n.Team.Id?1===n.Team.Role&&"ProBusiness"===i.currUser?o.universalBlocker():3<n.Team.Role&&e&&(window.location=e.TeamUrl):o.billing()}),t.each(function(e,t){var a=$(t),n=a.data("folio"),o=Faltu(n.Collaborators).find({Accepted:!0}).count(),i=a.addClass("locked").find(".edit");i.eq(0).attr("href",i.eq(0).attr("href").replace("edit","folio")),i.eq(1).remove();var s=a.find(".archived-options").empty();2<n.Role&&s.append('<div class="action delete-folio" data-tip="Delete"><i class="icon-Delete"></i></div>').data("token",n.Token),1<o&&n.Role<3&&s.append('<div class="action delete-folio" data-tip="Leave"><i class="icon-Transfer"></i></div>').data("token",n.Token)}),a.each(function(e,t){var a=$(t),n=(a.data("folio"),a.addClass("locked").find(".edit"));n.eq(0).removeAttr("href"),n.eq(1).remove(),a.find(".use-template").remove(),a.find(".archived-options").empty().append('<div class="action delete-folio" data-tip="Delete"><i class="icon-Delete"></i></div>')}),a.on("click",".delete-folio",function(){var e=$(this).closest(".folio-item-shell");o.message({heading:"Delete this template?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes, Delete This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){s.deleteUserTemplate({token:e.data("token"),op:"del",success:function(){e.animate({width:0,opacity:0,padding:0},500,"linear",function(){e.remove()})},error:function(e){$("#dashboard-page > .loader").hide(),o.message({heading:"Oops!",message:e.Message,btnText:"Ok",enterAsOK:!0})}})}})})),function a(){var e=$(".folio-item-shell.active"),t=$("#templates-items-container .folio-item.own");e.length<=i.limit&&0==t.length?n.IsDelinquent||n.Team&&n.Team.IsDelinquent?n.trialConverted?(l.show(),o.failedPaymentBlocker(i)):o.trialExpirePopup():"Free"==i.currUser&&1==i.limit?window.location.reload():r.isSubscriptionExpired()?(l.show(),o.expiredBlocker(i)):0<n.Team.Id&&"ProBusiness"===i.currUser?s.getUserTeamsAndFolios({userEmail:n.userEmail,success:function(e){console.log("getUserTeamsAndFolios response",e);var t=_.find(JSON.parse(e.Data),{Id:n.Team.Id});void 0!==t?t.TotalFolios<=i.limit?window.location.reload():setTimeout(a,1e3):console.log("getUserTeamsAndFolios teamDetails ERR",n.Team.Id)},error:function(e){console.log("getUserTeamsAndFolios error",e)}}):window.location.reload():setTimeout(a,1e3)}()},app.dash.emptyState=function(s,r){var l=$("#folio-items-container"),d=$("#tmp-empty-state").html();function e(e){$("#tmp-dash-topbar a.template").click()}function t(e,t,a,n,o){var i=$(d);i.find("h2").text(e),i.find("p.tag").text(t),a?i.find("button").text(a).on("click",n):i.find("button").hide(),s.Team&&0<s.Team.Id&&s.Team.Role<4?s.PersonalSpaceFolios<=0?i.find("p.imp-folio").remove():i.find("p.imp-folio").on("click",function(){r.importFolioPopup()}):i.find("p.imp-folio").remove(),l.append(i.addClass(o||""))}return{addNoFolio:function(){t("Create your first folio.","A folio can be any document or presentation: Create one-pagers, fact sheets, pitches and proposals, press releases, employee handbooks, reports, strategy canvases, landing pages and more.","Choose a template to get started",e,"empty")},addNoShared:function(){t("Looks like no one's shared folios with you yet.","When collaborators add you to their folios, you will see them here.",!1,null,"empty-shared")},addNoMyFolio:function(){t("Create your first folio.","A folio can be any document or presentation: Create one-pagers, fact sheets, pitches and proposals, press releases, employee handbooks, reports, strategy canvases, landing pages and more.","Choose a template to get started",e,"my-empty")}}},app.dash.exampleLabels=function(i,a,s,t,r,l){var n,o=$(".folios-container.examples"),d=$("#tmp-example-sidebar"),c=$("#single-label").html(),u=$("#tmp-example-labels-container"),m=$("#dashboard-page .filter-bar .example-sort"),p=a.getColors(),f=$("#examples-items-container");a.sort(i.exampleLabels,"Name"),0===$("#dashboard-page").find("#exampleloader").length&&$("#dashboard-page").append($('<div id="exampleloader" class="example-loader"><div class="loading-animation"></div></div>')),n=$("#dashboard-page").find("#exampleloader");var h,g,v,b=o.find(".label-details.example"),T=o.find(".example-labels-dropdown");function y(e){e?(f.css("visibility","hidden"),n.find(".loading-animation").html(t.spinner),n.show()):(f.css("visibility","visible"),n.hide())}function C(e){g=f.find(".as-example"),h.filter(g.filter("."+e))}$("#example-sidebar").append(d),s.addListener("reInitMixerTemplates",function(){y(!0),function(){if(i.exampleLabels){u.html("");for(var e=0;e<i.exampleLabels.length;e++){var t=i.exampleLabels[e],a=$(c).data("label",t);t.color=p[e%p.length],a.find(".label").css("background-color",t.color),a.find(".name").text(t.Name||"Untitled"),a.find(".options").remove(),a.on("click",k).data("label",t),u.append(a);var n=$("<option></option>");n.text(t.Name||"Untitled").val(t.Token),T.append(n)}}}(),function(){h&&h.destroy();var e=m.find(".item.active").data("value");e=void 0===e?"used:desc":e,h=mixitup(o,{animation:{duration:400},selectors:{target:".folio-item"},load:{filter:".xtensio",sort:e},callbacks:{onMixEnd:function(){var e=app.core.padlocks(r,l,i,s),t=e.setTemplateStatsLock,a=e.setFolioStatsLock,n=e.setCopyFolioLock,o=e.setLockStatsSaveAsTemplate;setTimeout(function(){n(),o(),t(),a()},200)},onMixFail:function(e){y(!1),console.log("No items could be found matching the requested filter")}},debug:{enable:!0},controls:{enable:!1}}),clearTimeout(v),v=setTimeout(function(){h.forceRefresh()},1e3)}(),h.filter("all"),y(!1)});function k(){var e=$(this),t=e.data("label");if(d.find(".item").removeClass("active"),e.addClass("active"),f.find(".state").hide(),b.find(".label-name").css({paddingLeft:"10px"}),b.find(".label-name").css({display:"inline-block"}),t&&"own"==t.Token&&(b.find(".label-color").hide(),f.find(".own").removeClass("hidden")),!t)return h.filter(".xtensio"),b.addClass("normal").find(".label-name").text("Xtensio Examples"),void f.find(".state").hide();b.removeClass("normal"),b.find(".label-name").text(t.Name),b.find(".label-color").css("background-color",t.color),C(t.Token)}s.addListener("showExamplesTab",function(){$("#tmp-dashboard-content .x-select.example-labels-dropdown").hide(),b.find(".label-name").hide(),u.show(),u.find(".item").removeClass("active"),$("#tmp-dashboard-content .x-select.example-labels-dropdown").show(),b.find(".label-name").css({display:"inline-block"}),h&&h.filter("all"),b.addClass("normal").find(".label-name").text("Xtensio Examples")}),T.on("change",function(){var e=$(this).val(),t=a.obtain(i.exampleLabels,"Token",e);if(null===t)return h.filter("all"),void b.addClass("normal");C(t.Token),b.removeClass("normal")}),m.change(function(){h.sort($(this).data("value"))})},app.dash.examples=function(s,r,e,t,a,n,o){var i=$("#app-load-animation"),l=$("#examples-items-container"),d=$(".nav-main-menu a").not("a.help-center, a.examples-link"),c=r.getColors(),u=$(".tab-content"),m=$("#example-item").html();app.core.padlocks(a,o,s,n);function p(i,e){$.each(e.Labels,function(e,t){var a=r.obtain(s.exampleLabels,"Token",t),n=c[e%c.length];if(a){a.color=n;var o=$('<div class="label"></div>').css("background-color",n).text(a.Name);o.data("token",a.Token),i.addClass(a.Token),i.find(".labels").prepend(o)}})}function f(o){void 0!==s&&s.isDashboard&&t.getExampleData({success:function(e){console.log("getExampleData response",e);try{var t=JSON.parse(e.Data),a=JSON.parse(t.XtensioExamples),n=JSON.parse(t.ExampleLabels);console.log("--- examples data ---",t),s.exampleLabels=n,l.html(""),function(e){for(var t=0;t<e.length;t++){var a=e[t];tempFolio=$(m),tempFolio.attr("data-template",a.TemplateName).attr("data-name",a.PublicName||a.FolioName).attr("data-used",a.UsedCount).attr("data-type",!1).attr("data-date",a.CreatedDate).attr("data-token",a.FolioToken),p(tempFolio,a),a.Thumbnail&&tempFolio.find(".img").removeClass("hidden").find("img").attr("src",a.Thumbnail),a.UsedCount&&tempFolio.find(".used").text("Used "+a.UsedCount+" times");var n=a.FolioUrlSlug?a.FolioUrlSlug:a.FolioToken;url=s.baseUrl+"/"+n;var o=tempFolio.find("h4");o.text(a.PublicName||a.FolioName),setTimeout(function(){o.scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",minScrollWidth:268,animBack:!0,ellips:32})},1e3),tempFolio.find(".preview, .link").attr("href",url),a.IsNew&&tempFolio.find(".new-label").removeClass("hidden"),tempFolio.find(".img").hover(function(){$(this).stop().animate({scrollTop:$(this).find("img").height()},5e3)},function(){$(this).stop().animate({scrollTop:0},2e3)}),tempFolio.find(".create-cont").hide(),tempFolio.find(".link-share-cont").hide(),tempFolio.find(".options").remove(),tempFolio.addClass("xtensio"),tempFolio.hide(),l.append(tempFolio),console.log("tempFolio",tempFolio)}}(a),"function"==typeof o&&o()}catch(e){console.trace("getExampleData error",e)}},error:function(e){console.log("getExampleData error",e)},complete:function(){n.raiseEvent("initToolTips")}})}tempFolio=null,url=null,$(".nav-main-menu a.examples-link").click(function(e){if(1==s.enableExamplesTab){e.preventDefault(),d.removeClass("active");var t=$(this),a=t.addClass("active").index();u.addClass("hidden").filter(":eq("+a+")").removeClass("hidden"),$("body").removeClass("colored-dashboard"),n.raiseEvent("clearTemplateSubmenu",t),tempInit=!0,l.css({opacity:0}),i.show(),f(function(){n.raiseEvent("reInitMixerTemplates"),setTimeout(function(){l.css({opacity:1}),n.raiseEvent("showExamplesTab"),i.hide()},2e3)})}})},app.dash.expiredTrials=function(e,o,t){function a(e){var t=e-Date.now(),a=Math.floor(t/864e5),n=Math.floor(t%864e5/36e5);return i.text(a+" days, "+n+" hours "),t<0&&o.expiredBlocker(),t}var n=$("#tmp-trial-expired-bar"),i=n.find(".trial-expired-bar .timer"),s=n.find(".trial-expired-bar .message"),r=t.getExpirationDate(),l=(a(r),setInterval(function(){a(r)<0&&clearInterval(l)},36e5));$("#dashboard-page").addClass("onTrial"),$("#edit-page").addClass("onTrial"),$("#logo-bar").before(n),t.isOwner()||!t.hasTeam()?(s.text("Your free trial expires in"),n.find(".trial-expired-bar p").append($('<span class="link">Upgrade Now</span>'))):s.text("Your team is on a free trial that expires in"),n.find(".link").click(function(){o.universalBlocker()})},app.dash.getExploreFolio=function(T,e,t){var y=$("#tmp-dashboard-content .explore .loading-animation");y.html(t.spinner),e.getFolioFullByToken({token:T.ExploreTabFolioToken,success:function(e){console.log("Success from GetFolioByTOken",e);var t,a,n,o,i,s=JSON.parse(e.Data).FolioData,r=app.core.main(T,s),l=r.utility,d=r.apiHelper,c=r.eventManager,u=r.pageManager,m=r.store,p=r.modStore,f=r.folioStore,h=r.configStore,g=r.appHub,v=r.plusHelper,b='<style id="folio-style" type="text/css">'+(f.get("style")||"")+"</style>";$("head").append(b),app.plugin.main(T,r,s,v,l),n=app.popup.main(T,c,l,d,u,v,p,m,s,f,h,g),t={},o=(a=app.managers.main(T,s,r,t,n)).modManager,i=a.rddm,console.log(s),app.factory.main(T,s,r,t,n,o,i,l),o.activatePreview(),T.EditTemplate="dash-explore",app.menutcopy(T,d,c,n,v,l),$("#home-page").after($("#presentation-buttons").addClass("public")),y.hide()},error:function(e){console.log("Error from GetFolioByTOken",e),$("#tmp-dash-topbar .explore").hide(),y.hide()}})},app.dash.filterBar=function(e,t,s,a,r,n,l){var d,o,i,c=app.acl.helper(l),u=app.strings.popups,m=u.collabNotAvailableMsg,p=u.pleaseUpgradeAccount,f="private",h=$("#dashboard-page > .loader"),g=!1;function v(){s.message({heading:"Please Upgrade Your Account",message:"Channel collaboration is only available on team dashboards. Please upgrade or switch to your team dashboard to add people.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){s.universalBlocker()}})}function b(){s.message({heading:p,message:m(c.getMainPlanName(),c.getNextPlanToUpgrade()),btnText:"See Plans",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){s.universalBlocker()}})}function T(){0!=c.collabActive()?c.isPremiumGuest()?s.teamUserActionBlocked("guest-collab"):s.teamChannelManagePopup(!0):b()}h.find(".loading-animation").html(s.spinner),setTimeout(function(){$(".label-details:not(.temp)").find(".label-name").scrollText({speed:2e3,startEvent:"mouseenter",minScrollWidth:190,ellips:0,animBack:!0})},1e3),d=$(".filter-bar .private-button"),o=$(".filter-bar .add-new-people"),i=$(".filter-bar .initials.add"),l.Team&&0<l.Team.Id&&l.isDashboard?(o.hide(),d.click(function(){var e=$(this).find(".item.active").data("name"),t=$("#all-labels-container").find(".item.active").data("name"),a=_.findIndex(l.labels,["Token",t]);0!=c.collabActive()||"private"!=e||l.labels[a].OwnerEmail!==l.userEmail?4!==l.Team.Role&&5!==l.Team.Role||(-1!==a&&(console.log("config.labels[labelID]",l.labels[a]),f=2===l.labels[a].AccessType?"team":"private"),s.message({heading:"You Cannot Perform this Action",message:"Sorry, guests are not allowed to change access type of channels. Please reach out to a team admin for more access.",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0}),setTimeout(function(){doToggleHtml(f)},300)):b()}),d.change(function(){if(!g){var e=function(e){var t="private"===e?'<i class="icon-PadlockBig"></i> Private':'<i class="icon-UsersGroup"></i> Team Visible';t='<span class="text-current">'+t+'</span><i class="icon-Down-Arrow"></i>',d.find(".text").html(t)},t=function(e){(g=e)?(d.addClass("disable-ui"),h.show()):(h.hide(),d.removeClass("disable-ui"))},a=$(this).data("value"),n=$("#all-labels-container").find(".item.active").data("name"),o=_.findIndex(l.labels,["Token",n]);-1!==o&&(console.log("config.labels[labelID]",l.labels[o]),f=2===l.labels[o].AccessType?"team":"private"),console.log("private-button change",a),console.log("labelToken",n),e(a);var i="Are you sure you want to make this channel private? Your team members will be removed from folios within this channel. You can still add individual collaborators to the channel and folios.";"team"===a&&(i="Are you sure you want to make this channel team visible? All of your team members will have editing access to all folios added to this channel."),s.message({heading:"Channel Access Change",message:i,btnText:"Ok",cancelText:"Cancel",bodyCentered:!0,enterAsOK:!0,notMini:!0,handleOK:function(){t(!0),r.changeChannelAccess({data:{labelToken:n,newAccessType:"private"===a?1:2},success:function(e){f=a,console.log("changeChannelAccess response",e)},error:function(e){a=f,console.log("changeChannelAccess err",e)},complete:function(){t(!1),d.find(".item").removeClass("active"),d.find("div[data-name='"+a+"']").addClass("active"),e(a)}})},handleNo:function(){t(!1),e(f)}})}}),o.click(T),i.click(T)):(d.addClass("fade-ui"),d.unbind("click"),o.addClass("fade-ui"),i.hide(),d.click(v),o.click(v))},app.dash.filter=function(f,h,e,g,d,t,c,u){var v,b,T,y,C,n,o,k=app.acl.helper(f),w=$(".folios-container:not(.templates)"),i=w.find(".folio-item-shell"),x=$(".label-details:not(.temp):not(.example)"),a=($(".content .filter-bar .labels-dropdown"),$(".my-shared-popup-menu")),s=$("#tmp-empty-channel-state").html(),r=$("#all-folios-button"),l="private",m='<i class="icon-PadlockBig"></i> Private',p='<i class="icon-UsersGroup"></i> Team Visible',P=$("#tmp-filter-bar"),S=$(P.html()),D=$(s),F=$("#dashboard-page > .loader"),I=$("#folio-arch-container #days-limit");F.find(".loading-animation").html(e.spinner);var M=app.plugin.popupMenu(r,a,!0);function E(e){U(""),0===$("#folio-items-container .state.empty-label").length&&setTimeout(function(){O()},1e3),n.forceRefresh(),o.forceRefresh(),n.filter(e),o.filter(e)}function A(){console.log("config.selectedChannel=====",f.selectedChannel);var r=f.lastChannel.toString().replace("chan-",""),e=0<$("#all-labels-container").find('div[data-name="'.concat(r,'"]')).length;f.selectedChannel||(f.selectedChannel=e?f.lastChannel:"all"),f.sortChannel||(f.sortChannel="saved:desc"),console.log("setMixer exec");var t={animation:{duration:400},selectors:{target:".folio-item-shell"},load:{filter:"all"===f.selectedChannel?f.selectedChannel:"."+f.selectedChannel,sort:f.sortChannel},controls:{enable:!1},callbacks:{onMixStart:function(e,t){F.show()},onMixEnd:function(e,t){F.hide();var a=app.core.padlocks(d,u,f,c),n=a.setTemplateStatsLock,o=a.setFolioStatsLock,i=a.setCopyFolioLock,s=a.setLockStatsSaveAsTemplate;setTimeout(function(){i(),s(),n(),o(),f.lastChannel&&"all"!==f.lastChannel&&r&&$('.filter-bar .label-details .labels-dropdown option[value="'.concat(r,'"]')).prop("selected",!0)},200)}}},a=_objectSpread({},t,{callbacks:{onMixStart:function(e,t){F.show()},onMixEnd:function(e,t){var a=$("#folio-items-container .state.empty-label"),n="none"===a.css("display");setTimeout(function(){a.css("opacity",n?0:1)},300),console.log(n);var o=app.core.padlocks(d,u,f,c),i=o.setTemplateStatsLock,s=o.setFolioStatsLock,r=o.setCopyFolioLock,l=o.setLockStatsSaveAsTemplate;setTimeout(function(){r(),l(),i(),s()},200),F.hide()}}});n&&n.destroy(),o&&o.destroy(),n=mixitup(w.eq(0),a),o=mixitup(w.eq(1),t),console.log("empty-label count",$("#folio-items-container .state.empty-label").length),0===$("#folio-items-container .state.empty-label").length&&setTimeout(function(){O()},1e3)}function U(e){w.removeClass("mine shared").addClass(e)}function N(e){console.log("applyFilter target",e);var t=(i=w.find(".folio-item-shell")).filter(".".concat(e,", .transfer-item"));E(t),L(e);var a=t.filter(".active, .transfer-item").length,n=t.filter(".archived").length;$("#folio-items-container")[0<a?"addClass":"removeClass"]("has-label-folios"),$("#folio-arch-container")[0<n?"addClass":"removeClass"]("has-label-folios")}function L(e){g.setLastChannel({token:e,success:function(e){console.log("setLastChannel response",e)},error:function(e){console.log("setLastChannel err",e)}})}function O(){F.hide(),D.find("button.view-all").on("click",function(){$("#tmp-dash-topbar .nav-main-menu .template").trigger("click")}),console.log("createEmptyState exec"),$("#folio-items-container").append(D.addClass("empty-label"))}function R(){var t=$("#all-labels-container").find(".item.active").data("name");console.log("currentToken",t);var e=_.findIndex(f.labels,function(e){return e.Token===t});if(console.log("config.labels",f.labels),console.log("labelID",e),-1!==e){var a="";console.log("config.labels[labelID]",f.labels[e]),l=2===f.labels[e].AccessType?(a=p,"team"):(a=m,"private"),a='<span class="text-current">'+a+'</span><i class="icon-Down-Arrow"></i>',b.find(".text").html(a),b.find(".item").removeClass("active"),b.find("div[data-name='"+l+"']").addClass("active")}else console.log("Failed to retrieve current label's details")}$("#folio-items-container").before(S),$("#templates-items-container").before($("#tmp-temp-filter-bar").html()),$("#examples-items-container").before($("#tmp-examples-filter-bar").html()),$(".filter-bar .sort").change(function(){var e=$(this).data("value");f.sortChannel=e,($("#folio-items-container").hasClass("active")?n:o).sort(e)}),$(".filter-bar .filter").change(function(){"Deleted"==$(this).data("value")?(I.html(k.maxRetentionDays()),0<$("#folio-arch-container .folio-item-shell").length?($("#folio-arch-container .warning").show(),$("#dashboard-page").addClass("has-archived")):($("#folio-arch-container .warning").hide(),$("#dashboard-page").removeClass("has-archived"))):$("#dashboard-page").removeClass("has-archived"),$("#folio-items-container").removeClass("active archived").addClass($(this).data("value").replace("Deleted","Archived").toLowerCase());var e=S.find(".label-details");e.hasClass("normal")&&e.find(".label-name").text($(this).data("value")+" Folios")}),c.addListener("reInitChannelMixers",function(){A()}),r.click(function(){f.selectedChannel="all",$(this).hasClass("active")&&M()}),a.find(".item").on("click",function(){var e=$(this);if(!e.hasClass("active")){e.addClass("active").siblings().removeClass("active"),r.find(".name").text(e.data("show-name"));var t=e.data("show-name");$(".label-details:not(.temp):not(.example)").addClass("normal").find(".label-name").text(t),w.removeClass("label-view"),L("all"),U(e.data("orderby"))}}),$(document).on("change",".content .filter-bar .labels-dropdown",function(e){var t=$(this).val(),a=h.obtain(f.labels,"Token",t);if(null===a)return"all"!=t?U(t):(E("all"),L("all")),i.removeClass("hidden"),void x.addClass("normal");U(""),N("chan-"+a.Token),x.removeClass("normal").data("label",a)}),f.Team&&0<f.Team.Id&&f.isDashboard&&c.addListener("refreshLabelData",function(){return R()}),A(),void 0===f.filterInit&&($("#dashboard-page").append('<div class="loader" style="position: fixed;width: 100%;height: 100%;top: 0;left: 0;display: none;z-index: 99999;"><div class="loading-animation"></div></div>'),$("#tmp-sidebar").on("click",".item:not(.pmenu)",function(e){if(!(0<$(e.target).closest(".options").length)){v=$("#tmp-sidebar .sidebar").find(".item:not(.pmenu)");var t=$(this);v.removeClass("active"),t.addClass("active");var a=t.data("name"),n=t.find(".name").text(),o=t.find(".label").attr("style");if(w.removeClass("has-label-folios"),!a){w.removeClass("label-view");var i="My Folios"==n?"mine":"Shared With Me"==n?"shared":"";return E("all"),L("all"),U(i),void x.addClass("normal").find(".label-name").text(n)}w.addClass("label-view"),(x=$(".label-details:not(.temp):not(.example)")).removeClass("normal").data("label",t.data("label")),x.find(".label-name").text(n),x.find(".label-name").stop(),x.find(".label-name").removeAttr("style"),x.find(".label-color").attr("style",o);var s=f.labels[h.findIndex(a,"Token",f.labels)],r=h.getHideShowChannelOptions(s,f),l=r.hideDelete,d=r.hideRename,c=r.hideDefault,u=r.hideLeave;if(h.toggleElementViz(c,x.find(".default")),h.toggleElementViz(l,x.find(".delete")),h.toggleElementViz(d,x.find(".rename")),h.toggleElementViz(u,x.find(".leave")),f.Team&&0<f.Team.Id&&f.isDashboard){b=$(".filter-bar .private-button"),R();var m=$("#all-labels-container").find(".item.active").data("name");T=$(".filter-bar .add-new-people"),y=$(".filter-bar .initials.add"),C=$(".filter-bar .initials-list"),T.show(),y.hide(),C.empty(),k.collabActive()&&g.getChannelCollaborators({data:{token:m},success:function(e){console.log("getChannelCollaborators response",e);var t=JSON.parse(e.Data);if(console.log("collaboratorsData",t),0<t.length){T.hide(),y.show(),C.empty();for(var a=3<t.length?3:t.length,n=0;n<a;n++){var o=$('<div data-tip="" class="initials"></div>'),i=t[n].FullName||t[n].Email;o.data("tip",i),o.text(h.getInitials(i)),C.append(o)}}},error:function(e){console.log("getChannelCollaborators response",e)}})}if("all"!==a){var p="".concat(f.baseUrl,"/#channel-").concat(a,"-").concat(n.toString().replace(/ /g,"-"));window.history.replaceState("object or string","Xtensio Dashboard",p),a="chan-"+a}N(f.selectedChannel=a)}}),f.selectedChannel="",f.filterInit=!0)},app.dash.folios=function(f,h,g,v,b,m){Date.now(),f.plusInfo.End;var p=0,T=0,y=0,e=($("#home-page"),$("#dashboard-page")),t=$("#tmp-sidebar"),a=$("#tmp-dashboard-content"),C=a.find("#folio-items-container"),k=a.find("#folio-arch-container"),w=$("#folio-item").html(),n=($("#single-label"),t.find("#all-labels-container"),a.find("#sidebar")),x=($("#top-bar"),$("#app-load-animation"));isplus=!1,ispro=!1;var o=app.acl.helper(f),l=o.getMainPlanName,d=o.getNextPlanToUpgrade,c=o.isPremiumGuest,u=o.collabActive,i=app.strings.popups,P=i.collabNotAvailableMsg,S=i.pleaseUpgradeAccount;function D(t,a){0===f.labels.length?$("#add-label").click():v.labels(a,t,function(e){t.find(".labels >*:not(:last-child)").remove(),F(t,a,!0)})}function F(s,r,l){var e=".folio-item-shell[data-token="+s.data("token")+"]",d=null;!0===l&&0<$(e).length&&(d=$(e)),s.find(".labels").empty(),!0===l&&d.find(".labels").empty(),$.each(r.Labels,function(e,t){var a=g.obtain(f.labels,"Token",t),n=_.findIndex(f.labels,function(e){return e.Token===t});if(a){var o=a.color||f.colors[n%f.colors.length],i=$('<div class="label"></div>').css("background-color",o).html(a.Name+'<div class="ghost"><i class="icon-Close"></i></div>');i.data("token",a.Token),i.find(".ghost").on("click",function(){(function(e,t){var a=$(this),n=a.data("token"),o=g.removeFromList(t.Labels,n);e.removeClass(o);var i={token:t.Token,id:$(this).data("token"),success:function(e){a.animate({width:0,opacity:0,padding:0},500,"linear",function(){a.hide()})},error:function(e){console.log(e),v.error(e.Message)}};if(f.Team&&0<f.Team.Id)if(4===f.Team.Role||5===f.Team.Role)v.message({heading:"You Cannot Perform this Action",message:"Sorry, guests are not allowed to add or remove folios to channels. Please reach out to a team admin for more access.",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0});else{var s=_.findIndex(f.labels,["Token",n]);if(0<=s)var r=f.labels[s];else console.log("WARN DEV: token "+n+" not found on config.labels");!t.IsCurrentUserOwner&&0<=s&&(2==r.AccessType||1==r.AccessType&&0<r.ChannelMembers.length)?v.message({heading:"Do you really want to remove this folio?",message:"Removing the folio from <b>"+r.Name+"</b> will remove all channel collaborators, including you. The folio will return to <b>"+t.UserFullName+"'s</b> default channel.",btnText:"Yes, remove the folio",cancelText:"Nevermind",notMini:!0,handleOK:function(){b.removeFromCollabChan(i)}}):b.removeFromCollabChan(i)}else b.removeFromLabels(i)}).call(i,s,r)}),s.addClass("chan-"+a.Token),s.find(".labels").prepend(i),!0===l&&(d.addClass("chan-"+a.Token),d.find(".labels").prepend(i))}})}function I(e,t){if(!(t.Version<2)){var n=e.find(".collabs"),o=0,i=[],s=[];if($.each(t.Collaborators,function(e,t){if(t.Accepted&&0<t.Privilege&&t.Email!=f.userEmail)if(++o<=5){var a=$('<div class="outer"><div class="initials">MU</div></div>');a.find(".initials").text(g.getInitials(t.FullName||t.Email)).attr("data-tip",t.FullName).attr("data-email",t.Email),n.prepend(a.find(".initials"))}else i.push(t.Email),s.push(t.FullName)}),5<o){var a=n.find(".initials:last-child");s.unshift(a.attr("data-tip")),i.unshift(a.attr("data-email")),a.attr("data-html","true").text("+"+(o-5+1)).attr("data-email",i.join("-")).attr("data-tip",s.join("<br/>"))}var r=$('<div class="initials add"><i class="icon-AddCollaborator2"></i></div>');c()||m.isFreeGuest()?(r.attr("data-tip","Add / Remove People"),r.click(function(){v.teamUserActionBlocked("add-remove-collab","Guests")})):(1===t.Role?r.addClass("hidden"):r.removeClass("hidden"),r.attr("data-tip","Add / Remove People"),r.click(function(){var e;0!=u()?(e=t,v.collaborators(e)):v.message({heading:S,message:P(l(),d()),btnText:"See Plans",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){v.universalBlocker()}})})),n.append(r)}}function M(t,e,a,n){var o=$(w),i=(f.baseUrl,t.Token,t.FolioName||"Untitled"),s=dayjs(t.LastSavedUtc);t.Status<1&&(T++,2<t.Role&&p++),t.Role<3&&y++,o.attr("data-token",t.Token).attr("data-saved",t.LastSavedUtc).attr("data-name",i.toLowerCase()).data("folio",t),o.addClass(0===t.Status?"active":"archived"),o.addClass(1<t.Role?t.Role<3?"shared edit-access":"mine":"shared");var r,l=o.find("h4");l.text((r=i,$("<div/>").html(r).text())),setTimeout(function(){l.scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",minScrollWidth:268,animBack:!0,ellips:32})},1e3),o.find(".inline-title").val(i),0==t.Status&&o.find(".preview").attr("href",f.baseUrl+"/edit/"+t.Token+"#preview").removeClass("hidden"),o.find(".edit").attr("href",f.baseUrl+"/"+(0===t.Status?"edit":"folio")+"/"+t.Token);var d,c=1==t.Status?"View":"Edit";(o.find(".options .edit").text(c+" Folio"),o.find(".delete-folio, .copy-folio-btn, .rename-folio-btn, .transfer-folio-btn").data("token",t.Token),o.find(".last-update").find("span").text(s.fromNow()).attr("title",s.format("lll")),t.Role<3)&&(o.find(".delete-folio span").text("Leave"),o.find(".delete-folio i").removeClass("icon-Delete").addClass("icon-Transfer"),_.flatten(_.map(_.filter(f.labels,{AccessType:2}),"FolioTokens")).includes(t.Token)?o.find(".delete-folio").hide():o.find(".delete-folio").show());if(F(o,t),I(o,t),o.find(".manage-label").click(function(){f.Team&&0<f.Team.Id?(console.log("Role",f.Team.Role),console.log("$tempFolio",o),console.log("folio",t),4===f.Team.Role||5===f.Team.Role?v.message({heading:"You Cannot Perform this Action",message:"Sorry, guests are not allowed to add or remove folios to channels. Please reach out to a team admin for more access.",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0}):D(o,t)):D(o,t)}),o.find(".share").click((d=t,function(){return v.shareLink(d),!1})),f.Team&&0==f.Team.Id&&!ispro&&h.addListener("aclDataLoaded",function(){var e=app.plugin.lockedTip(f,h);app.dash.folioStats(f,v,m,e,h)}),3!==t.Role&&o.find(".transfer-folio-btn").addClass("hidden"),e)$("body").animate({scrollTop:0},500),o.addClass("scaleup").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){$(this).removeClass("scaleup")}),C.find('.folio-item-shell:not(".transfer-item"):eq(0)').before(o);else if(t.Status<1){n&&($("body").animate({scrollTop:0},500),o.addClass("scaleup").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){$(this).removeClass("scaleup")}),setTimeout(function(){o.removeClass("scaleup")},2e3));var u=$("#all-labels-container").find(".item.active").attr("data-name");u&&!o.hasClass("chan-".concat(u))&&o.hide(),a?C.prepend(o):C.append(o)}else k.find(".folio-item-shell[data-token='"+o.data("token")+"']").remove(),k.append(o);h.addListener("labelChange",function(e){o.find(".labels >*:not(:last-child)").remove(),F(o,t)})}e.append(a),n.append(t),C.addClass("visible-hidden");var s,r=app.core.padlocks(m,lockedTip,f,h),E=r.setTemplateStatsLock,A=r.setFolioStatsLock,U=r.setCopyFolioLock,N=r.setLockStatsSaveAsTemplate;function L(e){e&&setTimeout(function(){$("#all-labels-container").find('div[data-name="'.concat(e,'"]')).click()},1e3)}if(s=function(){var e=$.trim(window.location.hash.substr(1));if(e&&e.indexOf(!0))L(e.toString().split("-")[1]);else if(f.lastChannel&&"all"!==f.lastChannel)L(f.lastChannel.toString().replace("chan-",""));else if(!f.lastChannel){if(0<(f.folios&&f.folios.length)){var t=f.labels,a=t.find(function(e){return e.FolioTokens.length}),n=t.find(function(e){return e.ChannelMembers.length});L((1==t.length?t[0]:a||n||t[0]).Token)}}},f.isFollioDataInit=!1,x.show(),h.raiseEvent("folioDataLoading"),b.getFolioData({success:function(e){console.log("getFolioData response",e),C.find(".state.empty").remove();try{var t=JSON.parse(e.Data),a=""===t.UserFolios?[]:JSON.parse(t.UserFolios),n=""===t.TransferFolios?[]:JSON.parse(t.TransferFolios),o=""===t.PendingFolios?[]:JSON.parse(t.PendingFolios);console.log("config.folios ",f.folios),console.log("userFolios1 ",a),f.folios=a,f.tansFolios=n,f.foliosPending=o,console.log("userFolios",f.folios),console.log("transferFolios",f.tansFolios),console.log("foliosPending",f.foliosPending),i=a,C.html(""),i.sort(function(e,t){return t.LastSavedUtc-e.LastSavedUtc}),i.forEach(function(e){return M(e)}),C.is(":empty")&&app.dash.emptyState(f,v).addNoFolio(),C.addClass("active").removeClass("visible-hidden"),U(),N(),E(),A(),x.hide(),f.isFollioDataInit=!0,h.raiseEvent("processPendingNotifications"),h.raiseEvent("processPendingTransfers"),h.raiseEvent("reInitChannelMixers"),s&&"function"==typeof s&&s()}catch(e){console.error("getFolioData error",e),x.hide()}var i},error:function(e){console.error("getFolioData error",e),x.hide()}}),$(".custom-select").on("click",function(){$(this).parent(".folio-item").toggleClass("selected",$(this).is(":checked"))}),h.addListener("collabChange",function(e){var t=$('.folio-item-shell[data-token="'+e.Token+'"]');t.find(".collabs").empty(),I(t,e),app.plugin.tooltip()}),h.addListener("folioRename",function(e){$('[data-token="'+e.Token+'"]  > .folio-item > a > h4').html(e.NewFolioName)}),m.checkFolioRestrictions(b,function(e){app.dash.downgrade(f,v,e,b,m,h)}),m.getExpirationDate()&&app.dash.expiredTrials(f,v,m),function(){T<1&&f.tansFolios&&0===f.tansFolios.length?0===C.find(".state.empty").length&&app.dash.emptyState(f,v).addNoFolio():C.find(".state.empty").remove();0<T&&p<1?0===C.find(".state.my-empty").length&&app.dash.emptyState(f,v).addNoMyFolio():C.find(".state.my-empty").remove()}(),y<1&&app.dash.emptyState(f,v).addNoShared(),h.addListener("collabreqaccpt",function(e,t){M(e,!1,t)}),h.addListener("folioArchived",function(e){var t;t=e.Token,f.isHome&&(C.find(".folio-item-shell[data-token='"+t+"']").remove(),console.log("folio cont length",C.find("div").length),0===C.find(".active").length&&0===C.find(".state.empty").length&&app.dash.emptyState(f,v).addNoFolio())}),h.addListener("foliosRecieved",function(e,t){e.Collaborators.push({Email:f.userEmail,FullName:f.fullName,Privilege:3,Accepted:!0}),M(e,!1,t,!0)}),h.addListener("refreshFoliosOnDash",function(){var p;console.log("refreshFoliosOnDash"),x.show(),h.raiseEvent("folioDataLoading"),b.getFolioData({success:function(e){console.log("updateFolioItems getFolioData response",e);try{var t=JSON.parse(e.Data),a=""===t.UserFolios?[]:JSON.parse(t.UserFolios);console.log("config.folios ",f.folios),console.log("userFolios ",a);for(var n,o,i,s=[],r=[],l={},d=a.length,c=f.folios.length,u=[],m=0;m<d;m++)s.push(a[m].Token),l[a[m].Token]=a[m];for(m=0;m<c;m++)r.push(f.folios[m].Token);if(d!==c){if(d<c&&(u=g.arrayDiff(r,s)),0<u.length)for(m=0;m<u.length;m++)$(".folio-item-shell[data-token='"+u[m]+"']").remove()}else if(d===c){for(m=0;m<d;m++)s.push(a[m].Token),l[a[m].Token]=a[m];for(m=0;m<c;m++)(o=l[(n=f.folios[m]).Token]).Collaborators&&n.Collaborators.length!==o.Collaborators.length&&((i=$(".folio-item-shell[data-token='"+n.Token+"']")).find(".collabs").empty(),I(i,n))}console.log("userFolioTokens ",s),console.log("configFoliosTokens ",r),console.log("userFoliosWithKey ",l),console.log("foliosToRemove ",u),f.folios=a,C.is(":empty")&&app.dash.emptyState(f,v).addNoFolio(),x.hide(),p&&"function"==typeof p&&p()}catch(e){console.error("getFolioData error",e),x.hide()}},error:function(e){console.error("getFolioData error",e),x.hide()}})}),f.Team&&0<f.Team.Id&&f.isDashboard){h.addListener("editorStatusOnDash",function(e){console.log("editorStatusOnDash in folios.js ",e);var t=f.currentlyEditing[e.email],a=1==e.status?t&&t.active?"editing":"active":"";!function(t){var e=$(".folio-item-shell[data-token='"+t.folioToken+"']").find("[data-email*='"+t.email+"']");if(e.attr("data-html")){var a=e.attr("data-email").split("-"),n=e.attr("data-tip").split("<br/>")[a.findIndex(function(e){return e==t.email})],o=$(".collabs .initials").filter(function(){return 0<!$(this).find("i").length&&!$(this).attr("data-html")});if(o.length){var i=$(o[0]),s=i.attr("data-tip"),r=i.attr("data-email");i.text(g.getInitials(n)).attr("data-tip",n).attr("data-email",t.email).attr("data-original-title",n),e.attr("data-tip",e.attr("data-tip").replace(n,s)).attr("data-original-title",e.attr("data-tip")).attr("data-email",e.attr("data-email").replace(t.email,r))}}}(e);var n=$("[data-token='"+e.folioToken+"']").find("[data-email*='"+e.email+"']");0==n.find(".status").length&&n.append("<i class='status'></i>"),0==n.find(".editing").length&&n.append("<i class='editing'></i>"),n.removeClass("active editing").addClass(a)}),h.addListener("updateFolioData",function(e){var n=e.data,t=e.cb;if(console.log("updateFolioData data ",n),n&&n.FolioData){x.show(),h.raiseEvent("folioDataLoading");var o=n.FolioData,a=!0,i=!1;f.labels.forEach(function(e){e.Token===n.Token&&(i=!0)});var s=[];if(console.log("updateFolioData folioData ",o),0<o.length){if(f.folios.forEach(function(t){var a=!1,n=!0;o.forEach(function(e){t.Token===e.Token&&(a=!0),f.labels.forEach(function(e){-1!==e.FolioTokens.indexOf(t.Token)&&(n=!1)})}),a||n||s.push(t)}),console.log("updateFolioData filtered ",s),console.log("updateFolioData prevLabels ",f.prevLabels),f.prevLabels){var r=f.prevLabels.find(function(e){return e.Token===n.LabelToken});if(r){var l=[];if(r.FolioTokens&&0<r.FolioTokens.length&&(r.FolioTokens.forEach(function(e){-1===n.FolioTokens.indexOf(e)&&l.push(e)}),console.log("removedFolioTokens",l),0<l.length)){var d=[];if(l.forEach(function(t){var a=!1;f.labels.forEach(function(e){e.Token!==n.Token&&-1!==e.FolioTokens.indexOf(t)&&(a=!0)}),a&&d.push(t)}),console.log("foliosNeedUpdating",d),0<d.length){a=!1;var c=0,u=d.length,m=setInterval(function(){c===u&&(clearInterval(m),a=!0)},500);d.forEach(function(t){var i=_.findIndex(s,function(e){return e.Token===t});-1!==i?b.getRemovedFolioData({token:t,success:function(e){console.log("getRemovedFolioData response",e);var t=JSON.parse(e.Data),a=t.LabelTokens,n=t.Collaborators,o=s[i];console.log("rfolioData",o,i),o.LabelTokens=a,o.Collaborators=n,s.splice(i,1,o)},error:function(e){return console.log("getRemovedFolioData error",e)},complete:function(){return c++}}):c++})}}}}}else s=f.folios;var p=setInterval(function(){a&&(clearInterval(p),function(e,t,a,n){if(f.folios=e?[].concat(_toConsumableArray(t),_toConsumableArray(a)):_toConsumableArray(t),C.html(""),f.folios.sort(function(e,t){return t.LastSavedUtc-e.LastSavedUtc}),f.folios.forEach(function(e){return M(e)}),C.is(":empty")&&app.dash.emptyState(f,v).addNoFolio(),C.addClass("active").removeClass("visible-hidden"),x.hide(),"all"==f.selectedChannel)$("#all-folios-button").click();else{var o=f.selectedChannel.toString().replace("chan-","");$("#all-labels-container [data-name='"+o+"']").click()}n&&"function"==typeof n&&n()}(i,s,o,t))},500)}})}},app.dash.folioStats=function(e,t,a,n,o){var i=app.acl.helper(e),s=$("#folio-items-container"),r=app.core.padlocks(a,n,e,o),l=r.setTemplateStatsLock,d=r.setFolioStatsLock;function c(){l(),d()}o.addListener("plusUnlocked",c),o.addListener("plusCancelled",c),o.addListener("updateStatsSaveAsTempLocks",c),s.on("click",".show-stats",function(){if(i.statsAllowed()){var e=$(this).closest(".folio-item-shell");return t.folioStats(e.data("token"),e.find(".edit h4").text()),!1}t.statsBlocker("folio")})},app.dash.globalAlert=function(e,t){var a=$("#tmp-global-alert"),n=a.find(".global-alert-container"),o=a.find("#gdpr");$p=n.find("p.content"),$close=n.find(".closebtn"),$p.html(o.html()),$("body").addClass("global-alert").prepend(n),$close.on("click",function(){t.setGdprConsent({success:function(){console.log("consent closed")}});var e=n.outerHeight();n.animate({opacity:.25,height:"0px"},1e3,function(){n.remove()}),$("#top-bar, #home-page, #edit-page, #dashboard-page").animate({"margin-top":"-="+e+"px"},2e3,function(){$("#n-panel").css("top","50px"),$("body").removeClass("global-alert")})})},app.dash.inlineRename=function(r,l){$(" #folio-items-container, #templates-items-container").on("click",".inline-action-edit",function(){var e=$(this),t=$(this).next(".inline-action-save"),a=t.find(".inline-title"),n=e.prev(".edit").find("h4");t.removeClass("hidden"),e.addClass("inactive"),a.removeClass("error").focus().blur(function(){e.removeClass("inactive")}).on("keydown",function(e){13==(e.which||e.keyCode)?t.find(".save-icon").trigger("mousedown"):27==(e.which||e.keyCode)&&a.blur()}).data("lastVal",n.text()),n.text(a.data("lastVal")),a.val(n.text())}),$("#folio-items-container, #templates-items-container").on("mousedown",".save-icon",function(){var e=$(this),t=e.parent(".inline-action-save"),a=t.closest(".folio-item").find("h4"),n=t.find(".inline-title"),o=n.val(),i=t.find(".inline-save-error"),s=e.closest(".folio-item-shell").data("folio");if(o.length<3)return n.addClass("error"),i.removeClass("hidden"),void n.focus();o!=n.data("lastVal")?(a.text(o),t.addClass("fadeout"),n.off("keypress"),i.addClass("hidden"),$(".inline-action-edit").removeClass("inactive"),r.renameFolio({token:s.Token,name:o,success:function(){s.FolioName=o,s.LastSavedUtc=Date.now(),n.val(o).data("lastVal",o),t.removeClass("fadeout").addClass("hidden")},error:function(e){a.text(n.data("lastVal")),n.val(n.data("lastVal")),l.error(e.Message)}})):t.addClass("hidden")})},app.dash.labels=function(c,u,m,p,o,f){var i,s,r,h=$("#all-labels-container"),g=$("#single-label").html(),v=$(".labels-dropdown"),l=$("#app-load-animation");function d(s,e){var t=$(g).data("label",s),a=s.color||c.colors[e%c.colors.length];(t.find(".label").css("background-color",a),t.find(".name").text(s.Name||"Untitled"),c.selectedChannel)&&(c.selectedChannel.toString().replace("chan-","")===s.Token&&t.addClass("active"));t.find(".share").click(function(){if(c.Team&&0<c.Team.Id){var e=s.Token,i=_.findIndex(c.labels,["Token",e]);console.log("currentTOken",e),console.log("currentLabelID",i),-1!==i?u.getLabelOwner({data:{token:e},success:function(e){var t=JSON.parse(e.Data),a=c.userEmail===t.Email,n=f.isPremiumGuest()||f.isSingleFolioGuest(),o=!c.labels[i].Private;a||!n&&o?p.shareLink(s,null,null,a):p.message({heading:"You Cannot Perform this Action",message:"Only channel owners can adjust the channel's link sharing settings. Reach out to the channel owner to perform this action. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})},error:function(e){console.log("getLabelOwner error",e),p.message({heading:"Oops!",message:"Could not process request. Please try again later. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})}}):m.devHighlightConsole("Token not found on config.labels",e)}else p.shareLink(s)});var n=m.getHideShowChannelOptions(s,c),o=n.hideDelete,i=n.hideRename,r=n.hideDefault,l=n.hideLeave;m.toggleElementViz(r,t.find(".default-btn")),m.toggleElementViz(o,t.find(".delete-btn")),m.toggleElementViz(i,t.find(".rename-btn")),m.toggleElementViz(l,t.find(".leave-btn")),t.find(".default-btn, .delete-btn, .leave-btn, .rename-btn").data("label",s),t.attr("data-name",s.Token),h.append(t);var d=$("<option></option>");d.text(s.Name||"Untitled").val(s.Token),v.append(d)}function b(){var a,n;h.html(""),n=[],$.each(c.labels,function(e,t){t.IsDefault?a=t:n.push(t)}),a&&n.sort(function(e,t){return e.Name>t.Name}).unshift(a),c.labels=n,console.log("channels sorted");for(var e=0;e<c.labels.length;e++)d(c.labels[e],e)}function e(e,t){var a=h.find(".item").length;c.labels.push({Name:e,Token:t.Message,FolioTokens:[],Private:!0,HasPass:!1,Indexed:!1,isLabel:!0,color:c.colors[a%c.colors.length]});var n=c.labels.length-1;d(c.labels[n],n),o.raiseEvent("reInitChannelMixers")}function t(e){var n;i=e.goToNewChannelCb,s=e.channelToken,r=e.openLabelsPopup,console.log("refreshData ",e),n=function(){o.raiseEvent("updateFolioData",{data:e,cb:function(){o.raiseEvent("refreshLabelData"),o.raiseEvent("refreshMemberData"),function(t){if(c.selectedChannel){var e=c.selectedChannel.toString().replace("chan-","");if(console.log("setChannelToAllFilter",e,t),e===t){l.show();var a=c.labels.filter(function(e){return e.Token===t});console.log("channel",a),0===a.length?setTimeout(function(){$("#all-folios-button").removeClass("active"),$("#all-folios-button").click(),l.hide()},1500):setTimeout(function(){h.find("[data-name='".concat(t,"']")).trigger("click"),l.hide()},1500)}}}(e.Token),console.log("data.refreshFolios ",e.refreshFolios),!0===e.refreshFolios&&o.raiseEvent("refreshFoliosOnDash")}})},l.show(),u.getLabelData({success:function(e){try{console.log("getLabelData response",e);var t=JSON.parse(e.Data),a=""===t?[]:JSON.parse(t);a.forEach(function(e,t){return e.color=c.colors[t%c.colors.length]}),console.log("labels",a),c.prevLabels=_toConsumableArray(c.labels),c.labels=a,b(),n&&"function"==typeof n&&n(),i&&"function"==typeof i&&(i(s),s=i=!1),!0===r&&(p.labels(null,null,null,!0,s),o.raiseEvent("refreshLabelData"),r=!1)}catch(e){console.log("try catch getLabelData err",e)}},error:function(e){console.log("getLabelData err",e)},complete:function(){return l.hide()}})}$("#add-label").on("click",function(){if(c.Team&&0<c.Team.Id){if(5===c.Team.Role||4===c.Team.Role)return void p.message({heading:"You Cannot Perform this Action",message:"Sorry, guests are not allowed to create new channels. Please reach out to a team admin for more access.",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0});p.teamChannelPopup()}else p.personalChannelPopup(e);return!1}),o.addListener("addlabel",function(e){d(c.labels[e],e),o.raiseEvent("reInitChannelMixers")}),c&&c.isDashboard&&(o.addListener("channelAdd",function(e){return t(e)}),o.addListener("userJoinedChannel",function(e){return t(e)}),o.addListener("channelChangedTeamVisible",function(e){return t(e)}),o.addListener("channelDelete",function(e){return t(e)}),o.addListener("userLeftChannel",function(e){return t(e)}),o.addListener("channelChangedPrivate",function(e){return t(e)}),o.addListener("userJoinedChannelOwner",function(e){return t(e)}),o.addListener("userLeftChannelOwner",function(e){return t(e)}),o.addListener("folioAddedToChannel",function(e){return t(e)}),o.addListener("folioRemovedFromChannel",function(e){e.refreshFolios=!0,t(e)})),b()},app.dash.listRequests=function(n,e,o){var i=null,s=$("#tmp-dashboard-content").find("#folio-items-container"),r=$("#tmp-tranfer-item").html();function l(){s.find(".state.empty-label").removeClass("empty-label")}function t(e){if(1<n.UserTeams.filter(function(e){return e.Role<4}).length&&-1==window.location.hash.search(/accepttransfer/))o.transferFolioToSpace({sameUser:!1,skipPersonal:!0,outsideRequest:!0,Data:{Token:e.Token,TeamID:n.Team.Id,Owner:n.userEmail}});else{var t=s.find("div").data();if((!t||t.code!=(e.Secret||e.Code))&&((i=$(r)).data("code",e.Secret||e.Code),i.data("item",e),i.find("h4").text(e.FolioName||e.Folio||"Untitled"),i.find(".description").text((e.UserName||e.Name)+" wants to transfer this folio to you."),s.prepend(i),l(),-1<window.location.hash.search(/accepttransfer/))){var a=window.location.hash.split(/\//);2==a.length?e.Token==a[1]&&i.find(".request-btn.yes").eq(0).click():$("#folio-items-container .transfer-item .request-btn.yes").eq(0).click()}}}function d(e){(i=$(r)).addClass("collabRequest").data("Id",e.Data.Id).attr("data-token",e.Data.Token),i.find("h4").text(e.Data.Folio||"Untitled"),i.find(".description").text(e.Data.Name+" has invited you to this folio."),s.prepend(i),l(),$(".nav-main-menu a:eq(0)").click(),"#acceptcollab"==window.location.hash&&$("#folio-items-container .collabRequest .request-btn.yes").eq(0).click()}e.addListener("transferRequestArrived",t),e.addListener("collabRequestArrived",d),e.addListener("processPendingTransfers",function(){0<n.UserTeams.length&&(n.tansFolios&&0<n.tansFolios.length&&n.tansFolios.forEach(function(e){return t(e)}),n.foliosPending&&0<n.foliosPending.length&&n.foliosPending.forEach(function(e){var t=e.FolioName,a=e.Token,n=e.Role;d({Data:{Token:a,Id:e.AwaitingCollabID,Name:t,Privilege:n}})}))})},app.dash.main=function(e,t,a,n,o,i){for(var s=this,r=e.labels,l=e.colors,d=app.plugin.lockedTip(e,t),c=0;c<r.length;c++)r[c].isLabel=!0,r[c].color=l[c%l.length];e.currentlyEditing={},s.tabs(e),s.listRequests(e,t,o),s.folios(e,t,n,o,a,i),s.labels(e,a,n,o,t,i),s.createNewMenu(o,i),s.filter(e,n,o,a,i,!0,t,d),s.filterBar(app.plugin.popupMenu,t,o,i,a,n,e),s.subOptionsMenu(),s.subOptionLabelMenu(e,n,o,a,i),s.templateLabels(e,n,t,o,i,d),s.templates(e,n,o,a,i,t,d),s.examples(e,n,o,a,i,t,d),s.exampleLabels(e,n,t,o,i,d),s.delFolio(a,o),s.archiveFolio(e,a,o),s.saveAsTemplate(e,a,o,i),s.unarchiveFolio(a,o,e,i,t),s.createFolio(e,s,a,o,i,t),s.copyFolio(s,a,o,t,e,i,d),s.rename(s,a,o),s.inlineRename(a,o),s.processRequests(a,o,t,e,i),s.transferFolio(e,o),s.renameLabel(s,e,n,a,t,o),s.delLabel(e,n,a,t,o),s.defaultLabel(e,n,a,t,o),s.folioStats(e,o,i,d,t),app.plugin.tooltip()},app.dash.processRequests=function(i,s,e,r,l){function n(e,t){var a,n=t.data("item");function o(){i.processTransfer({data:a,success:function(){"accept"===e?(console.log("in processTransfer",n),n.isUseTemplate=!1,r.saveFolioTransferItem=n,s.saveFolio()):window.location="/"},error:function(e){5==e.StatusCode?s.plusPrompt("create",null,!0):10==e.StatusCode?s.plusPrompt("create",null,!1,!0):s.error(e.Message)}})}a=r.UserTeams&&0<r.UserTeams.length&&0<n.TeamID?{verb:e,secret:t.data("code"),teamId:r.Team.Id}:{verb:e,secret:t.data("code")},"reject"!==e&&n.TeamID==r.Team.Id?o():l.checkFoliosLimitReached(i,s,o)}$("#folio-items-container").on("click",".request-btn",function(e){console.log("on processRequests"),e.preventDefault(),s.busy();var t=$(this),a=t.hasClass("yes")?"accept":"reject",o=t.closest(".folio-item-shell");if("reject"===a)o.hasClass("collabRequest")?i.processCollaborator({data:{verb:a,id:o.data().Id},success:function(){o.remove(),s.close(),window.location="/"},error:function(e){5==e.StatusCode?s.plusPrompt("create",null,!0):10==e.StatusCode?s.plusPrompt("create",null,!1,!0):s.error(e.Message)}}):n(a,o);else{o.hasClass("collabRequest")?(console.log("processCollab NO limit check"),i.processCollaborator({data:{verb:a,id:o.data().Id},success:function(){if("accept"==a){console.log("collab func on dash");var n=o.data().token;$("#folio-items-container").find(".empty-shared, .empty").remove(),i.getFolioByToken({token:n,success:function(e){var a=JSON.parse(e.Data);i.getFolioCollaborators({token:n,success:function(t){console.log("response",t),i.getWorkspaceChannels({teamId:r.Team.Id,success:function(e){console.log("response channels",e),r.saveFolioCollabItem={FolioName:a.FolioName,Token:n,TeamID:a.TeamID,collaborators:JSON.parse(t.Data),labels:JSON.parse(e.Data)},console.log("saveFolioCollabItem",r.saveFolioCollabItem),s.saveFolio()},error:function(e){console.log(e)}})},error:function(e){console.log(e)}})},error:function(e){console.log("error",e)}})}},error:function(e){5==e.StatusCode?s.plusPrompt("create",null,!0):10==e.StatusCode?s.plusPrompt("create",null,!1,!0):s.error(e.Message)}})):n(a,o)}})},app.dash.rename=function(a,n,o,e){$(".edit-link").each(function(){var e=$(this),t=e.text();e.data("name",t),a.setName(e,t)}),$(" #folio-items-container").on("click",".rename-folio-btn",function(){var e=$(this),t=e.data("token"),a=e.closest(".folio-item-shell").find("h4");return o.message({heading:"Rename Folio",showBusy:!0,showInput:!0,enterAsOK:!0,btnText:"Rename",emptyError:"Please provide a name for the folio",cancelText:"Cancel",input:a.text(),namespace:"rename-folio-popup",inputPlaceholder:"Enter name",handleOK:function(e){n.renameFolio({token:t,name:e,success:function(){a.text(e),o.close()},error:function(e){o.error(e.Message)}})}}),!1})},app.dash.renameLabel=function(e,t,a,n,o,i){var s=function(e,t,a){i.message({heading:"Rename Channel",showBusy:!0,showInput:!0,enterAsOK:!0,btnText:"Rename",cancelText:"Cancel",emptyError:"Please provide a name for the channel",namespace:"rename-label-popup",inputPlaceholder:"Enter name",input:e,handleOK:function(e){n.renameLabel({token:t.Token,name:e,success:function(){t.Name=e,o.raiseEvent("labelChange"),a(e),i.close()},error:function(e){i.error(e.Message)}})}})};$("#all-labels-container").on("click",".rename-btn",function(){var t=$(this),e=t.data("label"),a=t.closest(".item").find(".name");return s(a.text(),e,function(e){a.text(e),t.closest(".item").hasClass("active")&&$(".label-name").text(e)}),!1}),$(".label-details").on("click",".rename",function(){var e=$(this).closest(".label-details"),t=e.data("label"),a=e.find(".label-name");return s(t.Name,t,function(e){a.text(e),$("#all-labels-container").find(".item[data-name="+t.Token+"] .name").text(e),$(".labels-dropdown").find("option[value="+t.Token+"]").text(e)}),!1})},app.dash.saveAsTemplate=function(n,e,o,t,a){$("#folio-items-container").on("click",".save-template-btn",function(){if((0,app.acl.helper(n).personalTemplatesAllowed)()){var e=$(this).closest(".folio-item-shell"),t=e.data("token"),a=e.find("h4").text()+" - Template";return o.createTemplatePopup(a,t),!1}o.saveCustomTemplateBlocker(o,n)})},app.dash.subOptionLabelMenu=function(l,d,c,t,u){var s=null,r=null;$("#sidebar").on("click",".menu",function(e){e.preventDefault();var t=$(this),a=t.closest(".item"),n=a.offset();null!=s&&null!=r||(s=a.height(),r=a.width());var o=n.top+s,i=n.left+r;t.next(".settings-btns").css("top",o+10+"px").css("left",i-165+"px"),t.toggleClass("active"),t.hasClass("active")&&setTimeout(function(){$("body").on("click.labelMenuRemover",function(){t.removeClass("active"),$("body").off(".labelMenuRemover")})},100)}),$(".left-section").on("click",".share",function(){if(l.Team&&0<l.Team.Id){var e=$(this).closest(".label-details").data("label").Token,s=_.findIndex(l.labels,["Token",e]),r=$(this);console.log("currentTOken",e),console.log("currentLabelID",s),-1!==s?t.getLabelOwner({data:{token:e},success:function(e){var t=JSON.parse(e.Data),a=l.userEmail===t.Email,n=u.isPremiumGuest()||u.isSingleFolioGuest(),o=!l.labels[s].Private;if(a||!n&&o){var i=d.obtain(l.labels,"Token",r.closest(".label-details").data("label").Token);i.isLabel=!0,c.shareLink(i,null,null,a)}else c.message({heading:"You Cannot Perform this Action",message:"Only channel owners can adjust the channel's link sharing settings. Reach out to the channel owner to perform this action. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})},error:function(e){console.log("getLabelOwner error",e),c.message({heading:"Oops!",message:"Could not process request. Please try again later. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})}}):d.devHighlightConsole("Token not found on config.labels",e)}else c.shareLink(d.obtain(l.labels,"Token",$(this).closest(".label-details").data("label").Token))})},app.dash.subOptionsMenu=function(){$("#folio-items-container , #templates-items-container").on("click",".menu",function(e){e.preventDefault(),$(".more-options .menu").not(this).removeClass("active");var t=$(this);t.toggleClass("active"),t.next(".settings-btns").children().on("click",function(){t.removeClass("active")}),$("body").off(".menuRemover"),t.hasClass("active")&&setTimeout(function(){$("body").on("click.menuRemover",function(){t.removeClass("active"),$("body").off(".menuRemover")})},100)})},app.dash.tabs=function(e){$(".tab-content"),$(".nav-main-menu a").not("a.help-center"),$("#top-bar .template-subnav"),$("#dashboard-page");$("body").addClass("colored-dashboard")},app.dash.templateLabels=function(s,a,r,t,l,d){var n,o=$("#templates-items-container"),i=$("#tmp-temp-sidebar"),c=$("#single-label").html(),u=$("#tmp-labels-container"),m=($("#all-templates-button"),$("#tmp-my-labels-container")),p=$("#top-bar .template-subnav");a.getColors();0===$("#dashboard-page").find("#temploader").length&&($("#dashboard-page").append($('<div id="temploader" class="template-loader"><div class="loading-animation"></div></div>')),n=$("#dashboard-page").find("#temploader"));var f,h,g,v=o.find(".label-details.temp"),b=o.find(".tmp-labels-dropdown");function T(e){e?($("#templates-items-container").css("visibility","hidden"),n.find(".loading-animation").html(t.spinner),n.show()):($("#templates-items-container").css("visibility","visible"),n.hide())}function y(e){h=$("#templates-items-container .as-template"),f.filter(h.filter(".".concat(e,", .blank")))}$("#tmplt-sidebar").append(i),r.addListener("reInitMixerTemplates",function(){T(!0),function(){if(s.templatesLabels){s.templatesLabels=_.sortBy(s.templatesLabels,function(e){return app.consts.xtensioLabelSortArray.indexOf(e.Name)}),u.html("");for(var e=0;e<s.templatesLabels.length;e++){var t=s.templatesLabels[e],a=$(c).data("label",t);a.addClass(t.Name.toLowerCase().split(" ").join("-")),a.find(".label").css("background-color",t.color),a.find(".name").text(t.Name||"Untitled"),a.find(".options").remove(),a.on("click",C).data("label",t),u.append(a);var n=$("<option></option>");n.text(t.Name||"Untitled").val(t.Token),b.append(n)}}}(),function(){s.templateTab||(s.templateTab=".xtensio-temp"),f&&f.destroy();var e=p.find(".tmp-sort .item.active").data("value");e=void 0===e?"used:desc":e,f=mixitup(o,{animation:{duration:400},selectors:{target:".folio-item"},load:{filter:s.templateTab,sort:e},callbacks:{onMixEnd:function(e){var t=app.core.padlocks(l,d,s,r),a=t.setTemplateStatsLock,n=t.setFolioStatsLock,o=t.setCopyFolioLock,i=t.setLockStatsSaveAsTemplate;setTimeout(function(){o(),i(),a(),n()},200)},onMixFail:function(e){T(!1),console.log("No items could be found matching the requested filter")}},debug:{enable:!0},controls:{enable:!1}}),clearTimeout(g),g=setTimeout(function(){f.forceRefresh()},1e3)}(),s.templateTab||(s.templateTab=".xtensio-temp"),p.find(s.templateTab).click(),T(!1)}),r.addListener("xtensioTemplateSearch",function(e){var t=e.map(function(e){return'[data-template="'.concat(e.TemplateName,'"]')}).join(",");f.filter(t)});function C(){var e=$(this),t=e.data("label");if(i.find(".item").removeClass("active"),e.addClass("active"),$("#templates-items-container .state").hide(),v.find(".label-name").css({paddingLeft:"10px"}),v.find(".label-name").css({display:"inline-block"}),$("#feat-templates-items-container").addClass("hidden"),t&&"own"==t.Token&&(v.find(".label-color").hide(),$("#templates-items-container").find(".own").removeClass("hidden")),!t)return f.filter(".xtensio"),v.addClass("normal").find(".label-name").text("Xtensio Templates"),void $("#templates-items-container .state").hide();v.removeClass("normal"),v.find(".label-name").text(t.Name),v.find(".label-color").css("background-color",t.color),y(t.Token);var a="".concat(s.baseUrl,"/#xtensiotemplates-").concat(t.Name.toLowerCase().split(" ").join("-"));window.history.replaceState("object or string","Xtensio Templates",a)}function k(e){$("#tmp-labels-container").hide(),$("#all-templates-button").hide(),$(".template-search-input-group").addClass("hidden"),$(".folios-container.templates .filter-bar").hide(),$("#templates-items-container .empty-state-team-temp").hide(),$("#templates-items-container .empty-state-my-temp").hide(),$("#templates-items-container").find(e).length<1&&$("#templates-items-container .empty-state-".concat(e.replace(".",""))).show(),$("#feat-templates-items-container").addClass("hidden")}function e(){var e=$(this).attr("id"),t="",a="";switch(console.log("-- id --",e),$("#templates-items-container .empty-state-team-temp").hide(),$("#templates-items-container .empty-state-my-temp").hide(),$("#templates-items-container .cont-template-request").hide(),$("#tmp-dashboard-content .x-select.tmp-labels-dropdown").hide(),v.find(".label-name").hide(),e){case"all-templates-button":$("#tmp-labels-container .item").removeClass("active"),$("#all-templates-button").addClass("active"),$("#feat-templates-items-container").removeClass("hidden");var n="".concat(s.baseUrl,"/#xtensiotemplates-all");window.history.replaceState("object or string","Xtensio Templates",n);case"all-temps-button":var o=$.trim(window.location.hash.substr(1).toLowerCase()).replace("xtensiotemplates-","");if(o&&"all"!=o)var i=setInterval(function(){var e=$("#tmp-labels-container").find(".item.".concat(o));e.length&&(e.trigger("click"),clearInterval(i))},50);else t=".xtensio:not(.feat)",a="Xtensio Templates",$("#tmp-labels-container").show(),$("#all-templates-button").show(),$(".template-search-input-group").removeClass("hidden"),$("#tmp-labels-container .item").removeClass("active"),$("#templates-items-container .cont-template-request").show(),$("#tmp-dashboard-content .x-select.tmp-labels-dropdown").show(),$(".folios-container.templates .filter-bar").show(),v.find(".label-name").show(),$("#feat-templates-items-container").removeClass("hidden"),s.templateTab=".xtensio-temp";break;case"my-temps-button":window.location.hash="",t=".my-temp",a="My Templates",k(s.templateTab=t);break;case"team-temps-button":window.location.hash="",t=".team-temp",a="Team Templates",k(s.templateTab=t)}f&&f.filter(t),v.addClass("normal").find(".label-name").text(a)}!function(e){var t=$(c).data("label",e);t.find(".name").text(e.Name||"Untitled"),t.find(".options").remove(),t.on("click",C).data("label",e),m.append(t),"xtensio"==e.Token&&t.find(".new").remove();var a=$("<option></option>");a.text(e.Name||"Untitled").val(e.Token),b.append(a)}(s.myLabel),$("#all-temps-button").on("click",e),$("#my-temps-button").on("click",e),$("#team-temps-button").on("click",e),$("#all-templates-button").on("click",e),b.on("change",function(){var e=$(this).val(),t=a.obtain(s.templatesLabels,"Token",e);if(null===t)return f.filter("all"),void v.addClass("normal");y(t.Token),v.removeClass("normal")}),p.find(".tmp-sort").change(function(){f.sort($(this).data("value"))})},app.dash.templates=function(h,r,g,n,o,l,e){var v=app.acl.helper(h),a=$(".nav-main-menu a").not("a.help-center, a.examples-link"),i=$("#app-load-animation"),s=!1,t=$("#dashboard-page"),d=$(".tab-content"),c=r.getColors(),u=$("#top-bar .template-subnav"),m=$("#top-bar .example-subnav"),b=($("#tmp-dashboard-content"),$("#feat-templates-items-container")),T=$("#templates-items-container"),y=$("#template-item").html(),p=($("#my-template-item").html(),app.core.padlocks(o,e,h,l)),C=null,k=null;function w(o,e){$.each(e.Labels,function(e,t){var a=r.obtain(h.templatesLabels,"Token",t);if(a){var n=$('<div class="label"></div>').css("background-color",a.color).text(a.Name);n.data("token",a.Token),o.addClass(a.Token),o.find(".labels").prepend(n)}})}function x(e){return function(){return g.shareLink(e),!1}}function P(a,e){if(!h.IsDelinquent||1!=_.find(h.folios,{Status:0}).length)return function(){if(!o.isSingleFolioGuest()&&!o.isPremiumGuest()){$(this);var e=a.Token,t="Untitled ( "+a.FolioName+" )";return h.userName?o.checkFoliosLimitReached(n,g,function(){h.saveFolioTransferItem={FolioName:t,Token:e,template:a.FolioName,isUseTemplate:!0},g.saveFolio(null,{fromTemplate:!0})}):g.signUp(!0),!1}g.teamUserActionBlocked("create","Premium Guests")};g.plusPrompt("create",null,!0)}function S(e){return function(){return v.statsAllowed()?(g.folioStats(e.Token,e.FolioName,{isTemplate:!0,UsedCount:e.UsedCount}),!1):void g.statsBlocker("template")}}function D(e){return function(){return window.location=h.baseUrl+"/edit/"+e.Token,!1}}function F(o,i){return function(){return console.log("current",i),console.log("folio",o),$("#dashboard-page > .loader").show(),n.switchTemplateTypes({token:o.Token,op:"switch",success:function(e){console.log("switchTemplateTypes response",e);var t="team-temp"===i?" is now your private template in ":" is available to all team members in ",a="team-temp"===i?"my-temp":"team-temp",n="team-temp"===i?"My Template":"Team Template";g.message({heading:'Template Moved <i class="icon-CheckMark"></i>',message:"<b>"+o.FolioName+"</b>"+t+'<a href="#" class="popup-template-link" data-type="'+a+'">'+n+"s</a>",bodyCentered:!0,btnText:"Done",enterAsOK:!0,notMini:!0})},error:function(e){f(e)},complete:function(){$("#dashboard-page > .loader").hide()}}),!1}}function f(e){$("#dashboard-page > .loader").hide(),g.message({heading:"Oops!",message:e.Message,btnText:"Ok",enterAsOK:!0})}function I(e,t){return function(){return g.message({heading:"Are you sure?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes",notMini:!0,bodyCentered:!0,handleOK:function(){n.deleteUserTemplate({token:e.Token,op:"del",success:function(){$("#dashboard-page > .loader").hide(),"my-temp"===t&&l.raiseEvent("teamTemplateUpdate")},error:function(e){f(e)}})},cancelText:"Cancel",handleNo:function(){g.close()}}),!1}}function M(o,e){$.each(e.Labels,function(e,t){var a=h.myLabel;if(a){var n=$('<div class="label"></div>').css("background-color",a.color).text(a.Name);n.data("token",a.Token),o.addClass(a.Token),o.find(".labels").prepend(n)}})}h.templateTab=".xtensio-temp";var E=function(e){return _.sortBy(e,["CreatedDate"]).slice(-3)};function A(e,t,a){for(var n=function(e,t,a){var n,o={};if(e&&t){var i=T.find(".folio-item."+e);i.length>a.length&&i.each(function(e,t){n=$(t).data("token"),o[n]=n})}return o}(t,a,e),o=!t&&E(e),i=0;i<e.length;i++){var s=T.find(".folio-item[data-token="+e[i].Token+"]");if(t){if(delete n[e[i].Token],a&&1==s.length&&s.data("type")==t&&s.hasClass(t))continue;s.remove()}s=e[i];var r=!t&&"blank"==s.TemplateName;(C=$(y)).attr("data-template",s.TemplateName).attr("data-name",s.PublicName||s.FolioName).attr("data-used",s.UsedCount).attr("data-type",t).attr("data-date",s.CreatedDate),t?M(C,s):w(C,s),s.Thumbnail&&C.find(".img").removeClass("hidden").find("img").attr("src",s.Thumbnail),s.UsedCount&&!r&&C.find(".used").text("Used "+s.UsedCount+" times"),k=h.baseUrl+"/folio/"+s.FolioToken;var l=C.find("h4");if(l.text(s.PublicName||s.FolioName),setTimeout(function(){l.scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",minScrollWidth:268,animBack:!0,ellips:32})},1e3),C.find(".preview, .link").attr("href",k),_.find(o,{FolioToken:s.FolioToken})&&(C.find(".new-label").removeClass("hidden"),C.addClass("new")),r&&(C.find(".primary").addClass("red").text("Create New"),C.attr("data-used",Number.MAX_SAFE_INTEGER).attr("data-date",Date.now()).attr("data-name","  "+s.PublicName).addClass("blank").find(".blank-description").removeClass("hidden"),C.find(".cta-buttons .preview").parent().remove()),C.find(".img").hover(function(){$(this).stop().animate({scrollTop:$(this).find("img").height()},5e3)},function(){$(this).stop().animate({scrollTop:0},2e3)}),t){var d=_.find(s.Collaborators,{Email:h.userName});d&&d[0]&&(d[0].Privilege=3);var c=s.Private?"Off":"On";C.find(".link-share-cont span").text(c),C.find(".create-cont span.created-by").text(s.UserFullName),C.find(".create-cont span.created-at").text(dayjs(s.LastSavedUtc).fromNow()),setInterval(function(){C.find(".create-cont span.created-at").text(dayjs(s.LastSavedUtc).fromNow())},36e5);var u="team-temp"===t?"Move to My Templates":"Move to Team Templates",m="team-temp"===t?"move-to-my":"move-to-team",p=!v.teamTemplatesAllowed()&&"move-to-team"==m;C.find(".move-template").addClass(m),C.find(".move-template .settings-btn-text").text(u),p&&(C.find(".move-template").addClass("locked"),C.find(".move-template").append('<i class="fa fa-lock" data-html="true" data-original-title="" title=""></i>')),s.Collaborators=d,C.attr("data-token",s.Token),C.attr("data-date",s.LastSavedUtc),C.data("folio",s),C.find(".used").hide(),C.find(".labels").hide(),C.find(".link").attr("href",h.baseUrl+"/edit/"+s.Token),C.addClass("own"),C.addClass(t),C.find(".cta-buttons").remove(),C.find(".use-template").click(P(s)),C.find(".share-btn").click(x(s)),"my-temp"===t&&C.find(".owner-info").hide(),C.find(".show-stats").click(S(s)),"my-temp"===t||s.UserEmail===h.userEmail?p?C.find(".move-template").click(app.popup.moveToTeamTemplatesBlocker(g,h)):C.find(".move-template").click(F(s,t)):C.find(".move-template").remove(),"my-temp"===t||s.UserEmail===h.userEmail||1===h.Team.Role||2===h.Team.Role?(C.find(".edit-template").click(D(s)),C.find(".delete-folio").click(I(s,t))):(C.find(".edit-template").remove(),C.find(".delete-folio").remove())}else{C.find(".create-cont").hide(),C.find(".link-share-cont").hide(),C.find(".options").remove(),C.addClass("xtensio");var f=s.FolioUrlSlug?s.FolioUrlSlug:s.FolioToken;xurl=h.libBaseUrl+"/"+f,C.find(".preview, .link").attr("href",xurl)}r&&(C.find(".link").attr("href","#"),C.find(".link ").removeAttr("target")),C.hide(),t?T.prepend(C):T.append(C),s.IsFeatured&&(C.addClass("feat"),b.append(C))}b.find(".folio-item").show(),"object"===_typeof(n)&&0<Object.keys(n).length&&$.each(n,function(e,t){T.find(".folio-item[data-token="+t+"]").remove()}),0===T.find(".btn-request-template").length&&(T.append("<div class='cont-template-request' style='display:none;'>Can't find what you're looking for? <a class='btn-request-template' href='#'>Request a New Template</a></div>"),T.find(".btn-request-template").click(function(e){e.preventDefault(),window.$crisp&&($crisp.push(["set","message:text",["Hi Xtensio team, \nCan you please add this template? \n\n(Please add the template's name as well as links and examples to help us understand your need better)"]]),$crisp.push(["do","chat:open"]))}))}function U(){setTimeout(function(){p.setTemplateStatsLock()},1500)}l.addListener("initToolTips",function(){U()});function N(s){void 0!==h&&h.isDashboard&&n.getTemplateData({success:function(e){console.log("getTemplateData response",e);try{var t=JSON.parse(e.Data),a=JSON.parse(t.XtensioTemplates),n=""===t.UserTemplates?[]:JSON.parse(t.UserTemplates),o=""===t.TeamTemplates?[]:JSON.parse(t.TeamTemplates),i=JSON.parse(t.TemplateLabels).map(function(e,t){return e.color=c[t%c.length],e});console.log("--- template data ---",t),h.userTemplates=n,h.teamTemplates=o,h.templatesLabels=i,T.html(""),A(a,!1),$("input#template-search").keypress(_.debounce(function(e){e.preventDefault();var o=$("#template-search").val().trim().toLowerCase().split(" "),t=a.filter(function(e){var t,a,n=e.Labels.map(function(e){var t;return null===(t=r.obtain(h.templatesLabels,"Token",e))||void 0===t?void 0:t.Name});return t=o,a=[e.Description,e.PublicName,n.join(" ")],!t.some(function(t){return!a.some(function(e){return-1!==e.toLowerCase().indexOf(t)})})});$("#feat-templates-items-container").addClass("hidden"),l.raiseEvent("xtensioTemplateSearch",t)},500)),setTimeout(function(){0<o.length?A(o,"team-temp",!0):$(".folio-item.team-temp").remove(),0<n.length?A(n,"my-temp",!0):$(".folio-item.my-temp").remove();var e=L("empty-state-my-temp"),t=L("empty-state-team-temp");e.hide(),t.hide(),T.prepend(e),T.prepend(t),"function"==typeof s&&s()},200)}catch(e){console.trace("getTemplateData error",e)}},error:function(e){console.log("getTemplateData error",e)},complete:function(){U()}})}function L(e){var t=$("#tmp-empty-state").html(),a=$(t),n="You haven't saved any templates yet.";return"empty-state-team-temp"===e&&(n="You don't have any Team Templates yet.",textEmpTeam="Save folios as team template for team members to use and repurpose.<br> Keep them private or share with the world."),a.addClass(e),a.find("p.imp-folio").remove(),a.find("h2").text(n),a.find("button").remove(),a.find("p.tag").html('Save folios as templates to reuse and repurpose. <br>Keep them private or share with the world.<br><br><img src="/img/empty-team-my-temp.png" style="height: 170px" />'),a}function O(e){u.find(".xtensio-temp").click(),window.location.hash="",e.hasClass("template")&&e.hasClass("active")?(u.show(),m.hide(),t.addClass("template-sub-active")):(e.hasClass("examples-link")&&e.hasClass("active")?(u.hide(),m.show()):(u.hide(),m.hide()),t.removeClass("template-sub-active"))}a.on("click",function(e){$that=$(this),a.removeClass("active"),$(".nav-main-menu a.examples-link").removeClass("active");var t=$that.addClass("active").index();d.addClass("hidden").filter(":eq("+t+")").removeClass("hidden"),$("body").toggleClass("colored-dashboard",!$that.hasClass("template")),s?O($that):(s=!0,T.css({opacity:0}),i.show(),N(function(){l.raiseEvent("reInitMixerTemplates"),setTimeout(function(){O($that),T.css({opacity:1}),i.hide()},2e3)}))}),l.addListener("clearTemplateSubmenu",function(e){O(e)}),$(".use-template").on("click",function(){a.filter(":eq(1)").trigger("click")}),$(".plus-menu .create-new").on("click",function(){s?$('div[data-template="blank"]').find(".cta-btn.primary").trigger("click"):(i.show(),N(function(){$('div[data-template="blank"]').find(".cta-btn.primary").trigger("click"),setTimeout(function(){i.hide()},3e3)}))}),l.addListener("teamTemplateUpdate",function(){N(function(){l.raiseEvent("reInitMixerTemplates")})})},app.dash.transferFolio=function(t,a){$(" #folio-items-container").on("click",".transfer-folio-btn",function(e){return t.Team&&0<t.Team.Id?a.transferTeamFolio($(this).data("token")):a.transferFolio($(this).data("token")),!1})},app.dash.unarchiveFolio=function(o,i,s,r,l){$(".folios-container").on("click",".unarchive",function(){var e=$("#folio-items-container").find(".folio-item-shell.active").length,t=$(this).closest(".folio-item-shell"),a=t.data("folio");if(!((!r.hasTeam()||s.IsDelinquent)&&1<=e||r.isFreeWithTeam()||r.isProTeamMember()))return n(),!1;function n(){i.unarchive(a,function(){i.close(),a.Collaborators=Faltu(a.Collaborators).find({Email:s.userName}).get(),t.removeClass("archived").addClass("active").find(".edit").each(function(){$(this).attr("href",$(this).attr("href").replace("folio","edit"))}).eq(1).text("Edit Folio");var e=$("#folio-items-container");e.find(".state.empty").hide(),0<$("#folio-items-container").find(".collabRequest").length?e.find(".collabRequest").after(t):e.prepend(t),l.raiseEvent("updateStatsSaveAsTempLocks",{}),window.location.hash="active"})}r.checkFoliosLimitReached(o,i,function(){n()})})},app.dash.getUserTypeSelect=function(e,t){var a=$("#tmp-user-type-select"),n=a.find(".paper"),o=a.find(".btn.popup-cta"),i=a.find(".cta-btns"),s=parseInt(e.Team.Id);s=isNaN(s)?0:s,i.toggleClass("swap-cta-btns",s%2==0),a.find(".username").text(e.fullName),a.appendTo($("body")).show(),o.on("click",function(){n.addClass("busy"),t.setUserType({data:{userType:parseInt($(this).data("usertype"))},success:function(e){},error:function(e){console.log("Error: ",e)},complete:function(){a.remove(),n.removeClass("busy")}})})},app.dash.wizardDash=function(e,t,a,n){$("#top-bar .user-menu-popup").find(".dash-wizard");var o='NEXT <i class="fa fa-angle-right"></i>',i=function(e){return'<text style="color: #00bd9c"><b>'+e+"</b></text><br>"},s=function(e){return'<p style="color: #ffd371">'+e+" / 5</p>"};s(1),i("Start a New Project:"),s(2),i("Adjust Settings:"),s(3),i("Check Notifications:"),s(4),i("Get Organized with Channels:"),s(5),i("You are all set!");"string"==typeof e.ShowOnboarding&&(e.ShowOnboarding="not-set"===e.ShowOnboarding||JSON.parse(e.ShowOnboarding.toLowerCase()))};var logger=function(){try{var e=null,t={enableLogger:function(){null!=e&&(window.console.log=e)},disableLogger:function(){e=console.log,window.console.log=function(){}}}}catch(e){}return t}(),consologs=function(e){var t=!document.URL.includes("xtensio.com")||e.isAdmin||e&&e.userEmail&&-1!==e.userEmail.indexOf("xtensio.com");if(!t){var n={};window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,a){a=a.replace(/\#|\//g,""),n[t]=a});n.xyz&&"werxtensio"===n.xyz&&(t=!0,console.log("*** DEBUG: ON ***"))}if(!t)for(var a=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],o=0;o<a.length;o++)console[a[o]]=function(){}};app.plugin.folioView=function(t){var a,n="";if(console.log("exec folioView scripts"),t.StyleGuides&&(""===t.userEmail?a=t.StyleGuides[0]:t.StyleGuides.forEach(function(e){e.TeamId===t.Team.Id&&(a=e)})),console.log("styleGuide",a),a){var e,o=a.DefaultFontFamily;if((e=a.TeamFonts.map(function(e){return{id:e.SourceIdentifier,data:e.FontJson,title:e.Name,default:o===e.SourceIdentifier,owner:e.SourceString,family:e.FontJson.FontLocalName?e.FontJson.Name:e.FontJson.IdString}})).length&&setTimeout(function(){e.forEach(function(e){var t;null!==(t=e.data).FontLocalName&&(n+='@font-face {\n                font-family: "'.concat(t.FontLocalName,'";\n                font-weight: "').concat(t.FontWeight,'";\n                font-style: "').concat(t.FontStyle,'";\n                src: local("').concat(t.FontLocalName,'"), url("').concat(t.FontUrl,"\")  format('woff2');\n                unicode-range: \"").concat(t.UnicodeRange,'";\n            }'))}),$("head").append("<style class='font-face-tag'>".concat(n,"</sttyle>"))},1e3),a.TeamFonts.forEach(function(e){var t;e.SourceIdentifier===o&&(t=e.FontJson.Name,$("#modules-preview-main").css("font-family",'"'.concat(t,'", ').concat("Proxima-Light, Helvetica, sans-serif")))}),0<a.TeamColors.length){var i="";if(a.TeamColors.forEach(function(e,t){e.IsDefault&&(i=e.HexCode)}),""!==i&&(console.log("implementing default color: ",i),!t.isDashboard)){var s="#modules-edit-main, #modules-edit-main h1, ";s+="#modules-edit-main h2, ",s+="#modules-edit-main h3, ",s+="#modules-edit-main h4, ",s+="#modules-edit-main p, ",s+="#modules-preview-main, #modules-preview-main h1, ",s+="#modules-preview-main h2, ",s+="#modules-preview-main h3, ",s+="#modules-preview-main h4, ",s+="#modules-preview-main p, ",s+="#modules-preview-main .title > *:not(.fr-wrapper):first-child, ",s+="#modules-edit-main .title > *:not(.fr-wrapper):first-child, ",s+="#modules-preview-main .title .fr-view > *:first-child, ",s+="#modules-edit-main .title .fr-view > *:first-child { ",s+="color: "+i+"; ",s+="} ",s+="#modules-edit-main .module, #modules-preview-main .module { ",s+="border-color: "+i+"; ",s+="color: "+i+"; ",s+="} ",s+="#modules-preview-main .text-module .name, ",s+="#modules-preview-main .text-module .fr-view > ul, ",s+="#modules-preview-main .text-module .fr-view > ol, ",s+="#modules-edit-main .text-module .name, ",s+="#modules-edit-main .text-module .fr-view > ul, ",s+="#modules-edit-main .text-module .fr-view > ol {",s+="color: "+i+"; ";var r="<style id='defaultColor' type='text/css'> "+(s+="} ")+" </style>";setTimeout(function(){$("head style:eq(0)").before(r)},100),t.teamDefaultColorStyles=r}}}},app.plugin.froalaSetup=function(b,T,y,e,C,t,a,n,k){var w={__RequestVerificationToken:b.verificationToken,type:"froala",token:b.token},o=b.colors,i="d575355bb0d24163871dc640ba400f2a",s=app.core.padlocks(a,n,b,T);function m(e){return'<span class="fr-open-'+e.toLowerCase()+'"></span>'}function p(e){return'<span class="fr-close-'+e.toLowerCase()+'"></span>'}function x(e,t){var a,n;for(a=e.length-1;0<=a;a--)for(n=a-1;0<=n;n--)if($(e[n]).find(e[a]).length||e[n]==e[a]){e.splice(a,1);break}var o=[];for(a=0;a<e.length;a++){var i=$(e[a]),s=e[a].parentNode,r=i.attr("class");if(i.before(p(s.tagName)),"LI"==s.parentNode.tagName)i.before(p("LI")),i.after(m("LI"));else{var l="";r&&(l+=' class="'+r+'"');var d="rtl"==t.opts.direction||"rtl"==i.css("direction")?"margin-right":"margin-left";t.helpers.getPX($(s).css(d))&&0<=($(s).attr("style")||"").indexOf(d+":")&&(l+=' style="'+d+":"+t.helpers.getPX($(s).css(d))+'px;"'),t.html.defaultTag()&&0===i.find(t.html.blockTagsQuery()).length&&i.wrapInner(t.html.defaultTag()+l),t.node.isEmpty(i.get(0),!0)||0!==i.find(t.html.blockTagsQuery()).length||i.append("<br>"),i.append(m("LI")),i.prepend(p("LI"))}i.after(m(s.tagName)),"LI"==s.parentNode.tagName&&(s=s.parentNode.parentNode),o.indexOf(s)<0&&o.push(s)}for(a=0;a<o.length;a++){var c=$(o[a]),u=c.html();u=(u=u.replace(/<span class="fr-close-([a-z]*)"><\/span>/g,"</$1>")).replace(/<span class="fr-open-([a-z]*)"><\/span>/g,"<$1>"),c.replaceWith(t.node.openTagString(c.get(0))+u+t.node.closeTagString(c.get(0)))}t.$el.find("li:empty").remove(),t.$el.find("ul:empty, ol:empty").remove(),t.clean.lists(),t.html.wrap()}FroalaEditor.DEFAULTS=$.extend(FroalaEditor.DEFAULTS,{key:"xGE6oB4D4C3B10B6C4fLUQZf1ASFb1EFRNh1Hb1BCCQDUHnA8B6E5C4B1C3E4A1A8B6==",embedlyKey:i,colorsText:o,colorsBackground:o,keepFormatOnDelete:!0,imageResizeWithPercent:!0,fontSize:["8","9","10","11","12","14","16","18","20","24","30","36","40","48","60","72","96"],imageAllowedTypes:["jpeg","jpg","png","gif"],htmlAllowedAttrs:FroalaEditor.DEFAULTS.htmlAllowedAttrs.concat(["webkitallowfullscreen","mozallowfullscreen","allowfullscreen"]),pasteDeniedAttrs:["class","id","width","min-width","style"],linkInsertButtons:[],linkEditButtons:["linkOpen","linkEdit","linkRemove"],htmlDoNotWrapTags:["script","style"],updateManageColorLock:s.setLockStyleGuide,linkAutoPrefix:"https://",tableStyles:{noborder:"No Borders",solidborder:"Solid Borders","fr-dashed-borders":"Dashed Borders","fr-alternate-rows":"Alternate Rows"}}),embedly("defaults",{cards:{key:i}});var r={toolbarInline:!0,toolbarVisibleWithoutSelection:!0,theme:"custom",tabSpaces:!1,placeholderText:null,embedlyKey:i,toolbarButtons:[],imageUploadURL:b.tryMode?"/Apiv1/UploadTempFolioImage":"/Apiv1/UploadImage",fileUploadURL:"",linkAlwaysNoFollow:!1,htmlRemoveTags:["script"],spellcheck:!0,toolbarContainer:"#toolbarContainer",htmlUntouched:!0,htmlSimpleAmpersand:!0,videoInsertButtons:["videoBack","|","videoByURL","videoEmbed"],embedlyInsertButtons:["embedlyBack","|","embedlyRemove"],listAdvancedTypes:!1,fontFamily:{},imageMaxSize:e||t?b.FreeUserLimitPerImage:b.PaidUserLimitPerImage,charCounterCount:!1};b.fontFamily&&(r.fontFamily=$.extend(r.fontFamily,b.fontFamily));var l=C.getTeamStyleGuide(b),d=!1;if(l&&0<l.TeamFonts.length){var c=document.createElement("style");c.className="font-face-tag";l.DefaultFontFamily&&(!0,d=l.DefaultFontFamily+",proxima-light,Helvetica,sans-serif");var u={};$.map(l.TeamFonts,function(e,t){if("Xtensio"!=e.SourceString&&"System"!=e.SourceString)return a=e,c.appendChild(document.createTextNode("  @font-face {      font-family: '"+a.FontJson.FontLocalName+"';      font-weight: "+a.FontJson.FontWeight+";       font-style: "+a.FontJson.FontStyle+";       src: url("+a.FontJson.FontUrl+")  format('woff2');      unicode-range: "+a.FontJson.UnicodeRange+";   }  ")),e.FontJson.FontLocalName;var a});document.head.appendChild(c);for(var f=0;f<l.TeamFonts.length;f++){var h=l.TeamFonts[f];"Xtensio"==h.SourceString||"System"==h.SourceString?u["'"+h.FontJson.IdString+"',proxima-light,Helvetica,sans-serif"]=h.Name:u["'"+h.FontJson.FontLocalName+"',proxima-light,Helvetica,sans-serif"]=h.Name}C.implementDefaultFont(b)}else u={"proxima-nova,Helvetica,sans-serif":"Proxima Nova","proxima-light,Helvetica,sans-serif":"Proxima Light","proxima-bold,Helvetica,sans-serif":"Proxima Bold","Tahoma,Geneva,sans-serif":"Tahoma","Times New Roman,Times,serif":"Times New Roman","Verdana,Geneva,sans-serif":"Verdana"};u&&(r.fontFamily=$.extend(r.fontFamily,u)),d&&(r.fontFamilyDefaultSelection=d);var P=$.extend({},r,{plainPaste:!0,multiLine:!1}),S=$.extend({},r,{imageUploadParams:w,toolbarButtons:[["undo","redo","paragraphFormat","fontFamily","fontSize","textColor","bold","italic","underline","align","lineHeight"],["more","outdent","indent","formatOL","formatUL","insertHR"],["insertTable","insertImage","insertVideo","insertLink","insertCTAButton","embedly","html","clearFormatting"]]}),g=$("<div>");function D(e){return g.html(e).html()}if(l&&0<l.TeamColors.length){console.log("styleGuide",l);var v="";if(l.TeamColors.forEach(function(e,t){e.IsDefault&&(v=e.HexCode)}),""!==v&&(console.log("implementing default color: ",v),!b.isDashboard)){var F="#modules-edit-main, #modules-edit-main h1, ";F+="#modules-edit-main h2, ",F+="#modules-edit-main h3, ",F+="#modules-edit-main h4, ",F+="#modules-edit-main p, ",F+="#modules-preview-main, #modules-preview-main h1, ",F+="#modules-preview-main h2, ",F+="#modules-preview-main h3, ",F+="#modules-preview-main h4, ",F+="#modules-preview-main p, ",F+="#modules-preview-main .title > *:not(.fr-wrapper):first-child, ",F+="#modules-edit-main .title > *:not(.fr-wrapper):first-child, ",F+="#modules-preview-main .title .fr-view > *:first-child, ",F+="#modules-edit-main .title .fr-view > *:first-child { ",F+="color: "+v+"; ",F+="} ",F+="#modules-edit-main .module, #modules-preview-main .module { ",F+="border-color: "+v+"; ",F+="color: "+v+"; ",F+="} ",F+="#modules-preview-main .text-module .name, ",F+="#modules-preview-main .text-module .fr-view > ul, ",F+="#modules-preview-main .text-module .fr-view > ol, ",F+="#modules-edit-main .text-module .name, ",F+="#modules-edit-main .text-module .fr-view > ul, ",F+="#modules-edit-main .text-module .fr-view > ol {",F+="color: "+v+"; ";var I="<style id='defaultColor' type='text/css'> "+(F+="} ")+" </style>";setTimeout(function(){$("head style:eq(0)").before(I)},100),b.teamDefaultColorStyles=I}}$.fn.editor=function(a,i,s,n){var e,t,d,c;console.log("module on init",a);var u,r=this,o=$(this[0]),l=new diff_match_patch,m="Text"===(null==a?void 0:null===(e=a.Data)||void 0===e?void 0:e.Type);"object"!==_typeof(n)&&(n={}),n=$.extend({},n),i[s]=i[s]||"",n.url&&(n.noHtml=!0);var p=n.noHtml?$.extend({},P):$.extend({},S);function f(e){return!C.isJsLink(e)||(app.popup.message({heading:"You Cannot Perform this Action",message:"Javascript links are not allowed.",btnText:"Ok",enterAsOK:!0,notMini:!0,bodyCentered:!0}),!1)}function h(e){var t=e.html.get();return n.noHtml&&(t=$("<div>").html(t).text()),t}function g(e){return n.cleanPTags&&1<$("<div>"+e+"</div>").find("p").length?"<p>"+$(e).text()+"</p>":e}function v(){$(r).find(".fr-embedly").each(function(){if($(this).data().originalEmbed){var e=$(this).data().originalEmbed,t=$(e).attr("href");if(t){var a=C.replaceHttp(t),n=e.toString().replace(t,a);$(this).attr("href",a),$(this).attr("data-original-embed",n),$(this).data("original-embed",n),$(this).html(n)}else $(this).html(originalEmbed)}})}return p.multiLine=null==p.multiLine||p.multiLine,p.enter=FroalaEditor.ENTER_BR,p.htmlAllowedEmptyTags=["textarea","a","iframe","object","video","script",".fa","br","img"],p.paragraphFormat={P:"Normal",H1:"Heading 1",H2:"Heading 2",H3:"Heading 3",H4:"Heading 4",PRE:"Code"},p.events={initialized:function(){var o=this;if(t=_toConsumableArray(o.opts.pasteDeniedAttrs),r.data("unMountCb",function(){o.destroy()}),T.addListener("tokenRenewed",function(){w.__RequestVerificationToken=b.verificationToken,o("option","imageUploadParams",w)}),y.reg(a,s+(n.index||""),function(e,t){var a=h(o),n=g(l.patch_apply(t,a)[0]);n=D(n),i[s]=n,o.html.set(n),r.updateCaller(o)}),r.unstyle=function(){var e=h(o),t="h1, h2, h3, h4, h5, h6";e=$("<div>").html(e),"Title"==s&&(t+=", > p:first-child"),e.find(t).removeAttr("style").find("*").removeAttr("style"),o.html.set(e.html()),function(){var e=r.text();e=e||r.find("img, video, audio, iframe, table, embedly, lineHeight").length?h(o):(o.html.set(""),"");i[s]!=e&&(i[s]=e,a.save(),n.onSave&&n.onSave(e),r.updateCaller(o))}()},!0===n.noBrOnEmpty){var e=h(o);"<br>"!=e&&""!=e||(console.log("init event "),o.$el.children().remove())}o.events.on("dragstart",function(e){this.opts.pasteAllowedStyleProps=["font-family","font-size","color","background-color","line-height"],this.opts.pasteDeniedAttrs=[]}),o.events.on("document.dragend",function(e){this.opts.pasteDeniedAttrs=_toConsumableArray(t)}),o.events.on("drop",function(e){if($(e.currentTarget).hasClass("btn"))return e.preventDefault(),!1},!0)},contentChanged:function(){var e=g(h(this));if(!(55e3<(e=D(e)).length)){var t=l.patch_make(i[s],l.diff_main(i[s],e,!0));a.Data[s]&&(a.Data[s]=e),i[s]=e,y.sync(a,s+(n.index||""),t),r.updateCaller(this)}},mousedown:function(e){m&&(d=this.html.get())},keyup:function(e){if(m){var t;d=this.html.get(),c=null===(t=$(this.selection.blocks())[0])||void 0===t?void 0:t.outerHTML}},keydown:function(e){if(m){var t=this,a=$(t.selection.blocks());a.is(":last-child");if(t.selection.isCollapsed()&&a.is("li")){var n=a.text();a.prev().text();if(8==e.which){var o=t.html.get(),i=$(d).find("li").length,s=$(o).find("li").length,r=(a.parent(),t.selection.info(a[0]));if(0<i-s)if((c=$(c))&&(0<c.find("ul").length||0<c.parents("li").length));else if(0<c.length&&c.hasClass("hideBulletIconinLi"))t.cursor.enter(),a=$(t.selection.blocks()),t.selection.save(),x([a[0]],t),t.selection.restore(),0===a.parents("li").length&&t.cursor.del();else if(0<c.length&&(""!==c.text()||""==c.text()&&""!==c.html())&&r.atStart&&r.atEnd);else{var l=(a=$(t.selection.blocks())).closest("ul");l&&l.parent().is("li")&&r.atEnd&&a.is(":last-child")||(t.cursor.enter(),(a=$(t.selection.blocks())).addClass("hideBulletIconinLi"))}else i-s==0&&r.atStart&&""==n&&(a.empty(),t.selection.save(),x([a[0]],t),t.selection.restore())}else 13==e.which&&""==n&&""==a.prev().text()&&t.selection.info(a[0]).atStart&&(a.prev().remove(),t.selection.save(),x([a[0]],t),t.selection.restore(),0===a.parents("li").length&&t.cursor.del())}}},focus:function(){var e=r.text();!0!==n.noBrOnEmpty||""!==e&&"<br>"!==e||this.html.set("<br>")},blur:function(){var e=r.text(),t=!e&&!r.find("img, video, audio, iframe, table, embedly, lineHeight").length;!0!==n.noBrOnEmpty||""!==e&&"<br>"!==e?e=t?(this.html.set(""),""):h(this):this.$el.children().remove(),i[s]!=e&&(i[s]=e,a.save(),n.onSave&&n.onSave(e),r.updateCaller(this))},"image.inserted":function(o,e){if(!b.tryMode)try{var i=o.attr("src");k.fetchImageData({url:-1===i.indexOf("http")?"https:"+i:i,success:function(e){console.log("fetchImageData response",e);var t=e.description.captions[0].text,a=i.replace("//xtensiowebjobdev.azureedge.net/images/big/",""),n=e.description.tags.join(",");o.attr("alt",t),k.setImageData({imageUrl:a,imageTags:n,imageDesc:t,success:function(e){console.log("setImageData response",e)},error:function(e){console.log("setImageData err",e)}})},error:function(e){console.log("fetchImageData err",e)}})}catch(e){console.log("fetchImageData try catch err",e)}},"link.beforeInsert":function(e,t,a){return f(e)},"url.linked":function(e){return f(e)},"paste.afterCleanup":function(e){this.opts.pasteDeniedAttrs=_toConsumableArray(t)},"image.error":function(e,t){try{"string"==typeof t&&(t=JSON.parse(t))}catch(e){t={}}var a=this.popups.get("image.insert").find(".fr-image-progress-bar-layer"),n=app.acl.helper(b),o="The image is too big. Maximum size for uploads is ".concat(n.imgUploadLimit(),"MB.");5==e.code?n.isFreePlan()||n.isIndividualPlan()?T.raiseEvent("free-exceedsize"):a.find("h3").text(o):"object"===_typeof(t)&&null!==t&&"Error"==t.Status&&11==t.StatusCode&&a.find("h3").text(o)},click:function(e){T.raiseEvent("froalaClick",{e:{},editor:this,clickEvent:e})},"commands.after":function(e,t,a){switch(T.raiseEvent("froalaCmdAfter",{e:{},editor:this,cmd:e,param1:t,param2:a}),e){case"textColor":var n=this.selection.blocks,o=$(n[0]).parent(),i=o.prop("tagName"),s=$(".fr-color-hex-layer");i&&("LI"===i&&(i=(o=$(n[0]).parent().parent()).prop("tagName")),console.log("parentTag",i),"UL"!==i&&"OL"!==i||o.css({color:t})),setTimeout(function(){s.find("input").addClass("fr-not-empty").val(u),s.find(".btn-picker").css("background-color",u)},0);break;case"embedlyInsert":var r=$(this.selection.blocks()[0]),l=r.parent(),d=r.next();(l.is("ul")||l.is("ol"))&&(r.detach().prependTo(d),r.after("<br>")),v();break;case"applytextColor":case"customTextColor":var c=$(this.selection.element());c.find(".fr-cta-btn").css("color",t),c.hasClass("fr-cta-btn-container")&&this.selection.clear();break;case"formatOL":case"formatUL":v()}},"commands.before":function(e,t,a){switch(T.raiseEvent("froalaCmdBefore",{e:{},editor:this,cmd:e,param1:t,param2:a}),e){case"textColor":u=C.rgb2hex($(this.selection.element()).css("color")).toUpperCase()}}},FroalaEditor.DefineIcon("more",{NAME:"more",SVG_KEY:"more"}),FroalaEditor.RegisterCommand("more",{title:"More Text",focus:!0,undo:!1,refreshAfterCallback:!1,callback:function(e,t,a){$(this.$tb).find("[id^='more-']").toggleClass("more-expanded")}}),setTimeout(function(){o[0]&&new FroalaEditor(o[0],p)}),r.updateCaller=function(e){a.renderPreview(),a.factory.folio.Role<2&&a.save(),n.changed&&n.changed(e)},r.html(i[s]||""),r}},app.plugin.lockedTip=function(e,t){return{add:function(e,t,a){var n,o,i,s,r,l;o=t,i=a,(n=e).addClass("locked"),n.find(".fa-lock").remove(),n.append('<i class="fa fa-lock" data-html="true"></i>'),s=n.find(".fa-lock"),r="bottom auto",l=o,s.tooltip({container:"body",html:!0,trigger:"manual",placement:r,title:function(){return l}}),setTimeout(function(){var e=null;n.mouseenter(function(){clearTimeout(e),n.tooltip("hide"),n.find(".fa-lock").tooltip("hide"),$(this).find(".fa-lock").tooltip("show")}).mouseleave(function(){$(".tooltip").remove(),$this=$(this),e=setTimeout(function(){$this.find(".fa-lock").tooltip("hide")},i)})},10)},remove:function(e){e.removeClass("locked"),e.find(".fa-lock").remove(),setTimeout(function(){app.plugin.tooltip()},100)}}},app.plugin.main=function(e,t,a,n,o){var i=t.apiHelper,s=t.appHub,r=t.eventManager,l=!0,d=n.isFreeWithTeam();l=(!e.Team||0===e.Team.Id)&&n.isFree(),(e.editMode||e.tryMode)&&this.froalaSetup(e,r,s,l,o,d,n,app.plugin.lockedTip(e,r),i),(e.folioMode||e.dashboardMode)&&this.folioView(e),this.sliders(),this.uploader(e,i,n),this.misc(),this.social(),this.tooltip(),this.tipped(e,i,o,!1)},app.plugin.misc=function(){$.fn.unMount=function(){var e=this.data("unMountCb");e&&e()},$.fn.copier=function(){var e=this;return e.click(function(){e.select()}),e},$.fn.insertAt=function(e,t){return(e=Math.min(e,this.children().length))<1?this.prepend(t):this.find("> :eq("+(e-1)+")").after(t),this}},app.plugin.popupMenu=function(e,t,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=t.jquery?t:$(t),i=e.jquery?e:$(e);function s(){o.slideToggle(200,function(){var e=$(window).height()-$(".user-menu-popup").position().top;$(".user-menu-popup").css("max-height",e+"px")}),i.toggleClass("menu-active")}if($(document).mouseup(function(t){var e=i,a=n.some(function(e){return $(t.target).hasClass(e)||0<$(".".concat(e)).find($(t.target)).length});e.is(t.target)||0!==e.has(t.target).length||a||(o.slideUp(300),i.removeClass("menu-active"),o.find(".theme-picker").hide())}),o.on("mouseenter.popupMenu",function(){i.addClass("over")}),o.on("mouseleave.popupMenu",function(){i.removeClass("over")}),i.off("click.popupMenu"),a)return s;i.on("click.popupMenu",s)},app.plugin.sliders=function(){var n,o,i=null,s=0,r=null,l=function(e,t){null!==i&&(n=i.offset(),s=e.pageX-n.left,o=Math.ceil(s/i.width()*100),i.find("> .slider-bar").css("width",o+"%"),t.obj.Val=o,t.sync("Items"))},d=function(e,t){if(null!==i){n=i.offset(),mouseY=i.height()-(e.pageY-n.top),height=Math.ceil(mouseY/i.height()*100),height=100<height?100:height,i.find("> .slider-bar").css("height",height+"%"),t.obj.Height=height.toString();var a=i.closest(".vert-bar-module").find(".y-axis-max").text();t.obj.Val=Math.ceil(height*a/100).toString(),t.setTooltipPosVal(i.parent().find(".slider-tooltip"),height),t.sync("Items")}},c=function(e,t,a){null!==r&&(n=t.offset(),o=r.width(),s=e.pageX-n.left-o/2,o=Math.min(100-o/t.width()*100,Math.max(0,Math.ceil(s/(t.width()-o/2)*100))),r.css("left",o+"%"),a.obj.Val=o,a.sync("Items"))};$.fn.percentSlider=function(t){var a=this;return a.find(".slider-bar").css({width:Math.ceil(t.obj.Val)+"%"}),a.on("touchstart mousedown",function(e){$("body").addClass("disable-select"),i=a,l(e,t)}).on("touchmove mousemove",function(e){null!==i&&i.get(0)===this&&l(e,t)}).on("touchend mouseup touchcancel mouseleave",function(e){i=null,$("body").removeClass("disable-select")}),this},$.fn.percentVertSlider=function(t){var a=this;t.obj.Height=parseFloat(100*t.obj.Val/t.yAxisMax),100<parseFloat(t.obj.Height)&&(t.obj.Height=100),t.obj.Height=t.obj.Height.toFixed(2),a.find(".slider-bar").css({height:Math.ceil(t.obj.Height)+"%"});var n=!1;return a.on("touchstart mousedown",function(e){$("body").addClass("disable-select"),i=a,d(e,t),"mousedown"==e.type&&(n=!0),$(a).addClass("slider-dragging")}).on("touchmove mousemove",function(e){null!==i&&i.get(0)===this&&d(e,t)}).on("mouseup",function(){n=!1,$(a).removeClass("slider-dragging")}).on("touchend touchcancel mouseleave",function(e){("mouseleave"==e.type&&!1===n||"mouseleave"!=e.type)&&(i=null,$("body").removeClass("disable-select")),$(a).removeClass("slider-dragging")}),this},$.fn.thumbSlider=function(t){var a=this,n=a.find(".slider-bar");return n.css({left:t.obj.Val+"%"}),t.thumb&&a.css("cursor","auto"),a.on("touchstart mousedown",function(e){r=n,$("body").addClass("disable-select"),t.thumb||c(e,a,t)}).on("touchend mouseup touchcancel mouseleave",function(e){r=null}).on("touchmove mousemove",function(e){c(e,a,t)}),a},$(document).on("touchend mouseup touchcancel mouseleave",function(e){r=i=null,$("body").removeClass("disable-select")})},app.plugin.social=function(){$.fn.gPlus=function(e){return this.on("click",function(){window.open("https://plus.google.com/share?url="+encodeURIComponent(e),"height=300,width=600")}),this},$.fn.facebook=function(e){return this.on("click",function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e),"facebook-share-dialog","width=626,height=436")}),this},$.fn.twitter=function(e,t){return this.on("click",function(){window.open("https://twitter.com/share?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(t),"height=300,width=600")}),this},$.fn.twitterVia=function(e){return this.on("click",function(){window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(e+" @xtensio_com"),"height=300,width=600")}),this},$.fn.linkedIn=function(e,t,a){return this.on("click",function(){window.open("https://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(e)+"&title="+encodeURIComponent(t),"&summary="+encodeURIComponent(a),"height=300,width=600")}),this},$.fn.emailto=function(e){var t="mailto:?subject=Here's an invite for a free month of Xtensio Plus! Create one pagers, personas, lean canvases and more!&body=Hey there,%0D%0A%0D%0AI wanted to reach out to you because I just discovered Xtensio - a toolbox for smart and beautiful business documents. It comes with FREE tools to help you build one-pagers, user personas, lean canvases, and more.%0D%0A%0D%0AXtensio has been super helpful for my work, so I thought you might want to give it a try. You can sign up here:%0D%0A%0D%0A"+e+"%0D%0A%0D%0AIf you sign up with my link above, we'll both get a free month of premium features with Xtensio Plus!%0D%0A%0D%0ACheers,";this.attr("href",t)},$.socialLinks=function(e,t,a,n,o,i,s){t.find(a).gPlus(e),t.find(n).facebook(e),t.find(o).twitter(e,"I've got invites for a FREE month of Xtensio Plus. Create one pagers, personas, lean canvases for your #startup"),t.find(i).linkedIn(e,"Create an Xtensio account","Invitation to unlock a FREE month of Xtensio Plus. Looking to start a new company or restructure your business? Create dynamic one pagers, lite investor decks, lean canvases, user personas, and more."),t.find(s).emailto(e)},$.shareLinks=function(e,t,a,n,o,i,s,r){t.find(o).gPlus(e),t.find(i).facebook(e),t.find(s).twitter(e,n),t.find(r).linkedIn(e,a,n)}},app.plugin.tipped=function(s,r,l,e,t,a){var n,o,i,d,c,u,m=[],p=_defineProperty({skin:"light",size:"medium",radius:!1,close:!0},"close","overlap"),f=(_defineProperty(n={skin:"light",size:"medium",radius:!1,close:!1},"skin","xtensio"),_defineProperty(n,"hideOnClickOutside",!0),_defineProperty(n,"onShow",function(e,t){var a=$(t),n=a.parent().parent();a.hasClass("bg-panel-btn")?n.find(".bg-panel").is(":visible")&&Tipped.hideAll():a.hasClass("move-sec-btn")?(n.find(".bg-panel").is(":visible")||n.find(".move-menu").is(":visible"))&&Tipped.hideAll():a.hasClass("more-sec-btn")&&(n.find(".more-menu").is(":visible")||n.find(".move-menu").is(":visible")||n.find(".bg-panel").is(":visible"))&&Tipped.hideAll()}),n),h=(_defineProperty(o={skin:"light",size:"medium",radius:!1,close:!1},"skin","xtensio"),_defineProperty(o,"hideOnClickOutside",!0),_defineProperty(o,"position","right"),o),g=(_defineProperty(i={skin:"light",size:"medium",radius:!1,close:!1},"skin","xtensio"),_defineProperty(i,"hideOnClickOutside",!0),_defineProperty(i,"position","left"),i);function v(t){p.showOn={element:"mouseenter",tooltip:"mouseenter"},p.hideOn="click",p.hideAfter=100;var e=void 0!==t.DivId?t.DivId:t.divId,a=void 0!==t.Title?t.Title:t.title;0<(d=$(e)).length&&0==d.hasClass("tip-initialized")&&(d.addClass("tip-initialized"),p.onShow=function(e,t){},Tipped.create(e,function(e){return{content:'<div class="xt-tipped-wrapper">'+(a?"<h4>"+a+"</h4>":"")+t.html+"</div>"}},p))}function b(t){p.showOn={element:"mouseenter",tooltip:"mouseenter"},"Click"!==t.Trigger&&"Click"!==t.trigger||(p.showOn={element:"click",tooltip:"mouseenter"});var e=void 0!==t.DivId?t.DivId:t.divId,a=void 0!==t.Icon?t.Icon:t.icon,n=void 0!==t.DarkLight?t.DarkLight:t.darkLight,o=void 0!==t.Id?t.Id:t.id,i=void 0!==t.Title?t.Title:t.title;e=e.replace(/trymode/gi,"donotselect-trymode"),0<(d=$(e)).length&&0==d.hasClass("tip-initialized")&&(d.addClass("tip-initialized tip-icon-"+n.toLowerCase()).find(".fa").removeClass().addClass("fa fa-"+a.toLowerCase()),1==t.pulsate?($(e).data("tooltipId",o),l.isIE9orLess()?$(e).addClass("pulsating-circle-ie9"):$(e).addClass("pulsating-circle"),p.onShow=function(e,t){var a=parseInt($(t).data("tooltipId"));0<a&&(s.tryMode?T(t):r.setTooltipUserClick({tooltipId:a,type:0,complete:function(){T(t)}}))}):p.onShow=function(e,t){},Tipped.create(e,function(e){return{content:'<div class="xt-tipped-wrapper">'+(i?"<h4>"+i+"</h4>":"")+t.html+"</div>"}},p))}function T(e){$(e).hasClass("pulsating-circle")?$(e).removeClass("pulsating-circle"):$(e).hasClass("pulsating-circle-ie9")&&$(e).removeClass("pulsating-circle-ie9"),$(e).removeData("tooltipId")}function y(){Tipped.create(".tipped-static",function(e){if(!$(e).hasClass("tip-initialized")){var t={};return $(e).addClass("tip-initialized"),$(e).data("title")&&(t.title=$(e).data("title")),$(e).data("content")&&(t.content=$(e).data("content")),t}},f),Tipped.create(".exp-btn.locked",function(e){if(!$(e).hasClass("tip-initialized")){var t={};return $(e).addClass("tip-initialized"),$(e).data("title")&&(t.title=$(e).data("title")),$(e).data("content")&&(t.content=$(e).data("content")),t}},h),Tipped.create(".exp-btn.locked-sec",function(e){if(!$(e).hasClass("tip-initialized")){var t={};return $(e).addClass("tip-initialized"),$(e).data("title")&&(t.title=$(e).data("title")),$(e).data("content")&&(t.content=$(e).data("content")),t}},g)}!0!==a?t?(c=s.tippedData)&&0<c.length&&c.forEach(b):s&&(s.editMode||s.tryMode||s.dashboardMode||s.isSignup)&&(""!==s.userEmail||s.isSignup||e)&&(u={success:function(e){var t,a;console.log("getTooltips response",e),m=JSON.parse(e.Data),s.tryMode?(a=m,(s.tippedData=a)&&0<a.length&&a.forEach(v)):(t=m,(s.tippedData=t)&&0<t.length&&t.forEach(b)),y()},error:function(e){console.log("getTooltips error",e)}},s.tryMode?r.getTooltipsAnon(u):r.getTooltips(u),$(".tipped-icon").click(function(e){e.stopPropagation()})):Tipped.hide(".tipped-static")},app.plugin.tooltip=function(e){var t=$("body").hasClass("tryModeEditor"),a=$(".tooltip").not("#templates .tooltip"),n=$("[data-tip]").not("#templates [data-tip]"+(t?", .trymode-tip":""));!0===e&&(a=$(".tooltip").not("#templates .tooltip, .tipped-tooltip-created"),n=$("[data-tip]").not("#templates [data-tip], .tipped-tooltip-created"+(t?", .trymode-tip":""))),a.tooltip("destroy"),n.tooltip({delay:150,trigger:"hover",container:"body",placement:"bottom auto",title:function(){return $(this).data("tip")}}).addClass("tipped-tooltip-created").click(function(){$(this).tooltip("hide")})},app.plugin.uploader=function(d,c,u){$.fn.uploader=function(i){var t=i.module,a=i.success,n=i.imageLoaded,e=$('<input type="file" name="file" accept="image/*"/>'),o=$('<label class="file-label"></label>').append(e),s=$('<form encType="multipart/form-data" class="image-form"></form>').append(o),r=e[0],l=s[0];return i.imageLoaded=function(e){t&&t.hideSpinner(),n&&n(e)},i.success=function(e){a&&a(e),l.reset()},i.error=function(){t&&t.hideSpinner(),l.reset()},e.on("change",function(){var o=r.files&&r.files[0];o&&(t&&t.showSpinner(),d.tryMode?c.uploadImage(l,o,i,!1):u.getData(1,function(e,t,a,n){isFreeWithTeam=d.Team&&0<=d.Team.Id&&(0===e.ST||34===e.ST),c.uploadImage(l,o,i,isFreeWithTeam&&!t)},!0))}),this.append(s)}},app.popup.main=function(e,t,a,n,o,i,s,r,l,d,c,u){var m=this,p=$('<div id="popup-container"></div>'),f=[],h=app.plugin.lockedTip(e,t),g=app.lib.googleFonts();$("body").append(p),$("body").append($("#notify-popup")),m.spinner=$("#spinner-container > .loading-animation").html(),m.upgrade=$("#tmp-upgrade-panel").html(),$(document).on("keydown",function(e){var t=p.find(".show");if(t.length)if(27!=(e.keyCode||e.which)||t.hasClass("no-close")){var a=t.data("keydownCb");a&&a(e)}else{var n=t.data("closeCb");m.close(),n&&n()}});var v=!1;$(".popup-content input").mousedown(function(){v=!0}),$("#popup-container").mouseup(function(e){setTimeout(function(){v=!1},200)}),m.reg=function(e,t,a,n){e.data("closeCb",a),e.data("keydownCb",n),p.append(e),t&&(e.find(".popup-content").click(function(e){e.stopPropagation()}),e.find(".popup-wrapper").add(t).click(function(){p.find(".show").hasClass("no-close")||v||(m.close(),a&&a())}))},m.push=function(e){f.push(e)},m.pop=function(){f.pop()},m.signIn=app.popup.getSignIn(m,e,a,n),m.signUp=app.popup.getSignUp(m,e,a,n,e.campaignHandle,e.campaignSettings,t),m.signUpTeam=app.popup.getSignUpTeam(m,e,n,g,i,a),m.signUpDone=app.popup.getSignUpDone(m,a,n),m.signUpDoneInvited=app.popup.getSignUpDoneInvited(m,a,n),m.forgotPass=app.popup.getForgotPass(m,e,a,n),m.settings=app.popup.getSettings(m,e,t,a,n,i),m.emailSettings=app.popup.getEmailSettings(m,e,t,a,n),m.billing=app.popup.getBilling(m,e,a,n,i,t),m.payment=app.popup.getPayment(m,e,a,n,i),m.discPayment=app.popup.getDiscPayment(m,e,a,n,i),m.message=app.popup.getMessage(m,a),m.busy=app.popup.getBusyPopup(m),m.usermenu=app.popup.getUserMenu(e,m,t,i,a),m.plusPrompt=app.popup.getPlusPrompt(m,e,i),m.plusInfo=app.popup.getPlusInfo(m,e,a,i,t),m.signupPerformance=app.popup.getSignUpPerformance(e,m,a,n,t,s),m.transferFolio=app.popup.getTransferFolio(e,m,a,n,t),m.labels=app.popup.getLabelsPopup(e,m,a,n,t,s),m.collaborators=app.popup.getCollaboratorsPopup(e,m,a,n,i,h,t),m.archive=app.popup.getArchivePopup(e,m,n),m.unarchive=app.popup.getUnarchivePopup(m,n,i),m.shareLink=app.popup.getShareLink(n,m,e,i,h,t,c,a),m.folioVersion=app.popup.getFolioVersion(n,m,t,l,e,u,i),m.expiredBlocker=app.popup.getExpiredBlocker(e,m,i,n,t),m.failedPaymentBlocker=app.popup.getFailedPaymentBlocker(e,m,n,i,t),m.planExpireBlocker=app.popup.getPlanExpireBlocker(e,m,n,i,t),m.folioStats=app.popup.getFolioStatsPopup(e,m,n),m.copySectionPopup=app.popup.getCopySectionPopup(e,m,a,l,n),m.importFolioPopup=app.popup.getImportFolioPopup(e,m,n),m.statsBlocker=app.popup.getStatsBlocker(i,m,e),m.addFolioToSpace=app.popup.getAddFolioToSpace(e,m,n,i,t),m.transferFolioToSpace=app.popup.getTransferFolioToSpace(e,m,n,i,t),m.saveFolio=app.popup.getSaveFolio(e,m,a,n,t,i),m.personalChannelPopup=app.popup.getPersonalChannelPopup(e,m,n,a),m.trialExpirePopup=app.popup.getTrialExpirePopup(e,m,n,a,i,t),m.signupPlansPopup=app.popup.getSignupPlansPopup(e,m,n,a,i,t),m.createTemplatePopup=app.popup.getCreateTemplatePopup(e,m,n,a,i,t,h),m.confirmDowngradePopup=app.popup.getConfirmDowngradePopup(e,m,n,a,i,t),m.confirmRemoveMember=app.popup.getConfirmRemoveMemberPopup(e,m,n,a,i,t),m.confirmAddMember=app.popup.getConfirmAddMemberPopup(e,m,n,a,i,t),m.downgradeNoticePopup=app.popup.getDowngradeNoticePopup(e,m,n,a,i,t),m.teamManagePopup=app.popup.getTeamManagePopup(e,m,n,a,i,t,app.plugin),m.failedPaymentAddUser=app.popup.getFailedPaymentAddUser(e,m,n,i,t),m.universalBlocker=app.popup.getUniversalBlocker(m,e,a,n,i),m.downloadBlocker=app.popup.getDownloadBlocker(m,e,a,n,i),m.anonymousTemplatesPage=app.popup.getAnonymousTemplatesPage(e,a,m,n,i,t,h),m.anonymousExamplesPage=app.popup.getAnonymousExamplesPage(e,a,m,n,i,t,h),e.Team&&(m.teamSettingPopup=app.popup.getTeamSettingPopup(e,m,n,i,a),m.sfgUpgradePopup=app.popup.getSfgUpgradePopup(e,m,n,a),m.teamChannelManagePopup=app.popup.getTeamChannelManagePopup(e,m,n,h,a,i,t),m.styleGuidePopup=app.popup.getStyleGuidePopup(e,m,n,t,i,g,a,h),m.addTeamMemberPopup=app.popup.getAddTeamMemberPopup(e,m,n),m.setupTeamPopup=app.popup.getSetupTeamPopup(e,m),m.choosePlanPopup=app.popup.getChoosePlanPopup(e,m,n,i),m.teamUserActionBlocked=app.popup.getTeamUserActionBlocked(e,m,i),m.teamCollaborationPopup=app.popup.getTeamCollaborationPopup(e,m,a,n,i,h,t),m.addTeamMember=app.popup.getAddMembers(e,m,n),m.transferTeamFolio=app.popup.getTransferTeamFolio(e,m,a,n,t),m.teamChannelPopup=app.popup.getTeamChannelPopup(e,m,n,a,i,t),0<e.Team.Id&&(m.failedPaymentBlocker=app.popup.getFailedPaymentTeamBlocker(e,m,n,i,t))),(e.editMode||e.tryMode)&&(m.addModule=m.getAddModule(m,n,e,d,i,a,u),m.exp=app.popup.getExport(e,m,a,n,t,i),m.expOption=app.popup.getExpOption(m,a,r),m.bgImageAdjust=app.popup.getBgImageAdjust(m)),e.tryMode&&(m.tryWelcome=app.popup.getTryWelcome(e,m,t,n)),m.error=function(e,t,a){m.message({heading:t||"Oops!",message:e||"There was an error, please try again.",btnText:"Close",bodyCentered:a||!1})};var b=p.find(".app-popup");return m.close=function(){p.hide(),o.restore();var e=f.pop();e&&m.show(e),location.hash&&history.pushState("","",location.pathname)},m.show=function(e,t){b.filter(".show").removeClass("show"),e.addClass("show"),e.hasClass("normal")&&o.hideCurrent(),p.show().toggleClass("normal",e.hasClass("normal")),p.show().toggleClass("solid",e.hasClass("solid")),p.show().toggleClass("dark",e.hasClass("dark")),t&&history[location.hash?"replaceState":"pushState"]("","","#"+t)},m},app.popup.getBilling=function(f,h,r,c,g,e){var v,t,o,a,n,i,d,b=!1,T=$("#tmp-billing"),l=T.find(".error-msg"),u=T.find(".save-card"),s=T.find(".save-plan"),y=T.find(".paper"),C=T.find(".status-tab"),k=(C.find(".expire"),C.find(".date")),w=(C.find(".upgrade-panel"),C.find(".user-plan"),C.find(".discount").find(".claim-offer"),C.find(".unlock"),T.find(".pay-tab")),m=w.find(".credit-card"),p=T.find(".invoice-tab"),x=(C.find(".right"),C.find(".details")),P=w.find(".month"),S=w.find(".year"),D=w.find(".existing"),F=w.find(".change-card"),I=w.find(".change-plan"),M=T.find(".radios a"),E=w.find(".change-renew"),A=w.find("input, select"),U=p.find(".history"),N=T.find(".tabs span"),L=T.find(".card-change-status"),O=T.find(".plan-change-status"),R=m.find("#bln-ccnum"),B=m.find(".cvc"),G=m.find(".name"),H=!1,Y=!0,j=T.find(".choose-plan"),z=T.find(".circular-switch"),q=0,V=T.find("section .plan-cont"),K=T.find(".success-panel"),J="",W=$(".plan-billing-banner"),X=C.find("section.team-owner-trial"),Z=C.find("section.team-owner-cancelled"),Q=!0,ee=!1;K.find(".no").click(function(){T.find(".popup-content").removeClass("success"),f.close(),window.location=h.baseUrl});var te=function(e){Y=e||Y?(z.attr("title","Yearly"),z.toggleClass("off",!e),z.find(".button-switch").text("Yearly"),!0):(z.attr("title",Y?"Yearly":"Monthly"),z.toggleClass("off",!Y),z.find(".button-switch").text("Monthly"),!1),z.find(".button-switch").text(Y?"Yearly":"Monthly"),Y?z.addClass("off"):z.removeClass("off"),$("#tmp-billing .paper section .button p").removeClass("selected"),$("#tmp-billing .paper section .button p:eq("+(Y?0:1)+")").addClass("selected"),Y?($("#tmp-billing .plan-block:eq(1) .plan-head h1 span.num").text("25"),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small-inline").text("/user/mo"),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small").text("$300/user/year"),$("#tmp-billing .plan-block:eq(1) .plan-head a").attr("href","/teams/create/?plan=year"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.num").text("15"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small-inline").text("/user/mo"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small").text("$180/user/year"),$("#tmp-billing .plan-block:eq(0) .plan-head a").attr("href","/teams/create/?plan=proyear")):($("#tmp-billing .plan-block:eq(1) .plan-head h1 span.num").text("30"),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small-inline").text(""),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small").text("/user/mo"),$("#tmp-billing .plan-block:eq(1) .plan-head a").attr("href","/teams/create/?plan=month"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.num").text("20"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small-inline").text(""),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small").text("/user/mo"),$("#tmp-billing .plan-block:eq(0) .plan-head a").attr("href","/teams/create/?plan=promonth")),Y?(V.addClass("yearly"),V.removeClass("monthly")):(V.addClass("monthly"),V.removeClass("yearly"))};z.on("click",function(){Y=!Y,te()}),te();for(j.click(function(){$("#tmp-payment .plan-banner").hide();var s="",r="",l=$(this).attr("data-plan");if("Team"!=l)if("Credits"!==l){var d=("Pro"==l?"":"Plus")+(Y?"Year":"Month");g.getData(1,function(e,t,a,n){if(a){r="Are you sure you want to change your current plan to <b>Xtensio ",r+="Pro"==l?"Pro ":"Plus ",r+=Y?"Yearly":"Monthly",r+="</b>?",1==q&&"Pro"==l?s="Upgrade Plan":2==q&&"Plus"==l?(s='<span style="font-size: 26px;">Are you sure you want to downgrade?</br><span style="font-size: 18px;">These changes will take effect immediately.</span></span>',r="By downgrading your plan, you'll no longer have unlimited folios and exports.</br></br>Are you sure you want to change your current plan?"):s="Change Plan";var i="Xtensio ";i+="Pro"==l?"Pro ":"Plus ",i+=Y?"Yearly":"Monthly",T.addClass("busy"),c.getUserActiveFoliosCount({success:function(e){T.removeClass("busy");var o=e.Data;c.getUserTemplateCount({success:function(e){var t,a,n=e.Data;2==q&&"Plus"==l&&(5<o||0<n)?(5<o&&n<1?(t="Uh oh - You have more than 5 folios!",a="The Xtensio Plus plan has a limit of 5 folios. In order to downgrade your account, please delete extra folios on your dashboard."):5<o&&0<n?(t="Uh oh - You have more than 5 folios and saved templates",a="The Xtensio Plus plan has a limit of 5 folios and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):o<6&&0<n&&(t="Uh oh - You have saved templates!",a="The Xtensio Plus plan does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard."),f.push(T),f.message({heading:t,message:a,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){window.location=h.baseUrl}})):(f.push(T),f.message({heading:s,message:r,btnText:"Yes, I am sure",cancelText:"Nevermind",notMini:!0,handleOK:function(){ie(d,function(){ae(0),g.refresh(),console.log("inside"),T.find(".popup-content").addClass("success"),T.find(".success-panel").addClass("plan-changed"),T.find(".success-panel .plan-change .plan-name").text(i),T.find(".success-panel .plan-change h3 span").text(i)})}}))},error:function(e){T.removeClass("busy"),console.log("error: ",e)}})},error:function(e){T.removeClass("busy"),console.log("error: ",e)}})}else{f.universalBlocker()}},!0)}else f.universalBlocker()}),T.find(".expire .not-charged").hide(),T.find(".expire .prox-bold").text(""),T.find(".loading-animation").html(f.spinner),f.reg(T,T.find(".icon-Close")),T.find(".icon-Close").click(function(){T.removeClass("cardDetailsOnly"),f.close(),Q||r.reloadWithoutHash()}),u.find(".loading-animation").html(f.spinner),s.find(".loading-animation").html(f.spinner),t=1;t<=12;t++)P.append('<option value="'+t+'">'+t+"</option>");for(t=(new Date).getFullYear();t<=2030;t++)S.append('<option value="'+t+'">'+t+"</option>");var ae=function(u,m){C.find(".right").show(),T.find("section .plan-cont .plan-block").removeClass("selected"),h.hasDiscount&&C.css({visibility:"hidden"});var p="Xtensio ";C.removeClass("paying").find(">div").hide(),T.addClass("busy"),I.add(F).removeClass("cancel"),g.getData(0,function(e,t,a,n){a||T.find(".cancel-plan-btn").hide(),b&&C.find("section.team-owner .date").text(n),oe(),T.find(".existing").toggleClass("yearly",2==e.ST);var o=":eq("+u+")",i="selected";if(N.removeClass(i).filter(o).addClass(i),y.removeClass(i).filter(o).addClass(i),T.find(".tabs span:eq(1)").toggleClass("disable",!a),T.find(".tabs span:eq(2)").toggleClass("disable",!a&&!h.everPlus),(h.everPlus||a||e.Count)&&se(),w.find(".auto-on, .auto-off").hide(),G.val(e.Name),U.empty(),$.each(e.Invoices,function(e,t){U.append('<p class="clearfix"><span class="time">'+dayjs(t.Time).format("MMMM DD, YYYY")+'</span><span class="gray">$'+t.Price+'</span><a target="_blank" href="/billing/invoice/'+t.Id+'">PDF</a></p>')}),e.Invoices.length<1&&U.append('<p class="clearfix">No invoices yet.</p>'),console.log("plusActive",t,"hasPaidPlus",a),t||a){if(v.text("Add Billing Information"),p+="Plus ",a||1==e.ST||2==e.ST||9==e.ST||10==e.ST||11==e.ST||14==e.ST||19==e.ST||22==e.ST||25==e.ST||28==e.ST||31==e.ST||34==e.ST){var s=e.Last4||"0000",r=e.Brand||"Card Not Found";J="xxxx xxxx xxxx "+s,R.val(J),R.on("click focusin",function(){$(this).val().includes("xxxx")&&$(this).val("")}),w.find(".left .existing").html("<h3>"+r+'</h3><p><span class="stars">**** **** **** </span>'+s+"</p>");var l=C.addClass("paying").find(".user-plan").show(),d=2==e.ST||11==e.ST||9==e.ST?"year":"month";l.find(".type").text(d+"ly"),l.find(".time").text(d),w.find(".date").text(n),C.find(".plan-verb").text(a?"will renew on":"will expire on"),T.find("section .date").text(n),9==e.ST?w.find(".package").text("Student"):1==e.ST||2==e.ST?w.find(".package").text("Pro"):10==e.ST||11==e.ST?w.find(".package").text("Plus"):w.find(".package").text("Free"),w.find(".period").text(2==e.ST||9==e.ST||11==e.ST?"Yearly":"Monthly"),e.AR?w.find(".auto-on").show():w.find(".auto-off").show(),T.find("section .plan-cont .plan-block:eq(0) button").text("Purchase Export Credits"),T.find("section .plan-cont .plan-block:eq(0) .plan-bot").removeClass("downgrade"),T.find("section .plan-cont .plan-block:eq(1) button").text("Upgrade to Pro");var c="Xtensio ";9==e.ST?c+="Student ":1==e.ST||2==e.ST?(c+="Pro (GrandFathered)",T.find("section .plan-cont .plan-block:eq(1)").addClass("selected"),T.find("section .plan-cont .plan-block:eq(0) button").text("Downgrade to Plus"),T.find("section .plan-cont .plan-block:eq(0) .plan-bot").addClass("downgrade"),q=2):10!=e.ST&&11!=e.ST||(console.log("planName",c),c+="Plus ",T.find("section .plan-cont .plan-block:eq(0)").addClass("selected"),q=1),1==e.ST||10==e.ST?(c+="Monthly (GrandFathered)",Y=!0,T.find("section .plan-cont .plan-block.selected").removeClass("yearly monthly"),T.find("section .plan-cont .plan-block.selected").addClass("monthly"),T.find("section .plan-cont .plan-block.selected .plan-bot button").text("Switch to Yearly"),T.find("section .plan-cont .plan-block.selected .plan-bot button").removeClass("gray"),W.addClass("hidden")):2!=e.ST&&9!=e.ST&&11!=e.ST||(c+="Yearly (GrandFathered)",Y=!1,T.find("section .plan-cont .plan-block.selected").removeClass("yearly monthly"),T.find("section .plan-cont .plan-block.selected").addClass("yearly"),T.find("section .plan-cont .plan-block.selected .plan-bot button").text("Switch to Monthly"),T.find("section .plan-cont .plan-block.selected .plan-bot button").addClass("gray"),W.addClass("hidden")),te(m),T.find("section .plan-name:eq(0)").text(a?c:c+" is cancelled"),T.find("section .plan-name:eq(1)").text(c)}else C.find(".expire").show().find(".verb").text("will expire"),C.find(".upgrade-panel").show(),w.find(".auto-off").show().find(".date").text(n);T.find(".no-charge").toggleClass("hidden",e.CST<3)}else v.text("Upgrade"),C.find(".upgrade-panel").show(),(e.Count||e.Referrals.length)&&(C.find(".expire").show().find(".verb").text("expired"),T.find(".expire .prox-bold").text("Upgrade to regain access to Plus features."));1==e.ST||10==e.ST,1==e.ST||10==e.ST||2==e.ST||11==e.ST||9==e.ST||(C.find(".right").hide(),T.find(".plan-block .plan-bot").removeClass("downgrade"),T.find(".plan-block").removeClass("yearly"),T.find(".plan-block").removeClass("monthly"),T.find("section .plan-cont .plan-block:eq(0) button").text("Purchase Export Credits"),T.find("section .plan-cont .plan-block:eq(1) button").text("Upgrade to Pro"),p="Xtensio (Free)",T.find(".upgrade-panel .right").css({marginTop:"0"}),T.find("section p .plan-name").text("Xtensio (Free)"),C.find(".plan-verb").text("has expired on"),t?(T.find(".expire .prox-bold").text("Add billing information to retain access to Plus features."),T.find(".expire .not-charged").show(),T.find(".upgrade-panel .right").css({marginTop:"20px"}),p="Xtensio Pro (Free)",!0,T.find("section p .plan-name").text("free Xtensio"),C.find(".plan-verb").text("will expire on")):e.Count||e.Referrals.length||(T.find(".expire .prox-bold").text("Unlock more features with Xtensio Plus."),T.find(".expire").show(),T.find(".expire .exp-txt").hide(),p="Xtensio (Free)",!0,H||h.everPlus||!h.Team||0!=h.Team.Id||f.universalBlocker()),"Xtensio (Free)"===p&&T.find(".team-member .plans-det p").hide(),T.find("section h3 .plan-name").text(p),t&&4==e.ST?(T.find("section p .plan-name").text("Free Pro"),T.find("section h3 .plan-name").text("Free Pro")):!t||16!=e.ST&&3!=e.ST||(T.find("section p .plan-name").text("Free Plus"),T.find("section h3 .plan-name").text("Free Plus"))),C.find(".plan").text(p),0!=e.ST||t?k.text(n):k.text(dayjs(Date(h.planCancel)).format("MMMM Do, YYYY")),C.css({visibility:"visible"})})};function ne(e){e=e||"Error - Please review the highlighted fields.",l.text(e).addClass("show")}function oe(){clearTimeout(i),i=setTimeout(function(){T.removeClass("busy")},4e3)}function ie(e,t){T.addClass("busy"),c.changePlan({data:{plan:e,renew:e?1:0},success:function(e){Q=!1,g.refresh(),ae(1),t(e)},error:function(e){f.push(T),f.error(e.Message||"There was an error. Please try later.")},complete:function(){T.removeClass("busy")}})}N.click(function(){var e=$(this);return e.hasClass("disable")||ae(e.index()),!1}),v=T.find(".upgrade-panel").html(f.upgrade).find(".ok"),T.find(".invite-link").val(h.sharePlusLink).copier(),$.socialLinks(h.sharePlusLink,T,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),v.click(function(){f.payment()}),u.click(function(e){var t=0,a=R.data("val"),n=B.val(),o=P.val(),i=S.val(),s=G.val();if(a==J)return L.html('<i class="fi-check"></i> Changes saved.').removeClass("hidden"),setTimeout(function(){L.html("").addClass("hidden")},3e3),!1;A.removeClass("error"),l.removeClass("show"),Stripe.card.validateCardNumber(a)||(t=1,R.addClass("error")),Stripe.card.validateCVC(n)||(t=1,B.addClass("error")),Stripe.card.validateExpiry(o,i)||(t=1,P.add(S).addClass("error")),s||(t=1,G.addClass("error")),t?ne():(u.find(".loading-animation").removeClass("hidden"),u.find("span").text("Saving ..."),u.prop("disabled",!0),Stripe.card.createToken({number:a,cvc:n,exp_month:o,exp_year:i,name:s},function(e,t){if(t.error)ne(t.error.message);else{var a=t.card,n=t.id;c.card({data:{Token:n,CardId:a.id,Last4:a.last4,Brand:a.brand,Name:s},success:function(e){g.refresh(),Q=!1,F.trigger("click"),R.val(""),u.find(".loading-animation").addClass("hidden"),u.find("span").text("Save"),u.prop("disabled",!1),L.html('<i class="fi-check"></i> Credit card changed successfuly.').removeClass("hidden"),!0===ee&&(window.location.href=r.getAppUrl(h.Environment)),setTimeout(function(){L.html("").addClass("hidden")},3e3)},error:function(e){ne(e.Message)},complete:function(){T.removeClass("busy")}})}}))}),s.click(function(){var e=M.filter(".selected").data("time"),t=$(this);t.find(".loading-animation").removeClass("hidden"),t.find("span").text("Saving ..."),t.prop("disabled",!0),ie(e,function(){D.toggleClass("yearly","Year"==e),w.find(".period").text(e+"ly"),I.trigger("click"),s.find(".loading-animation").addClass("hidden"),s.find("span").text("Save"),s.prop("disabled",!1),O.html('<i class="fi-check"></i> Plan changed successfuly.').removeClass("hidden"),setTimeout(function(){O.html("").addClass("hidden"),window.location=h.baseUrl},3e3)})}),F.click(function(){T.find(".pay-tab").find(".change-card span:last-child").css({display:""}),T.find(".pay-tab").find(".change-card span:first-child").css({display:""}),T.find(".pay-tab").find(".change-card").hasClass("cancel")?(T.find(".pay-tab").find(".change-card span:last-child").css({display:"inline"}),T.find(".pay-tab").find(".change-card span:first-child").css({display:"none"})):(T.find(".pay-tab").find(".change-card span:last-child").css({display:"none"}),T.find(".pay-tab").find(".change-card span:first-child").css({display:"inline"})),$(this).toggleClass("cancel"),w.find(".left").toggleClass("edit")}),I.click(function(){$(this).toggleClass("cancel"),w.find(".right").toggleClass("edit")}),C.find(".plus-btn").click(function(){f.plusInfo()});var se=function(){c.getStripInvoiceData({success:function(e){if("Success"==e.Status){$("#billingUserInvoices").html(""),data=JSON.parse(e.Data);var t="https://static.accountdock.com/app.min.js";if(("localhost"==window.location.hostname||"www.localhost.com"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||-1<window.location.hostname.indexOf("xtensio.tech")||-1<window.location.hostname.indexOf("localhost.com"))&&(t="https://sandbox.accountdock.com/app.min.js"),"undefined"==typeof AccountDock){var a=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=t,a.appendChild(n)}if("undefined"!=typeof AccountDock){var o=AccountDock.configure({key:data.AccountDockKey,customer:data.StripeCustomerId});$(function(){o.open({container:"#billingUserInvoices"})})}}}})};C.find(".cancel-plan-btn, .contact span").click(function(){return f.push(T),f.confirmDowngradePopup("cancel"),!1}),x.click(function(){ae(1)}),M.click(function(e){e.preventDefault();$(this).hasClass("selected")||M.toggleClass("selected")}),E.click(function(){$(this).toggleClass("selected")});function re(e){for(var t=0;t<h.TeamRoles.length;t++)if(h.TeamRoles[t].Id==e)return h.TeamRoles[t].Name}if(h.UserTeams&&0<h.UserTeams.length){for(var le=0;le<h.UserTeams.length;le++)T.find(".team-list").append('<span class="bold">'+h.UserTeams[le].Name+" ("+re(h.UserTeams[le].Role)+")</span><br>");C.find(".button span.team-mem").css("display","inline-block")}else T.find(".team-list").remove(),C.find("button span.team-mem").hide();if(h.UserTeams)for(le=0;le<h.UserTeams.length;le++)1==h.UserTeams[le].Role&&(b=!0);function de(e,n){var o=d.isFreePlan();c.getTeamSetCount({data:{teamId:e},success:function(e){console.log("getTeamSetCount response",e);var t=JSON.parse(e.Data);if(n&&"function"==typeof n){var a=o?t.TotalUserCount:parseInt(t.GuestSeatsPurchased)+parseInt(t.MemberSeatsPurchased)+1;n(a)}},error:function(e){console.log("getTeamSetCount error",e)}})}function ce(n,e){de(e,function(e){var t=h.ReActivationData.LastPlan||h.Team.Plan;if(C.find("section.team-member").remove(),C.find("section.team-owner").remove(),X.hide(),Z.show(),console.log("planType",t),Z.find(".plan-type").text(t),Z.find(".plan-duration").text(dayjs(h.plusExpireTime).format("MMMM Do, YYYY")),Z.find(".plan-seats").text(e),n)Z.find(".plan-type-head").text(t+"  (Canceled)"),Z.find(".is-deactivated").hide(),Z.find(".is-ongoing").show(),Z.find(".mtm-popup-link").hide();else{var a=_.find(h.UserTeams,function(e){return 1===e.Role});Z.find(".plan-type-head").text("Free Forever"),Z.find(".is-deactivated").show(),Z.find(".is-ongoing").hide(),Z.find(".seat-text").hide(),a?Z.find(".team-name").text(a.Name):Z.find(".team-text").hide()}})}function ue(){return g.isProBusiness()?"Pro":"Business"}return X.find(".trial-compare").click(function(e){e.preventDefault(),f.universalBlocker()}),X.find(".trial-upgrade-now").click(function(e){e.preventDefault(),f.universalBlocker()}),Z.find(".plan-upgrade-now").click(function(e){e.preventDefault(),f.universalBlocker()}),C.find("section.team-owner .expired-upgrade-now").click(function(e){e.preventDefault(),f.universalBlocker()}),C.find("section.team-member .member-upgrade-now").click(function(e){e.preventDefault(),f.universalBlocker()}),X.find(".trial-seats, .mtm-popup-link").click(function(e){e.preventDefault(),f.teamManagePopup()}),Z.find(".mtm-popup-link, .plan-seats").click(function(e){e.preventDefault(),f.teamManagePopup()}),C.find("section.team-owner .see-payment").click(function(){ae(2)}),C.find(".cont-export-credits .purchase-btn").click(function(e){e.preventDefault(),g.isFree()&&!g.isFreeWithTeam()||g.isFreeWithTeam()&&(g.isOwner()||g.isAdmin())?(f.universalBlocker(),$("#tmp-payment").css("opacity",0),setTimeout(function(){$("#tmp-payment .btn-credits, .btn-creds").trigger("click"),setTimeout(function(){$("#tmp-payment").css("opacity",1)},200)},1e3)):f.message({heading:"You Cannot Perform this Action",message:"Please contact your team admins for more credits.",btnText:"Ok",bodyCentered:!0,notMini:!0})}),C.find("section.team-owner .change-plan").click(function(e){e.preventDefault(),f.universalBlocker()}),C.find("section.team-owner .cont-owner-seats .btn-team-members").click(function(e){e.preventDefault(),d&&d.collabActive()?f.teamManagePopup():f.universalBlocker()}),$("[name=plan_type]").click(function(){console.log("$(this).val()",$(this).val()),a=$(this).val()}),$("[name=plan_cycle]").click(function(){console.log("$(this).val()",$(this).val()),n=$(this).val()}),C.find("section.team-owner .change-plan .switch-biz-plan").click(function(e){e.preventDefault(),a=ue(),ue(),19===o.ST||25===o.ST||31===o.ST?n="Month":14!==o.ST&&22!==o.ST&&28!==o.ST||(n="Year"),console.log("planChangeCycle",n),console.log("planChangeType",a),$("[name=plan_type][value="+a+"]").prop("checked",!0),$("[name=plan_cycle][value="+n+"]").prop("checked",!0)}),function(e,t,a,n){ee=n,"string"==typeof a&&T.addClass(a),T.addClass("busy"),d=app.acl.helper(h),z.hasClass("off")||z.trigger("click"),$("#tmp-billing").find(".status-tab").find(".discount").css({display:"none"}),T.find(".popup-content").removeClass("success"),H=t||0,g.loadStripe(function(){ae(e||0,!0)}),h.IsDelinquent&&(T.find(".pay-tab").find(".left").addClass("edit"),T.find(".pay-tab").find(".change-card span:first-child").css({display:"none"}),T.find(".pay-tab").find(".change-card span:last-child").css({display:"inline"})),T.addClass("busy"),b?g.getData(1,function(e,r,l,t){o=e,C.find("section.team-member").remove(),console.log("planDetails",o),console.log("config.ReActivationData.LastPlan",h.ReActivationData.LastPlan);var a=null;h.Team&&0!==h.Team.Id?a=h.Team.Id:h.UserTeams&&0<h.UserTeams.length&&h.UserTeams.forEach(function(e,t){1===e.Role&&(a=e.Id)}),h.ReActivationData&&h.ReActivationData.LastPlan?ce(!1,a):0===h.autoRenew&&0!==h.Team.ST&&34!==h.Team.ST&&!h.isTrialCanceled&&h.trialConverted?ce(!0,a):(a||(a=0),de(a,function(e){var t=d.planDisplayName(),a=t.toString().toLowerCase(),n=h.ReActivationData.LastPlan||h.Team.Plan,o=-1<t.indexOf("Team")||-1<t.indexOf("Pro")||d.isIndividualPlan(),i="none"===n.toLowerCase()||-1<n.search(/export|credit/gi);if(o?C.find(".seat-num").text(e):C.find(".seat-num").text("Unlimited"),l&&r)-1!==a.indexOf("monthly")?C.find("section.team-owner p:eq(0) span.bold:eq(0)").text("monthly"):-1!==a.indexOf("yearly")?C.find("section.team-owner p:eq(0) span.bold:eq(0)").text("yearly"):-1!==a.indexOf("edu")&&C.find("section.team-owner p:eq(0) span.bold:eq(0)").text("semester (3 month)"),C.find("section.team-owner h2:eq(0) span.bold:eq(0)").text(t),C.find("section.team-owner .expire-upgrade-cont").hide(),d.collabActive()||(C.find(".seat-num").text(1),C.find("section.team-owner .cont-owner-seats .btn-team-members").text("Upgrade to Business to add users"));else{C.find("section.team-member").remove(),C.find("section.team-owner").remove(),X.hide(),Z.show(),console.log("planType",n),Z.find(".plan-type").text(n);var s=_.find(h.UserTeams,function(e){return 1===e.Role});Z.find(".plan-type-head").text("Free Forever"),c.getCreditsLeft({success:function(e){console.log("getCreditsLeft response",e);var t=JSON.parse(e.Data);i&&t.CreditsLeft<=0?$(".cont-export-credits").hide():($(".cont-export-credits").show(),$(".export-credits-num").text(t.CreditsLeft))},error:function(e){console.log("getCreditsLeft error",e),ne(e.Message)}}),i?Z.find(".is-deactivated").hide():Z.find(".is-deactivated").show(),Z.find(".is-ongoing").hide(),s?Z.find(".team-name").text(s.Name):Z.find(".team-text").hide()}oe()}))}):(C.find("section.team-owner").hide(),oe(),C.find("section.team-member .feat-cont").hide(),C.find("section.team-member .plan-cont").hide(),C.find("section.team-member .plan-billing-banner").hide(),C.find("section.team-member .button").hide()),f.show(T,"billing"),R.passwordify({maxLength:19,numbersOnly:!0,charToShow:4}),B.mask("0000")}},app.popup.getConfirmAddMemberPopup=function(u,m,p,e,t,a){var f,h,g=$("#tmp-confirm-add-member"),n=g.find(".cancel, .popup-close.icon-Close"),v=g.find(".loading-animation").html(m.spinner),b={basic:"Team Members can create their own folios and are automatically added to team visible channels.",full:"Team Members can create their own folios, save custom templates and are automatically added to team visible channels."},T={basic:"Premium guests can collaborate on any folio or channel, but cannot create new folios.",full:"Premium guests can collaborate on any folio or channel, but cannot create new folios."},y={basic:"Team Admins can create new folios, and collaborate on team visible. Plus, admins can manage the style guide and add new users to the team.",full:"Team Admins can create new folios, save custom templates and collaborate on team visible. Plus, admins can manage the style guide and add new users to the team."};return g.find(".cancel-add-btn").click(function(e){e.preventDefault(),m.close()}),g.find(".confirm-add-btn").click(function(e){e.preventDefault(),g.removeClass("show"),m.close(),"function"==typeof f&&f()}),m.reg(g,n),function(e,t,a){var n;h=app.acl.helper(u),f=a,!0?(v.hide(),g.find(".popup-content").show()):(v.show(),g.find(".popup-content").hide());var o,i,s,r=h.planDisplayName().toString().toLowerCase(),l=-1!==r.indexOf("basic access");function d(e){return e+1<=s?i:i+(e+1-s)*o}e=$.trim(e),console.log("memberType",e),console.log("plan name",r),console.log("isBasic",l),n=h.getMonthlyYearly(),o=h.getAddMemberPrice(),i=h.getBasePrice(),s=h.minUsers(),g.find(".member-type").text(e),g.find(".memberTypeInfo").hide(),g.find('.memberTypeInfo[data-member="'+e+'"]').show(),g.find(".amount-per").text("$"+o+" "+(""==n?"":"per "+n)),g.find(".monthly-yearly").text(""==n?"":n+"ly"),g.find(".next-payment-date").text(dayjs(u.Team.plusExpireTime).format("MMMM Do, YYYY"));var c=l?"basic":"full";g.find(".member .text").text(b[c]),g.find(".admin .text").text(y[c]),g.find(".pg .text").text(T[c]),console.log("add member price from acl",o),null==t||null==t?p.listALLMembers({data:{teamId:u.Team.Id},success:function(e){g.find(".next-total-payment").text("$"+d(e.Data.Data.members.length))},error:function(e){console.log(e)},complete:function(){m.show(g)}}):(g.find(".next-total-payment").text("$"+d(t)),m.show(g))}},app.popup.getConfirmRemoveMemberPopup=function(n,o,i,e,t,a){var s,r=$("#tmp-confirm-remove-member"),l=r.find(".cancel, .popup-close.icon-Close"),d=r.find(".loading-animation").html(o.spinner);function c(e){e?(d.hide(),r.find(".popup-content").show()):(d.show(),r.find(".popup-content").hide())}return t.isFreeWithTeam()?r.find(".hidden-on-free").hide():r.find(".hidden-on-paid").hide(),r.find(".cancel-remove-btn").click(function(e){e.preventDefault(),o.close()}),r.find(".confirm-remove-btn").click(function(e){e.preventDefault(),c(!1),s&&"function"==typeof s&&s()}),o.reg(r,l),function(e,t,a){s=a,o.show(r),c(!1),$("#dashboard-page .loader").show(),r.find(".channel").text(t),i.getUserFolioCountFromTeam({username:e,teamId:n.Team.Id,success:function(e){console.log("getUserFolioCountFromTeam response",e);var t=JSON.parse(e.Data);console.log("data",t);var a=t.TotalOwnedFolios,n=t.TotalOwnedTeamTemplates,o=t.TotalOwnedUserTemplates;r.find(".folio").text(1===a?a+" folio":a+" folios"),r.find(".team-templates").text(1===n?n+" Team Template":n+" Team Templates"),r.find(".my-templates").text(1===o?o+" Personal Template":o+" Personal Templates"),0===a&&r.find(".folio").closest(".item").hide(),0===n&&r.find(".team-templates").closest(".item").hide(),0===o&&r.find(".my-templates").closest(".item").hide()},error:function(e){console.log("WARNING"),console.log("getUserFolioCountFromTeam err",e)},complete:function(){$("#dashboard-page .loader").hide(),c(!0)}})}},app.popup.getDiscPayment=function(n,t,e,l,d){var a,o,c=$("#tmp-disc-payment"),u=c.find(".error-msg"),i=c.find(".checkout-btn"),m=c.find(".card-num"),p=c.find(".cvc"),f=c.find(".user-name"),h=(c.find(".radios a"),c.find(".month")),g=c.find(".year"),v=c.find("input, select"),s=c.find(".detail-btn"),b=c.find(".success-panel"),r=i.find(".txt"),T=c.find("h1"),y=!1;for(o=1;o<=12;o++)h.find(".filter-popup-menu").append('<div class="item" data-value="'+o+'">'+o+"</div>");for(o=(new Date).getFullYear();o<=2030;o++)g.find(".filter-popup-menu").append('<div class="item" data-value="'+o+'">'+o+"</div>");function C(e){e=e||"Error - Please review the highlighted fields.",u.text(e).addClass("show")}c.find(".loading-animation").html(n.spinner),n.reg(c,c.find(".icon-Close, .no"),function(){a&&a()}),s.click(function(){n.billing(1,!0)});var k=function(){c.addClass("busy");var e,t,a=$(this);a.find(".loading-animation").removeClass("hidden"),e="DiscountYearly",t=function(){setTimeout(function(){a.find(".loading-animation").removeClass("hidden")},3e3)},c.addClass("busy"),l.changePlan({data:{plan:e,renew:e?1:0},success:function(e){d.refresh(),d.getData(0,function(e,t,a,n){b.find(".time").text(n)}),c.find(".popup-content").addClass("success"),b.find(".period").text("year"),b.find(".plan-time").text("Yearly"),T.data("plus")?(T.text("Discount Applied!"),b.find(".msg-plus").hide(),b.find(".msg-free .act").text("updated")):(T.text("Welcome to Xtensio Plus"),b.find(".msg-free").hide()),t(e)},error:function(e){n.push(c),n.error(e.Message||"There was an error. Please try later.")},complete:function(){c.removeClass("busy")}})};return i.click(function(e){if(y)k();else{var t=0,a=m.val(),n=p.val(),o=parseInt(h.find(".item.active").attr("data-value")),i=parseInt(g.find(".item.active").attr("data-value")),s=f.val(),r="DiscountYearly";console.log(o+" y "+i),v.removeClass("error"),u.removeClass("show"),Stripe.card.validateCardNumber(a)||(t=1,m.addClass("error")),Stripe.card.validateCVC(n)||(t=1,p.addClass("error")),Stripe.card.validateExpiry(o,i)||(t=1,h.add(g).addClass("error")),s||(t=1,f.addClass("error")),t?C():(c.addClass("busy"),Stripe.card.createToken({number:a,cvc:n,exp_month:o,exp_year:i,name:s},function(e,t){if(t.error)c.removeClass("busy"),C(t.error.message);else{var a=t.card,n=t.id;r.toLowerCase();l.buy({data:{Token:n,CardId:a.id,Last4:a.last4,Brand:a.brand,Plan:r,Name:s},success:function(e){d.refresh(),c.removeClass("busy"),c.find(".popup-content").addClass("success"),b.find(".time").text(dayjs(+e.Message).format("MMMM Do, YYYY")),b.find(".period").text("year"),b.find(".plan-time").text("Yearly"),T.data("plus")?(T.text("Billing Information Saved!"),b.find(".msg-plus").hide()):(T.text("Welcome to Xtensio Plus"),b.find(".msg-free").hide()),console.log(y+"sd ")},error:function(e){c.removeClass("busy"),C(e.Message)}})}}))}}),$("#billing-link").click(function(){n.universalBlocker()}),function(e){c.find(".filter-popup-menu").hide(),t.hasDiscount?(a=e,c.addClass("busy").find(".popup-content").removeClass("success"),T.text("Students and Faculty, Save 50%"),r.text("Upgrade"),d.loadStripe(function(){d.getData(1,function(e,t,a,n){c.removeClass("busy"),c.find(".msg").toggleClass("hidden",!t).find(".time").text(n),T.data("plus",t),T.data("end",n),a||e.Referrals.length||!t||r.text("Add Billing Information"),1==e.ST&&(r.text("Upgrade to Yearly"),c.find(".card-box").hide(),c.find(".item").hide(),y=!0,i.css({marginTop:0}),$(".total  ul li:nth-child(3)").hide()),m.passwordify({maxLength:19,numbersOnly:!0,charToShow:4}),p.mask("0000")})}),n.show(c,"studentbilling")):n.universalBlocker()}},app.popup.getForgotPass=function(t,e,a,n){var o,i,s,r=$("#tmp-fpass"),l=r.find(".email"),d=(r.find(".popup-cta"),r.find(".msg")),c=function(){d.attr("class","msg"+(i?" error":"")).text(s)},u=function(){o=l.val(),i=!validator.isEmail(o),empty=!o,s=i?"Please provide a valid email address.":"Sending Email. Please wait.",c(),empty&&d.html("Email  cannot be  Blank.").addClass("error"),i||n.forgotPassword({email:o,success:function(e){i=!1,s=e.Message,c()},error:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){i=!0,s=e.Message||"There was an error. Please try again.",c()})})};return r.find(".sign-in").on("click",function(){t.signIn()}),l.on("keyup",function(e){13==e.which&&u(),c()}),r.find(".popup-cta").on("click",u),t.reg(r),function(e){o=e,l.val(o),c(),t.show(r)}},app.popup.getPayment=function(u,T,y,m,p){var r,e,f,h,g,v,b,C,k,w,x,P,S,D=$("#tmp-payment"),l=D.find(".error-msg"),t=D.find(".checkout-btn"),d=D.find(".card-num"),c=D.find("#crd-ccnum"),F=D.find(".cvc"),I=(D.find(".month-radio"),D.find(".year-radio"),D.find(".user-name")),M=(D.find(".radios a"),D.find(".month")),E=D.find(".year"),A=D.find("input, select"),a=D.find(".detail-btn"),i=(D.find(".charged"),D.find(".msg-end"),D.find(".success-panel")),U=(t.find(".txt"),D.find(".popup-header h1").first()),N=D.find(".checkout-title-box"),n=N.find(".chk-back-btn"),o=D.find(".circular-switch"),L=(o.find(".button-out"),o.find(".button-in"),!0),O=D.find(".card-details .select.confirm"),R=!1,B={},G=!1,H=D.find(".card-details"),s=H.find(".new-card-details"),Y=H.find(".existing-card-details"),j=D.find(".container-plans"),z=D.find(".cont-upgrade-panel"),q=D.find(".popup-header"),V=D.find(".popup-header .intro-text"),K="monthly",J="team",W=null,X=!1,Z=null,Q=!1,ee=5,te=0,ae=0,ne=[],oe=!1,ie=$("#upg-ccnum"),se=z.find(".cvc"),re=z.find(".user-name"),le=$("#upg-ccdate"),de=z.find(".upg-confirm"),ce=z.find(".upg-error-msg"),ue=D.find(".cont-upgrade-success"),me=(D.find(".back-btn"),j.find(".cont-compare-plans-full .table"),!0),pe=j.find(".cont-compare-plans-full"),fe=pe.find(".btn-pro"),he=(pe.find(".btn-pro + .curr"),pe.find(".btn-biz")),ge=(pe.find(".btn-biz + .curr"),pe.find(".btn-free-dg"),pe.find(".note-free-curr"),!1),ve=[],be=183561;n.click(function(){window.location.reload()});var Te=function(e){L=e||L?(o.attr("title","Yearly"),o.toggleClass("off",!e),$("#tmp-payment .card-panel .paper").removeClass("monthly"),$("#tmp-payment .card-panel .paper").addClass("yearly"),o.find(".button-switch").text("Yearly"),!0):(o.attr("title",L?"Yearly":"Monthly"),o.toggleClass("off",!L),$("#tmp-payment .card-panel .paper").removeClass("yearly"),$("#tmp-payment .card-panel .paper").addClass("monthly"),o.find(".button-switch").text("Monthly"),!1),o.find(".button-switch").text(L?"Yearly":"Monthly"),L?o.addClass("off"):o.removeClass("off"),$("#tmp-payment .card-panel .popup-header p").removeClass("selected"),$("#tmp-payment .card-panel .popup-header p:eq("+(L?0:1)+")").addClass("selected"),console.log("isYearly",L)};function ye(e){Z&&clearTimeout(Z);var t=z.find(".member-err");t.text(e),t.show(),Z=setTimeout(function(){t.hide()},5e3)}function Ce(e){e?(z.find(".cont-back").hide(),z.find(".card-new").show(),z.find(".card-exists").hide()):(z.find(".card-new").hide(),z.find(".card-exists").show())}function ke(e,t){if(void 0===e||void 0===t){var a=y.getUrlVars();e=a.promo?a.promo.toString():"",t=a.plan?a.plan.toString():""}return"business"==t&&("deskpass"==e||"profitwell"==e)}function we(){var e,t="yearly"===K?"monthly":"yearly",a="basic plus pro team agency edu ".concat(t),n=(J+" "+K).toString(),o=y.capitalizeFirstLetter(J),i=y.capitalizeFirstLetter(K),s=o+" "+i,r=y.capitalizeFirstLetter(K),l="Xtensio "+s,d=dayjs().add(1,"yearly"===K?"years":"months");"edu"===J&&(t="yearly",n=J+" monthly",i="",r="per Semester",l="Xtensio "+o,d=dayjs().add(3,"months"),s=o="Students and Educators",l="Xtensio Students and Educators"),e=t,!0===T.IsDelinquent?(z.find(".change-plan").hide(),z.find("input[type=radio]").closest(".radio-cont").css("display",""),z.find("input[type=radio][value="+e+"]").closest(".radio-cont").hide()):(z.find(".change-plan").css("display",""),z.find("input[type=radio]").closest(".radio-cont").css("display","")),j.removeClass(t),j.addClass(K),z.removeClass(a),z.addClass(n),z.find(".panel-title .plan-type").text(s),z.find(".card-title.plan-title").text(o),z.find(".plandur").text(r),z.find(".upg-checkout-btn .type").text(s),ue.find(".upg-success-seat-cont").hide(),ue.find(".muted").hide(),ue.find(".upg-success-type").text(l),ue.find(".next-payment-date").text(d.format("MMMM Do, YYYY"));var c=y.getUrlVars(),u=c.promo?c.promo.toString():"",m=c.plan?c.plan.toString():"",p=$("#checkout-subtotal-discount");if(c.promo&&z.find(".change-plan").hide(),p.hide(),T&&T.HasDiscount||""!==u){var f=0;if(T.Discount?f=parseInt(T.Discount,10)||25:-1!==u.indexOf("1")&&(f=25),ke(u,m)){var h=z.find("input[type=radio][value=monthly]");h.attr("disabled","disabled"),h.parent().addClass("disabled"),z.find(".chk-back-btn").removeClass("showOnSignUp").hide(),f=50}if(0!==f){var g="yearly"===K?ae:te,v=g*(f/100),b=g-v;p.find(".disc-perc").text(f),p.find(".disc-val").text(Me(v)),p.find(".disc-tot").text(Me(b)),ue.find(".upg-success-cost").text(Me(b)+" USD"),z.find(".upg-checkout-btn .cost-pay").text(Me(b)),p.show()}}!function(){if(console.log("config.Team ",T.Team),0!==T.Team.Id){var e=void 0===T.Team.Plan?"None":T.Team.Plan,t=-1!==e.toString().indexOf("Business")?"business":"pro",a=-1!==e.toString().indexOf("Yearly")?"yearly":"monthly";j.find(".plan-cont:eq(2)").removeClass("current"),j.find(".plan-cont:eq(0)").removeClass("current"),pe.removeClass("current"),pe.hasClass(t)||pe.addClass(t),t===J&&K===a&&X&&("pro"===J?(j.find(".plan-cont:eq(2)").addClass("current"),pe.addClass("current")):"business"===J&&(j.find(".plan-cont:eq(0)").addClass("current"),pe.addClass("current")))}}()}function xe(e){var t="Please Upgrade Your Account";"string"==typeof e&&"signUpMode"===e&&(t="Choose Your Plan"),we(),$("body").addClass("fullScreenPopupOpen"),window.scrollTo(0,0),z.hide(),j.addClass("upgrade"),U.text(t),V.text("No commitment. Switch plans or cancel anytime."),U.show(),q.hide(),j.show(),D.find(".popup-wrapper").addClass("plan-list")}function $e(e){setTimeout(function(){"semester"===e?($(".cont-plan-details").find(".bill-dur-cont .radio-cont").hide(),z.find(".bill-dur-cont .edu-cont").show()):($(".cont-plan-details").find(".bill-dur-cont .radio-cont").show(),z.find(".bill-dur-cont .edu-cont").hide())},100)}function Pe(){console.log("upgradePlanType",J),console.log("upgradeDuration",K);var e=y.getPriceFromCents,t=x.getPlanObjFromAllPlansAclData(J+"yearly",ve),a=x.getPlanObjFromAllPlansAclData(J+"monthly",ve),n=parseInt(x.getRuleValueFromPlanObj("minUsers",a)),o=e(t.PriceCents),i=e(a.PriceCents),s=e(a.ExtraSeatPriceCents),r=e(t.ExtraSeatPriceCents),l=parseInt(b.find(".quantity__field:eq(1) span").text(),10),d=parseInt(b.find(".quantity__field:eq(0) span").text(),10),c=parseInt(C.find(".quantity__field:eq(1) span").text(),10),u=parseInt(C.find(".quantity__field:eq(0) span").text(),10);S=1,"pro"===J?S="monthly"===K?l:d:"team"===J&&(S="monthly"===K?c:u);var m=n<S?S-n:0;te=i+m*s,ae=o+m*r,$e(),z.find(".durtxt").text("month"),z.find(".cost").text(Me(te)),z.find(".newcost").text(Me(ae/12)),z.find(".totalcost-month").text(Me(te,!0)),z.find(".totalcost-year").text(Me(12*te,!0)),z.find(".newtotalcost").text(Me(ae,!0));var p="monthly"===K?te:ae/12,f="yearly"===K?ae:te;ue.find(".upg-success-seat-cost").text(Me(p)+"/month, billed "+K),ue.find(".upg-success-cost").text(Me(f,!0)+" USD"),de.find(".charge-amnt").text(Me(f,!0)),z.find(".upg-checkout-btn .cost-pay").text(Me(f)),de.find(".charge-duration").text(K.replace("ly","")),Se("agency"===J?20:S)}function Se(e){var t=e+(1===e?" seat":" seats");z.find(".upg-num-seats").text(t),z.find(".seat-num span").text(t),ue.find(".upg-success-seatnum").text(t)}function De(e){function t(e){var t,a,n;console.log("listALLMembers response",e),t=ge?T.teamMembersOnSignUp:e.Data.Data.members,"edu"===J?(a=x.getPlanObjFromAllPlansAclData(J,ve),n=y.getPriceFromCents(a.PriceCents),$e("semester"),S=1,z.find(".durtxt").text("semester"),z.find(".cost").text(Me(n)),z.find(".totalcost-month").text(Me(n,!0)),ue.find(".upg-success-seat-cost").text(Me(n)+"/semester, billed every 3 months"),ue.find(".upg-success-cost").text(Me(n,!0)+" USD"),de.find(".charge-amnt").text(Me(n,!0)),z.find(".upg-checkout-btn .cost-pay").text(Me(n)),de.find(".charge-duration").text("semester"),Se(S)):Pe();var o=(ne=t).length;0===o&&(ne.push({Email:T.userEmail}),o=1);var i="",s="",r="",l="";ne.forEach(function(e,t){if(e.Email===T.userEmail){var a="<li>"+e.Email+" <span>(You)</span></li>";i=a+i,r=a+r,l+=a}else{var n='<li><span class="email">'+e.Email+'</span><span class="pull-right"><a class="btn-remove" href="#"><i class="icon-Close"></i> Remove</a></span></li>';r+='<li><span class="email">'+e.Email+'</span><span class="pull-right"><a class="btn-mem-remove" href="#"><i style="font-size: 10px;" class="icon-Close"></i></a></span></li>',l+='<li><span class="email">'+e.Email+'</span><span class="pull-right"><a class="btn-remove-signUp" href="#">Remove <i class="icon-Close"></i></a></span></li>',t<ee?i+=n:s+=n}}),i=Fe(i),r=Fe(r),s=Fe(s,'start="'+(ee+1)+'"'),z.find(".upg-first-five").html(i),z.find(".upg-rest-list").html(s),ue.find(".upg-success-seat-cont").html(r),ge?z.find(".cont-seat-toggle").html(l):z.find(".cont-seat-toggle").html(r);var d=_.find(T.UserTeams,function(e){return 1===e.Role||ge&&0===e.Role});if(d=T.Team){var c=-1===d.TeamUrl.toString().indexOf("https://")?"https://"+d.TeamUrl:d.TeamUrl,u=1===d.TotalFolios?" Folio":" Folios";z.find(".upg-team-url").text(c),z.find(".upg-team-name").text(d.Name),z.find(".upg-team-folios").text(d.TotalFolios+u),ue.find(".upg-success-email").text(T.userEmail),ue.find(".goto-team").attr("href",c),ue.find(".goto-team span").text(d.Name)}we(),U.hide(),q.hide(),j.hide(),console.log("plusData",B),void 0!==B.Last4&&void 0!==B.Brand&&(Q=!0,z.find(".card-exists .card-num span").text(B.Last4),Ce(!1)),z.show(),D.removeClass("busy")}D.addClass("busy"),ge?t():m.listALLMembers({data:{teamId:e},success:t,error:function(e){console.log("listALLMembers error",e)}})}function Fe(e,t){return"<ol "+(t||"")+">"+e+"</ol>"}function Ie(){D.find(".popup-wrapper").removeClass("plan-list"),z.find(".cont-seat-toggle").hide(),-1!==J.indexOf("basic")||-1!==J.indexOf("plus")||-1!==J.indexOf("edu")?z.find(".seat-toggle").hide():z.find(".seat-toggle").show(),T&&T.Team?De(W=T.Team.Id):ge?(W=null,1!==T.Team.Role&&0!==T.Team.Role||(W=T.Team.Id),W||(console.log("DEV WARNING: No useable TeamID available for calculation"),console.log("defaulting teamID to 0."),W=0),De(W)):!0===p.isOldFreeUserNeverOnTrialOrPlan()&&xe()}function Me(e,t){var a=t||!1,n=parseFloat(e,10).toFixed(2).toString();return a||(n=n.replace(".00","")),"$"+n}function Ee(){D.addClass("busy");var e=T.Team.TeamUrl.toString(),t=-1===e.indexOf("https://")?window.location.protocol+"//"+e:e;window.location.href=t}function Ae(e){e=e||"Error - Please review the highlighted fields.",ce.text(e).addClass("show")}z.find(".btn-toggle-seats").click(function(e){e.preventDefault(),z.find(".upg-rest-list").slideToggle(400,function(){$(this).is(":visible")?z.find(".btn-toggle-seats").text("Hide"):z.find(".btn-toggle-seats").text("Show All")})}),D.find(".cont-plan-details .seat-toggle").click(function(e){e.preventDefault(),D.find(".cont-plan-details .cont-seat-toggle").slideToggle(400)}),z.find(".cont-seat-toggle").on("click",".btn-remove-signUp",function(e){e.preventDefault(),D.addClass("busy");var t=$(this).parent().parent().find(".email").text(),a=T.teamMembersOnSignUp;T.teamMembersOnSignUp=a.filter(function(e){return e.Email!==t}),De(W)}),z.find(".upg-team-members").on("click",".btn-remove",function(e){e.preventDefault(),D.addClass("busy");var t=$(this).parent().parent().find(".email").text();console.log("email",t),m.removeTeamMemberReactivation({userEmail:t,success:function(e){console.log("removeTeamMemberReactivation response",e),me=!1,De(W)},error:function(e){console.log("removeTeamMemberReactivation err",e),ye(e.Message)},complete:function(){D.removeClass("busy")}})}),z.find(".cont-seat-toggle").on("click",".btn-mem-remove",function(e){e.preventDefault();var t=$(this).parent().parent().find(".email").text();console.log("email",t),u.push(D),u.confirmRemoveMember(t,t,function(){D.addClass("busy"),m.removeMember({userEmail:t,success:function(e){De(W),u.message({heading:"Success",message:t+" has been successfully removed from your team.",btnText:"Ok",notMini:!0,bodyCentered:!0})},error:function(e){ye(e.Message)},complete:function(){D.removeClass("busy")}})})}),z.find(".card-exists  a.edit-billing-btn").click(function(e){e.preventDefault(),Ce(!(Q=!1)),z.find(".cont-back").show()}),z.find(".cont-back").click(function(e){e.preventDefault(),Ce(!(Q=!0))}),z.find(".change-plan").click(function(e){e.preventDefault(),window.location.hash="seeplans",xe()}),z.find(".chk-back-btn").click(function(e){window.location.hash="seeplans",setTimeout(function(){setTimeout(function(){console.log("dispatch resize"),window.dispatchEvent(new Event("resize"))},300)},200),xe()}),de.click(function(e){e.preventDefault(),oe=!oe,z.find(".upg-confirm").toggleClass("selected",oe),console.log("upgIsConfirmed",oe)}),z.find(".upg-checkout-btn").click(function(e){e.preventDefault();var t=y.capitalizeFirstLetter(J)+y.capitalizeFirstLetter(K.replace("ly",""));-1!==t.indexOf("Edu")&&(t="Edu");var a=0,n=ie.data("val"),o=se.val(),i=re.val(),s=le.val(),r=s?s.toString().substr(0,2):"",l=s?s.toString().substr(3):"";console.log("num",n),console.log("date",s),console.log("== attempting to upgrade to ==",t),ce.removeClass("show"),ie.removeClass("error"),se.removeClass("error"),le.removeClass("error"),re.removeClass("error"),de.find("span.check").removeClass("error"),de.find("p").removeClass("error"),Q||(Stripe.card.validateCardNumber(n)||(a=1,ie.addClass("error")),Stripe.card.validateCVC(o)||(a=1,se.addClass("error")),Stripe.card.validateExpiry(r,l)||(a=1,le.addClass("error")),i||(a=1,re.addClass("error"))),oe||(a=1,de.find("p").addClass("error"),de.find("span.check").addClass("error"));var d=function(e){var t=null;if(!ge){var a=ne.length,n={heading:"You Have Too Many Users",cancelText:"Remove users",handleNo:function(){u.teamManagePopup()},enterAsOK:!0,notMini:!0,bodyCentered:!0},o={btnText:"See Plans",handleOK:function(){u.universalBlocker()}},i={btnText:"Choose Team",handleOK:function(){$('[data-plan="team"]').trigger("click")}},s={btnText:"Choose Agency",handleOK:function(){$('[data-plan="agency"]').trigger("click")}},r=x.planName(),l=x.getRuleValueFromPlanObj("maxUsers",f)||3,d=x.getRuleValueFromPlanObj("maxUsers",g)||10;console.log("pro limit",l),console.log("team limit",d),x.isFreePlan()?-1!==e.indexOf("Pro")?4<a&&a<=10?t=_objectSpread({},n,{},i,{message:"The Pro plan supports up to ".concat(l," users; your team currently has ").concat(a,". <br>Please upgrade to the Team plan.")}):d<a&&(t=_objectSpread({},n,{},s,{message:"The Pro plan supports up to ".concat(l," users; your team currently has ").concat(a,". <br>Please upgrade to the Agency plan.")})):-1!==e.indexOf("Team")&&d<a&&(t=_objectSpread({},n,{},s,{message:"The Team plan supports up to ".concat(d," users; your team currently has ").concat(a,". <br>Please upgrade to the Agency plan.")})):-1!==r.indexOf("Agency")?-1!==e.indexOf("Pro")?l<a&&(t=_objectSpread({},n,{},o,{message:"The Pro plan supports up to ".concat(l," users; your team currently has ").concat(a,". <br>Please remove users or choose a different plan.")})):-1!==e.indexOf("Team")&&d<a&&(t=_objectSpread({},n,{},o,{message:"The Team plan supports up to ".concat(d," users; your team currently has ").concat(a,". <br>Please remove users or choose a different plan.")})):-1!==r.indexOf("Team")&&l<a&&-1!==e.indexOf("Pro")&&(t=_objectSpread({},n,{},o,{message:"The Pro plan supports up to ".concat(l," users; your team currently has ").concat(a,". <br>Please remove users or choose a different plan.")}))}return t}(t);if(console.log("blockerObject",d),a)Ae();else if(d)u.push(D),u.message(d);else if("edu"!==J||P){D.addClass("busy");var c={plan:t,count:S,success:function(e){console.log("upgrade response",e),ge&&m.getWorkspaceChannels({teamId:T.Team.Id,success:function(e){var t=JSON.parse(e.Data)[0],a={Private:t.Private,Token:t.LabelToken,isLabel:!0};m.updatePrivacy(a,{success:function(){}})},error:function(e){console.log(e)}}),me=!1,p.refresh(),D.removeClass("busy"),z.hide(),ue.show()},error:function(e){console.log("upgrade error",e),D.removeClass("busy"),Ae(e.Message)}};ge&&(c.teamMembers=T.teamMembersOnSignUp),console.log(t),Q?m.upgrade(c):Stripe.card.createToken({number:n,cvc:o,exp_month:r,exp_year:l,name:i},function(e,t){if(t.error)console.log("Stripe createToken error",t),D.removeClass("busy"),Ae(t.error.message);else{var a=t.card,n=t.id;c.data={Token:n,CardId:a.id,Last4:a.last4,Brand:a.brand,Name:i},console.log("apiData: ",c),m.upgrade(c)}})}else u.push(D),u.message({heading:"Please Update Your Email Address",message:'Please update the email address on your account to your ".edu" address in account settings. <br><br>If you’re associated with an academic institution but don’t own an ".edu" email, please contact us at <a href="mailto:help@xtensio.com">help@xtensio.com</a> for further assistance in signing up.',btnText:"Update Email",cancelText:"Nevermind",handleOK:function(){u.push(D),u.settings()},notMini:!0,bodyCentered:!0})}),o.on("click",function(){L=!L,Te()}),Te();var Ue={Plusmonthly:10,Plusyearly:8,Promonthly:14,Proyearly:10,Credits:10},Ne=function(e,t){console.log("plusData",B),console.log("typeof plusData.Brand",_typeof(B.Brand)),console.log("typeof plusData.Last4",_typeof(B.Last4)),Le(!1);var a=t||Ue[e];H.show(),N.show(),U.hide(),V.hide(),j.hide(),z.hide(),console.log("planPrice",a),console.log("planName",e)};function Le(e){e?(Y.find(".exist-card-cont h2").text(B.Brand),Y.find(".exist-card-cont span.four-digits").text(B.Last4),s.find("input.card-num").val("**** **** **** "+B.Last4),s.find("input.user-name").val(B.Name),F.val("***"),s.hide(),Y.show()):(s.show(),Y.hide())}for(Y.find(".btn-card-update").click(function(e){e.preventDefault(),Le(!1)}),O.click(function(e){e.preventDefault(),R=!R,O.toggleClass("selected",R),console.log("isConfirmed",R)}),D.find(".pass-protect").toggleClass("selected"),e=1;e<=12;e++)M.find(".filter-popup-menu").append('<div class="item" data-value="'+e+'">'+e+"</div>");for(e=(new Date).getFullYear();e<=2030;e++)E.find(".filter-popup-menu").append('<div class="item" data-value="'+e+'">'+e+"</div>");function Oe(e){e=e||"Error - Please review the highlighted fields.",l.text(e).addClass("show")}function Re(e,t,a,n){var o={success:function(e){me=!1,p.refresh(),m.getCreditsLeft({success:function(e){console.log("getCreditsLeft response",e);var t=JSON.parse(e.Data);i.find(".credits").text(t.CreditsLeft),D.find(".popup-content").addClass("success"),setTimeout(function(){y.reloadWithoutHash()},4e3)},error:function(e){console.log("getCreditsLeft error",e),Oe(e.Message)},complete:function(){busy=!1,D.removeClass("busy")}})},error:function(e){D.removeClass("busy"),Oe(e.Message)}};G?m.buyCreditsWithoutCard(o):(o.data={Token:e,CardId:t.id,Last4:t.last4,Brand:t.brand,Plan:a,Name:n},m.buyCredits(o))}function Be(){$("#tmp-payment .js-slider").each(function(){$(this).find(".swiper-container").each(function(){var e=$(this),t=e.parent().data("slides-to-show"),a=e.parent().data("start-from");new Swiper(this,{slidesPerView:1,initialSlide:a,pagination:{el:$(this).find(".swiper-pagination.slider__pagination"),clickable:!0,dynamicBullets:!0},breakpoints:{1024:{slidesPerView:t,initialSlide:0}}})})})}function _e(c){setTimeout(function(){$("#tmp-payment .js-accordion").on("click",".accordion__head",function(e){var t=$(this).closest(".accordion__section");t.find(".accordion__body").stop().slideToggle(),t.toggleClass("is-current")}),$("#tmp-payment .js-nav-trigger").on("click",function(e){e.preventDefault(),$(this).toggleClass("is-active").closest(".header").find(".js-toggle-content").slideToggle()});var i="is-current";$("#tmp-payment .tabs__nav a").on("click",function(e){e.preventDefault();var t=$(this),a=$(t.attr("href")),n=t.attr("href").toString().replace("#",""),o=a.find(".swiper-container");t.parent().addClass(i).siblings().removeClass(i),$("#tmp-payment .tabs__body .tab").removeClass(i),$("#tmp-payment .tabs__body ".concat(t.attr("href"))).addClass(i),$("#tmp-payment .tabs__titles .tabs__title").removeClass(i),$('#tmp-payment .tabs__titles *[data-tab="'.concat(n,'"]')).addClass(i),o&&void 0!==o.swiper&&o[0].swiper.update()}),b=$("#tmp-payment #pro-slide"),C=$("#tmp-payment #team-slide");var e=y.getPriceFromCents;function t(e,t){var a="plus"===e?1:-1,n=t.memberNumber+a;"plus"===e&&n>t.maxValue?n=t.memberNumber:"minus"===e&&n<t.minValue&&(n=t.memberNumber);var o=n-t.minValue;return _objectSpread({},t,{monthly:o*t.monthStep+t.baseValueMonth,yearly:o*t.yearStep+t.baseValueYear,memberNumber:n})}function s(e,t){e.find(".quantity__field span").text(t.memberNumber),e.find(".slide__pricing-content .js-price-value").text(t.yearly),e.find(".slide__pricing-content--monthly .js-price-value").text(t.monthly)}function a(e){var t=e?"monthly":"yearly";"monthly"===t?$("#tmp-payment .tab").addClass("pay-monthly"):$("#tmp-payment .tab").removeClass("pay-monthly"),setTimeout(function(){$("#tmp-payment .js-toggle input").prop("checked",e)},100),z.removeClass("yearly monthly"),z.addClass(t)}if(console.log("teamPlanMonthlyObj",g),console.log("proPlanMonthlyObj",f),k={baseValueMonth:e(f.PriceCents),baseValueYear:e(h.PriceCents)/12,minValue:parseInt(x.getRuleValueFromPlanObj("minUsers",f),10),maxValue:parseInt(x.getRuleValueFromPlanObj("maxUsers",f),10),monthStep:e(f.ExtraSeatPriceCents),yearStep:e(h.ExtraSeatPriceCents)/12,monthly:0,yearly:0,memberNumber:parseInt(x.getRuleValueFromPlanObj("minUsers",f))},w={baseValueMonth:e(g.PriceCents),baseValueYear:e(v.PriceCents)/12,minValue:parseInt(x.getRuleValueFromPlanObj("minUsers",g),10),maxValue:parseInt(x.getRuleValueFromPlanObj("maxUsers",g),10),monthStep:e(g.ExtraSeatPriceCents),yearStep:e(v.ExtraSeatPriceCents)/12,monthly:0,yearly:0,memberNumber:parseInt(x.getRuleValueFromPlanObj("minUsers",g))},console.log("proObject -- before proc",k),console.log("teamObject -- before proc",w),function(){var e=y.getUrlVars(),t=e&&e.seats&&ge?parseInt(e.seats,10):ne.length,a=k.minValue,n=w.minValue;console.log("params",e),console.log("membersNum",t),console.log("proObject",k),console.log("teamObject",w),1<t&&((n=a=t)>k.maxValue?a=k.maxValue:t<k.minValue&&(a=k.minValue),t>w.maxValue?n=w.maxValue:t<w.minValue&&(n=w.minValue),k.memberNumber=a,w.memberNumber=n);var o=a-k.minValue,i=n-w.minValue;k.monthly=o*k.monthStep+k.baseValueMonth,k.yearly=o*k.yearStep+k.baseValueYear,w.monthly=i*w.monthStep+w.baseValueMonth,w.yearly=i*w.yearStep+w.baseValueYear,console.log("teamlist",ne),s(C,w),s(b,k)}(),T.isPaymentsPageInit||(T.isPaymentsPageInit=!0,C.find(".js-increment-minus").click(function(e){e.preventDefault(),w=t("minus",w),s(C,w)}),C.find(".js-increment-plus").click(function(e){e.preventDefault(),w=t("plus",w),s(C,w)}),b.find(".js-increment-minus").click(function(e){e.preventDefault(),k=t("minus",k),s(b,k)}),b.find(".js-increment-plus").click(function(e){e.preventDefault(),k=t("plus",k),s(b,k)})),$("#tmp-payment .js-toggle .toggle__label").on("click",function(){var e=$(this).parent().find("input").prop("checked");a(!e),He(e?"yearly":"monthly",".cont-upgrade-panel input[type=radio]")}),$('#tmp-payment .tabs__body table a[href^="#tab-business"]').click(function(e){e.preventDefault(),$('#tmp-payment .tabs__nav a[href^="#tab-business"]').click(),$("#tmp-payment .popup-wrapper").animate({scrollTop:50},500)}),$("#tmp-payment .js-plans-tooltip-trigger").on("click",function(e){$(this).parent().hasClass("is-visible")?$(".plans-tooltip").removeClass("is-visible"):($(".plans-tooltip").removeClass("is-visible"),$plans,tooltipContainer.addClass("is-visible"))}),$(document).on("click",function(e){$(e.target).closest(".js-plans-tooltip-trigger").length||$(".plans-tooltip").removeClass("is-visible")}),j.find(".upg-button").click(function(e){var t;e.preventDefault(),J=$(this).data("plan"),!0===p.isOldFreeUserNeverOnTrialOrPlan()?(t=void 0===t?"":"?plan="+t,window.location.href="/teams/create"+t):Ie()}),j.find(".btn.free").click(function(e){e.preventDefault(),u.push(D),u.confirmDowngradePopup("cancel")}),D.find(".cont-upgrade-panel input[type=radio]").click(function(){var e=$(this),t=e.val();if(ke()&&"monthly"==t)return $("input[name="+e.attr("name")+"][value=yearly]").click(),!1;K=t,console.log("radio buttons on upgrade checkout panel: toggle plan value ",t),a("monthly"===t),we(),Pe()}),j.find(".choose-free").click(Ee),j.find(".btn-ent-contact").click(function(e){e.preventDefault(),window.Intercom&&window.Intercom("showNewMessage","We're interested in learning more about Xtensio for Enterprise.")}),j.find(".btn-school-contact").click(function(e){e.preventDefault(),window.Intercom&&window.Intercom("showNewMessage","We're interested in learning more about Xtensio for Schools.")}),ge){var n=y.getUrlVars();if(n&&n.plan){if(""!==n.plan){console.log("params",n);var o=n.plan.toString().toLowerCase().trim(),r=-1!==o.indexOf("monthly")?"monthly":"yearly",l=o.replace("monthly","").replace("yearly","");J=l,K=r,D.find('.cont-upgrade-panel input[type=radio][value="'.concat(r,'"]')).trigger("click"),$('[data-plan="'.concat(l,'"]')).trigger("click"),"plus"!==l&&"basic"!==l||$('#tmp-payment .tabs__nav a[href^="#tab-individual"]').click()}}else $('#tmp-payment .tabs__nav a[href^="#tab-individual"]').click()}else if(0!==T.autoRenew&&0!==T.Team.ST);else{var d=x.planName().toString().toLowerCase();-1!==d.indexOf("free")?Ge("free","btn.free"):-1!==d.indexOf("basic")?Ge("basic","upg-button"):-1!==d.indexOf("plus")?Ge("plus","upg-button"):-1!==d.indexOf("pro")&&-1===d.indexOf("grandfather")?Ge("pro","upg-button"):-1!==d.indexOf("team")?Ge("team","upg-button"):-1!==d.indexOf("agency")&&Ge("agency","upg-button")}m.getXtensioStats({success:function(e){console.log("getXtensioStats res",e),e&&e.Users&&(be=e.Users),j.find(".review-heading .users").text(y.numberWithCommas(be))},error:function(e){console.log("getXtensioStats err",e)}}),"function"==typeof c&&c()},500)}function Ge(e,t){j.find("#".concat(e,"-slide .curr")).show(),j.find("#".concat(e,"-slide .").concat(t)).hide()}function He(e,t){K=e.toString(),we(),D.find(t+"[value="+e+"]").prop("checked",!0)}function Ye(e,t){"string"==typeof e&&"showPlans"===e?"string"==typeof t&&"signUpMode"===t?xe(t):xe():Ie()}return D.find(".loading-animation").html(u.spinner),u.reg(D,D.find(".icon-Close, .no"),function(){r&&"function"==typeof r&&r()}),i.find(".no").click(function(){D.find(".popup-content").removeClass("success"),u.close(),me||y.reloadWithoutHash()}),D.find(".icon-Close").click(function(){$("body").removeClass("fullScreenPopupOpen"),D.find(".popup-content").removeClass("success"),u.close(),me||y.reloadWithoutHash()}),a.click(function(){u.billing(1)}),t.click(function(e){var t=0,a=c.data("val"),n=F.val(),o=parseInt(M.find(".item.active").attr("data-value"))||1,i=parseInt(E.find(".item.active").attr("data-value"))||(new Date).getFullYear(),s=I.val(),r=L?"Year":"Month";G=!1,A.removeClass("error"),l.removeClass("show"),M.add(E).removeClass("error"),O.find("span.check").removeClass("error"),O.find("h3").removeClass("error"),console.log("hasCardOnFile",!1),console.log("useCardOnFile",G),G||(Stripe.card.validateCardNumber(a)||(t=1,d.addClass("error")),Stripe.card.validateCVC(n)||(t=1,F.addClass("error")),Stripe.card.validateExpiry(o,i)||(t=1,M.add(E).addClass("error")),s||(t=1,I.addClass("error"))),R||(t=1,O.find("h3").addClass("error"),O.find("span.check").addClass("error")),t?Oe():(D.addClass("busy"),G?Re():Stripe.card.createToken({number:a,cvc:n,exp_month:o,exp_year:i,name:s},function(e,t){if(t.error)D.removeClass("busy"),Oe(t.error.message);else{var a=t.card;Re(t.id,a,r,s)}}))}),function(e,o,i,s){L=!0,r=e,D.addClass("busy").find(".popup-content").removeClass("success"),o||!1,D.find(".filter-popup-menu").hide();var t=$("#tmp-plans-list > .wrapper");j.append(t),p.loadStripe(function(){p.getData(1,function(e,t,a,n){x=app.acl.helper(T),B=e,D.removeClass("busy"),D.find(".msg").toggleClass("hidden",!t).find(".time").text(n),U.data("plus",t),U.data("end",n),t&&V.hide(),D.find(".plan-cont").removeClass("current"),console.log("free?",p.isFree()),console.log("pro?",p.isProBusiness()),console.log("business?",p.isBusiness()),pe.find(".btn-credits, .btn-creds").click(function(e){e.preventDefault(),ge||Ne("credits")}),ie.passwordify({maxLength:19,numbersOnly:!0,charToShow:4}),se.mask("0000"),c.passwordify({maxLength:19,numbersOnly:!0,charToShow:4}),F.mask("0000"),le.mask("00/0000",{placeholder:"mm/yyyy"}),console.log("==== UPGRADE FLOW: NORMAL ===="),z.find(".normal-flow").show(),z.find(".reactivate").hide(),X=!0,"string"==typeof o&&"signUpMode"===o||"signUpMode"!==o&&x.isFreePlan()?(z.find(".trial-flow, .upgrade").show(),z.find(".upg-flow").hide(),ue.find(".trial-flow, .upgrade").show(),ue.find(".upg-flow").hide()):(z.find(".trial-flow, .upgrade").hide(),z.find(".upg-flow").show(),ue.find(".trial-flow, .upgrade").hide(),ue.find(".upg-flow").show()),H.hide(),N.hide(),i?(L=i.isYearly,i.planName,Ne(i.planName)):(we(),He(K,".cont-upgrade-panel input[type=radio]"),"string"==typeof o&&"signUpMode"===o&&(D.addClass("signUpMode"),ge=!0,fe.text("Choose Pro"),he.text("Choose Business"),"string"==typeof s&&(J="business"===s?"team":s)),z.find("input[type=radio][value=yearly]").click(),K="yearly",L=!0),m.isEduEmail({email:T.userEmail,success:function(e){P=JSON.parse(e.Data),console.log("isEduDomain",P)},error:function(e){console.log("isEduEmail err",e)},complete:function(){}}),m.getAllPlansAclData({success:function(e){var t;ve=JSON.parse(e.Message),console.log("allPlansData response",ve),f=x.getPlanObjFromAllPlansAclData("ProMonthly",ve),h=x.getPlanObjFromAllPlansAclData("ProYearly",ve),g=x.getPlanObjFromAllPlansAclData("TeamMonthly",ve),v=x.getPlanObjFromAllPlansAclData("TeamYearly",ve),ge?_e(function(){Ye(r,o),Be()}):(t=function(){_e(function(){Ye(r,o),Be()})},m.listALLMembers({data:{teamId:T.Team.Id},success:function(e){ne=e.Data.Data.members,t&&"function"==typeof t&&t()},error:function(e){console.log("listALLMembers error",e)}}))},error:function(e){console.log("getAllPlansAclData err",e)},complete:function(){D.removeClass("busy"),u.show(D,"showPlans"===r?"seeplans":"billing")}})})}),(p.isAdmin()||p.isTeamMember()||p.isPremiumGuest()||p.isSingleFolioGuest())&&(window.location="/")}},app.popup.getSettings=function(e,s,r,t,l,a){var d=0,n=$("#tmp-settings"),o=n.find(".tabs > span"),i=n.find(".tab"),c=n.find(".save"),u=n.find(".icon-Close , .cancel"),m=n.find(".email-text").val(s.userEmail),p=n.find(".full-n").val(s.fullName),f=n.find(".current-pass"),h=n.find(".new-pass"),g=n.find(".repeat-pass"),v=n.find(".msg"),b=n.find(".downgrade-upgrade");function T(e,t){t=t||"success",v.text(e).addClass(t),setTimeout(function(){v.removeClass("success error")},3e3)}return o.on("click",function(){var e=$(this).addClass("selected");o.not(e).removeClass("selected"),d=e.index(),v.text(""),i.removeClass("selected").filter(":eq("+d+")").addClass("selected")}),c.on("click",function(){switch(v.text("Saving ...").attr("class","msg"),d){case 1:(i=$.trim(m.val()))?i!=s.userEmail?validator.isEmail(i)?l.changeEmail({email:i,success:function(){T("Email saved."),s.userEmail=i},error:function(e){T(e.Message,"error")}}):T("Invalid email.","error"):T("Email saved"):T("Email cannot be empty.","error");break;case 2:t=f.val(),a=h.val(),n=g.val(),o="",t||(o+="<p>Please provide your current password.</p>"),(!a||a.length<8)&&(o+="<p>New Password must be at least 8 characters long.</p>"),a!=n&&(o+="<p>New password and password confirm do not match</p>"),o?v.addClass("error").html(o):l.changePassword({oldPassword:t,newPassword:a,confirmPassword:n,success:function(){T("Password saved")},error:function(e){T(e.Message,"error")}});break;default:(e=$.trim(p.val()))?e!=s.fullName?/[^a-zA-Z0-9\s\-\/]/.test(e)?T("Name Cannot Have Special characters","error"):l.changeFullName({fullName:e,success:function(){s.fullName=e,T("Name saved."),r.raiseEvent("nameChanged")},error:function(e){T(e,"error")}}):T("Name saved"):T("Name cannot be empty.","error")}var e,t,a,n,o,i}),n.find(".popup-footer .contact span").click(function(){window.$crisp&&($crisp.push(["set","message:text",["Email: ("+s.userEmail+") I would like to DELETE my account and data."]]),$crisp.push(["do","chat:open"]))}),e.reg(n,u),function(){v.removeClass("error success"),a.isOwner()||b.hide(),e.show(n),t.doSetFocus(p)}},app.popup.getSignIn=function(o,i,s,r){var l=$("#tmp-sign-in"),e=l.find(".popup-header"),t=l.find(".sign-up"),a=l.find(".forgot-btn"),d=l.find(".msg"),c=l.find(".sign-in"),n=l.find("form"),u=n.find(".email"),m=n.find(".pass"),p=l.find(".actions"),f=l.find(".popup-cta.ok"),h=l.find(".loading-animation").html(o.spinner),g=l.find(".select"),v=!1,b=!1,T=0;g.on("click",function(){$(this).toggleClass("selected").parent().toggleClass("selected")}),d.on("click",".resend",function(e){return d.html("Resending verification email. Please wait.").attr("class","msg"),r.resendEmail({email:u.val(),success:function(){d.html("Verification email was resent.").attr("class","msg success")},error:function(){d.html("There was an error. Check your connection and try again.").attr("class","msg error")}}),!1}),"EmailConfirm"==i.loginState?(e.html('<h1>Email address confirmed.</h1><h3 class="message" style="font-size: 20px;">Please sign in to pick up where you left off.</h3>'),p.remove()):"PassReset"==i.loginState?(e.html('<h1>Password was reset.</h1><h3 class="message" style="font-size: 20px;">Please sign in to continue.</h3>'),p.remove()):e.html("<h1>Sign In</h1>"),t.on("click",function(){window.location.href="/templates"}),a.on("click",function(){return o.forgotPass(u.val()),!1});var y=function(e){d.text(e).addClass("error").show("slow"),setTimeout(function(){d.removeClass("error").hide("slow")},5e3),C(!1)};function C(e){e?(c.addClass("disable"),h.show()):(c.removeClass("disable"),h.hide())}return n.submit(function(e){C(!0);var t=u.val(),a=m.val(),n="";return v&&(n=i.token),t||a?validator.isEmail(t)?!a||a.length<8?y("Password must be at least 8 characters long."):!validator.isEmail(t)&&!a||a.length<8?y("Please provide a valid email and Password."):b||(b=!0,c.prop("disabled",!0),r.signIn(t,a,g.hasClass("selected"),function(e){window.location=e.Message||"/"},function(e){c.prop("disabled",!1),C(b=!1),d.attr("class","msg error"),3==e.StatusCode?d.html('Please first verify your email address. <a href="#" class="resend">Resend verification email.</a>'):6==e.StatusCode?d.html("Account has been locked out for 5 minutes due to multiple failed login attempts."):d.html("Email or password was not valid. Please try again.")},n,T)):y("Please provide a valid email."):y("Email and Password cannot be Blank."),!1}),f.on("click",function(){n.submit()}),l.on("keyup.sign-in",function(e){13==(e.keyCode||e.which)&&f.click()}),i.Team&&0!=i.Team.Id&&(e.html("<h1>Sign in to "+i.Team.Name+"</h1><p>"+i.Team.TeamUrl+"</p>"),l.addClass("is-team")),o.reg(l),function(e,t,a){t,v=!!a,C(!1);var n=s.getUrlVars();n&&n.notice&&"addusers"===n.notice&&(T=1,l.find(".sign-in").text("Sign In to Add Users"),l.find(".pricing").show(),l.find(".notice").show()),o.show(l),s.doSetFocus(u)}},app.popup.getSignUp=function(h,g,v,b,T,e,t){var a=$("#xtensio-refer-info"),n=a.length,y=$("#tmp-sign-up"),o=y.find(".sign-in"),i=(y.find(".pending-invite"),y.find(".msg")),C=y.find(".popup-cta"),k=y.find(".popup-cta.ok.submit_on_enter"),s=y.find("form"),w=s.find(".email").val(g.userEmail),x=s.find(".name").val(g.fullName),P=s.find(".pass"),S=s.find(".team_name"),D=s.find(".teamUrl"),F=s.find(".coupon"),r=y.find(".popup-header"),l=y.find(".signup-next"),d=y.find(".popup-header .signup-step-1"),I=!1;if(y.find(".loading-animation").hide().html(h.spinner),"True"==g.isInvite?(w.val(g.inviteEmail),w.prop("readonly",!0),w.css({"background-color":"#f0f0f0"}),x.val(g.inviteFullName),k.text("Join "+g.TeamName),d.text("Join "+g.TeamName),y.addClass("isinvite")):y.removeClass("isinvite"),(n||T)&&y.find(".sign-in-container").hide(),n&&(y.find(".xtensio-agreement").append(a.find(".agreement")),y.find(".xtensio-refer-info").append(a.find("> a, .list")),r.after(r.find("h2")),r.append(a.find(".name-sender"))),T){var c=y.find(".popup-content");r.html(e.PopupTitle).css("padding-top","35px"),C.text(e.SubmitText),c.before(e.Header),c.after(e.Footer),$("head").append('<style type="text/css">'+e.Css+"</style>")}function M(e){y.removeClass("signup-step-2 signup-step-1").addClass("signup-step-"+e)}function u(){var e,t,a;e=P.val(),t=w.val(),((a=x.val())||t||e?!a||a.length<3||/[^a-zA-Z0-9\s\-\/]/.test(a)?(E("Please provide Valid name."),0):t&&validator.isEmail(t)?e&&!(e.length<8)||(E("Password must be at least 8 characters long."),0):(E("Please provide a valid email."),0):(E("Fields cannot be left Blank."),0))&&M(2)}g.getCoupon&&F.removeClass("hidden");var E=function(e){k.prop("disabled",!1),y.find(".loading-animation").hide(),i.text(e).addClass("error").show("slow"),setTimeout(function(){i.removeClass("error").hide("slow")},5e3)};return o.on("click",function(){var e=v.getUrlVars(),t=$.trim(window.location.hash.substr(1).toLowerCase()),a="/account/signin";e.ReturnUrl?a=a+"?ReturnUrl="+e.ReturnUrl:e.token&&(a=a+"?token="+e.token,e.name&&(a=a+"&name="+e.name)),"use-template"===t&&(a=a+"#"+t),console.log("url",a),window.history.pushState("","",a),"true"==g.EditTemplate?h.signIn(!1,null,!0):h.signIn()}),s.submit(function(e){var t=P.val(),a=w.val(),n=x.val(),o=F.val(),i="";I&&(i=g.token);var s=v.getUrlVars(),r=s.plan?s.plan.toString():"",l=s.promo?s.promo.toString():"",d=s.seats?s.seats.toString():"1",c=S.val(),u=D.val().toLowerCase(),m=c.toLowerCase();if(g.getCoupon&&!o)E("Please provide activation code.");else if("True"!=g.isInvite&&m.length<3)E("Team Name must be at least 3 characters long.");else if("True"==g.isInvite||m.match(/^[a-zA-Z\d-_ ]+$/))if("True"!=g.isInvite&&u.length<3)E("Team url must be at least 3 characters long.");else if("True"==g.isInvite||u.match(/^[0-9a-zA-Z]+$/)){var p={Email:a,Password:t,FullName:n,coupon:o,campaign:T,FolioToken:i,Plan:r,Discount:l,seats:d},f=document.location.href;f=f.toLowerCase(),g.isTeam?(C.prop("disabled",!0),b.TeamSignUp(p,function(){"True"==g.isInvite?window.location="/":h.message({heading:"All set!",message:"Your account is successfully created.",btnText:"Go To Your Dashboard",noClose:!0,bodyCentered:!0,notMini:!0,handleOK:function(){g.Team&&(window.location=g.baseUrl)}})},function(e){e.StatusCode&&15===e.StatusCode?e.Message&&(window.location.href=e.Message):(C.prop("disabled",!1),E(e.Message),M(1))})):b.checkTeamURL({data:{teamUrl:u},success:function(e){console.log("res???",e.Data),1==e.Data?E("This Team url is already taken. Please choose another Url."):(C.prop("disabled",!0),"live"==g.Environment?u+=".xtensio.com":"dev"==g.Environment?u+=".xtensio.tech":"local"==g.Environment&&(u+=".localhost.com:44301"),p.TeamName=c,p.TeamUrl=u,b.signUp(p,function(){k.prop("disabled",!1),y.find(".loading-animation").hide(),"True"==g.isInvite?window.location="/":h.signUpDone(a)},function(e){7==e.StatusCode?h.message({heading:"You have a pending invitation",message:e.Message,btnText:"OK",notMini:!0,handleOK:function(){window.location="/"}}):(E(e.Message),M(1)),C.prop("disabled",!1),k.prop("disabled",!1),y.find(".loading-animation").hide()}))},error:function(e){k.prop("disabled",!1),y.find(".loading-animation").hide(),console.log("error: ",e)}})}else E("Team URL may only contain alphabetical and numerical values.");else E("Team Names may contain only alphabetical and numerical values, hyphens and underscores.");return!1}),l.on("click",u),k.on("click",function(){y.find(".loading-animation").show(),k.prop("disabled",!0),s.submit()}),$(document).on("keyup.submit_on_enter",function(e){13==(e.keyCode||e.which)&&(y.hasClass("signup-step-1")&&"True"!=g.isInvite?u():k.click())}),h.reg(y),function(e){M(1),F.val("");try{var t=new URL(location.href).searchParams.get("email")}catch(e){if("TypeError"==e.name){var a=window.location.href.match(new RegExp(/email=([^&]*)/));t=a?a[1]:""}}"False"==g.isInvite&&w.val(t),I=!!e,h.show(y),v.doSetFocus(x)}},app.popup.getSignUpDone=function(t,e,a){var n=$("#tmp-sign-up-done"),o=n.find(".msg"),i=n.find(".email"),s=n.find(".popup-cta");return s.on("click",function(){s.attr("disabled",!0),o.html("Re-sending verification email. Please wait ...").removeClass("success error"),a.resendEmail({email:i.text(),success:function(){s.attr("disabled",!1),o.html("The verification email was re-sent.").addClass("success")},error:function(){s.attr("disabled",!1),o.html("Could not connect to the server. Please try again.").addClass("error")}})}),t.reg(n),function(e){i.text($.trim(e)),t.show(n)}},app.popup.getSignUpDoneInvited=function(e,t,a){var n=$("#tmp-sign-up-done-invited"),o=(n.find(".msg"),n.find(".popup-cta"));return e.reg(n),o.on("click",function(){return e.signIn(),!1}),function(){e.show(n)}},app.popup.getSignupPlansPopup=function(e,a,t,n,o,i){var s=$("#tmp-signup-plans"),r=s.find(".cancel, .popup-close, .icon-Close"),l=s.find(".loading-animation").html(a.spinner);return r.click(function(){a.close()}),s.find(".item-faq .i-btn, .item-faq .text").click(function(){var e;e=$(this).parent(),$that=e.find(".i-btn"),e.find(".item-full").slideToggle(200,function(){$(this).is(":visible")?($that.html('<i class="fa fa-minus-circle"></i>'),s.find(".item-full").not($(this)).slideUp(400,function(){$(this).parent().find(".i-btn").html('<i class="fa fa-plus-circle"></i>')})):$that.html('<i class="fa fa-plus-circle"></i>')})}),a.reg(s,r),function(){var e=window.location.href.toString(),t="https://www.localhost.com:44301";-1!==e.indexOf("xtensio.com")?t="https://app.xtensio.com":-1!==e.indexOf("xtensio.tech")&&(t="https://app.xtensio.tech"),s.find(".plan-cont.middle .popup-cta.pro").attr("href",t+"/teams/create/?plan=promonth"),l.hide(),a.show(s)}},app.popup.getSignUpTeam=function(t,n,o,e,a,i){var s=$("#tmp-sign-up-team"),r=s.find(".btn-next-trial"),l=s.find(".loading-animation").html(t.spinner),d=(s.find(".change-logo"),s.find(".icon-Close"),s.find("#uploadimage-form")[0],s.find("span.error"),""),c="",u="month",m=!1;function p(){n.UserTeams=[],n.UserTeams[0]=n.Team,console.log("config.Team signUp",n.Team),void 0===n.teamMembersOnSignUp&&(n.teamMembersOnSignUp=[]),n.userEmail=n.SignedInEmail;var e=i.getUrlVars();e.plan?t.payment("","signUpMode",null,e.plan):t.payment("showPlans","signUpMode")}$(document).on("click",".icon-Close",function(){c=null,$(".team-signup .uploaded-img").replaceWith('<a class="btn btn-yes btn-upload uploaded-img">Upload Logo</a>'),$("#logo_img").addClass("hidden"),$(".uploaded-logo").addClass("hidden"),$(".change-logo-cont").addClass("hidden")}),$("input#team_name").on("input",function(){var e=$(this),t=e.val(),a=/^[a-zA-Z\d-_ ]+$/,n=a.test(e.val()),o=t.replace(/[^a-z0-9]/gi,"");n?e.removeClass("invalid").addClass("valid"):e.removeClass("valid").addClass("invalid"),t.length<3?(e.removeClass("valid").addClass("invalid"),f(s.find("input#team_name"),"Name must be at least 3 characters long.")):t.match(a)?f(s.find("input#team_name"),""):(e.removeClass("valid").addClass("invalid"),f(s.find("input#team_name"),"Names may contain only alphabetical and numerical values, hyphens and underscores.")),$("#team_url").val(o)}),$("#team_url").on("input",function(){var e=$(this);/^[0-9a-zA-Z]+$/.test(e.val())?e.removeClass("invalid").addClass("valid"):e.removeClass("valid").addClass("invalid");var t=e.val();t.length<3?(s.removeClass("busy"),f(s.find("input#team_url"),"A url must be at least 3 characters long.")):t.match(/^[0-9a-zA-Z]+$/)?f(s.find("input#team_url"),""):(s.removeClass("busy"),f(s.find("input#team_url"),"URL may only contain alphabetical and numerical values."))});var f=function(e,t){var a=e.hasClass("valid"),n=$("span",e.parent());clearTimeout(m),a?(n.css("visibility","hidden"),n.removeClass("error_show",1e3,"easeOutSine")):(n.stop(!0,!0),s.removeClass("busy"),n.text(t).show(),n.css("visibility","visible"),n.addClass("error_show",1e3,"easeOutSine"),m=!1,m=setTimeout(function(){n.css("visibility","hidden"),n.removeClass("error_show",1e3,"easeOutSine")},5e3)),l.hide()};$(document).on("keydown","form",function(e){return"Enter"!=e.key}),r.click(function(e){l.show(),s.addClass("busy"),d=s.find("input#team_name").val();var t=s.find("input#team_url").val().toLowerCase(),a=s.find("input#team_name").val().toLowerCase();a.length<3?($("#team_name").removeClass("valid").addClass("invalid"),f(s.find("input#team_name"),"Name must be at least 3 characters long.")):a.match(/^[a-zA-Z\d-_ ]+$/)||($("#team_name").removeClass("valid").addClass("invalid"),f(s.find("input#team_name"),"Names may contain only alphabetical and numerical values, hyphens and underscores."));t.length<3?(s.removeClass("busy"),$("#team_url").removeClass("valid").addClass("invalid"),f(s.find("input#team_url"),"A url must be at least 3 characters long.")):t.match(/^[0-9a-zA-Z]+$/)?o.checkTeamURL({data:{teamUrl:t},success:function(e){console.log("res???",e.Data),1==e.Data?($("#team_url").removeClass("valid").addClass("invalid"),f(s.find("input#team_url"),"This url is already taken. Please choose another Url."),s.removeClass("busy")):("live"==n.Environment?t+=".xtensio.com":"dev"==n.Environment?t+=".xtensio.tech":"local"==n.Environment&&(t+=".localhost.com:44301"),function(e,t){s.addClass("busy");var a=[];o.createTeam({data:{teamInfo:{Id:0,Name:e,LogoUrl:c,TeamUrl:t,Status:1,OwnerEmail:"",TeamMembers:a,ImageID:void 0,TeamFonts:[]},billingInfo:{plan:h(),MembersCount:a.length,Trial:!0}},success:function(e){console.log(e),n.Team=JSON.parse(e.Data),p()},error:function(e){f(s.find("input#gen_error"),e.Message)}})}(d,t))},error:function(e){console.log("error: ",e)}}):(s.removeClass("busy"),$("#team_url").removeClass("valid").addClass("invalid"),f(s.find("input#team_url"),"URL may only contain alphabetical and numerical values."))});function h(){return"promonth"===u.toLowerCase()?"ProMonth":"BusinessMonth"}return t.reg(s),function(){if((n.isSignup||"True"==n.isSignup)&&n.Team&&0<n.Team.Id&&p(),"#managepeople"!==window.location.hash){u="BusinessMonth";var e=i.getUrlVars();console.log("params",e),e.plan&&-1!==e.plan.toString().indexOf("promonth")&&(u="ProMonth"),console.log("preplan",u),checkOut=!e.checkout,l.hide(),a.loadStripe(function(){console.log("Signing up ",h()),-1<window.location.hostname.search(/app\.xtensio/g)&&!1===$("body").hasClass("team-signup")&&$("body").addClass("team-signup"),t.show(s)})}else t.teamManagePopup({mode:"signUp",data:JSON.stringify(n.Team)})}},app.popup.getAddFolioToSpace=function(n,o,i,e,t){var a=$("#tmp-add-folio-to-space"),s=a.find(".no-show"),r=a.find(".cancel, .icon-Close"),l=a.find(".teams"),d=null,c=null,u=e.getActiveUserTeams(n.UserTeams);function m(t,e,a){console.log("on addFolioId func on addFolioToSpace popup"),console.log("id name url",t,e,a),console.log("fToken fName",d,c),i.getWorkspaceChannels({teamId:t||n.lastTeamId,success:function(e){console.log("response from getWorkspaceChannels on addFolioToSpace popup",e),o.close(),n.saveFolioEditPreview={teamId:t||n.lastTeamId,FolioName:c,Token:d,labels:JSON.parse(e.Data),isUseTemplate:!0},o.saveFolio()},error:function(e){console.log("error",e)}})}function p(e,t,a){return function(){console.log("getFolioToIdFunc func..."),m(e,t,a)}}if(a.find(".loading-animation").html(o.spinner),u&&n.Team)for(var f=$(s.html()),h=0;h<u.length;h++)5!=u[h].Role&&(f=$(s.html()),4!=u[h].Role&&5!=u[h].Role||(f.find("h3").hide(),f.find(".left").hide(),f.find(".right").hide(),f.find("h3").text(u[h].Name).hide()),f.find("h3").text(u[h].Name),console.log("userTeams[i].Id ",u[h].Id),f.on("click",p(u[h].Id,u[h].Name,u[h].TeamUrl)),l.append(f));return o.reg(a,r),function(e,t){console.log(e,t),c=t,d=e,console.log("==== userteams",u),1<u.length?o.show(a):1==u.length?m(u[0].Id,u[0].Name,u[0].TeamUrl):m(0,"","")}},app.popup.getArchivePopup=function(o,n,i){var s,r,l=$("#tmp-leave-popup"),e=l.find(".popup-content"),d=l.find(".loading-animation"),c=l.find(".archive-section"),u=l.find(".leave-section"),m=u.find("select"),t=u.find(".btn.ok"),a=u.find("input"),p=l.find(".leave-single-section .btn.ok"),f=l.find(".leave-sfg-section .btn.ok"),h=null;function g(){l.removeClass("sfg-leave");var n=0;m.empty(),$.each(s.Collaborators,function(e,t){if(0<t.Privilege&&t.Privilege<3&&t.Accepted){var a=$("<option></option>");if(a.val(t.Email).text(t.FullName),o.Team&&0<o.Team.Id)(function(e){if(h)for(var t=0;t<h.length;t++)if(h[t].Email==e)return h[t].Role;return 0})(t.Email)<4&&m.append(a);else m.append(a);n++}}),0<n?(e.hasClass("single")&&e.removeClass("single"),o.Team&&0<o.Team.Id&&5==o.Team.Role?(console.log("in team"),e.addClass(s.Role<3?"single":"").removeClass("archive leave"),l.addClass("sfg-leave"),l.find(".leave-sfg-section").find(".msg .team").text(o.Team.Name)):e.addClass("leave "+(s.Role<3?"single":"")).removeClass("archive")):e.addClass("archive").removeClass("leave single"),a.prop("checked",""),t.prop("disabled",!0).text("Leave Folio")}return d.html(n.spinner),c.find(".btn.ok").click(function(){n.busy(),i.deleteFolio({data:{token:s.Token},success:r,error:function(e){n.error("There was an error. Please refresh page and try again.")}})}),m.on("change",function(){$(this).closest("label").find("input").click()}),a.click(function(){t.prop("disabled","").text("archive"==$(this).val()?"Delete Folio":"Transfer Folio")}),t.click(function(){if("archive"==u.find("input:checked").val())c.find(".btn.ok").click();else{d.show();var e=m.find("option:checked"),t=e.val(),a=e.text();i.transfer({data:{token:s.Token,name:a,email:t},success:function(){d.hide(),n.message({heading:"Transfer Requested",message:"Folio transfer request has been sent to "+a+".<br/>Folio will be transfered once they accept.",btnText:"OK",handleOK:function(){n.close()}})},error:function(e){n.error(e.Message||"There was an error. Please try later.")}})}}),f.click(function(){i.removeSingleFolioGuest({data:{userEmail:o.userEmail,teamId:o.Team.Id},success:function(){var e="";"live"==o.Environment?e="https://app.xtensio.com/":"dev"==o.Environment?e="https://app.xtensio.tech/":"local"==o.Environment&&(e="https://www.localhost.com:44301/"),window.location=e},error:function(e){showStatus(e.Message,"error")}})}),p.click(function(){d.show(),i.changeCollaborator({data:{verb:"drop",role:s.Role,token:s.Token,email:o.userEmail},success:function(){window.location.href="/"},error:function(e){d.hide(),n.error(e.Message)}})}),n.reg(l,l.find(".icon-Close, .btn.no")),function(t,a){h=null,o.Team&&0<o.Team.Id?(d.show(),i.listTeamMembers({data:{teamId:o.Team.Id},success:function(e){d.hide(),h=e.Data.Data,s=t,r=a,g(),n.show(l)},error:function(e){d.hide()}})):(s=t,r=a,g(),n.show(l))}},app.popup.getBusyPopup=function(a){var n=$("#tmp-busy");n.find(".busy, .anim").html(a.spinner);var o,i,s=n.find(".message"),r=n.find("h1"),l=n.find(".msg"),d=n.find(".anim");return a.reg(n),function(e,t){i=t||"",(o=e||"")?(d.hide(),s.show(),r.text(o),l.text(i).show()):(s.hide(),d.show()),a.show(n)}},app.popup.getCollaboratorsPopup=function(c,l,d,u,s,e,o){var m,r,p,f={main:1,notUser:2,aUser:3,pendingUser:4,sfgUser:5},a=$("#tmp-single-person"),h=$("#tmp-collaborators-popup"),i=h.find(".toggle"),n=h.find(".changes-applied"),g=$("#tmp-single-recent"),v=$(".recently-added"),b=h.find(".header-collaboration-blocker"),T=h.find(".popup-content"),y=T.find(".list"),C=y.find(".owner-list"),k=y.find(".folio-collab-list"),w=y.find(".channel-collab-list"),x=T.find(".selected"),P=x.find(".a-user"),S=x.find(".not-user"),D=x.find(".sfg-user"),F=h.find(".loading-animation"),I=h.find("#collab-search"),M=I.find("#collab_search"),t=h.find(".search-btn"),E=h.find(".popup-header h1.am-h .team"),A=h.find(".popup-header p.am-h .email"),U=h.find(".popup-header h1.sfg-h"),N=h.find(".popup-header p.sfg-h"),L=h.find(".popup-header p.pro-rated"),O=h.find(".success-panel p.pro-rated"),R=h.find(".team-add"),B=h.find(".add-team-member"),G=h.find(".add-team-member"),H=G.find(".custom-msg"),Y=G.find(".msg-content .icon-Close"),j=h.find(".back-button"),z=!0,q=!1,V=!1,K="",J="",W=0,X=[],Z=0;numSeatMembers=0,newTeamList=[],hasInit=!1,memType="",padlocks=app.core.padlocks(s,e,c,o);var Q=app.strings.popups,ee=Q.maxUsersMsgAdmin,te=Q.maxUsersMsgOwner,ae=Q.pleaseUpgradeAccount,ne=Q.cannotPerformAction;function oe(e){switch(e){case f.main:T.removeClass("selected"),h.find(".popup-header h1.am-h").removeClass("hidden"),h.find(".popup-header p.am-h").removeClass("hidden"),E.removeClass("hidden"),A.removeClass("hidden"),h.find(".popup-header h1.sfg-h").addClass("hidden"),h.find(".popup-header p.sfg-h").addClass("hidden"),U.addClass("hidden"),N.addClass("hidden");break;case f.sfgUser:me(J);(function(){var e=0;switch(c.Team.ST){case 19:case 25:e=30;break;case 14:case 22:e=300;break;case 31:e=20;break;case 28:e=180}})();h.find(".popup-header h1.am-h").addClass("hidden"),h.find(".popup-header p.am-h").addClass("hidden"),E.addClass("hidden"),A.addClass("hidden"),h.find(".popup-header h1.sfg-h").removeClass("hidden"),h.find(".popup-header p.sfg-h").removeClass("hidden"),U.removeClass("hidden"),N.removeClass("hidden")}}function ie(e,t,a,n){switch(h.removeClass("belong-to-team"),K=t?d.standardizeEmail(t.email):"",x.removeClass("not-user add-guest add-paidmem a-user pending-user sfg-user"),h.removeClass("team-deny-non-xtensio add-paidmem add-guest add-sfg-upgrade"),x.find(".not-user input.email").attr("readonly",!1),O.addClass("hidden"),h.find(".subhead").hide(),oe(e),e){case f.main:r&&j.removeClass("hidden"),T.removeClass("selected"),L.addClass("hidden");break;case f.notUser:r&&j.addClass("hidden"),T.addClass("selected"),L.addClass("hidden"),c.Team&&0!=c.Team.Id&&!a.teamMember?(padlocks.teamAddLocks(R,l,c),n?(h.addClass(n),x.addClass(n),"add-paidmem"===n&&(L.removeClass("hidden"),O.removeClass("hidden")),x.find(".username").text(J)):h.addClass("add-mem"),E.text(c.Team.Name),A.text(t.email),R.find(".email").text(K),R.find(".team").text(c.Team.Name),x.find(".email").val(J),x.find(".full-name").val(""),x.addClass("not-user").removeClass("a-user pending-user sfg-user"),x.find(".not-user input.email").attr("readonly",!0)):(x.find(".email").val(K),x.addClass("not-user").removeClass("a-user pending-user sfg-user")),s.isFreeWithTeam()&&h.find(".subhead").show();break;case f.aUser:r&&j.addClass("hidden"),T.addClass("selected"),L.addClass("hidden"),c.Team&&0!=c.Team.Id&&!a.teamMember?(padlocks.teamAddLocks(R,l,c),n?(h.addClass(n),x.addClass(n),x.find(".username").text(J),"add-paidmem"===n&&(L.removeClass("hidden"),O.removeClass("hidden"))):h.addClass("add-mem"),E.text(c.Team.Name),A.text(K),R.find(".email").text(K),R.find(".team").text(c.Team.Name),T.addClass("selected"),x.find(".email").val(J),x.addClass("a-user").removeClass("not-user pending-user sfg-user"),x.find(".a-user input.email").attr("readonly",!0)):(c.Team&&0!=c.Team.Id&&a.teamMember&&(h.addClass("belong-to-team"),x.find(".team-role").text(" ("+a.RoleName+")"),x.find(".acc-lvl-txt").hide()),x.data("email",K).find(".username").text(t.name||K),x.find(".email").val(K),x.addClass("a-user").removeClass("not-user pending-user sfg-user")),P.show();break;case f.pendingUser:r&&j.addClass("hidden"),T.addClass("selected"),L.removeClass("hidden"),x.data("email",K).find(".username").text(t.name||K),x.addClass("pending-user").removeClass("not-user a-user sfg-user");break;case f.sfgUser:if(r&&j.addClass("hidden"),T.addClass("selected"),L.addClass("hidden"),c.Team&&0!=c.Team.Id&&!a.teamMember){if(2<c.Team.Role)return void l.teamUserActionBlocked("existing-sfg");n?(h.addClass(n),x.addClass(n),x.find(".username").text(J)):h.addClass("add-mem"),N.text(t.email),R.find(".email").text(K),R.find(".team").text(c.Team.Name),x.find(".email").val(J),x.find(".full-name").val(""),x.addClass("not-user").removeClass("a-user pending-user sfg-user"),x.find(".not-user input.email").attr("readonly",!0)}else{if(2<c.Team.Role)return void l.teamUserActionBlocked("existing-sfg");x.find(".email").val(K),x.addClass("sfg-user").removeClass("not-user pending-user a-user")}c.Team&&0!=c.Team.Id&&a.teamMember&&(h.addClass("add-sfg-upgrade"),x.find(".team-role").text(" ("+a.RoleName+")"),x.find(".acc-lvl-txt").hide()),x.data("email",K).find(".username").text(t.name||K),x.find(".email").val(K),x.addClass("sfg-user").removeClass("not-user pending-user a-user")}}function se(e){x.addClass(e),re("",{email:J},e)}function re(n,o,i){if(n!=f.main&&(F.show(),P.hide()),I.find("input").val(""),h.removeClass("add-mem add-sfg contact-supp non-user-add add-sfg-upgrade"),c.Team&&o&&0!=c.Team.Id){var s=d.standardizeEmail(o.email),a=f.notUser;u.getMember({data:{teamId:c.Team.Id,email:s},success:function(e){if(e.Data.Data.Email)teamUser=e.Data.Data,console.log("teamRole 405??",teamUser.Role),a=5===teamUser.Role?f.sfgUser:he(s)&&!V?f.pendingUser:f.aUser,n=a,console.log("onTeam view ??",n),u.listALLMembers({data:{teamId:c.Team.Id},success:function(e){var t=e.Data.Data.members,a={isXUser:!0,teamMember:!1};t.forEach(function(e){d.standardizeEmail(e.Email)===s&&(a.teamMember=!0,a.RoleName=e.RoleName,a.Role=e.Role)}),c.Team&&4===c.Team.Role&&!a.teamMember&&l.teamUserActionBlocked("non-team-member","Premium Guests"),ie(n,o,a,i),h.find(".loading-animation").hide()},error:function(e){h.find(".loading-animation").hide()}});else{var t={teamMember:!1,RoleName:"",Role:0,isXUser:!1};ie(n=f.notUser,o,t,i),F.hide()}},error:function(e){console.log("getMember err??",e.Message),F.hide()}})}else ie(n,o,null,i),F.hide()}function le(e,t,a){t=t||"success",F.hide(),a||re(f.main),n.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){n.addClass("hidden")},3e3)}function de(e,t){u.addCollaborator({data:e,success:t,error:function(e){10==e.StatusCode||le(e.Message,"error")}})}function ce(s,r,l,d){setTimeout(function(){if(h.hasClass("belong-to-team"))de({name:r,token:m.Token,role:l,email:s,message:d},function(e){F.hide(),le("A request has been sent to "+r),ge({Email:s,Accepted:null,FullName:r,Privilege:parseInt(l)})});else if(h.hasClass("add-guest")){var e=[],t={email:s,fullName:r,teamId:c.Team.Id,message:d,folioToken:m.Token,accessType:l,role:5};e.push(t),o=e,i=function(e){F.hide(),ge({Email:s,Accepted:null,FullName:r,Privilege:parseInt(l)}),le(s+" has been added as a Free Guest.")},u.addSingleFolioGuest({data:o,success:i,error:function(e){le(e.Message,"error")}})}else if(h.hasClass("add-paidmem")||h.hasClass("add-pg")||h.hasClass("add-sfg-upgrade")){h.hasClass("add-paidmem")?3:h.hasClass("add-pg")&&4;e=[],t={email:s,fullName:r,teamId:c.Team.Id,message:d,folioToken:m.Token,accessType:l,role:W};e.push(t),a=e,n=function(e){F.hide(),ge({Email:s,Accepted:null,FullName:r,Privilege:parseInt(l)}),h.find(".success-panel .list-mems span").text(s),h.addClass("success")},u.addMembers({data:{teamMembers:a},success:n,error:function(e){le(e.Message,"error")}})}var a,n,o,i},10)}function ue(){var t=S.find(".full-name").val(),a=S.find(".email").val();if(msg=S.find(".msg-area.open").length?S.find("textarea").val():"",validator.isEmail(a)){if(newTeamList.push({name:t,email:a,role:2}),F.show(),c.Team&&0<c.Team.Id)return console.log("from notUserView??",a),void ce(a,t,2,msg);de({name:t,token:m.Token,role:2,email:a,message:msg},function(e){F.hide(),le("A request has been sent to "+t),ge({Email:a,Accepted:null,FullName:t,Privilege:parseInt(2)})})}else le("Please provide a valid email address.","error",1)}function me(e){u.findUser({email:e,success:function(e){h.find(".popup-header p.sfg-h .username").text(e.Message)},error:function(e){F.hide(),le(e.Message,"error")}})}function pe(a,n){$.each(X,function(e,t){t&&t.Email==a&&(X[e].Role=n,X[e].RoleName=function(e){if(c.TeamRoles)for(var t=0;t<c.TeamRoles.length;t++)if(e===c.TeamRoles[t].Id)return c.TeamRoles[t].Name;return"Error in Team ID"}(n))}),o.raiseEvent("collabChange",m),we()}function fe(o,i,s,r){l.push(h),0<c.Team.Id&&(1===c.Team.Role||2===c.Team.Role)?(F.hide(),l.confirmAddMember(d.toggleSelectRole(i),1,function(){var t,a,e,n;F.show(),t=o,a=i,e=s,n=r,F.show(),u.changeMemberAccess({userEmail:t,userRole:a,teamId:c.Team.Id,folioToken:e,accessType:n,success:function(e){pe(t,W=a),V=!0,setTimeout(function(){re(f.aUser,{name:me(t),email:t})},0)},error:function(e){F.hide(),le(e.Message,"error")}})})):F.hide()}function he(e){for(var t=0;t<m.Collaborators.length;t++)if(m.Collaborators[t].Email==e&&!m.Collaborators[t].Accepted&&0<m.Collaborators[t].Privilege)return!0;return!1}function ge(a){var n=d.standardizeEmail(a.Email);if(Faltu(m.Collaborators).find({Email:n}).count())$.each(m.Collaborators,function(e,t){t&&d.standardizeEmail(t.Email)===n&&(m.Collaborators[e].Privilege=a.Privilege,m.Collaborators[e].Accepted=a.Accepted||null)});else{var e=a;m.Collaborators.push(e)}o.raiseEvent("collabChange",m)}function ve(a){$.each(m.Collaborators,function(e,t){t&&t.Email==a.Email&&(m.Collaborators[e].Privilege=0,m.Collaborators[e].Accepted=null)}),o.raiseEvent("collabChange",m),we()}function be(e,t){e.Email==c.userEmail?c.isHome?$(".folio-item-shell[data-token="+m.Token+"]").find(".delete-folio").click():l.archive(m,function(){window.location.href="/"}):(F.show(),u.changeCollaborator({data:{verb:"drop",role:e.Privilege,token:m.Token,email:e.Email},success:function(){F.hide(),t.remove(),ve(e),e.Accepted?le((e.FullName||e.Email)+" has been removed from folio."):le("Invitation for "+(e.FullName||e.Email)+" has been cancelled.")},error:function(e){le(e.Message,"error")}}))}function Te(i){return function(){var n=!1,o=$(this).closest(".person");if(!r)return c.Team&&c.Team.Id?(F.show(),void u.listALLMembers({data:{teamId:c.Team.Id},success:function(e){e.Data.Data.members.forEach(function(e){var t,a;e.Email==i.Email&&5==e.Role&&(t=i,a=o,u.removeSingleFolioGuest({data:{userEmail:t.Email,teamId:c.Team.Id},success:function(){F.hide(),a.remove(),ve(t),le((t.FullName||t.Email)+" has been removed from folio.")},error:function(e){le(e.Message,"error")}}),n=!0)}),!n&&c.Team&&5==c.Team.Role?(l.teamUserActionBlocked("collab"),F.hide()):n||be(i,o)},error:function(e){F.hide(),le(err.Message,"error")}})):void be(i,o);ve(i)}}function ye(e){if(X)for(var t=0;t<X.length;t++)if(X[t].Email==e)return X[t].Role;return 0}function Ce(n){var e=9;if(c.Team&&0<c.Team.Id&&(e=ye(n.Email)),0!==n.Privilege&&!1!==n.Accepted){h.find(".popup-header h1.sfg-h").addClass("hidden"),h.find(".popup-header p.sfg-h").addClass("hidden"),U.addClass("hidden"),N.addClass("hidden");var t=n.Privilege<3&&n.Email==c.userEmail,o=$(a.html());if(o.data("person",n).addClass(2<n.Privilege||t?"owner":"collabo").find(".isOwner").text(t?"You":"Owner"),o.addClass(null===n.Accepted&&0<n.Privilege?"pending":""),o.addClass("team-role-"+e).attr("team-role",e),o.find(".name").text(n.FullName||n.Email),o.find(".email").text(n.Email||n.FullName),setTimeout(function(){var t;o.find(".role").trigger("val",["value",n.Privilege]).on("change",(t=n,function(){if(c.Team&&5==c.Team.Role)return l.teamUserActionBlocked("collab"),!1;var e=$(this);u.changeCollaborator({data:{role:e.data("value"),token:m.Token,email:t.Email},success:function(){t.Privilege=e.data("value"),le((t.FullName||t.Email)+" can "+(1==t.Privilege?"now view only.":"view and edit now."))},error:function(e){le(e.Message,"error")}})}))},500),o.find(".remove").on("click",Te(n)).attr("data-tip",n.Accepted?2<n.Privilege||t?"Leave Folio":"Remove Collaborator":"Cancel Invitation"),3===n.Privilege)C.append(o),o.find(".actions span.remove").hide();else if(c.Team&&0<c.Team.Id){var i=!1;c.labels.forEach(function(e,t){if(-1!==e.FolioTokens.indexOf(m.Token)){var a=void 0!==e.OwnerEmail&&null!==e.OwnerEmail&&e.OwnerEmail==n.Email;(-1!==e.ChannelMembers.indexOf(n.Email)||a)&&(i=!0,o.find(".actions span.remove").hide())}}),i?w.append(o):k.append(o),0<w.find(".person").length&&y.find(".chan.header").show(),0<k.find(".person").length&&y.find(".folio.header").show()}else k.append(o)}}function ke(e){if(console.log("f on listPersons",e),e){var a=0;C.empty(),k.empty(),w.empty(),y.find("p.header").hide(),$.each(e.Collaborators,function(e,t){0<t.Privilege&&t.Accepted&&a++,t.Privilege=void 0===t.Privilege?1:t.Privilege,Ce(t)}),a>(c.isHome?0:1)&&y.addClass("hasCollabs"),app.plugin.tooltip(),app.menu.xSelect()}}function we(){if(m){v.empty(),I.removeClass("hasRecent");var o=0;c.recentCollaborators&&$.each(c.recentCollaborators,function(e,t){var a;if(!(3<=o)&&(!function(e){for(var t=d.standardizeEmail(e.Email),a=0;a<m.Collaborators.length;a++)if(d.standardizeEmail(m.Collaborators[a].Email)===t&&0<m.Collaborators[a].Privilege&&1==m.Collaborators[a].Accepted)return!0;return!1}(t)&&!he(t.Email))){var n=$(g.html());n.find(".name").text(t.FullName||t.Email),n.find(".email").text(t.Email||t.FullName),n.on("click",(a=t,function(){z&&q?(J=a.Email||a.FullName,re(f.aUser,{name:a.FullName,email:a.Email})):s.showUpgradePopup()})),v.append(n),I.addClass("hasRecent"),o++}})}}function xe(e){$e(e,!0)}function $e(n,e){var t=e||!1,a={getValue:function(e){return e.FullName+" "+e.Email},data:X,theme:"bootstrap",list:{match:{enabled:!0},onChooseEvent:function(){var e=M.getSelectedItemData();console.log(e),M.val(e.Email)}}};t&&1==c.editMode?u.getLabelData({success:function(e){try{console.log("getLabelData response in collaborators ",e);var t=JSON.parse(e.Data),a=""===t?[]:JSON.parse(t);a.forEach(function(e,t){return e.color=c.colors[t%c.colors.length]}),console.log("labels in collaborators",a),c.labels=a,ke(n),we()}catch(e){console.log("try catch getLabelData err",e)}},error:function(e){console.log("getLabelData err",e)},complete:function(){}}):(ke(n),we()),t&&c.Team&&0<c.Team.Id?(h.find(".loading-animation").show(),u.listALLMembers({data:{teamId:c.Team.Id},success:function(e){h.find(".loading-animation").hide(),X=e.Data.Data.members,Z=e.Data.Data.GuestSeatsPurchased,numSeatMembers=e.Data.Data.MemberSeatsPurchased,M.easyAutocomplete(a)},error:function(e){h.find(".loading-animation").hide()}})):M.easyAutocomplete(a)}if(b.find("a.btn").on("click",function(e){e.preventDefault(),window.location.hash="seeplans"}),H.click(function(){G.find(".msg-content").show("slow")}),Y.click(function(){G.find(".msg-content").hide("slow")}),B.find(".invite-confirm").click(function(){var e=B.find(".block:eq(1) .left input").val(),t=B.find(".block:eq(1) .right input").val(),a=B.find(".block:eq(2) .role .popup-menu .item.active").data("value"),n=B.find(".opts .msg-content textarea").val();validator.isEmail(e)?(F.show(),ce(e,t,a,n)):le("Please provide an valid email address.","error",1)}),t.on("click",function(){z&&q||s.showUpgradePopup()}),R.find(".get-in-touch").click(function(){window.$crisp&&($crisp.push(["set","message:text",["I would like to add a new team member."]]),$crisp.push(["do","chat:open"]))}),R.find(".add-single-folio-guest").click(function(){W=5,se("add-guest")}),R.find(".add-member").click(function(){l.teamManagePopup(!0)}),T.on("click",".pending-user .btn.yes",function(){var e=function(e){for(var t=0;t<m.Collaborators.length;t++)if(d.standardizeEmail(m.Collaborators[t].Email)===e&&0<m.Collaborators[t].Privilege)return m.Collaborators[t];return null}(d.standardizeEmail(x.data("email")));de({name:e.FullName,email:d.standardizeEmail(e.Email),role:e.Privilege,token:m.Token},function(){le("An invitation has been sent again to "+e.FullName)})}),T.on("click",".pending-actions .b",function(){var e=$(this),t=e.closest(".person"),a=t.data("person");F.show(),e.text("Sending ...").css("cursor","default"),de({name:a.FullName,email:a.Email,role:a.Privilege,token:m.Token},function(){F.hide(),e.text("Invitation Sent!"),t.find(".actions").addClass("active"),setTimeout(function(){e.text("Resend Invitation").css("cursor","pointer"),t.find(".actions").removeClass("active")},3e3)})}),x.find(".cancel").click(function(){re(f.main)}),S.find(".add-collab").on("click",function(){console.log("choosenRole",W),console.log("checkSeatsAndPaidPlan ",parseInt(numSeatMembers),parseInt(Z),X.length),0==p.isFreePlan()&&(1==p.isOwner()||1==p.isAdmin())&&parseInt(numSeatMembers)+parseInt(Z)+1<=X.length&&5!==W?l.confirmAddMember(memType,X.length,function(){l.collaborators(m,function(){h.addClass("show"),h.parent().show(),ue()})}):ue()}),P.find(".add-collab").on("click",function(){F.show();var t=P.find(".username").text(),e=P.find(".msg-area.open").length?P.find("textarea").val():"";J=o;var a,n,o=x.find(".email").val()||J;if(r)F.hide(),le("A request has been sent to "+t),ge({Email:o,Accepted:null,FullName:t,Privilege:parseInt(2)});else{if(c.Team&&0<c.Team.Id)return V&&(a={verb:"",token:m.Token,role:2,email:o},n=function(e){le("A request has been sent to "+t),ge({Email:o,Accepted:null,FullName:t,Privilege:parseInt(2)})},u.changeCollaborator({data:a,success:n,error:function(e){le(e.Message,"error")}})),void ce(o,t,2,e);de({token:m.Token,role:2,email:o,message:P.find(".msg-area.open").length?P.find("textarea").val():""},function(e){le("A request has been sent to "+t),ge({Email:o,Accepted:null,FullName:t,Privilege:parseInt(2)})})}}),D.find(".add-collab").on("click",function(){F.show();var e=D.find(".role").data("value")?D.find(".role").data("value"):4,t=a,a=x.find(".email").val()||t;console.log(),r?(ge({Email:a,Accepted:null,FullName:name,Privilege:parseInt(e)}),F.hide()):c.Team&&0<c.Team.Id&&fe(a,e,m.Token,2)}),I.on("submit",function(e){if(!z)return event.preventDefault(),!1;if(J=d.standardizeEmail(I.find("input").val()),c.Team&&5==c.Team.Role)return l.teamUserActionBlocked("collab"),!1;var o=d.standardizeEmail(I.find("input").val()),t=o,i="";return F.show(),validator.isEmail(o)?s.isTeamMember()&&!ye(o)?l.teamUserActionBlocked("team-member-collab"):u.findUser({email:o,success:function(e){var n=f.notUser;e.Message?(i=e.Message,u.getMember({data:{teamId:c.Team.Id,email:t},success:function(e){teamUser=e.Data.Data,re(n=5===teamUser.Role?f.sfgUser:he(t)&&!V?f.pendingUser:f.aUser,{name:i,email:o})},error:function(e){console.log("getMember error??",e.Message)}})):u.getMember({data:{teamId:c.Team.Id,email:t},success:function(e){if(null!=e.Data.Data){if(teamUser=e.Data.Data,console.log("returned result???",teamUser),null==teamUser.Email||0==teamUser.Role||0==teamUser.TeamID){var t=p.maxUsers();if(X.length>=t)return a=t,void(1==p.isOwner()?l.message({heading:ae,message:te(p.planDisplayName(),a,p.getNextPlanToUpgrade()),btnText:"Upgrade",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){l.universalBlocker()}}):1==p.isAdmin()&&l.message({heading:ne,message:ee(p.planDisplayName(),a),btnText:"Ok",bodyCentered:!0,notMini:!0}))}else i=teamUser.FullName||teamUser.UserName,n=f.pendingUser;re(n,{name:i,email:o})}var a},error:function(e){console.log("getMember error??",e.Message)}}),F.hide()},error:function(e){le(e.Message,"error")}}):le("Please provide a valid email address.","error"),!1}),T.on("click",".team-role-5 .resend-team-inv, .team-role-0 .resend-team-inv",function(){var t=$(this),a=t.closest(".person"),e=a.data("person");F.show(),t.text("Sending ...").css("cursor","default"),u.resendSFGEmailNotification({data:{userEmail:e.Email,teamId:c.Team.Id,folioToken:m.Token,accessType:e.Privilege},success:function(e){F.hide(),t.text("Invitation Sent!"),a.find(".actions").addClass("active"),setTimeout(function(){t.text("Remind").css("cursor","pointer"),a.find(".actions").removeClass("active")},3e3)},error:function(e){t.text("Remind").css("cursor","pointer"),a.find(".actions").removeClass("active"),le(e.Message,"error")}})}),R.find(".r1").click(function(){if($(this).hasClass("locked")){var e=4==c.Team.Role?"Premium Guests":"Team Members";l.teamUserActionBlocked("invite-member",e,function(e,t){l.show(h)})}else 4==c.Team.Role?l.teamUserActionBlocked("non-team-member","Premium Guests"):(memType="Team Member",h.find(".popup-header h1.am-h .mem").text("Team Member "),h.find(".popup-header p.am-h").addClass("hidden"),W=3,B.find(".block:eq(1) .left input").val(J),se("add-paidmem"))}),R.find(".r2").click(function(){if($(this).hasClass("locked")){var e=4==c.Team.Role?"Premium Guests":"Team Members";l.teamUserActionBlocked("invite-member",e,function(e,t){l.show(h)})}else 4==c.Team.Role?l.teamUserActionBlocked("non-team-member","Premium Guests"):(memType="Premium Guest",h.find(".popup-header h1.am-h .mem").text("Premium Guest "),h.find(".popup-header p.am-h").addClass("hidden"),W=4,B.find(".block:eq(1) .left input").val(J),se("add-paidmem"))}),R.find(".r3").click(function(){if(!p.legacyPlan())if(4==c.Team.Role)l.teamUserActionBlocked("non-team-member","Premium Guests");else{var e=0;if("Basic"===p.getMainPlanName())for(var t=0;t<X.length;t++)5==X[t].Role&&e++;"Basic"===p.getMainPlanName()&&e>=p.maxFreeGuests()?(l.close(),l.message({heading:ae,message:"You cannot add more than "+p.maxFreeGuests()+" Free Guests, Please Upgrade to Full Access to add more Free Guests",btnText:"Upgrade",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){l.universalBlocker()}})):(memType="Free Guest",h.find(".popup-header h1.am-h .mem").text("Free Guest "),R.find(".add-single-folio-guest").trigger("click"))}}),l.reg(h,h.find(".popup-close, .btn-close, .back-to, .back-button, .no"),function(){i.off("click"),m.Token?o.removeListener("collabChange",$e):l.saveFolio(1,{teamUsersList:_.without(m.Collaborators,newTeamList),newTeamUsersList:newTeamList})}),o.addListener("refreshMemberData",function(){hasInit&&$e(m,!0)}),s.isFreeWithTeam()&&(L.addClass("hidden-on-free"),O.addClass("hidden-on-free")),s.getData(1,function(e,t,a,n){e=null==e?{}:e,console.log("data.ST",e.ST),14!==e.ST&&19!==e.ST||!0,c.Team&&0<c.Team.Id&&4!==c.Team.Role&&5!==c.Team.Role&&(q=!0),s.hasTeam()?(s.isSingleFolioGuest()||s.isPremiumGuest())&&(tip="Guests can not add collaborators.",z=!1):(s.isFree()||s.isPlus())&&(z=!1),padlocks.setCollaboratorLocks(h,z)},!0),c.recentCollaborators)for(var Pe=0;Pe<c.recentCollaborators.length;Pe++)!c.recentCollaborators[Pe].Email&&c.recentCollaborators[Pe].FullName&&(c.recentCollaborators[Pe].Email=c.recentCollaborators[Pe].FullName);return F.html(l.spinner),function(){var e,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{Token:null,Collaborators:[]},t=1<arguments.length?arguments[1]:void 0;if(p=app.acl.helper(c),h.toggleClass("isLegacyPlan",p.legacyPlan()),hasInit=!0,"function"==typeof t)return l.show(h),void t();h.removeClass("success"),X=[],h.find(".loading-animation").show(),r=!(m=a).Token,F.show();for(var n=0;n<m.Collaborators.length;n++)!m.Collaborators[n].Email&&m.Collaborators[n].FullName&&(m.Collaborators[n].Email=m.Collaborators[n].FullName);memType="",h.find(".popup-header h1.am-h .mem").text(""),h.find(".popup-header p.am-h").removeClass("hidden"),h.find(".popup-header h1.sfg-h").addClass("hidden"),h.find(".popup-header p.sfg-h").addClass("hidden"),U.addClass("hidden"),N.addClass("hidden"),c.Team&&0<c.Team.Id?u.listALLMembers({data:{teamId:c.Team.Id},success:function(e){h.find(".loading-animation").hide();var t=e.Data.Data.members;X=[],Z=e.Data.Data.GuestSeatsPurchased,numSeatMembers=e.Data.Data.MemberSeatsPurchased,t.forEach(function(e,t){var a=e.FullName||"";e.search=e.Email+" "+a,X.push(e)}),re(1),$e(a,!0),o.addListener("collabChange",xe),i.parent().removeClass("open"),i.on("click",function(){$(this).parent().toggleClass("open")}),F.hide()},error:function(e){h.find(".loading-animation").hide()}}):(h.find(".loading-animation").hide(),re(1),ke(a),we(),o.addListener("collabChange",$e),i.parent().removeClass("open"),i.on("click",function(){$(this).parent().toggleClass("open")}),F.hide()),e=z?"5px":"130px",z||s.isFreeWithTeam()?(h.find(".popup-content").removeClass("remove-top-border"),b.addClass("hidden"),M.removeClass("disable-btns")):(h.find(".popup-content").addClass("remove-top-border"),b.removeClass("hidden"),M.addClass("disable-btns")),h.find(".cancel.icon-Close").css({top:e}),d.doSetFocus(M),l.show(h)}},app.popup.getConfirmDowngradePopup=function(t,a,e,n,o,i){var s=$("#tmp-confirm-downgrade"),r=s.find(".cancel, .popup-close.icon-Close"),l=s.find(".loading-animation").html(a.spinner),d=!1,c=!1;function u(e){e?(l.hide(),s.find(".popup-content").show()):(l.show(),s.find(".popup-content").hide())}return s.find(".cancel-dg-btn").click(function(e){e.preventDefault(),a.close()}),s.find(".confirm-dg-btn").click(function(e){e.preventDefault(),u(!1),a.trialExpirePopup(!0,d),setTimeout(function(){c||(c=!0,$("#pendo-button-fa73c61a").click(function(){a.trialExpirePopup(!0,d)}),$("#pendo-button-8fed2b42, #pendo-close-guide-77f71eb5").click(function(){u(!0),a.close()}))},500)}),a.reg(s,r),function(e){d=e||!1,!t.isTrial&&t.trialConverted&&s.find(".p-type").text("plan"),s.find(".datedue").html(dayjs(t.plusExpireTime).format("MMMM Do, YYYY")),l.hide(),a.show(s)}},app.popup.getCopySectionPopup=function(i,s,r,l,d){var c=$("#tmp-copy-move-section"),u=c.find(".destination .filter-popup-menu"),n=(u.find(".item"),c.find(".order .filter-popup-menu")),m=c.find(".popup-cta.ok"),p=c.find(".destination .x-select .text"),f=0,h=null,g=null,e=c.find(".go-to-folio"),a=e.find(".gotofolio"),o=e.find(".name"),v=e.find(".verb"),b=!1;c.find(".loading-animation").html(s.spinner);var T=function(e,t){console.log(t),u.html("");for(var a=0;a<t.length;a++)i.token!=t[a].Token&&(itemHtml='<div class="item" data-totalsec = "'+t[a].TotalSections+'" data-token="'+t[a].Token+'">'+t[a].FolioName+"</div>",u.append(itemHtml));u.find(".item").click(function(){$this=$(this),function(e){n.html("");for(var t=1;t<=e+1;t++)n.append('<div class="item" data-count="'+t+'">'+t+"</div>");n.find(".item:eq(0)").addClass("active")}($this.data("totalsec")),m.removeClass("disabled")})};return m.click(function(){c.addClass("busy"),d.getCopySections({sourceToken:i.token,destinationToken:u.find(".active").data("token"),sectionTag:f,order:n.find(".active").data("count"),action:g,success:function(e){c.removeClass("busy"),a.attr("href",i.baseUrl+"/edit/"+u.find(".active").data("token")),o.text(u.find(".active").text());var t=b?"copied":"moved";v.text(t),c.addClass("success"),h&&h()},error:function(e){c.removeClass("busy"),s.message({heading:"Oops!",message:e.Message,btnText:"Ok"})}})}),s.reg(c,c.find(".icon-Close, .popup-cta.cancel")),function(a,e,t){var n;u.html(""),c.removeClass("success"),n=-1<e.indexOf("Move")?(g="move","copy"):(g="copy","move"),b=!(-1<e.indexOf("Move")),h=t||null,c.find(".popup-header .tipped-icon").css("display","inline-block"),c.find(".popup-header .tipped-icon."+n+"section-icon").hide(),c.addClass("busy"),c.find(".popup-header h1").contents().first().replaceWith(e),p.html("<span>Copy Section</span> To:"),p.find("span").text(e),m.text(e),m.addClass("disabled");var o=r.obtain(l.Modules,"Type","DataModule").Data.Sections;d.getUserFolios({teamId:i.Team.Id,success:function(e){c.removeClass("busy");var t=JSON.parse(e.Data);0<t.length&&T(o[a].Tag,t),f=o[a].Tag},error:function(e){c.removeClass("busy"),s.message({heading:"Oops!",message:e.Message,btnText:"Ok"})}}),s.show(c)}},app.popup.getCreateTemplatePopup=function(l,d,c,e,u,m,t){var p,f,a=$("#tmp-create-template"),n=a.find(".cancel, .popup-close, .icon-Close"),o=a.find(".loading-animation"),i=($("#top-bar .template-subnav"),o.html(d.spinner)),h="team-temp",g=a.find(".cont-field .temp-name"),s=a.find(".create-save-btn"),r=a.find("input[type=radio]"),v=a.find(".err-msg"),b=a.find("#temp-type-team"),T=a.find("#temp-type-mytemp"),y=app.acl.helper(l),C=y.privateLinksAllowed,k=y.teamTemplatesAllowed,w=y.getMainPlanName;function x(e){e?(i.hide(),g.removeClass("disable"),r.removeClass("disable"),s.removeClass("disable")):(i.show(),g.addClass("disable"),r.addClass("disable"),s.addClass("disable"))}return app.core.padlocks(u,t,l,m).setTeamTemplateLock(b.parent()),r.click(function(){console.log("toggle template type value",$(this).val()),h=$(this).val()}),s.click(function(e){e.preventDefault();var t,a=g.val();if(console.log("template name",a),console.log("folioToken",p),console.log("templateType",h),""===a)t="Please provide a template name",clearTimeout(f),v.text(t),v.show(),f=setTimeout(function(){v.hide()},5e3);else{x(!1);var n="team-temp"===h,o=n?"Team Template":"My Template",i=n?" is available to all team members in ":" is now your private template in ",s=l.isDashboard?"":"/",r=n?s+"#teamtemplates":s+"#mytemplates";c.saveAsTemplate({token:p,name:a,teamId:l.Team.Id,CopiedFromTemplate:!1,isTeamTemplate:n,isIndexed:!C(),isPrivate:C(),success:function(){var e;n||m.raiseEvent("teamTemplateUpdate"),d.message((_defineProperty(e={heading:o+' Saved <i class="icon-CheckMark"></i>',message:"<b>"+a+"</b>"+i+'<a href="'+r+'">'+o+"s</a>",bodyCentered:!0,btnText:"Done",enterAsOK:!0,notMini:!0},"btnText","Go to "+o+"s"),_defineProperty(e,"cancelText","Ok"),_defineProperty(e,"handleOK",function(){window.location=r}),e))},error:function(e){u.doUpgradePopup(d,w())},complete:function(){x(!0)}})}}),d.reg(a,n),function(e,t){g.val(e),p=t,k()||(h="my-temp",b.attr("checked",!1),T.attr("checked",!0),b.prop("disabled",!0),b.parent().click(app.popup.moveToTeamTemplatesBlocker(d,l,a))),i.hide(),d.show(a)}},app.popup.getDowngradeNoticePopup=function(a,t,e,n,o,i){var s=$("#tmp-downgrade-notice"),r=s.find(".cancel, .popup-close.icon-Close"),l=s.find(".loading-animation"),d=s.find(".cancel-end-date"),c=l.html(t.spinner);function u(){var e=a.SubCancelledUTC14?dayjs(a.SubCancelledUTC14):dayjs(a.subCancelledDate).add(2,"week");s.find(".just-downgraded").hide(),s.find(".cont-pickup").show(),s.find(".dgn-close-btn").hide(),s.find(".upgrade-btn").show(),s.find(".upgrade-btn").click(function(e){e.preventDefault(),t.push(s),t.universalBlocker()}),s.find("h1.downgrade").show(),s.find("h1.cancellation").hide(),s.find(".del-date").html(e.format("MMMM Do, YYYY")),s.find(".popup-close.icon-Close").hide(),s.addClass("no-close")}return s.find(".dgn-close-btn, .popup-close.icon-Close").click(function(e){if(e.preventDefault(),a.plusExpireTime<=Date.now()){var t="";"live"==a.Environment?t="https://app.xtensio.com/":"dev"==a.Environment?t="https://app.xtensio.tech/":"local"==a.Environment&&(t="https://www.localhost.com:44301/"),window.location=t}else n.reloadWithoutHash()}),t.reg(s,r),function(){var e=Date.now();$("#tmp-downgrade-bar").addClass("hideOverride"),a.subCancelledDate&&""!==a.subCancelledDate&&!a.IsDelinquent&&e>=a.subCancelledDate?u():e>=a.plusExpireTime?u():a.isTrial||(s.find(".cont-pickup").hide(),s.find(".just-downgraded").show(),s.find("h1.downgrade").hide(),s.find("h1.cancellation").show(),s.find(".upgrade-btn").hide(),d.html(dayjs(a.plusExpireTime).format("MMMM Do, YYYY"))),c.hide(),t.show(s)}},app.popup.getDownloadBlocker=function(i,d,c,u,s){var r,m=$("#tmp-download-blocker"),e=m.find(".download-png-btn"),t=m.find(".pay-export-btn"),p=m.find(".export-checkout-btn"),f=m.find(".cc-num"),h=m.find(".cc-name"),g=m.find(".cc-email"),v=m.find(".cvc"),b=m.find(".cc-exp"),T=m.find(".select.confirm"),a=m.find(".db-seeplans-btn"),n=m.find(".db-upgrade-basic-btn"),o=m.find(".change-plans-link"),l=m.find(".thankyou-close"),y=m.find(".step-block .error-msg"),C=m.find(".export-pay-success"),k=m.find(".loading-animation").html(i.spinner),w=!1,x="unknown";function P(e,t){var a=t||"please make sure to fill out all the fields.";e.html('<i class="fa fa-exclamation-triangle"></i> Error: '+a),e.addClass("show"),setTimeout(function(){e.removeClass("show")},5e3)}function S(e){p.hide(),C.show();var t=3,a=C.find(".sec-count"),n=setInterval(function(){0===t&&(clearInterval(n),d.exportEnabled=!0,d.exporterEmail=e,i.close(),r()),1===t?a.text(t+" second"):a.text(t+" seconds"),console.log(t),t--},1e3)}return n.on("click",function(){i.close(),i.universalBlocker("basic",null,!0)}),o.on("click",function(){i.close(),i.universalBlocker()}),a.on("click",function(){i.close(),i.universalBlocker()}),l.on("click",function(){!1===$("body").hasClass("anon-download-busy")&&i.close()}),T.click(function(e){e.preventDefault(),w=!w,T.toggleClass("selected",w),console.log("isConfirmed",w)}),e.on("click",function(){m.removeClass("db-main db-after-paid-export db-pay-for-export").addClass("db-after-png-export"),"function"==typeof r&&r(!0)}),t.on("click",function(){m.removeClass("db-main db-after-png-export db-after-paid-export").addClass("db-pay-for-export")}),p.on("click",function(){if(!$(this).hasClass("disable-btn")){var e,t=0,a=f.data("val"),n=v.val(),i=c.trimLowercase(h.val()),s=c.trimLowercase(g.val()),o=b.val(),r=o?o.toString().substr(0,2):"",l=o?o.toString().substr(3):"";if(console.log("num",a),console.log("date",o),f.removeClass("error"),h.removeClass("error"),b.removeClass("error"),v.removeClass("error"),T.find("span.check").removeClass("error"),y.removeClass("show"),Stripe.card.validateCardNumber(a)||(t=1,f.addClass("error")),Stripe.card.validateCVC(n)||(t=1,v.addClass("error")),Stripe.card.validateExpiry(r,l)||(t=1,b.addClass("error")),i&&""!=i||(t=1,h.addClass("error")),""!=s&&!1!==validator.isEmail(s)||(t=1,g.addClass("error")),w||(t=1,T.find("span.check").addClass("error")),t)return e?(k.show(),m.addClass("busy")):(k.hide(),m.removeClass("busy")),void P(y);Stripe.card.createToken({number:a,cvc:n,exp_month:r,exp_year:l,name:i},function(e,t){if(t.error)console.log("Stripe createToken error",t),m.removeClass("busy");else{var a=t.card,n=t.id,o={success:function(e){console.log(e),1==e.StatusCode?S(s):P(y,e.Message)},error:function(e){e.Message?P(y,e.Message):P(y,e.toString()),console.log(e)},complete:function(){p.removeClass("disable-btn")}};o.data={Token:n,CardId:a.id,Last4:a.last4,Brand:a.brand,Name:i,FolioToken:d.token,Email:s},console.log("apiData: ",o),p.addClass("disable-btn"),u.purchasePDFExports(o)}})}}),i.reg(m,m.find(".icon-Close")),function(e,t,a,n,o){e,t,a,r=o,n?m.removeClass("db-main db-after-png-export db-pay-for-export").addClass("db-after-paid-export"):m.removeClass("db-main db-after-png-export db-after-paid-export db-pay-for-export").addClass("db-main"),i.show(m),s.loadStripe(function(){f.passwordify({maxLength:19,numbersOnly:!0,charToShow:4,ccInputHandler:function(e){var t=s.getCardType(e);t!==x&&(x=t,console.log("card type",x),m.find(".cc-type i").removeClass().addClass("fa "+s.getCardIconClass(x)))}}),v.mask("0000"),b.mask("00/0000",{placeholder:"mm/yyyy"})})}},app.popup.getEmailSettings=function(t,e,a,n,o){var i,s,r=$("#tmp-email-settings"),l=r.find(".paper"),d=r.find(".yes"),c=r.find(".icon-Close , .no");function u(){i&&$.each(i,function(e,t){l.find("."+n.valToProp(s,t.eType)).val(t.sType)}),!e.Team||1!==e.Team.Role&&2!==e.Team.Role?l.find(".weeklyInsightDiv").addClass("hidden"):(l.find(".weeklyInsightDiv").removeClass("hidden"),console.log(e))}return l.find(".loading-animation").html(t.spinner),t.reg(r,c),u(),d.on("click",function(){l.addClass("busy");var e={Digest:l.find(".digest").val(),PlusExtended:l.find(".plusExtended").val(),PlusReminder:l.find(".plusReminder").val(),FormResponse:l.find(".formResponse").val(),TransferRequest:l.find(".transferRequest").val(),TransferResult:l.find(".transferResult").val(),CollaboratorRequest:l.find(".collaboratorRequest").val(),CollaboratorResult:l.find(".collaboratorResult").val(),CollaboratorRevoke:l.find(".collaboratorRevoke").val(),CollaboratorReminder:l.find(".collaboratorReminder").val(),CollaborationChannelUpdate:l.find(".collaborationChannel").val(),OwnerLeave:l.find(".ownerLeave").val(),WeeklyInsights:l.find(".weeklyInsights").val()};o.emailSettings({data:{verb:"set",pairs:JSON.stringify(e)},success:function(e){l.removeClass("busy"),t.close()},error:function(){t.error(),l.removeClass("busy")}})}),function(){i||o.emailSettings({success:function(e){i=e.Data.Settings,s=e.Data.EmailTypes,e.Data.SettingTypes,u(),l.removeClass("busy")},error:function(){t.error()}}),t.show(r,"manage-notifications")}},app.popup.getExpiredBlocker=function(s,r,e,o,l){var d=$("#tmp-expired-blocker-popup"),t=d.find(".loading-animation"),a=d.find(".upgrade"),n=d.find(".downgrade");return t.html(r.spinner),a.click(function(){r.universalBlocker()}),n.click(function(){return $anim.show(),r.push(d),e.getData(1,function(e,t,a,n){o.getUserActiveFoliosCount({success:function(e){var i=e.Data;o.getUserTemplateCount({success:function(e){var t,a,n=e.Data,o=1<i||0<n;if(o&&(1<i&&n<1?(t="Uh oh - You have more than 1 folio!",a="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard."):1<i&&0<n?(t="Uh oh - You have more than 1 folio and saved templates",a="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):i<2&&0<n&&(t="Uh oh - You have saved templates!",a="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.")),$anim.hide(),o)setTimeout(function(){$("#tmp-downgrade-bar").show(),$("#tmp-downgrade-bar .downgrade-bar").show()},1e3),r.message({heading:t,message:a,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){r.close()}});else{2==currPlan?"Pro":1==currPlan&&"Plus",r.push(d),r.message({heading:'<span style="font-size: 26px;">Are you sure you want to downgrade to the free plan?</span>',message:"You will be downgraded to Free Forever plan and will be limited to 1 active folio.<br><br>Are you sure you want to change your current plan?",btnText:"Yes, Downgrade to Free Forever",cancelText:"Nevermind",notMini:!0,handleOK:function(){$anim.hide(),setTimeout(function(){l.raiseEvent("plusCancelled"),r.message({heading:'<h1 class="emphasize">Downgrade Successful</h1>',message:'<h3>Current Plan: <span class="prox-bold">Xtensio Free Forever</span></h3>',btnText:"Ok",notMini:!0,handleOK:function(){r.close();"live"==s.Environment||("dev"==s.Environment||s.Environment)}})},0)}})}},error:function(){}})},error:function(e){console.log("error: ",e)}})}),!1}),r.reg(d,d.find(".close-popup-btn, .no")),function(e){t.hide(),r.show(d)}},app.popup.getFailedPaymentBlocker=function(s,r,l,e,d){var c=$("#tmp-failed-payment-blocker-popup"),t=c.find(".loading-animation"),a=(c.find(".paper"),c.find(".upgrade")),u=(c.find(".success-panel"),s.Plan),n=c.find(".downgrade"),m=t.html(r.spinner);return a.click(function(){r.push(c),r.billing(1,!1)}),n.click(function(){return m.show(),r.push(c),e.getData(1,function(e,t,a,n){l.getUserActiveFoliosCount({success:function(e){var i=e.Data;l.getUserTemplateCount({success:function(e){var t,a,n=e.Data,o=1<i||0<n;if(o&&(1<i&&n<1?(t="Uh oh - You have more than 1 folio!",a="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard."):1<i&&0<n?(t="Uh oh - You have more than 1 folio and saved templates",a="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):i<2&&0<n&&(t="Uh oh - You have saved templates!",a="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.")),m.hide(),o)setTimeout(function(){$("#tmp-downgrade-bar").show(),$("#tmp-downgrade-bar .downgrade-bar").show()},1e3),r.message({heading:t,message:a,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){r.close()}});else{2==u?"Pro":1==u&&"Plus",r.push(c),r.message({heading:'<span style="font-size: 26px;">Are you sure you want to cancel?</br><span style="font-size: 18px;">These changes will take effect immediately.</span></span>',message:"You will be downgraded to Free Forever plan and will be limited to 1 active folio.<br><br>Are you sure you want to change your current plan?",btnText:"Yes, I am sure",cancelText:"Nevermind",notMini:!0,handleOK:function(){var e,t;m.show(),e=0,t=function(){m.hide(),d.raiseEvent("plusCancelled"),r.message({heading:'<h1 class="emphasize">Downgrade Successful</h1>',message:'<h3>Current Plan: <span class="prox-bold">Xtensio Free Forever</span></h3>',btnText:"Ok",notMini:!0,handleOK:function(){r.close();var e="";"live"==s.Environment?e="https://app.xtensio.com/":"dev"==s.Environment?e="https://app.xtensio.tech/":"local"==s.Environment&&(e="https://www.localhost.com:44301/"),window.location=e}})},l.cancelPlan({data:{plan:e,renew:e?1:0},success:function(e){t(e)},error:function(e){r.error(e.Message||"There was an error. Please try later.")},complete:function(){}})}})}},error:function(){}})},error:function(e){console.log("error: ",e)}})}),!1}),r.reg(c,c.find(".close-popup-btn, .no")),function(e){console.log("params",e),t.hide(),r.show(c)}},app.popup.getFailedPaymentAddUser=function(a,n,t,e,o){var i=$("#tmp-failed-payment-add-user-popup"),s=i.find(".loading-animation.forpopup"),r=i.find(".user-list"),l=$("#tmp-billing"),d=!1;function c(){i.find(".btn").toggleClass("disabled")}function u(){var e,t;1==a.isMembersPaymentFailed&&(!1===l.is(":visible")&&!1===d&&(e=a.failedMemberEmails,t=1<e.length?"users":"user",i.find(".paper p span, .remove-user span").html(t),r.html("<strong>"+e.join("<br>")+"</strong>"),n.show(i),d=!0),setTimeout(u,1e3))}return i.find(".remove-user").click(function(){if(!$(this).hasClass("disabled")){c();var e=a.failedMemberEmails;s.show(),t.removeUnpaidMembers({data:e,success:function(e){console.log(e)},error:function(e){console.log(e)},complete:function(){c(),s.hide(),window.location.reload()}})}}),i.find(".update-card-details").click(function(){$(this).hasClass("disabled")||(d=!1,n.billing(1,!1,"cardDetailsOnly"))}),s.html(n.spinner),n.reg(i),function(){u()}},app.popup.getFailedPaymentTeamBlocker=function(s,r,l,e,d){if(e.isOwner())s.IsDelinquent&&(c=$("#tmp-failed-payment-team-blocker-owner-popup")).find(".upgrade").click(function(){r.push(c),r.billing(1,!1)});else if(s.Team.IsDelinquent)var c=$("#tmp-failed-payment-team-blocker-popup");c&&(c.find(".downgrade").click(function(){return $anim.show(),r.push(c),e.getData(1,function(e,t,a,n){l.getUserActiveFoliosCount({success:function(e){var i=e.Data;l.getUserTemplateCount({success:function(e){var t,a,n=e.Data,o=1<i||0<n;o&&(1<i&&n<1?(t="Uh oh - You have more than 1 folio!",a="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard."):1<i&&0<n?(t="Uh oh - You have more than 1 folio and saved templates",a="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):i<2&&0<n&&(t="Uh oh - You have saved templates!",a="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.")),$anim.hide(),o?(setTimeout(function(){$("#tmp-downgrade-bar").show(),$("#tmp-downgrade-bar .downgrade-bar").show()},1e3),r.message({heading:t,message:a,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){r.close()}})):(r.push(c),r.message({heading:'<span style="font-size: 26px;">Are you sure you want to cancel?</br><span style="font-size: 18px;">These changes will take effect immediately.</span></span>',message:"You will be downgraded to Free Forever plan and will be limited to 1 active folio.<br><br>Are you sure you want to change your current plan?",btnText:"Yes, I am sure",cancelText:"Nevermind",notMini:!0,handleOK:function(){var e,t;$anim.show(),e=0,t=function(){$anim.hide(),d.raiseEvent("plusCancelled"),r.message({heading:'<h1 class="emphasize">Downgrade Successful</h1>',message:'<h3>Current Plan: <span class="prox-bold">Xtensio Free Forever</span></h3>',btnText:"Ok",notMini:!0,handleOK:function(){r.close(),"live"==s.Environment||"dev"==s.Environment||s.Environment}})},l.cancelPlan({data:{plan:e,renew:e?1:0},success:function(e){t(e)},error:function(e){r.error(e.Message||"There was an error. Please try later.")},complete:function(){}})}}))},error:function(){}})},error:function(e){console.log("error: ",e)}})}),!1}),r.reg(c,c.find(".close-popup-btn, .no")));return function(e){c&&r.show(c)}},app.popup.getFolioVersion=function(d,c,u,e,m,n,p){var f,t,a,o,i,s,h=6,g=!1,v=14,r=$("#tmp-folio-version"),l=r.find(".icon-Close"),b=r.find(".v-table.snapshot"),T=r.find(".v-table.localstorage"),y=$("#tmp-folio-version-table"),C=r.find(".btn-save"),k=y.html(),w=$('<div class="nonplus hidden"></div>'),x=$('<div class="overlay"></div>'),P=r.find(".loading-animation"),S=r.find(".showmore"),D=(g=!1,!1);P.html(c.spinner);var F=function(){g&&b.find(".v-table-row:eq(0)").removeClass("previous").addClass("current").find(".note-edit").remove(),a=r.find(".note-edit"),o=r.find(".note-save"),i=r.find(".note-container input"),a.click(function(){$(this).parent().addClass("editable"),(i=$(this).parent().find("input")).prop("readonly",!1).focus()}),o.click(function(){var e=$(this).closest(".v-table-row").data("item").Id;$(this).parent().removeClass("editable"),(i=$(this).parent().find("input")).prop("readonly",!0),d.folioVersion({data:{id:e,verb:"note",note:i.val(),token:f},success:function(){},error:function(){}})}),i.on("keydown",function(e){13==(e.which||e.keyCode)&&o.click()})};function I(e,t){d.getChannelsOfAFolio({data:{folioToken:e,teamId:m.Team.Id},success:function(e){console.log("getChannelsOfAFolio response",e),t&&"function"==typeof t&&t(e)},error:function(e){console.log("getChannelsOfAFolio error",e),c.error(e.Message)},complete:function(){P.hide()}})}function M(){var r,l;if(g=!1,console.log("num of days to keep revisions",v),r=dayjs().subtract(v,"day"),b.find(".v-table-row").remove(),$.each(s.splice(0,h),function(e,t){var a,n,o,i,s;a=$(k),(n=dayjs(t.Time)).isAfter(r)&&(a.data("item",t),a.find(".date").text(n.format("MM/DD/YY")),a.find(".time").text(n.format("h:mm a")),a.find(".note-container input").val(t.Notes||""),a.find(".preview-btn").prop("href","/version-preview/"+f+"/"+t.Id),a.find(".revert-btn").on("click",(s=function(){P.show(),d.folioVersion({data:{id:i.Id,token:f,verb:"revert"},success:function(e){c.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully reverted. You need to refresh this page.",handleOK:function(){u.raiseEvent("removeCollabs")}})},error:function(e){c.error(e.Message)}})},"Last revision before update"==(i=t).Notes?function(){c.message({heading:"Warning",message:"You are going to revert folio to older version so your collaborators would be removed.",btnText:"Go ahead",cancelText:"Cancel",handleOK:s})}:function(){P.show(),d.folioVersion({data:{id:i.Id,token:f,verb:"revert"},success:function(e){c.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully reverted. You need to refresh this page.",handleOK:function(){location.reload()}})},error:function(e){c.error(e.Message)}})})),a.find(".btn-copy").on("click",(o=t,function(){p.checkFoliosLimitReached(d,c,function(){console.log("item",o),console.log("token",f),P.show(),I(f,function(e){m.saveFolioFromSnapshot={token:f,id:o.Id,verb:"makecopy",channels:JSON.parse(e.Data),fromLocalStorage:!1},c.saveFolio()})})})),"Last revision before update"!==t.Notes&&(t.IsCurrent?g||(g=!0,a.removeClass("previous").find(".actions").text("Currently Live"),l=a):b.append(a)))}),l&&(b.find(".current").removeClass("current"),l.addClass("current"),b.find(".v-table-top").after(l)),0===s.length&&S.addClass("hidden"),F(),console.log("apphub",n),n){var e=n.loadFolioDataFromLocal();if(e){var t=dayjs(e.timestamp),a=$(k);T.find(".v-table-row").remove(),a.find(".date").text(t.format("MM/DD/YY")),a.find(".time").text(t.format("h:mm a")),a.find(".preview-btn").css({opacity:0,pointerEvents:"none"}),a.find(".note-container").css({opacity:0,pointerEvents:"none"}),a.find(".revert-btn").on("click",function(){n.loadLocalToFolio("overwrite")}),a.find(".btn-copy").on("click",function(){p.checkFoliosLimitReached(d,c,function(){console.log("token",f),P.show(),I(f,function(e){n.loadLocalToFolio("saveasacopy",JSON.parse(e.Data))})})}),T.append(a)}}}function E(e){var t='<img src="'+m.baseUrl+'/img/loader.gif" />';e?(C.removeClass("disable"),C.css("height","35px").html("Save a New Revision")):(C.addClass("disable"),C.css("height","45px").html(t))}function A(){M(),h<t&&S.removeClass("hidden"),g||b.find(".v-table-row:eq(0)").removeClass("previous").addClass("current").find(".actions").text("Currently Live"),F()}function U(){P.show(),m.plusExpireTime>=Date.now(),w.empty(),d.folioVersion({data:{token:f},success:function(e){s=JSON.parse(e.Message),t=s.length,A(),P.hide()},error:function(e){console.log("folioversion error",e),P.hide()}})}return S.click(M),x.append("<p class='plus-note'>You need <a href='https://www.xtensio.com/plus'>Xtensio Plus</a> to revert to an older version.</p>"),C.click(function(e){e.preventDefault(),E(!1),u.raiseEvent("saveCurrentRevision")}),u.addListener("doneSavingRevision",function(){E(!0),U()}),r.find(".btn-seeplans").click(function(e){e.preventDefault(),m.Team&&1===m.Team.Role&&c.universalBlocker()}),c.reg(r,l,function(){D&&$("#notify-popup").show()}),function(e,t){f=t,U();var a=app.acl.helper(e);a.planName().toString().replace("Yearly","").replace("Monthly",""),v=a.maxRetentionDays(),$("#notify-popup").is(":visible")&&($("#notify-popup").hide(),D=!0),c.show(r)}},app.popup.getStatsBlocker=function(o,i,e){var t=app.strings.popups,s=t.folioStatsMsgOwner,r=t.templateStatsMsgOwner,l=t.pleaseUpgradeAccount;return function(e){if(o.isOwner()){var t={heading:l,message:"folio"==e?s():r(),btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){i.universalBlocker()}};i.message(t)}else{var a="folio"==e?"stats":"template-stats",n=o.isPremiumGuest()?"guest":"member";i.teamUserActionBlocked(a,n)}}},app.popup.getFolioStatsPopup=function(e,n,t){var i=$("#tmp-folio-stats-popup"),s=i.find(".paper"),a=i.find(".popup-cta.cancel"),o=i.find(".icon-Close"),r=s.find(".folio-stats-section"),l=-1,d=!1;n.reg(i,a),n.reg(i,o);var c=function(e){return""==e?"never":dayjs(new Date(e+" UTC")).fromNow()};function u(e){s.find(".folio-stats-section").css({opacity:0}),i.find(".loading-animation").show(),t.getFolioDataPoints({token:e,success:function(e){null!=e.Data&&function(e){var t=JSON.parse(e),a=dayjs(new Date(t.Created+" UTC")).format("lll");r.find(".dp-created").text(a),-1<l?r.find(".dp-used").text(l).parent().show():r.find(".dp-used").parent().hide();var n=c(t.LastEdited);r.find(".dp-lastEdited").text(n);var o=c(t.LastViewed);r.find(".dp-lastViewed").text(o),r.find(".dp-edits").text(t.Edits),d?r.find(".dp-collaborators").parent().hide():r.find(".dp-collaborators").text(t.Collaborators).parent().show(),r.find(".dp-revisions").text(t.Revisions),r.find(".dp-exports").text(t.Exports),r.find(".dp-private").text(t.Private),r.find(".dp-views").text(t.Views),r.find(".dp-password").text(t.Password),setTimeout(function(){i.find(".loading-animation").hide(),s.find(".folio-stats-section").css({opacity:1})},500)}(e.Data)},error:function(e){console.log("error stats: ",e)}})}return i.find(".loading-animation").html(n.spinner),function(e,t,a){a&&(l=a.UsedCount,d=a.isTemplate),u(e),i.find(".popup-header h1").text(t),n.show(i)}},app.popup.fontUploadBlocker=function(e,t,a){var n=app.acl.helper(t).isOwner,o=app.strings.popups,i=o.pleaseUpgradeAccount,s=o.cannotPerformAction,r=o.uploadCustomFontsMsgOwner,l=o.uploadCustomFontsMsgAdmin,d=n()?"See Plans":"Ok",c=n()?"Nevermind":null,u=n()?function(){e.universalBlocker()}:null;e.push(a),e.message({heading:n()?i:s,message:n()?r:l,btnText:d,cancelText:c,notMini:!0,bodyCentered:!0,handleOK:u})},app.popup.imgUploadBlocker=function(t,a,e){var n=app.strings.popups.imgLimitHeading,o=app.acl.helper(e).imgErrorString;$("#uploading-popup").hide(),$("#toolbarContainer").find(".fr-image-progress-bar-layer.fr-error").hide(),setTimeout(function(){var e={heading:n,message:o(),bodyCentered:!0,notMini:!0};1==t.isOwner()?(e.btnText="See Plans",e.cancelText="Nevermind",e.handleOK=function(){a.universalBlocker()}):e.btnText="Ok",a.message(e)},600)},app.popup.getImportFolioPopup=function(o,t,e){var i=$("#tmp-import-folios"),a=(i.find(".paper"),i.find(".popup-header")),s=i.find(".list-of-folios"),n=i.find(".select-all"),r=i.find(".select-folios .ok"),l=i.find(".team-name"),d=[],c=!1,u=i.find(".error"),m=i.find(".confirm-move .back"),p=i.find(".confirm-move .ok"),f=i.find(".succ .ok"),h=i.find(".icon-Close"),g=i.find(".confirm-move .team-url"),v=i.find(".loading-animation");v.html(t.spinner),n.click(function(){$(this).hasClass("selected")?($(this).removeClass("selected"),s.find(".select").removeClass("selected")):($(this).addClass("selected"),s.find(".select").addClass("selected"))});var b=function(e){u.text(e).show("slow"),setTimeout(function(){u.hide("slow")},3e3)};r.click(function(){if(d=[],c){if($moveables=s.find(".selected"),$moveables.length<1)return void b("Please Select a Folio to move.");for(var e=0;e<$moveables.length;e++)d.push($moveables[e].getAttribute("data-token"));console.log(d),a.find("h3 .number").text(d.length),a.find("h3 .verb").text(1<d.length?"folios":"folio"),g.attr("href","https://"+o.Team.TeamUrl).text(o.Team.TeamUrl),T("confirmation")}else t.close()}),m.click(function(){T("")}),p.click(function(){v.show(),e.moveUserFolios({userEmail:o.userEmail,source:0,destination:o.Team.Id,folios:d,success:function(e){i.find(".succ .message").text(e.Message),v.hide(),T("complete"),$("#folio-items-container").find(".empty").remove(),$("#folio-items-container").find(".my-empty").remove()},error:function(e){b(e.Message),v.hide()}})}),f.click(function(){window.location=o.baseUrl});var T=function(e){i.removeClass("no-folio"),i.removeClass("complete"),i.removeClass("confirmation"),i.addClass(e)};return t.reg(i,i.find(".icon-Close, .cancel, .succ .ok")),h.click(function(){window.location=o.baseUrl}),function(){T(""),console.log(l,o.Team.Name),l.text(o.Team.Name),v.show(),t.show(i),e.getUserOwnFolios({success:function(e){s.empty();var t=JSON.parse(e.Data);if(0<t.length){c=!0,console.log("folio list",t);for(var a=0;a<t.length;a++){var n='<a href="#" class="select" data-token="'+t[a].Token+'"><span class="check"></span><span class="name">'+t[a].FolioName+"</span></a>";s.append(n),s.find(".select:last-child").click(function(e){$(this).toggleClass("selected"),e.preventDefault()})}r.text("Move to "+o.Team.Name)}else c=!1,T("no-folio"),i.find(".msg .cancel").text("Cancel");v.hide()},error:function(e){v.hide()}})}},app.popup.getLabelsPopup=function(r,l,d,c,e,t){var u,m,o,s,p,f,h=$("#tmp-label-item").html(),g=($("#all-labels-container"),$("#single-label").html(),$(".labels-dropdown"),$("#tmp-labels")),v=g.find(".labels"),b=$(".changes-applied"),T=$(".add-missing-label"),a=g.find(".loading-animation"),i=!1,y="";function C(){if(b.addClass("hidden"),r.Team&&0<r.Team.Id)c.changeCollabChan({token:u.Token,labelToken:y,success:function(){b.removeClass("hidden"),m(),setTimeout(function(){b.addClass("hidden")},3e3)},error:function(e){l.error(e.Message)},complete:function(){x(!0)}});else{var e=u.Labels.join();e!=u.lastSaved&&(u.lastSaved=e,c.changeLabels({token:u.Token,list:e,success:function(){b.removeClass("hidden"),m(),setTimeout(function(){b.addClass("hidden")},3e3)},error:function(e){l.error(e.Message)},complete:function(){x(!0)}}))}}function k(e,t){b.addClass("hidden");var a={token:u.Token,id:e,success:function(){!function(e){d.removeFromList(u.Labels,e);for(var t=0;t<r.folios.length;t++)if(r.folios[t].Token==u.Token){d.removeFromList(r.folios[t].Labels,e);break}}(e),b.removeClass("hidden"),m(),setTimeout(function(){b.addClass("hidden")},3e3)},error:function(e){l.error(e.Message)},complete:function(){x(!0)}};if(r.Team&&0<r.Team.Id){console.log("folio",u);var n,o,i,s=_.findIndex(r.labels,["Token",e]);if(0<=s?n=r.labels[s]:console.log("WARN DEV: token "+e+" not found on config.labels"),!u.IsCurrentUserOwner&&0<=s&&(2==n.AccessType||1==n.AccessType&&0<n.ChannelMembers.length))l.push(g),t.prop("checked",!0),console.log("id",s),console.log("labelID",e),x(!0),2==n.AccessType&&u.UserEmail!=r.userEmail?(o="Are you sure you want to remove this<br>folio from the shared channel?",i="Removing the folio will revoke your editing access. The folio will go back to the owner's default channel and all collaborators will be removed."):(2==n.AccessType||1==n.AccessType&&0<n.ChannelMembers.length)&&(o="Do you really want to remove this folio?",i="Removing the folio from <b>"+n.Name+"</b> will remove all channel collaborators. Collaborators added at the folio level will still have access and the folio will return to <b>"+u.UserFullName+"'s</b> default channel."),l.message({heading:o,message:i,btnText:"Yes, remove the folio",cancelText:"Nevermind",notMini:!0,bodyCentered:!0,handleOK:function(){x(!1),t.prop("checked",!1),p.removeClass(d.removeFromList(u.Labels,e)),c.removeFromCollabChan(a)}});else c.removeFromCollabChan(a)}else c.removeFromLabels(a)}a.html(l.spinner),v.on("click",".label-check",function(e){if(!i){var t=$(this);x(!1),clearTimeout(o);var a=$(this),n=a.data("id");n,a[0].checked?(d.pushUnique(u.Labels,n),y=n,o=setTimeout(C,800)):k(currentRemovedChannel=n,t)}});var w=function(e){if(13!=(e.which||e.keyCode)){var t=$.trim($(this).val()).replace(/ +/g," ").toLowerCase();s.show().filter(function(){return!~$(this).text().replace(/\s+/g," ").toLowerCase().indexOf(t)}).hide().length==s.length?(T.removeClass("hidden").find("span").text($(this).val()),v.hide()):(T.addClass("hidden"),v.show())}else T.click()};function x(e){i=!e,e?(a.hide(),v.removeClass("disable-ui")):(a.show(),v.addClass("disable-ui"))}function P(){v.empty().hide();for(var e=null,t=0;t<r.labels.length;t++){var a=r.labels[t],n=$(h),o=n.find(".label-check").data("id",a.Token);if(console.log("item token",a.Token),f===a.Token&&(e=o,f=null),n.find(".label-name").css("background-color",a.color).text(a.Name),u&&u.Labels){var i=d.indexOf(u.Labels,a.Token);0<=i?o[0].checked=!0:console.log("WARN DEV: index = "+i+" token "+a.Token+" not found on folio.Labels")}v.append(n)}s=v.find("label"),$("#labels-search").keyup(w).val(""),T.on("click",function(){$(this).off("click"),$("#add-label-from-popup").data("suggestedName",$(this).find("span").text()).click()}).addClass("hidden"),v.show(),null!==e&&(e.click(),e=null)}return $("#add-label-from-popup").on("click",function(){if(r.Team&&0<r.Team.Id){if(5===r.Team.Role||4===r.Team.Role)return void l.teamUserActionBlocked("label");l.teamChannelPopup({openLabelsPopupOnClose:!0})}else l.personalChannelPopup(function(){window.location.reload()});return!1}),e.addListener("refreshLabelData",function(){return P()}),l.reg(g,g.find(".icon-Close")),function(e,t,a,n,o){f=o,!0!==n?r.Team&&0<r.Team.Id&&5==r.Team.Role?l.teamUserActionBlocked("label"):(p=t,m=a,(u=e).lastSaved=u.Labels.join(),P(),l.show(g)):l.show(g)}},app.popup.linkShareBlocker=function(e,t,a,n){var o=app.strings.popups,i=o.changeLinkToPrivateMsgOwner,s=o.changeLinkToPublicMsgOwner,r=o.pleaseUpgradeAccount,l=app.acl.helper(n),d=l.isOwner,c=(0,l.getMainPlanName)(),u=t.isLabel?"channel":t.IsUserTemplate||t.IsTeamTemplate?"template":"folio";if(d()){var m={notMini:!0,bodyCentered:!0,btnText:"See Plans",cancelText:"Nevermind",handleOK:function(){a.universalBlocker()},heading:r,message:t.Private?s(u,c):i(u,c)};a.push(e),a.message(m)}else a.teamUserActionBlocked(t.Private?"new-folio-private":"new-folio-public",u,function(){return a.show(e)})},app.popup.getMessage=function(n,o){var t,a,i,s,r,l,d,c,u,m,p,f,h,g,v,b,T,y=$("#tmp-message"),C=!1,k=y.find("h1"),w=y.find(".msg"),x=y.find(".text-area"),P=y.find(".input").not("#valid-popup-ok"),S=y.find(".ok"),D=y.find(".no"),F=y.find(".popup-content"),I=y.find(".icon-Close"),M=y.find(".cta-btns"),E=!1,A=$(".nav-main-menu a").not("a.help-center, a.examples-link");return $(".popup-validation-message").removeClass("error"),S.on("click",function(){if(T){if(!T())return $(".popup-validation-message").addClass("error").html(v),!1;$(".popup-validation-message").removeClass("error")}if(r){var e=!0,t=P.val(),a=x.val();g&&!t?w.addClass("error").html(g):"email"==p?(e=validator.isEmail(t))||w.addClass("error").html("Invalid email. Please provide a valid email address."):"url"===p&&(e=o.isValidURL(t),console.log("isValid",e),e||w.addClass("error").html("Invalid url. Please provide a valid url.")),e&&(n.close(),f&&n.busy(),r(t,a))}else n.close();return!!c}),n.reg(y,D.add(I),0,function(e){C&&13==(e.keyCode||e.which)&&S.click()}),D.click(function(){l&&l()}),I.click(function(){l&&l(),n.close()}),w.on("click",".popup-template-link",function(e){e.preventDefault();var t="a."+$(this).data("type");console.log("tempType",t),A.filter(":eq(1)").trigger("click"),t&&setTimeout(function(){$("#top-bar .template-subnav "+t).trigger("click"),n.close()},600)}),function(e){t=e.heading,a=e.message||"",i=e.input,s=e.btnText||"Save",h=e.showArea,r=e.handleOK,T=e.beforeHandle,d=e.cancelText,c=e.url,u=!!e.noClose,p=e.validateFor,f=e.showBusy,l=e.handleNo,m=e.showInput||i,C=e.enterAsOK,e.defaultInputValue,g=e.emptyError,v=e.validationError,e.handleError,b=e.notMini,E=e.bodyCentered,S.addClass(e.okClass),e.isSwitchCta?M.addClass("is-switch"):M.removeClass("is-switch"),P.attr("placeholder",e.inputPlaceholder||""),x.val(e.areaText||"").attr({rows:e.rows||3,placeholder:e.areaPlaceholder||"Message (Optional)"}),y.attr("class","app-popup "+(e.namespace||"")),y.toggleClass("no-close",u),k.html(t),D.toggleClass("hidden",!d&&!l).text(d),I.toggleClass("hidden",u),P.toggleClass("hidden",!m).val(i),S.text(s).attr("href",c||"#"),w.removeClass("error").html(a),E&&w.addClass("text-center"),x.toggleClass("hidden",!h),F.toggleClass("mini",!b),n.show(y)}},app.popup.moveToTeamTemplatesBlocker=function(d,c,u){return function(){var e=app.strings.popups,t=e.saveteamTemplateMsgOwner,a=e.saveteamTemplateMsgMember,n=e.pleaseUpgradeAccount,o=e.cannotPerformAction,i=app.acl.helper(c),s=i.teamTemplatesAllowed,r=i.isOwner;if(!s()){var l={heading:r()?n:o,message:r()?t:a,btnText:r()?"See Plans":"Ok",bodyCentered:!0,notMini:!0};r()&&(l=_objectSpread({},l,{cancelText:"Nevermind",handleOK:function(){d.universalBlocker()}})),u&&d.push(u),d.message(l)}}},app.popup.getPlanExpireBlocker=function(s,r,o,t,l){var d=$("#tmp-plan-expire-blocker-popup"),a=d.find(".loading-animation"),e=(d.find(".paper"),d.find(".upgrade")),c=(d.find(".success-panel"),s.Plan),n=d.find(".downgrade"),u=a.html(r.spinner);return e.click(function(){r.push(d),r.billing(1,!1)}),n.click(function(){if(!t.isTeamPlan()||!s.IsDelinquent)return u.show(),r.push(d),t.getData(1,function(e,t,a,n){o.getUserActiveFoliosCount({success:function(e){var i=e.Data;o.getUserTemplateCount({success:function(e){var t,a,n=e.Data,o=1<i||0<n;if(o&&(1<i&&n<1?(t="Uh oh - You have more than 1 folio!",a="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard."):1<i&&0<n?(t="Uh oh - You have more than 1 folio and saved templates",a="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):i<2&&0<n&&(t="Uh oh - You have saved templates!",a="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.")),u.hide(),o)setTimeout(function(){$("#tmp-downgrade-bar").show(),$("#tmp-downgrade-bar .downgrade-bar").show()},1e3),r.message({heading:t,message:a,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){r.close()}});else{2==c?"Pro":1==c&&"Plus",r.push(d),r.message({heading:'<span style="font-size: 26px;">Are you sure you want to downgrade to the free plan?</span>',message:"You will be downgraded to Free Forever plan and will be limited to 1 active folio.<br><br>Are you sure you want to change your current plan?",btnText:"Yes, Downgrade to Free Forever",cancelText:"Nevermind",notMini:!0,handleOK:function(){u.hide(),l.raiseEvent("plusCancelled"),r.message({heading:'<h1 class="emphasize">Downgrade Successful</h1>',message:'<h3>Current Plan: <span class="prox-bold">Xtensio Free Forever</span></h3>',btnText:"Ok",notMini:!0,handleOK:function(){r.close(),window.location=s.baseUrl}})}})}},error:function(){}})},error:function(e){console.log("error: ",e)}})}),!1}),r.reg(d,d.find(".close-popup-btn, .no")),function(e){e&&e.limit&&e.currUser&&(d.find(".left .plan").text(e.currUser),d.find(".left .limit").text(e.limit)),t.isTeamPlan()&&s.IsDelinquent,a.hide(),r.show(d)}},app.popup.getPlusInfo=function(e,t,a,n,o){var i=$(e.spinner),s=$("#tmp-xtensio-plus"),r=s.find(".icon-Close"),l=(s.find(".ends-text"),s.find(".earned"),s.find(".percent-inner"),s.find(".joined"),s.find("input"));s.find(".unlock-head");return l.val(t.sharePlusLink).copier(),s.find(".loading-animation").append(i),$.socialLinks(t.sharePlusLink,s,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),s.find(".invite-link").attr("href",t.sharePlusLink),e.reg(s,r),s.find(".upgrade-btn").click(function(){e.universalBlocker()}),function(){e.message({heading:"Sorry",message:"This campaign is no longer available.",btnText:"OK"})}},app.popup.getPlusPrompt=function(r,l,d){l.plusInfo?l.plusExpireTime=l.plusInfo.End:l.plusExpireTime=Date.now();var c=$("#tmp-plus-prompt"),u=c.find(".msg");return c.find(".upgrade-panel").html(r.upgrade),c.find(".invite-link").val(l.sharePlusLink).copier(),$.socialLinks(l.sharePlusLink,c,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),r.reg(c,c.find(".icon-Close")),c.find(".ok").click(function(){r.payment()}),function(e,o,t,a){var n=Date.now();if("pass"==e)d.getData(1,function(e,t,a,n){t?10==e.ST||11==e.ST||3==e.ST||16==e.ST?r.billing():o():r.payment()});else if((l.autoRenew||n<l.plusExpireTime)&&o)o();else{if(t)return void("create"==e||r.payment());if(a)return void r.billing();var i='Unlock <a class="x-plus" target="_blank" href="//xtensio.com/plus">Xtensio Plus</a> ',s="Xtensio Plus allows you to export your folio as PDF or PNG";u.show(),"export"==e?i+="to export this folio":"export-mod"==e?i+="to export this module":"export-sec"==e?i+="to export this section":"pass"==e?(i+="for password protection",s="Xtensio Plus enables you to password protect any of your folios"):"create"==e?(i+="to create more folios",s="With a free account, you're limited to 1 folio"):(i+="to access this feature",u.hide()),c.find("h1").html(i),c.find(".desc").text(s),r.show(c)}}},app.popup.saveCustomTemplateBlocker=function(e,t){var a=app.acl.helper(t),n=a.isOwner,o=a.isPremiumGuest,i=app.strings.popups,s=i.pleaseUpgradeAccount,r=i.saveCustomTemplatesMsgOwner;n()?e.message({heading:s,message:r,btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){e.universalBlocker()}}):e.teamUserActionBlocked("save-as-template",o()?"Guests":"Member")},app.popup.getSaveFolio=function(f,h,g,v,e,n){var r,b,T,y,C,k,w,x,P,S,i,D=$("#tmp-save-folio"),F=!1,I=D.find(".loading-animation").html(h.spinner),d=D.find(".popup-close"),a=D.find(".changes-applied"),M=$("#folio_name"),t=($("#collab-cont"),$("#collab-list"),$(".collabs"),D.find(".add-new"),D.find(".add-btn"),D.find(".team-add")),o=$("#collab"),E=[],s=[],c={Token:null,Collaborators:[]},u=$("#channels"),A=D.find(".save-folio"),l=app.plugin.lockedTip(f,e),m=app.core.padlocks(n,l,f,e),p=($("#all-labels-container"),$(".channels-fgroup .icon-Down-Arrow")),U=app.acl.helper(f);function N(e,t){var a,n,o=(a=t,n=f.baseUrl,k&&void 0!==k.baseUrl&&""!==k.baseUrl&&f.Team&&0<f.Team.Id&&a===f.Team.Id&&(n=k.baseUrl),x&&void 0!==x.TeamUrl&&""!==x.TeamUrl&&(n=x.TeamUrl),n);1==i?window.location.href=o:window.location=o+"/edit/"+e,f.editMode&&!isDuplicate&&setTimeout(function(){window.location.reload()},300)}function L(e,t){var a=f.signUpFromFolio?f.folios[0].Token:e.Message;0<s.length?addNewTeamCollaborators(a):N(a,t),f.saveFolioSuccess={Result:!0},console.log("saveFolioSuccess",f.saveFolioSuccess)}t.find(".r3").click(function(){5==f.Team.Role&&(D.find(".popup-header h1.am-h .mem").text("Free Guest "),t.find(".add-single-folio-guest").trigger("click"))}),$(".fgroup").on("click","div.selectize-input div.item",function(e){var t=D.find(".selectize-input.has-items").children(".item").length;if(console.log("channel items number",t),1<t){r[0].selectize;var a=$(this).attr("data-value");r[0].selectize.removeItem(a),r[0].selectize.refreshItems(),r[0].selectize.refreshOptions()}else O("A Folio must be included in at least one channel. Add a different channel if you want to remove this one.","error"),console.log("need to have at least 1")}),A.click(function(e){if(!F){I.show(),F=!0,A.addClass("disable");var t=v.sanitizeText(M.val().trim()),a=[],n=[],o=null,i=$(".folio-private"),s=!i.is(":checked"),r=i.is(":checked");if(M.val(t),t.length<3)return O("Folio names must be at least three characters long.<br>Please provide a valid folio name.","error"),void A.removeClass("disable");if(!$('.folio-see input[type="checkbox"]').is(":checked"))return O("Please select this folio's privacy access to continue.","error"),void A.removeClass("disable");if(D.find(".selectize-input.has-items").children(".item").each(function(){var e=g.findIndex($(this).data("value"),"name",S);-1!==e&&(a.push(S[e]),n.push(S[e].token))}),P)P.fromLocalStorage?v.makeFolioFromSnapshot({data:P.data,token:P.token,verb:P.verb,channels:JSON.stringify(n),name:t,success:function(e){console.log("makeFolioFromSnapshot res",e),e&&e.Message?(console.log("folioVersion response",e),window.location.href=f.baseUrl+"/edit/"+e.Message):h.error("Folio token not found")},error:function(e){console.log("makeFolioFromSnapshot error",e),h.error(e.Message)}}):v.folioVersion({data:{id:P.id,token:P.token,verb:P.verb,channels:JSON.stringify(n),name:t},success:function(e){e&&e.Message?(console.log("folioVersion response",e),window.location.href=f.baseUrl+"/edit/"+e.Message):h.error("Folio token not found")},error:function(e){console.log("folioVersion error",err),h.error(err.Message)}});else{var l=null;C?l=C.Token:k?l=k.Token:x?l=x.Token:b?l=b.Token:w&&(l=w.Token),!l&&f.token&&(l=f.token);var d=!1;C&&null!==C.isUseTemplate?d=C.isUseTemplate:w&&null!==w.isUseTemplate&&(d=w.isUseTemplate);var c=!1;b&&null!==b.IsDuplicate&&(c=b.IsDuplicate);var u=0;if(x&&void 0!==x.TeamID)console.log("saveFolio saveFolioCollabItem.TeamID:::",x.TeamID),u=x.TeamID;else if(w&&void 0!==w.teamId)u=w.teamId;else if(f.signUpFromFolio){l=f.folios[0].Token,v.renameFoliowithPrivacySettings({token:l,name:t,isPrivate:r,isIndexed:s,success:L,error:function(e){I.hide(),A.removeClass("disable"),O(e.Message,"error"),f.saveFolioSuccess={Result:!0}}})}else if(f.Team&&0<f.Team.Id&&0<f.UserTeams.length){var m=g.findIndex(f.Team.Id,"Id",f.UserTeams);console.log("teamIdIndex",m),-1<m&&(u=f.Team.Id)}y&&(o=y.id),T&&(o=T.id);var p={teamId:u,folioToken:l,templateId:o,isUserTemplate:d,isDuplicate:c,IsIndexed:s,IsPrivate:r,data:{folioName:t,collaborators:E,channels:a,newChannels:[]},success:function(e){L(e,u)},error:function(e){I.hide(),A.removeClass("disable"),O(e.Message,"error"),f.saveFolioSuccess={Result:!0}}};v.saveFolio(p)}}});function O(e,t){t=t||"success",I.hide(),a.removeClass("hidden success error").addClass(t).html(e),setTimeout(function(){a.addClass("hidden"),F=!1},3e3)}function R(e){return"Untitled ("+e+")"}function B(e){var a=[],t=[],n=$('<div class="selectize-custom-err"><div class="custom-msg">Channel does not exist.</div></div>');if(e){e.forEach(function(e,t){a.push({id:e.ID||null,name:e.Name,color:e.color||("#FFFFFF"!==f.colors[t]?f.colors[t]:"#1abad3"),IsDefault:e.IsDefault,token:e.Token||e.LabelToken})});var o=g.findIndex(!0,"IsDefault",e);if(console.log("defIndex",o),P)e.forEach(function(e){e.Existing&&t.push(e.Name)});else{var i=$("#all-labels-container").find(".item.active").data("name")||"";if(console.log("currentActiveChannel",i),""===i)-1!==o&&t.push(e[o].Name);else{var s=a.find(function(e){return e.token===i});s&&t.push(s.name)}}}S=a,console.log("channelsData",S),1===S.length?p.hide():p.show(),r=u.selectize({maxItems:null,valueField:"name",labelField:"name",searchField:"name",options:a,render:{item:function(e,t){return'<div class="item" '+(e.color?'style="background-color:'+e.color+'"':"")+">#"+t(e.name)+'<i class="fa fa-times" aria-hidden="true"></i></div>'},option:function(e,t){return'<div class="item" >'+t(e.name)+"<button>Add</button></div>"}},items:t,create:!1,disableDelete:!0,onDropdownOpen:function(e){p.addClass("selectize-channel-dropdown-open")},onDropdownClose:function(e){p.removeClass("selectize-channel-dropdown-open")},onType:function(e){D.find(".selectize-control .selectize-custom-err").hide(),clearTimeout(void 0),3<=e.toString().length&&(this.currentResults.items.length||(clearTimeout(void 0),D.find(".selectize-control .selectize-custom-err").show(),hideInterval=setTimeout(function(){D.find(".selectize-control .selectize-custom-err").hide()},3e3)))}}),D.find(".selectize-control").append(n)}function _(e){m.setNewFolioLock(e),$('.folio-see input[type="checkbox"]').off().on("click",function(){!(0,U.privateLinksAllowed)()&&$(this).hasClass("folio-private")&&($(this).prop("checked",!1),app.popup.linkShareBlocker(D,c,h,f)),$(this).is(":checked")&&$(this).parent().siblings(".checkbox-desc").find("input").prop("checked",!1)})}return p.click(function(){var e=$(this);e.toggleClass("selectize-channel-dropdown-open"),!1===e.hasClass("selectize-channel-dropdown-open")&&u.find("+ .selectize-control .selectize-input").click()}),h.reg(D,d),function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=2<arguments.length?arguments[2]:void 0;i=a;var l=t.fromTemplate;if(E=[],1===e)return E=_toConsumableArray(t.teamUsersList),s=_toConsumableArray(t.newTeamUsersList),c.Collaborators=E,populateCollabList(),void h.show(D);f.saveFolioEditPreview||_(),D.find(".icon-Close").css({top:"15px"}),I.hide(),A.removeClass("disable"),M.removeClass("disable"),o.removeClass("disable"),M.val("Untitled"),console.log("config.signUpFromFolio ",f.signUpFromFolio),f.signUpFromFolio?(console.log("in add class 1"),$("#tmp-save-folio").addClass("no-close")):$("#tmp-save-folio").removeClass("no-close"),r&&($(".fgroup").find("div.selectize-input div.item").each(function(){var e=$(this).attr("data-value");r[0].selectize.removeItem(e)}),r[0].selectize.refreshItems(),r[0].selectize.refreshOptions()),u.selectize()[0].selectize.destroy(),D.find(".custom-check").prop("checked",!1),f.userEmail?g.standardizeEmail(f.userEmail):f.userName&&g.standardizeEmail(f.userName),U.isFreePlan()||"Basic"===U.getMainPlanName()||($(".folio-see").hide(),$(".custom-check.folio-private").prop("checked",!0)),n.getData(1,function(e,t,a,n){if(console.log("data.ST",e&&e.ST),console.log("!!config.saveFolioTransferItem ",!!f.saveFolioTransferItem),console.log("config.saveFolioTransferItem ",f.saveFolioTransferItem),console.log("config.saveFolioTemplate ",f.saveFolioTemplate),!e||14!==e.ST&&19!==e.ST||!0,0<f.Team.Id&&4!==f.Team.Role&&5!==f.Team.Role&&!0,console.log("config ",f),f.saveFolioTemplate)console.log("using config for xtensio template flow"),M.val(R(f.saveFolioTemplate.name)),T=f.saveFolioTemplate,f.saveFolioTemplate=null,B(f.labels);else if(f.saveFolioExample)console.log("using config for xtensio example flow"),M.val(R(f.saveFolioExample.name)),y=f.saveFolioExample,f.saveFolioExample=null,B(f.labels);else if(f.saveFolioTransferItem){console.log("using config for transfer folio or user template");var o=(C=f.saveFolioTransferItem).FolioName?C.FolioName:C.Folio;M.val(o),l||(D.addClass("no-close"),d.hide()),B(C.labels?C.labels:f.labels),f.saveFolioTransferItem=null}else if(f.saveFolioTransferWithTeam)console.log("using config for transfer folio with team context"),k=f.saveFolioTransferWithTeam,M.val(k.FolioName),B(k.labels);else if(f.saveFolioEditPreview){if(console.log("using config for edit folio on preview"),w=f.saveFolioEditPreview,M.val(w.FolioName),B(w.labels),w&&void 0!==w.teamId&&(!1,0<w.teamId)){var i=g.findIndex(w.teamId,"Id",f.UserTeams);if(-1!==i){var s=f.UserTeams[i];4!==s.Role&&5!==s.Role&&!0,_(s)}}}else f.sfgButtonClicked?(sfgButtonClicked=f.sfgButtonClicked,f.sfgButtonClicked=null,B(f.labels)):f.saveFolioCollabItem?(console.log("using config for collaboration request"),x=f.saveFolioCollabItem,M.val(x.FolioName),B(x.labels),d.click(function(){window.location="/"}),console.log("in close 2"),D.addClass("no-close")):f.duplicateFolioItem?(console.log("using config for duplicate folio."),b=f.duplicateFolioItem,M.val(b.FolioName),B(f.labels)):f.saveFolioFromSnapshot?(console.log("using config for save folio from snapshot."),P=f.saveFolioFromSnapshot,M.val($("#tmp-primary-bar input.folio-name").val()||""),P.labels=f.saveFolioFromSnapshot.channels,B(P.labels)):f.signUpFromFolio&&(console.log("using config for when signing up from example/template."),M.val(f.folios[0].FolioName),B(f.labels));var r=M.val();P&&(r+=" - Copy From Revision"),M.val(r.toString().replace(" - Template","")),F=!1,h.show(D),g.doSetFocus(M)},!0)}},app.popup.getShareLink=function(c,u,m,p,e,t,r,l){var f,h,d,g,v=app.acl.helper(m),b={},i=!1,T=$("#tmp-popup-folio-share-link"),s=T.find(".copy-field"),y=T.find(".copy-field.folio-link"),C=T.find(".embed-url").copier(),k=T.find(".popup-content"),a=T.find(".tabs > span"),n=T.find(".tab"),o=T.find(".button-bg"),w=o.find(".button-out"),x=o.find(".button-in"),P=T.find(".msg-content").hide(),S=T.find(".email-link"),D=P.find(".close-msg-btn"),F=P.find(".email-msg").val(""),I=T.find(".add-msg"),M=T.find(".input-pass-dot"),E=(T.find(".input-pass-visible"),T.find(".icon-Preview"),T.find(".send-email")),A=T.find(".btn-save-pass"),U=T.find(".pass-section"),N=U.find(".error"),L=T.find(".busy .msg"),O=(T.find(".loading-animation").html(u.spinner),T.find(".pass-protect")),R=T.find(".change-indexed"),B=T.find(".change-present"),_=T.find(".email-result"),G=T.find("h1"),H=$("#spinner-container > .loading-animation").clone().addClass("size-30"),Y=T.find(".share-url-desc-up.desc-btn"),j=T.find(".label-footer"),z=T.find(".labelnam"),q=j.find(".save-label-detail"),V=j.find(".no"),K=(T.find(".header-desc"),T.find(".preview")),J=T.find(".btn-edit-link"),W=T.find(".btn-default-link"),X=T.find(".edit-mode"),Z=T.find(".view-mode"),Q=T.find(".edit-field"),ee=T.find(".btn-cancel"),te=T.find(".btn-save-link"),ae=T.find(".btn-copy-link"),ne=T.find(".error-messge"),oe=T.find(".error"),ie=T.find(".add-people"),se=T.find(".collabs"),re=$("#templates-items-container"),le="",de=0,ce=370,ue=app.core.padlocks(p,e,m,t),me=386,pe='\'var _self=this;this.contentWindow.postMessage("requestDocHeight", "'+l.getLocationOrigin()+'");window.addEventListener("message", function(event){console.log("message received by parent ",event);_self.style.height=event.data+"px";}, false);\'',fe='width="100%" height="100%" style="border:none;min-height: 100vh;"',he="embed=iframe";$(".input-pass").xpassword({preview:!0,previewFontClass:"icon-Preview"}),y.on("click",function(){window.open(y.val(),"_blank")}),t.addListener("plusUnlocked",function(){console.log("setShareFolioLinkLock called from plusUnlocked"),ue.setShareFolioLinkLock(b,g)}),t.addListener("plusCancelled",function(){console.log("setShareFolioLinkLock called from plusCancelled"),ue.setShareFolioLinkLock(b,g)}),q.click(function(){ve("Saving"),b.Title=$.trim(T.find(".title").val()),b.Description=$.trim(T.find(".desc").val()),c.changeLabelProps(b,{success:function(){q.find("i").removeClass("hidden"),q.find("span").text("Saved"),V.text("Close"),setTimeout(function(){q.find("i").addClass("hidden"),q.find("span").text("Save"),V.click()},2e3)},error:function(e){u.error(e.Message)},complete:function(){ve()}})});var ge=function(){var e="Link Sharing is ".concat(b.Private?"Off":"On");b.isLabel?(G.text("Link Sharing"),o.attr("title",e),b.Private?(w.text(""),x.text("Off")):(w.text("On"),x.text("")),T.find(".title").val(""==b.Title||null==b.Title||null==b.Title?b.Name:b.Title)):(G.text(e),o.attr("title",e),T.find(".title").val(b.Title)),T.find(".desc").val(b.Description)};A.find(".loading-animation").html(u.spinner);var ve=function(e){i=!!e,L.text(e),k.toggleClass("busy",i)},be=function(){c.updatePrivacy(b,{success:function(){},error:function(e){u.error(e.Message)},complete:function(){ve(),k.toggleClass("private",b.Private),re.find(".folio-item[data-token="+b.Token+"] .link-share-cont span").text(b.Private?"Off":"On"),Ie(),R.prop("checked",!b.Indexed),b.isLabel||xe()}})};function Te(){u.show(T),ve("Restoring default url"),c.removeFoliosCurl({data:{token:b.Token},success:function(e){le=b.Token,r.folioStorage(b.Token).store("curl",le),Fe(),De(),Q.val(le),ve()},error:function(e){u.error(e.Message),ve()}})}function ye(){u.show(T)}function Ce(){b.Indexed=!1,R.prop("checked",!b.Indexed),R.closest("label").addClass("disable")}function ke(e){a.removeClass("selected"),n.removeClass("selected").filter(":eq("+e+")").addClass("selected"),a.filter(":eq("+e+")").addClass("selected")}W.on("click",function(e){e.preventDefault(),u.message({heading:"Restore to Default",message:"You are about to restore the default url for this folio.",btnText:"Go ahead",cancelText:"Cancel",handleOK:Te,handleNo:ye})}),o.on("click",function(){var e=v.privateLinksAllowed,t=b.Private?"public.":"private.";e()?(b.IsUserTemplate||b.IsTeamTemplate?ve("Making template ".concat(t)):b.isLabel?ve("Making channel ".concat(t)):ve("Making folio ".concat(t)),b.Private=!b.Private,b.Private&&(b.Indexed=!1),be(),ge()):p.isSingleFolioGuest()?u.teamUserActionBlocked("link"):app.popup.linkShareBlocker(T,b,u,m)}),R.on("click",function(){if(!(0,v.privateLinksAllowed)())return p.isSingleFolioGuest()?(R.prop("checked",!b.Indexed),u.push(T),void u.teamUserActionBlocked("link")):(R.prop("checked",!b.Indexed),void app.popup.linkShareBlocker(T,b,u,m));b.Indexed=!$(this).is(":checked"),be()}),B.on("click",function(){if(p.isSingleFolioGuest())return B.prop("checked",b.PresentationMode),u.push(T),void u.teamUserActionBlocked("link");var e=b.PresentationMode=$(this).is(":checked");c.changePresentMode({token:b.Token,present:e,error:function(e){u.error(e.Message)}})}),O.on("click",function(){var e,t,a,n,o,i,s=v.passwordProtectionAllowed,r=null!=f?f:p.isFolioOwner(m.userEmail,b),l=3<m.Team.Role,d=$(this);if(u.push(T),N.hide(),m.Team&&m.Team.Id){if(!s())return e=app.strings.popups,t=e.passwordProtectionMsgOwner,a=e.pleaseUpgradeAccount,n=v.passwordProtectionAllowed,o=v.isOwner,i=null!=f?f:p.isFolioOwner(m.userEmail,b),void(n()?i||u.teamUserActionBlocked("password-protect-biz",h):o()?(popupOpts={notMini:!0,bodyCentered:!0,btnText:"See Plans",cancelText:"Nevermind",handleOK:function(){u.universalBlocker()},heading:a,message:t},u.push(T),u.message(popupOpts)):u.teamUserActionBlocked("password-protect"));if(5===m.Team.Role)return void u.teamUserActionBlocked("link")}0<m.Team.Id&&!l&&b.IsTeamTemplate?(u.pop(),U.show(),ve("Removing folio password."),c.removeObjPass({isLabel:b.isLabel,token:b.Token,success:function(){d.toggleClass("selected"),b.HasPass=!1,T.find(".input-pass-dot").val(""),p.isSingleFolioGuest()&&O.removeClass("selected"),d.hasClass("selected")?U.show():U.hide(),R.closest("label").removeClass("disable")},error:function(e){u.push(T),u.error(e.Message)},complete:function(){ve()}})):(u.pop(),r?(U.show(),ve("Removing folio password."),c.removeObjPass({isLabel:b.isLabel,token:b.Token,success:function(){d.toggleClass("selected"),b.HasPass=!1,T.find(".input-pass-dot").val(""),d.hasClass("locked")&&O.removeClass("selected"),d.hasClass("selected")?U.show():U.hide()},error:function(e){u.push(T),u.message({heading:"Oops!",message:e.Message,btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){u.universalBlocker()}})},complete:function(){ve()}})):u.teamUserActionBlocked("password-protect-biz",h))}),A.click(function(){var e=app.strings.popups.passwordProtectionMsgNotOwner,t=null!=f?"channel":"folio",a=p.isFolioOwner(m.userEmail,b),n=3<m.Team.Role;u.push(T);var o=T.find(".input-pass-dot").val();o?(N.hide(),0<m.Team.Id&&0<m.Team.Role&&b.IsTeamTemplate&&!n?(u.pop(),A.find(".loading-animation").removeClass("hidden"),A.find("span").text("Saving"),c.setObjPass({isLabel:b.isLabel,token:b.Token,pass:o,success:function(){b.HasPass=!0,Ce()},error:function(e){u.push(T),u.error(e.Message)},complete:function(){A.find(".loading-animation").addClass("hidden"),A.find("img").removeClass("hidden"),A.find("span").text("Saved"),setTimeout(function(){A.find("img").addClass("hidden"),A.find("span").text("Save")},3e3)}})):a?(A.find(".loading-animation").removeClass("hidden"),A.find("span").text("Saving"),c.setObjPass({isLabel:b.isLabel,token:b.Token,pass:o,success:function(){b.HasPass=!0,Ce()},error:function(e){u.push(T),u.error(e.Message)},complete:function(){A.find(".loading-animation").addClass("hidden"),A.find("img").removeClass("hidden"),A.find("span").text("Saved"),setTimeout(function(){A.find("img").addClass("hidden"),A.find("span").text("Save")},3e3)}})):u.error(e(t))):N.show()}),I.on("click",function(){P.show(),I.hide()}),D.on("click",function(){P.hide(),F.val(""),I.show()}),a.on("click",function(){ke($(this).index()),b.isLabel&&(j.hide(),Y.removeClass("hideLabel"))}),E.click(function(){if(!i){var e=$.trim(S.val()),t=F.val();if(_.removeClass("error success").hide(),e&&0<e.length){var a=e.split(","),n=[];if($.each(a,function(e,t){validator.isEmail($.trim(t))||n.push(t)}),n.length)1==n.length?_.text('"'+n[0]+'" is not a valid email.').addClass("error").show():_.text(n.map(function(e){return'"'+e+'"'}).join(", ")+" are not valid email addresses.").addClass("error").show();else{E.find("span").text("Sending"),E.prepend(H),i=!0;var o={token:b.Token,addresses:e,message:t,modId:de,success:function(){E.addClass("sent").find("span").text("Sent"),setTimeout(function(){E.removeClass("sent").find("span").text("Send Email")},3e3)},error:function(e){_.text(e.Message).addClass("error").show(),E.find("span").text("Send Email")},complete:function(){i=!1,H.remove()}};b.isLabel?c.sendLabelEmail(o):c.sendShareEmail(o)}}else _.text("Please type one or more valid emails addresses to send message.").addClass("error").show()}});Y.on("click",function(){Y.addClass("hideLabel"),j.show()}),V.on("click",function(){b.Title||b.Description?Y.text("Edit page title and description"):Y.text("Add page title and description"),Y.removeClass("hideLabel"),j.hide()});function we(a,n){y.animate({"margin-left":"-="+a+"px",width:"+="+a+"px"},n,function(){var e,t;e=a,t=n,y.animate({"margin-left":"+="+e+"px",width:"-="+e+"px"},t,function(){we(e,t)})})}function xe(){var e=Pe(y.parent(),"copy-field folio-link");if(e<=me?(ce=e,y.css("width",e+"px")):y.outerWidth()<me&&me<=e&&(ce=me,y.css("width",me+"px")),(e-=1)>y.outerWidth()){var t=(e-y.outerWidth())/100*3500;t<2e3&&(t=2e3),we(e-y.outerWidth(),t)}else $e()}function $e(){y.stop(),y.css({"margin-left":"0",width:ce+"px"})}function Pe(e,t){var a=$("<span>");a.css({visibility:"hidden","white-space":"pre"}).addClass(t+" tmp-calc").html(y.val()),b.isLabel&&a.css({"text-overflow":"unset","font-family":y.css("font-family"),"font-weight":y.css("font-weight"),"font-size":y.css("font-size")}),e.append(a);var n=e.find(".tmp-calc").outerWidth();return a.remove(),n}function Se(e){if("view"==e)Q.parent().addClass("hidden"),X.addClass("hidden"),Z.removeClass("hidden"),K.removeClass("hidden"),ne.addClass("hidden"),s.removeClass("no-border"),oe.html(""),b.isLabel||($e(),xe());else if("edit"==e){if(Q.parent().removeClass("hidden"),X.removeClass("hidden"),Z.addClass("hidden"),K.addClass("hidden"),y.val(m.baseUrl+"/"),s.addClass("no-border"),!b.isLabel){$e();var t=Pe(y.parent(),"copy-field folio-link");Q.parent().css("left",t+"px")}De()}}function De(){r.folioStorage(b.Token).fetch("curl")||b.Curl;b.Token}function Fe(){var e=m.baseUrl+Me();y.val(e),K.attr({href:e}),C.val("<iframe onload="+pe+" "+fe+' src="'+l.addParamToUrl(e,he)+'"></iframe>')}function Ie(){if(b.isLabel)var e=Pe($("body"),"copy-field folio-link");else e=Pe(y.parent(),"copy-field folio-link");ce=y.outerWidth(),8==y.val().length&&(ce=e,y.css("width",ce+"px")),e<=me&&(ce=e,y.css("width",ce+"px"))}function Me(){if(b.isLabel)return"/channel/"+b.Token;r.folioStorage(b.Token).fetch("curl")||b.Curl;return"/"+le}function Ee(e,t,a){var n,o,i,s,r;Fe(),Se("view"),b.Role<2&&T.addClass("user-cannot-edit"),b.IsUserTemplate||b.IsTeamTemplate?(T.find(".header-message .private .f-t").text("This template is set to private, only you (and your collaborators) can view/use it."),T.find(".header-message .public .f-t").text("Anyone with the link can use your template."),T.find(".header-pass-desc.f-t").text("Password protect your template"),T.find(".url-content h3.f-t").text("Template share URL"),T.find(".email-content h3.f-t").text("Send template via email"),T.find(".embed-content h3.f-t").text("Embed your template"),ie.addClass("hidden")):(T.find(".header-message .private .f-t").html("This folio is set to private. Only you and your collaborators can view or edit it. <br> Warning: If you publicly share the channel(s) this folio is in, <br>others may still be able to view this folio."),T.find(".header-message .public .f-t").text("Anyone with the link can view your folio."),T.find(".header-pass-desc.f-t").text("Password protect your folio"),T.find(".url-content h3.f-t").text("Folio share URL"),T.find(".url-content h3.f-t").text("Send a link"),T.find(".embed-content h3.f-t").text("Embed your folio")),b.isLabel?(z.text(b.Name),url=m.baseUrl+"/channel/"+le,y.val(url),K.attr({href:url}),C.val("<iframe onload="+pe+" "+fe+' src="'+l.addParamToUrl(url,he)+'"></iframe>'),ge(),Z.addClass("hidden")):(t=t||0,url=0<(de=t)?m.baseUrl+"/folio"+Me()+"/"+t:m.baseUrl+Me()+"",y.val(url),K.attr({href:url}),C.val("<iframe onload="+pe+" "+fe+' src="'+l.addParamToUrl(url,he)+'"></iframe>'),n=t,o=a,T.toggleClass("mod-share",0<n),T.find(".modh1 .mod-type").text("Canvas"==o?"Canvas":"Module"),T.find(".modp .mod-type").text("Canvas"==o?"canvas":"module"),0<t?Z.addClass("hidden"):m.isTeam&&m.Team.Role&&m.Team.Role<4&&(Z.removeClass("hidden"),Q.val(le))),ge(),i=url,r=b.isLabel?(s=b.Title||b.Name,b.Description||'All my folios labelled "'+b.Name+'" on Xtensio. #'+b.Name.replace(/ /g,"")):(s=b.FolioName,'My folio "'+b.FolioName+'" on Xtensio.'),$.shareLinks(i,T,s,r,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin"),b.isLabel?(Y.removeClass("hideLabel"),j.hide(),(b.Title||b.Description)&&Y.text("Edit page title and description")):(Y.addClass("hideLabel"),j.hide()),u.show(T),Ie(),b.isLabel||xe()}function Ae(e){if(!(e.Version<2)){ie.removeClass("hidden"),se.html(""),e.Collaborators&&$.each(e.Collaborators,function(e,t){if(t.Accepted&&0<t.Privilege&&t.Email!=m.userEmail){se.removeClass("hidden"),ie.addClass("hidden");var a=$('<div class="outer"><div class="initials">MN</div></div>');a.find(".initials").text(l.getInitials(t.FullName||t.Email)).attr("data-tip",t.FullName),se.prepend(a.find(".initials"))}});var t=$('<div class="initials add"><i class="icon-AddCollaborator2"></i></div>');p.isSingleFolioGuest()?(t.attr("data-tip","Add / Remove People"),t.click(function(){u.teamUserActionBlocked("add-remove-collab","Guests")})):(1===e.Role?t.addClass("hidden"):t.removeClass("hidden"),t.attr("data-tip","Add / Remove People"),t.click(function(){return u.collaborators(b),!1})),se.append(t)}}return u.reg(T,T.find(".icon-Close")),J.on("click",function(){if(!(0,v.customLinksAllowed)())return function(){var e=app.strings.popups,t=e.customLinksMsgOwner,a=e.pleaseUpgradeAccount,n=v.customLinksAllowed,o=v.isPremiumGuest,i=v.isOwner;if(!n())if(i()){var s={notMini:!0,bodyCentered:!0,btnText:"See Plans",cancelText:"Nevermind",handleOK:function(){u.universalBlocker()},heading:a,message:t};u.push(T),u.message(s)}else u.teamUserActionBlocked("edit-link",o()?"Premium Guests":"",function(){u.show(T)})}(),!1;Se("edit")}),ee.on("click",function(){Fe(),Se("view")}),ae.click(function(){if(console.log("isSafari",l.isSafari()),ae.find(".loading-animation").removeClass("hidden"),l.isSafari()){var e=document.querySelector("#tmp-popup-folio-share-link .copy-field"),t=e.contentEditable,a=e.readOnly;e.contentEditable=!0,e.readOnly=!0;var n=document.createRange();n.selectNodeContents(e);var o=window.getSelection();o.removeAllRanges(),o.addRange(n),e.setSelectionRange(0,999999),e.contentEditable=t,e.readOnly=a}else s.select();document.execCommand("copy"),ae.find("span").text("Copied"),ae.find(".loading-animation").addClass("hidden"),ae.find("img").removeClass("hidden"),setTimeout(function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),ae.find("img").addClass("hidden"),ae.find("span").text("Copy link")},2e3)}),te.on("click",function(){ne.addClass("hidden"),oe.html("");var t=Q.val().trim(),e=m.baseUrl+"/"+t;t.match(/^[a-z\d\-\s]+$/i)?255<e.length?(ne.removeClass("hidden"),oe.html("Url can have maximum of 255 characters.")):(t=t.replace(/ /g,"-"),te.find(".loading-animation").removeClass("hidden"),c.checkCurlAvailability({curl:t,token:b.Token,success:function(e){1==e.StatusCode?(te.find(".loading-animation").removeClass("hidden"),c.updateFolioCurl({curl:t,token:b.Token,success:function(){},error:function(e){u.push(T),u.error(e.Message)},complete:function(){te.find("img").removeClass("hidden"),te.find("span").text("Saved"),te.find(".loading-animation").addClass("hidden"),le=t,r.folioStorage(b.Token).store("curl",le),Fe(),setTimeout(function(){te.find("img").addClass("hidden"),te.find("span").text("Save"),Se("view")},3e3)}})):(te.find(".loading-animation").addClass("hidden"),u.push(T),u.error(e.Message))},error:function(e){3==e.StatusCode?(te.find("img").removeClass("hidden"),te.find("span").text("Saved"),te.find(".loading-animation").addClass("hidden"),setTimeout(function(){te.find("img").addClass("hidden"),te.find("span").text("Save"),Se("view"),b.isLabel||xe()},3e3)):4==e.StatusCode?(te.find("img").removeClass("hidden"),te.find("span").text("Saved"),te.find(".loading-animation").addClass("hidden"),le=t,r.folioStorage(b.Token).store("curl",le),Fe(),setTimeout(function(){te.find("img").addClass("hidden"),te.find("span").text("Save"),Se("view")},3e3)):(te.find(".loading-animation").addClass("hidden"),u.push(T),u.error(e.Message))},complete:function(){}})):(ne.removeClass("hidden"),oe.html("Only numbers, letters and hyphens are allowed in custom links."))}),ie.click(function(e){u.collaborators(b)}),function(e,t,a,n,o){b=e,f=n,d=p.isFolioOwner(m.userEmail,b),h=null!=f?"channel":"folio",console.log("setShareFolioLinkLock called in normal flow ",f),g="channel"==h?f:d,ue.setShareFolioLinkLock(b,g),k=T.find(".popup-content").toggleClass("private",b.Private);var i,s=p.isBusinessTeamMember()&&p.isFolioOwner(m.userEmail,b);k.toggleClass("show-business-tooltip",s),b.HasPass?(p.isSingleFolioGuest()?M.val(""):M.val("****"),Ce()):M.val(""),U=T.find(".pass-section").toggle(b.HasPass),O=T.find(".pass-protect").toggleClass("selected",b.HasPass),U.removeClass("show-pass"),b.HasPass&&U.show(),R.prop("checked",!b.Indexed),B.prop("checked",b.PresentationMode),T.find(".popup-wrapper").toggleClass("all-label",!!b.isLabel),T.find(".tab, .tabs span").removeClass("selected"),T.find(".tabs span:eq(0), .url-content").addClass("selected"),se.addClass("hidden"),b.isLabel||b.Role&&1===b.Role?ie.addClass("hidden"):(ie.removeClass("hidden"),Ae(b)),i=function(){Ee(0,t,a),!0===o&&ke(2)},le=r.folioStorage(b.Token).fetch("curl")||b.Curl||b.Token,i&&i()}},app.popup.getSignUpPerformance=function(l,s,e,d,t,c){var u,m={},p=$("#tmp-sign-up-performance"),a=p.find(".icon-Close"),n=p.find(".export"),f=p.find(".total-count"),h=p.find(".new-items"),g=p.find(".f-name"),v=g.find("a"),b=p.find(".performance-table tbody"),T=p.find(".paper");function y(t,a,e){var n,o,r,i=m[u=t];i?(n=u,o=i.list,r=i.data,c.get(n,"viewed",function(i){var s=0;i=new Date(JSON.parse(i||JSON.stringify(new Date(2016,4,30).getTime()))),T.removeClass("busy"),r.t!=l.token?(v.text(r.n).attr("href","/edit/"+r.t),g.show()):g.hide(),f.html(o.length+(1==o.length?" Response":" Total Responses")),b.empty(),$.each(o,function(e,t){var a="</td><td>";t.Created>i&&(a="<span></span></td><td>",s++);var n=t.Created.getMonth()+1;n=n<10?"0"+n:n;var o=t.Created.getDate();o=o<10?"0"+o:o,b.append("<tr><td>"+a+n+"/"+o+"/"+t.Created.getFullYear()+"</td><td>"+t.Data.email+"</td></tr>")}),h.html(s+" New"),s&&c.set(n,"viewed",JSON.stringify(new Date))})):a?(m[u]={list:a,data:e},y(u,a,e)):(T.addClass("busy"),d.getRecords({id:u,success:function(e){a=JSON.parse(e.Message),$.each(a,function(e,t){t.Created=new Date(t.Created),t.Data=JSON.parse(t.Data)}),c.reg(t,JSON.parse(e.Data.s)),y(u,a,e.Data)},error:function(e){s.error()}})),s.show(p,i?"res-"+t:"")}return T.find(".loading-animation").html(s.spinner),s.reg(p,a),n.on("click",function(){var e=m[u];if(e){e=e.list;var n="data:text/csv;charset=utf-8,Date,Email\n",o=e.length;$.each(e,function(e,t){var a=1+t.Created.getMonth()+"/"+t.Created.getDate()+"/"+t.Created.getFullYear()+","+t.Data.email;n+=e<o?a+"\n":a});var t=encodeURI(n);window.open(t)}}),t.addListener("newSignUp",function(e){var t=m[e.Data.ModId];t&&t.list.unshift({ID:e.Data.RecId,Created:new Date(e.Time),Data:e.Data.Data})}),y.reg=function(e,t,a){m[e]={list:t,data:a}},y},app.popup.styleGuideBlocker=function(e,t,a){var n=app.strings.popups,o=n.styleGuideMsgOwner,i=n.styleGuideMsgAdmin,s=n.styleGuideMsgMember,r=n.pleaseUpgradeAccount,l=n.cannotPerformAction,d=a.isOwner,c=a.isAdmin,u=d()?o:c()?i:s;if(e.hasTeam()){var m={heading:d()?r:l,message:u,bodyCentered:!0,notMini:!0,btnText:d()?"Nevermind":"Ok"};d()&&(t.btnText="See Plans",t.handleOK=function(){t.universalBlocker()}),t.message(m)}else t.message({heading:"Please Upgrade Your Account",message:"Style guide is only available on premium plans. Please upgrade or switch to your team dashboard.",btnText:"See Plans",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){t.universalBlocker()}})},app.popup.getTransferFolio=function(a,n,e,t,o){var i,s,r,l={search:1,busy:2,found:3,notFound:4,sent:5},d=$("#tmp-transfer"),c=d.find(".paper"),u=d.find(".popup-header h1"),m=c.find(".email").val(""),p=c.find(".msg-box"),f=p.find(".msg"),h=p.find(".msg-content"),g=p.find(".close-msg-btn"),v=c.find(".error"),b=c.find(".found").find(".name"),T=c.find(".not-found"),y=T.find(".name"),C=c.find(".add-msg"),k=c.find(".popup-cta"),w=c.find(".result"),x=c.find(".full-name").val(""),P=c.find(".back-btn"),S=a.token,D=!1;function F(e){var t=c.height()+16;switch(i=e,m.prop("readonly",!0),c.css("min-height",""),c.removeClass("busy search sent found not-found"),i){case l.busy:c.css("min-height",t).addClass("busy");break;case l.found:c.addClass("found"),b.text(s),k.text("Transfer");break;case l.notFound:c.addClass("not-found"),y.text(r),k.text("Invite & Transfer");break;case l.sent:c.addClass("sent"),k.addClass("no").removeClass("yes").text("Close"),w.find(".name").text(s||x.val()+" signs up and");break;default:c.addClass("search"),m.prop("readonly",!1),k.text("Search")}}function I(){F(l.busy),t.transfer({data:{token:S,name:s||x.val(),email:r,message:f.val(),AllowOutside:!0},success:function(e){F(l.sent)},error:function(e){F(l.search),v.show().text(e.Message||"There was an error. Please try later.")}})}return c.find(".loading-animation").html(n.spinner),C.click(function(){C.hide(),h.show()}),g.click(function(){C.show(),h.hide(),f.val("")}),P.click(function(){m.val(""),F(l.search)}),k.click(function(){switch(i){case l.search:r=$.trim(m.val());var e=validator.isEmail(r);e&&r==a.userEmail&&a.Team&&0<a.Team.Id&&1==a.Team.Role?n.transferFolioToSpace({sameUser:!0,Data:{Token:S,TeamID:a.Team.Id,Owner:r}}):e&&r==a.userEmail&&a.Team&&0==a.Team.Id?v.show().text("You can not transfer to yourself!"):e?(v.hide(),F(l.busy),t.findUser({email:r,success:function(e){a.Team&&0<a.Team.Id&&a.Team.Role<4&&e.Message&&(D?F(l.found):t.listTeamMembers({data:{teamId:a.Team.Id},success:function(e){for(var t=!1,a=0;a<e.Data.Data.length;a++)e.Data.Data[a].Email==r&&(t=!0,s=e.Data.Data[a].UserName,5==e.Data.Data[a].Role&&(t=!1,F(l.search),v.show().text(e.Message||"This user is a Free Guest on this team."),!0));t?F(l.found):n.message({heading:"Can not transfer folio",message:"You can transfer your folio's ownership only to another team member. Please contact your team admin if you need to transfer your folio over to someone outside your team.",btnText:"Ok",notMini:!0})},error:function(e){v.show().text(e.Message||"There was an error. Please try later.")}})),a.Team&&0<a.Team.Id&&a.Team.Role<4&&!e.Message?n.message({heading:"User Not found",message:"Team folios can only be transferred to existing Xtensio users. Please ask this person to create a free Xtensio account and try again.",btnText:"Ok",notMini:!0}):(s=e.Message||s,F(e.Message?l.found:l.notFound))},error:function(){F(l.search),v.show().text("There was an error. Please try later.")}})):v.show().text("Invalid Email");break;case l.found:I();break;case l.notFound:s=x.val(),T.toggleClass("no-name",!s),s&&I();break;default:n.close()}}),d.find(".is-team-admin").click(function(){n.transferTeamFolio(S,{allowOutside:!0})}),n.reg(d,d.find(".icon-Close"),function(){$(document).off(".enterOnTransfer")}),function(e,t){D=!1,t&&(D=t.allowOutside||!1),D?u.html('Transfer Ownership<br><span style="font-size: 16px;">Outside Team</span>'):u.html("Transfer Ownership"),a.Team&&0<a.Team.Id&&5==a.Team.Role?n.teamUserActionBlocked("transfer"):a.Team&&0<a.Team.Id&&4==a.Team.Role?n.teamUserActionBlocked("transfer","Premium Guests"):(a.Team&&0<a.Team.Id&&(1==a.Team.Role||2==a.Team.Role)&&!D?d.addClass("team-allow-out"):d.removeClass("team-allow-out"),S=e||S,v.hide(),F(l.search),m.val(""),k.addClass("yes"),g.trigger("click"),$(document).on("keydown.enterOnTransfer",function(e){13==(e.keyCode||e.which)&&k.click()}),n.show(d))}},app.popup.getTryWelcome=function(e,t,a,n){var o=$("#tmp-try-welcome"),i=o.find(".tour-btn");return o.find(".skip-btn").click(function(e){e.preventDefault(),t.close()}),i.click(function(){a.raiseEvent("runTryWizard")}),t.reg(o,o.find(".icon-Close")),function(){t.show(o),n.setWelcomeMessageSeen({token:e.token,success:function(e){console.log("response setWelcomeMessageSeen",e)},error:function(e){console.log("error setWelcomeMessageSeen",e)}})}},app.popup.getUnarchivePopup=function(n,o,i){return function(e,t){var a="object"===_typeof(e)?e.Token:e;i.checkFoliosLimitReached(o,n,function(){n.message({heading:"Are you sure you want to recover?",message:"This folio will return to your dashboard as an active folio. You will be able to edit and share this folio again.",btnText:"Yes, Recover This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){n.busy(),o.deleteFolio({data:{op:"undo",token:a},success:t,error:function(e){5==e.StatusCode?n.plusPrompt("create",null,!0):10==e.StatusCode?n.plusPrompt("create",null,!1,!0):n.error("There was an error. Please refresh page and try again.")}})}})})}},app.popup.getUniversalBlocker=function(n,d,c,u,o){var m,p,f,h,i,s,r,l=$("#tmp-universal-blocker"),g=l.find(".planlisting"),v=l.find(".steps"),t=[g,v],b={},T={},y={},C=[],k=["step1","step2","step3","step4"],a=["basic","full"],w="basic",x="year",P="unknown",e=g.find(".basic-btn"),S=g.find(".full-btn"),D=v.find(".cc-num"),F=v.find(".cc-name"),I=v.find(".cvc"),M=v.find(".cc-exp"),E=v.find(".step1.step-block .error-msg"),A=v.find(".select.confirm"),U=!1,N=v.find(".checkout-btn"),L=v.find(".step2.step-block .error-msg"),O=v.find(".step2.step-block .input.name"),R=v.find(".step2.step-block .input.email"),B=v.find(".step2.step-block .input.password"),_=v.find(".step2.step-block .create-btn"),G=v.find(".step3.step-block .team-name"),H=v.find(".step3.step-block .team-url"),Y=v.find(".step3.step-block .create-workspace-btn"),j=v.find(".step3.step-block .error-msg"),z=v.find(".step4.step-block .dashboard-btn"),q=l.find(".loading-animation").html(n.spinner),V=!1,K={title:"Plans List",curl:"planslist"},J=0,W=0,X=v.find(".congrats .countdown"),Z=l.find("#monthly-plan");function Q(e){t.forEach(function(e){return e.hide()}),e.show(),e===g&&le(K.curl,K.title,"#"+K.curl)}function ee(e){var t=k.join(" ");v.find(".section-info").removeClass(t).addClass(e),v.find(".billing-form").removeClass(t).addClass(e),le(e,c.capitalizeFirstLetter(e),"#"+e)}function te(e){e?(q.show(),l.addClass("busy")):(q.hide(),l.removeClass("busy"))}function ae(){f=c.capitalizeFirstLetter(w)+"Access"+c.capitalizeFirstLetter(x);var e=m.getPlanObjFromAllPlansAclData(f+"ly",p),t=m.getPlanObjFromAllPlansAclData("BasicAccess"+c.capitalizeFirstLetter(x)+"ly",p),a=m.getPlanObjFromAllPlansAclData("FullAccess"+c.capitalizeFirstLetter(x)+"ly",p);console.log("planBasic",t),console.log("planFull",a);var n=parseInt(e.PriceCents,10)/100,o=d.exportEnabled&&d.tryMode?10:0,i=parseInt(e.ExtraSeatPriceCents,10)/100;n+=i*W,console.log("planAclData",e),console.log("cost per member",i),console.log("total cost",n),o&&(v.find(".total-cont .sub").show(),v.find(".total-cont .discount").show(),v.find(".total-cont .sub .cost").text("$"+n)),v.find(".total-cont .total .cost").text("$"+(n-o)),v.find(".select.confirm .total").text(n),v.find(".select.confirm .dur").text(x);var s="month"===x?1:12,r=parseInt(t.PriceCents,10)/100/s,l=parseInt(a.PriceCents,10)/100/s;g.find(".column-plan.basic .price").text(r),g.find(".column-plan.full .price").text(l),g.find(".column-plan .dur").text(x.toUpperCase()+"LY"),ce()}function ne(e,t){w=t&&t.plan?t.plan:$(this).data("plan"),console.log("plan name selected",w),t&&t.duration&&x!==t.duration?v.find('input[value="'.concat(t.duration,'"]')).click():v.find('input[value="'.concat(x,'"]')).click(),ee("step1"),v.find(".section-info").removeClass(a.join(" ")).addClass(w),v.find(".desc-block .plan-type").text(c.capitalizeFirstLetter(w)),v.find(".checkout-btn span").text(c.capitalizeFirstLetter(w)),Q(v)}function oe(e,t){var a=t||"please make sure to fill out all the fields.";e.html('<i class="fa fa-exclamation-triangle"></i> Error: '+a),e.addClass("show"),setTimeout(function(){e.removeClass("show")},5e3)}function ie(t){d.tryMode?t&&"function"==typeof t&&t():u.listALLMembers({data:{teamId:d.Team.Id},success:function(e){C=e.Data.Data.members,t&&"function"==typeof t&&t()},error:function(e){console.log("listALLMembers error",e)}})}function se(){d.tryMode?l.find(".members-list-cont").hide():(W=0,ie(function(){var e,n="";0===C.length&&(C.push({Email:d.userEmail}),memberLength=1),1<C.length?(C.forEach(function(e,t){if(e.Email===d.userEmail){var a="<li>"+e.Email+" <span>(You)</span></li>";n=a+n}else e.Role&&5!==e.Role&&(n+='<li><span class="email">'+e.Email+'</span><span class="pull-right"><a class="btn-mem-remove" href="#"><i style="font-size: 10px;" class="icon-Close"></i></a></span></li>',W++)}),n="<ul "+(e||"")+">"+n+"</ul>",l.find(".cont-seat-toggle").html(n)):l.find(".members-list-cont").hide()}))}function re(e){e?(v.find(".card-new").show(),v.find(".card-exists").hide()):(v.find(".card-new").hide(),v.find(".card-exists").show())}function le(t,e,a){var n=k.findIndex(function(e){return e===t});console.log("step details",n,t,i),i!==t&&(i=t,history.pushState({name:e,step:n,url:a},e,a))}function de(){setTimeout(function(){var e=4;X.show();var t=setInterval(function(){e--,X.find("span").text(e+"..."),0===e&&(clearInterval(t),window.location.href="https://"+h)},1e3)},2e3)}function ce(){if(!d.tryMode&&0!==d.autoRenew){var e=m.planName().toString().toLowerCase(),t=-1!==e.indexOf("basicaccess"),a=-1!==e.indexOf("fullaccess"),n=-1!==e.indexOf("month")?"month":"year",o=t||a;if(console.log("isBasic",t),console.log("isFull",a),console.log("isNewPlan",o),console.log("dur",n),console.log("plan",e),console.log("planDuration",x),g.find(".column-plan").removeClass("current"),o&&n===x){var i=t?"basic":"full";g.find(".column-plan."+i).addClass("current")}}}function ue(e){return/^[0-9a-zA-Z]+$/.test(e)}return v.find(".card-exists  a.edit-billing-btn").click(function(e){e.preventDefault(),re(!(V=!1))}),v.find(".plans-link").click(function(e){var t,a;e.preventDefault(),(s.checked?"month":"year")!==x&&(t=r,((a=!s.checked)&&!t.isChecked()||!a&&t.isChecked())&&(t.setPosition(!0),t.handleOnchange(!0))),Q(g),ce()}),e.click(ne),S.click(ne),v.find("input[type=radio]").click(function(){x=$(this).val(),ae()}),A.click(function(e){e.preventDefault(),U=!U,A.toggleClass("selected",U),console.log("isConfirmed",U)}),v.find(".cont-seat-toggle").on("click",".btn-mem-remove",function(e){e.preventDefault();var t=$(this).parent().parent().find(".email").text();console.log("email",t),n.push(l),n.confirmRemoveMember(t,t,function(){te(!0),u.removeMember({userEmail:t,success:function(e){console.log("removeMember res",e),n.message({heading:"Success",message:t+" has been successfully removed from your team.",btnText:"Ok",notMini:!0,bodyCentered:!0}),ie(function(){se(),ae(),te(!1)})},error:function(e){console.log("removeMember error",e),te(!1),showErrorPopup(e.Message)}})})}),N.click(function(){te(!0);var e=c.capitalizeFirstLetter(w)+"Access"+c.capitalizeFirstLetter(x),t=0,a=D.data("val"),n=I.val(),o=F.val(),i=M.val(),s=i?i.toString().substr(0,2):"",r=i?i.toString().substr(3):"";if(console.log("num",a),console.log("date",i),console.log("== attempting to upgrade to ==",e),D.removeClass("error"),F.removeClass("error"),M.removeClass("error"),I.removeClass("error"),A.find("span.check").removeClass("error"),E.removeClass("show"),V||(Stripe.card.validateCardNumber(a)||(t=1,D.addClass("error")),Stripe.card.validateCVC(n)||(t=1,I.addClass("error")),Stripe.card.validateExpiry(s,r)||(t=1,M.addClass("error")),o||(t=1,F.addClass("error"))),U||(t=1,A.find("span.check").addClass("error")),t)te(!1),oe(E);else{var l={plan:f=e,count:C.length,success:function(e){te(!1),console.log("upgrade response",e),d.Team&&d.Team.TeamUrl&&(h=d.Team.TeamUrl),c.toggleExitIntent(!1,d),ee("step4"),de()},error:function(e){te(!1),console.log("upgrade error",e),oe(E,e.Message)}};V&&!d.tryMode?u.upgrade(l):V&&d.tryMode?(b=null,te(!1),ee("step2")):Stripe.card.createToken({number:a,cvc:n,exp_month:s,exp_year:r,name:o},function(e,t){if(te(!1),t.error)console.log("Stripe createToken error",t),oe(E,t.error.message);else{var a=t.card,n=t.id;b={Token:n,CardId:a.id,Last4:a.last4,Brand:a.brand,Name:o,count:C.length},console.log("upgradeData",b),d.tryMode?(te(!1),ee("step2")):(l.data=b,u.upgrade(l))}})}}),_.click(function(){te(!0);var e=B.val(),t=R.val(),a=O.val(),n=0;B.removeClass("error"),R.removeClass("error"),O.removeClass("error"),L.removeClass("show"),(!a||a.length<3||/[^a-zA-Z0-9\s\-\/]/.test(a))&&(n=1,O.addClass("error")),t&&validator.isEmail(t)||(n=1,R.addClass("error")),(!e||e.length<8)&&(n=1,B.addClass("error")),n?(oe(L),te(!1)):(T={Email:t,Password:e,FullName:a,ischeckout:J},console.log(T,T),te(!1),ee("step3"))}),G.on("input",function(){var e=$(this),t=e.val(),a=/^[a-zA-Z\d-_ ]+$/,n=a.test(e.val()),o=t.replace(/[^a-z0-9]/gi,"");n?e.removeClass("error"):e.addClass("error"),t.length<3?(e.addClass("error"),oe(j,"Name must be at least 3 characters long.")):t.match(a)?(e.removeClass("error"),ue(H.val())&&H.removeClass("error")):(e.addClass("error"),oe(j,"Names may contain only alphabetical and numerical values, hyphens and underscores.")),H.val(o)}),H.on("input",function(){var e=$(this);ue(e.val())?e.removeClass("error"):e.addClass("error");var t=e.val();t.length<3?oe(j,"A url must be at least 3 characters long."):t.match(/^[0-9a-zA-Z]+$/)?e.removeClass("error"):oe(j,"URL may only contain alphabetical and numerical values.")}),Y.click(function(){te(!0);var e=G.val(),t=H.val();if(!G.hasClass("error")&&!H.hasClass("error")&&e&&t){h=o.getTeamFullUrl(t);var a=m.getPlanObjFromAllPlansAclData(f+"ly",p);console.log("planAclData",a),y={TeamName:e,TeamUrl:h,seats:m.getRuleValueFromPlanObj("maxUsers",a)||999,count:C.length,FolioToken:d.token},console.log("teamData",y),console.log("purchased plan",f),u.checkTeamURL({data:{teamUrl:t},success:function(e){console.log("checkTeamURL response",e),1==e.Data?(te(!1),oe(j,"This Team url is already taken. Please choose another Url.")):u.register({accountData:T,teamData:y,data:b,plan:f,success:function(e){console.log("register response",e),c.toggleExitIntent(!1,d),te(!1),ee("step4"),de()},error:function(e){console.log("register error",e),te(!1),3==e.StatusCode?(ee("step1"),oe(E,e.Message)):oe(j,e.Message)}})},error:function(e){console.log("checkTeamURL error",e),te(!1),oe(j,e.Message)}})}else te(!1),oe(j,"Check the required fields and try again"),e||G.addClass("error"),t||H.addClass("error")}),z.click(function(){window.location.href="https://"+h}),n.reg(l,l.find(".icon-Close")),function(t,e,a){te(!0),Q(g),t||n.show(l),e&&(l.addClass("no-close"),l.find(".icon-Close").hide()),window.addEventListener("popstate",function(e){if(!e.state)return!1;var t=history.state;console.log(t),-1===t.step&&t.name===K.title?Q(g):-1!==t.url.indexOf("step")&&(Q(v),ee(k[t.step]))}),r||(s=document.querySelector("#tmp-universal-blocker .js-switch"),r=new Switchery(s,{size:"small",secondaryColor:"#00bd9c",color:"#00bd9c"}),setTimeout(function(){l.find(".switchery").click(function(){var e=s.checked?"month":"year";x=e,ae()})},100)),o.loadStripe(function(){m=app.acl.helper(d);var e={success:function(e){p=JSON.parse(e.Message),console.log("allPlansData response",p),se(),d.tryMode||(v.find(".step2-wrap").hide(),v.find(".step3-wrap").hide(),v.find(".step4-wrap").css({left:"110px"}),v.find(".step4-wrap .step-num").text("2")),console.log("config.exporterEmail",d.exporterEmail),console.log("config.userEmail",d.userEmail),(d.userEmail||d.exporterEmail)&&u.getFreePlusInfo({success:function(e){var t=JSON.parse(e.Message);console.log("plusData",t),void 0!==t.Last4&&void 0!==t.Brand&&(V=!0,v.find(".card-exists .card-num span").text(t.Last4),re(!1))},error:function(e){console.log("getFreePlusInfo error",e)}}),d.tryMode&&d.exporterEmail&&R.val(d.exporterEmail),D.passwordify({maxLength:19,numbersOnly:!0,charToShow:4,ccInputHandler:function(e){var t=o.getCardType(e);t!==P&&(P=t,console.log("card type",P),l.find(".cc-type i").removeClass().addClass("fa "+o.getCardIconClass(P)))}}),J=d.checkoutMode?1:0,I.mask("0000"),M.mask("00/0000",{placeholder:"mm/yyyy"}),!t||"basic"!==t.plan&&"full"!==t.plan?le(K.curl,K.title,"#"+K.curl):(ne(0,t),setTimeout(function(){n.show(l)},1e3)),a&&setTimeout(function(){Z.click()},500),ae(),te(!1)},error:function(e){console.log("getAllPlansAclData err",e),showErrorPopup(e.Message)}};d.tryMode?u.getAllPlansAclListAnon(e):u.getAllPlansAclData(e)})}},app.popup.upgradePrompt=function(r,l,e,t,d,a){r.plusInfo?r.plusExpireTime=r.plusInfo.End:r.plusExpireTime=Date.now();var c=$("#tmp-upgrade-prompt"),u=c.find(".msg");return c.find(".upgrade-panel").html(l.upgrade),l.reg(c,c.find(".icon-Close")),c.find(".ok").click(function(){l.payment()}),function(e,o,t,a){var n=Date.now();if("pass"==e)d.getData(1,function(e,t,a,n){t?10==e.ST||11==e.ST||3==e.ST||16==e.ST?l.billing():o():l.universalBlocker()});else if((r.autoRenew||n<r.plusExpireTime)&&o)o();else{if(t)return void("create"==e?d.getData(1,function(e,t,a,n){var o=1,i="Free Forever";(t&&10==e.ST||11==e.ST)&&(o=5,i="Xtensio Plus"),(t&&16==e.ST||3==e.ST)&&(o=5,i="Free Plus");var s="Free Forever"==i?'The limit on your personal dashboard (<a href="https://app.xtensio.com" target="_blank">app.xtensio.com</a>) is one active folio at a time':"The "+i+" plan has a limit of "+o+" active folio"+(1<o?"s":"");l.message({heading:"You've reached your folio limit!",message:s+".  To work on more folios, please delete/leave some old folios or upgrade to premium plans.",btnText:"See Plans",cancelText:"Nevermind",notMini:!0,handleOK:function(){10==e.ST||11==e.ST?(console.log("From here..."),l.billing()):l.universalBlocker()}})}):l.universalBlocker());if(a)return void l.billing();var i='Unlock <a class="x-plus" target="_blank" href="//xtensio.com/plus">Xtensio Plus</a> ',s="Xtensio Plus allows you to export your folio as PDF or PNG";u.show(),"create"==e?(i+="to create more folios",s="With a free account, you're limited to 1 folio"):(i+="to access this feature",u.hide()),c.find("h1").html(i),c.find(".desc").text(s),l.show(c)}}},app.popup.getUserMenu=function(s,r,e,t,a){var n=Date.now()<s.plusExpireTime,o=$("#top-bar .user-menu-popup"),i=o.find(".e-settings"),l=o.find(".logout"),d=o.find(".billing"),c=o.find(".plus"),u=o.find(".settings"),m=$(".user-menu-popup .upgrade-user"),p=$(".user-menu-popup .upgrade-free-owner"),f=(o.find(".nav-setmenu li"),!1);function h(){(n||s.everPlus)&&d.text("Billing")}function g(){$("#dashboard-page .upgrade-user").show(),m.show(),p.hide(),$("#tmp-dash-topbar .upgrade-btn, #tmp-primary-bar .upgrade-btn").remove(),$(".user-menu-popup li.item.upgrade").remove()}s.isTeam&&s.Team&&1!==s.Team.Role&&d.hide(),h(),e.addListener("plusUnlocked",h),u.click(function(){r.settings()}),c.click(function(){r.plusInfo()}),i.click(function(){r.emailSettings()}),l.click(function(){$("#logoutForm").submit()}),d.click(function(){t.getData(0,function(e,t,a,n){console.log(a,t,s.everPlus,e);var o=!1;if(s.UserTeams)for(var i=0;i<s.UserTeams.length;i++)1==s.UserTeams[i].Role&&(o=!0);1==e.ST||2==e.ST||9==e.ST||10==e.ST||11==e.ST||34==e.ST||s.everPlus||t||o?r.billing():r.payment()})}),setTimeout(function(){if(s.Team&&0!==s.Team.Id&&!f)if(f=!0,1!==s.Team.Role){p.hide();var e=_.find(s.UserTeams,function(e){return 1===e.Role});e||s.isTrial||s.isTrialCanceled?(!e&&s.ReActivationData&&s.ReActivationData.LastPlan||e&&0!==e.ST&&0===s.autoRenew&&!s.isTrialCanceled&&s.trialConverted)&&(g(),$("#dashboard-page .upgrade-user, .user-menu-popup .upgrade-user").click(function(e){e.preventDefault(),r.payment()})):(g(),$("#tmp-signup-plans i.icon-Close").show(),$("#dashboard-page .upgrade-user, .user-menu-popup .upgrade-user").click(function(e){e.preventDefault(),window.location.href=a.getAppUrl(s.Environment)+"teams/create"}))}else t.isFreeWithTeam()&&(p.css("display","inline-block"),m.hide())},2500)},app.popup.getAnonymousExamplesPage=function(p,i,e,t,a,n,o){var s,r,l,d=!1,c=$("#dashboard-page"),u=$(".tab-content"),m=($("#top-bar .template-subnav"),$("#top-bar .example-subnav"),$("#tmp-dashboard-content")),f=$("#feat-examples-items-container"),h=$("#examples-items-container"),g=$("#template-item").html(),v=h,b=$("#tmp-temp-sidebar"),T=$("#single-label").html(),y=$("#tmp-labels-container"),C=(T=$("#single-label").html(),$($("#tmp-template-nav").html())),k=v.find(".label-details.temp"),w=$(".folios-container.examples"),x=$("#all-templates-button");if(!1!==$("body").hasClass("anonymous-examples")){h.before($("#tmp-temp-filter-bar").html()),h.find(".filter-bar .label-name").text("Xtensio Examples"),0===c.find("#exampleloader").length&&(c.append($('<div id="exampleloader" class="example-loader"><div class="loading-animation"></div></div>')),l=c.find("#exampleloader"));var P=null,S=null;p.templateTab=".xtensio-temp";var D=function(e){return _.sortBy(e,["CreatedDate"]).slice(-3)};return $("#all-temps-button").on("click",A),$("#all-templates-button").on("click",A),function(){M(),c.append(m),w.removeClass("hidden"),f.removeClass("hidden"),$("#example-sidebar").append(b),app.menu.xSelect(),$(window).scroll(function(){100<=$(window).scrollTop()?$("#top-bar").addClass("fixed-header"):$("#top-bar").removeClass("fixed-header")})}}function F(o,e){$.each(e.Labels,function(e,t){var a=i.obtain(p.examplesLabels,"Token",t);if(a){var n=$('<div class="label"></div>').css("background-color",a.color).text(a.Name);n.data("token",a.Token),o.addClass(a.Token),o.find(".labels").prepend(n)}})}function I(e,t,a){for(var n=function(e,t,a){var n,o={};if(e&&t){var i=h.find(".folio-item."+e);i.length>a.length&&i.each(function(e,t){n=$(t).data("token"),o[n]=n})}return o}(t,a,e),o=!t&&D(e),i=0;i<e.length;i++){var s=h.find(".folio-item[data-token="+e[i].Token+"]");if(t){if(delete n[e[i].Token],a&&1==s.length&&s.data("type")==t&&s.hasClass(t))continue;s.remove()}s=e[i];var r=!t&&"blank"==s.TemplateName;(P=$(g)).find(".create-btn").text("Use Example"),P.attr("data-template",s.TemplateName).attr("data-name",s.PublicName||s.FolioName).attr("data-used",s.UsedCount).attr("data-type",t).attr("data-date",s.CreatedDate),F(P,s),s.Thumbnail&&P.find(".img").removeClass("hidden").find("img").attr("src",s.Thumbnail),s.UsedCount&&!r&&P.find(".used").text("Used "+s.UsedCount+" times"),S=p.baseUrl+"/folio/"+s.FolioToken;var l=P.find("h4");if(l.text(s.PublicName||s.FolioName),setTimeout(function(){l.scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",minScrollWidth:268,animBack:!0,ellips:32})},1e3),P.find(".preview, .link").attr("href",S),_.find(o,{FolioToken:s.FolioToken})&&(P.find(".new-label").removeClass("hidden"),P.addClass("new")),r)P.find(".primary").addClass("red").attr("href","/try").text("Create New"),P.attr("data-used",Number.MAX_SAFE_INTEGER).attr("data-date",Date.now()).attr("data-name","  "+s.PublicName).addClass("blank").find(".blank-description").removeClass("hidden"),P.find(".cta-buttons .preview").parent().remove();else{var d=e[i].Curl;d=""==d||null==d?e[i].TemplateName:d,P.find(".cta-buttons .create-btn").attr("href","/try/"+d)}P.find(".img").hover(function(){$(this).stop().animate({scrollTop:$(this).find("img").height()},5e3)},function(){$(this).stop().animate({scrollTop:0},2e3)}),P.find(".create-cont").hide(),P.find(".link-share-cont").hide(),P.find(".options").remove(),P.addClass("xtensio");var c=s.FolioUrlSlug?s.FolioUrlSlug:s.FolioToken;xurl=p.libBaseUrl+"/"+c,P.find(".preview, .link").attr("href",xurl),r&&(P.find(".link").attr("href","#"),P.find(".link ").removeAttr("target")),P.css("display",""),t?h.prepend(P):h.append(P),s.IsFeatured&&(P.addClass("feat"),f.append(P))}var u,m=f.find(".folio-item");m.show(),u=m,console.log("$featFolioItems ",u,u.length),0<u.length?f.find(".filter-bar").show():f.find(".filter-bar").hide(),"object"===_typeof(n)&&0<Object.keys(n).length&&$.each(n,function(e,t){h.find(".folio-item[data-token="+t+"]").remove()}),0===h.find(".btn-request-template").length&&(h.append("<div class='cont-template-request' style='display:none;'>Can't find what you're looking for? <a class='btn-request-template' href='#'>Request a New Template</a></div>"),h.find(".btn-request-template").click(function(e){e.preventDefault()}))}function M(){$("#top-bar #logo-bar .row.user-info > a").attr("href",i.getAppUrl(p.Environment)+"account/signin"),c.find(".loading-animation").html(e.spinner),$(".upgrade-user").remove(),w.find(".content").eq(0).prepend(C.find(".tmp-sort")[0].outerHTML),x.find(".name").text("All Examples");u.addClass("hidden").filter(":eq(2)").removeClass("hidden"),d||(E(d=!0),function(){if(console.log("reinitTemplateLabels ",p.examplesLabels),p.examplesLabels){p.examplesLabels=_.sortBy(p.examplesLabels,function(e){return app.consts.xtensioLabelSortArray.indexOf(e.Name)}),y.html("");for(var e=0;e<p.examplesLabels.length;e++){var t=p.examplesLabels[e];t.color=p.colors[e%p.colors.length];var a=$(T).data("label",t);a.addClass(t.Name.toLowerCase().split(" ").join("-")),a.find(".label").css("background-color",t.color),a.find(".name").text(t.Name||"Untitled"),a.find(".options").remove(),a.on("click",N).data("label",t),y.append(a)}}}(),function(e){if(void 0!==p){console.log("getTemplateData response");try{var t=p.exampleData;h.html(""),I(t,!1),$(".folio-item.team-temp").remove(),$(".folio-item.my-temp").remove(),"function"==typeof e&&e()}catch(e){console.trace("getTemplateData error",e)}}}(function(){console.log("eventManager.raiseEvent('reInitMixerTemplates')"),function(){p.templateTab||(p.templateTab=".xtensio-temp");s&&s.destroy();var e=C.find(".tmp-sort .item.active").data("value");e=void 0===e?"used:desc":e,s=mixitup(v,{animation:{duration:400},selectors:{target:".folio-item"},load:{filter:p.templateTab,sort:e},callbacks:{onMixEnd:function(e){},onMixFail:function(e){E(!1),console.log("No items could be found matching the requested filter")}},debug:{enable:!0},controls:{enable:!1}}),clearTimeout(r),r=setTimeout(function(){s.forceRefresh()},1e3)}(),s.filter("all"),E(!1)})),w.find(".content .tmp-sort").change(function(){s.sort($(this).data("value"))})}function E(e){console.log("toggleLoading ",e,l),e?l.show():l.hide()}function A(){var e=$(this).attr("id"),t="",a="";switch(console.log("-- id --",e),h.find(".empty-state-team-temp").hide(),h.find(".empty-state-my-temp").hide(),h.find(".cont-template-request").hide(),m.find(".x-select.tmp-labels-dropdown").hide(),k.find(".label-name").hide(),e){case"all-templates-button":y.find(".item").removeClass("active"),x.addClass("active"),U();var n="".concat(p.baseUrl,"/#xtensioexamples-all");window.history.replaceState("object or string","Xtensio Examples",n);case"all-temps-button":var o=$.trim(window.location.hash.substr(1).toLowerCase()).replace("xtensioexamples-","");if(o&&"all"!=o)var i=setInterval(function(){var e=$("#tmp-labels-container").find(".item.".concat(o));e.length&&(e.trigger("click"),clearInterval(i))},50);else t=".xtensio:not(.feat)",a="Xtensio Examples",$("#tmp-labels-container").show(),x.show(),$(".template-search-input-group").removeClass("hidden"),$("#tmp-labels-container .item").removeClass("active"),h.find(".cont-template-request").show(),$("#tmp-dashboard-content .x-select.tmp-labels-dropdown").show(),k.find(".label-name").show(),U(),p.templateTab=".xtensio-temp"}s&&s.filter(t),k.addClass("normal").find(".label-name").text(a)}function U(){f.find(".folio-item").css("display",""),f.removeClass("hidden")}function N(){var e,t=$(this),a=t.data("label");if(console.log(a),b.find(".item").removeClass("active"),t.addClass("active"),h.find(".state").hide(),k.find(".label-name").css({paddingLeft:"10px"}),k.find(".label-name").css({display:"inline-block"}),function(e){if(0<f.find("."+e).length){f.removeClass("hidden");var t=f.find(".folio-item");t.css("display",""),t.not("."+e).css("display","none")}else f.addClass("hidden")}(a.Token),a&&"own"==a.Token&&(k.find(".label-color").hide(),h.find(".own").removeClass("hidden")),!a)return s.filter(".xtensio"),k.addClass("normal").find(".label-name").text("Xtensio Examples"),void $("#examples-items-container .state").hide();k.removeClass("normal"),k.find(".label-name").text(a.Name),k.find(".label-color").css("background-color",a.color),e=a.Token,$allFolios=h.find(".as-template"),s.filter($allFolios.filter(".".concat(e,", .blank")));var n="".concat(p.baseUrl,"/#xtensioexamples-").concat(a.Name.toLowerCase().split(" ").join("-"));window.history.replaceState("object or string","Xtensio Examples",n)}},app.popup.folioPass=function(e){var t,a=$("#tmp-get-fpass"),n=a.find(".pass"),o=a.find(".agree-box"),i=a.find(".agree"),s=a.find(".folio-msg"),r=a.find(".project-msg"),l=a.find("form"),d=a.find(".error-msg").text(e.passError),c=a.find("button");a.find(".token").val(e.verificationToken),e.isProject&&(s.hide(),r.removeClass("hidden"),i.prop("checked",!e.disclaimer),e.disclaimer&&o.removeClass("hidden")),n.on("keyup",function(e){t=!n.val(),c.prop("disabled",t)}),l.submit(function(){return n.val()?e.isProject&&!0!==i[0].checked?(d.text("You must agree with the Disclaimer first."),!1):void 0:(d.text("No password given."),!1)}),$("body").append(a.addClass("show"))},app.popup.getAnonymousTemplatesPage=function(m,i,e,t,a,n,o){var s,r,l,d=$(".nav-main-menu a").not("a.help-center, a.examples-link"),c=!1,u=$("#dashboard-page"),p=$(".tab-content"),f=$("#top-bar .template-subnav"),h=$("#top-bar .example-subnav"),g=$("#tmp-dashboard-content"),v=$("#feat-templates-items-container"),b=$("#templates-items-container"),T=$("#template-item").html(),y=b,C=$("#tmp-temp-sidebar"),k=$("#single-label").html(),w=$("#tmp-labels-container"),x=g.find(".tmp-labels-dropdown"),P=(k=$("#single-label").html(),$($("#tmp-template-nav").html())),S=y.find(".label-details.temp");if(!1!==$("body").hasClass("anonymous-templates")){T=T.replace(/h4/gi,"h3"),b.before($("#tmp-temp-filter-bar").html()),b.find(".filter-bar .label-name").text("Xtensio Templates"),0===u.find("#exampleloader").length&&(u.append($('<div id="exampleloader" class="example-loader"><div class="loading-animation"></div></div>')),l=u.find("#exampleloader"));var D=null;m.templateTab=".xtensio-temp";var F=function(e){return _.sortBy(e,["CreatedDate"]).slice(-3)};return $("#all-temps-button").on("click",L),$("#all-templates-button").on("click",L),function(){A(),u.append(g),$(".folios-container.templates ").removeClass("hidden"),v.removeClass("hidden"),$("#tmplt-sidebar").append(C),app.menu.xSelect(),$(window).scroll(function(){100<=$(window).scrollTop()?$("#top-bar").addClass("fixed-header"):$("#top-bar").removeClass("fixed-header")}),x.on("change",function(){var e=$(this).val(),t=i.obtain(m.templatesLabels,"Token",e);if(null===t)return s.filter("all"),S.addClass("normal"),void B();O(t.Token),R(t.Token),S.removeClass("normal")})}}function I(o,e){$.each(e.Labels,function(e,t){var a=i.obtain(m.templatesLabels,"Token",t);if(a){var n=$('<div class="label"></div>').css("background-color",a.color).text(a.Name);n.data("token",a.Token),o.addClass(a.Token),o.find(".labels").prepend(n)}})}function M(e,t,a){for(var n=function(e,t,a){var n,o={};if(e&&t){var i=b.find(".folio-item."+e);i.length>a.length&&i.each(function(e,t){n=$(t).data("token"),o[n]=n})}return o}(t,a,e),o=!t&&F(e),i=0;i<e.length;i++){var s=b.find(".folio-item[data-token="+e[i].Token+"]");if(t){if(delete n[e[i].Token],a&&1==s.length&&s.data("type")==t&&s.hasClass(t))continue;s.remove()}s=e[i];var r=!t&&"blank"==s.TemplateName;(D=$(T)).attr("data-template",s.TemplateName).attr("data-name",s.PublicName||s.FolioName).attr("data-used",s.UsedCount).attr("data-type",t).attr("data-date",s.CreatedDate),I(D,s),s.Thumbnail&&D.find(".img").removeClass("hidden").find("img").attr("src",s.Thumbnail),s.UsedCount&&!r&&D.find(".used").text("Used "+s.UsedCount+" times"),m.baseUrl+"/folio/"+s.FolioToken;var l=D.find("h3");if(l.text(s.PublicName||s.FolioName),setTimeout(function(){l.scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",minScrollWidth:268,animBack:!0,ellips:32})},1e3),_.find(o,{FolioToken:s.FolioToken})&&(D.find(".new-label").removeClass("hidden"),D.addClass("new")),r)D.find(".primary").addClass("red").attr("href","/try").text("Create New"),D.attr("data-used",Number.MAX_SAFE_INTEGER).attr("data-date",Date.now()).attr("data-name","  "+s.PublicName).addClass("blank").find(".blank-description").removeClass("hidden"),D.find(".cta-buttons .preview").parent().remove();else{var d=e[i].Curl;d=""==d||null==d?e[i].TemplateName:d,D.find(".cta-buttons .create-btn").attr("href","/try/"+d),D.find(".cta-buttons .preview").text("Learn More")}D.find(".img").hover(function(){$(this).stop().animate({scrollTop:$(this).find("img").height()},5e3)},function(){$(this).stop().animate({scrollTop:0},2e3)}),D.find(".create-cont").hide(),D.find(".link-share-cont").hide(),D.find(".options").remove(),D.addClass("xtensio"),D.find(".preview, .link").attr("href",s.LearnMoreLink),r&&(D.find(".link").attr("href","#"),D.find(".link ").removeAttr("target")),D.css("display",""),t?b.prepend(D):b.append(D),s.IsFeatured&&(D.addClass("feat"),v.append(D))}var c,u=v.find(".folio-item");u.show(),c=u,console.log("$featFolioItems ",c,c.length),0<c.length?v.find(".filter-bar").show():v.find(".filter-bar").hide(),"object"===_typeof(n)&&0<Object.keys(n).length&&$.each(n,function(e,t){b.find(".folio-item[data-token="+t+"]").remove()}),0===b.find(".btn-request-template").length&&(b.append("<div class='cont-template-request' style='display:none;'>Can't find what you're looking for? <a class='btn-request-template' href='#'>Request a New Template</a></div>"),b.find(".btn-request-template").click(function(e){e.preventDefault()}))}function E(e){var t=$("#tmp-empty-state").html(),a=$(t),n="You haven't saved any templates yet.";return"empty-state-team-temp"===e&&(n="You don't have any Team Templates yet.",textEmpTeam="Save folios as team template for team members to use and repurpose.<br> Keep them private or share with the world."),a.addClass(e),a.find("p.imp-folio").remove(),a.find("h2").text(n),a.find("button").remove(),a.find("p.tag").html('Save folios as templates to reuse and repurpose. <br>Keep them private or share with the world.<br><br><img src="/img/empty-team-my-temp.png" style="height: 170px" />'),a}function A(){$("#top-bar #logo-bar .row.user-info > a").attr("href",i.getAppUrl(m.Environment)+"account/signin"),u.find(".loading-animation").html(e.spinner),$(".upgrade-user").remove(),$(".folios-container.templates .content").eq(0).prepend(P.find(".tmp-sort")[0].outerHTML),d.removeClass("active"),$(".nav-main-menu a.examples-link").removeClass("active");p.addClass("hidden").filter(":eq(2)").removeClass("hidden"),c?U():(N(c=!0),function(){if(console.log("reinitTemplateLabels ",m.templatesLabels),m.templatesLabels){m.templatesLabels=_.sortBy(m.templatesLabels,function(e){return app.consts.xtensioLabelSortArray.indexOf(e.Name)}),w.html(""),0===x.length&&(x=g.find(".tmp-labels-dropdown"));for(var e=0;e<m.templatesLabels.length;e++){var t=m.templatesLabels[e];t.color=m.colors[e%m.colors.length];var a=$(k).data("label",t);a.addClass(t.Name.toLowerCase().split(" ").join("-")),a.find(".label").css("background-color",t.color),a.find(".name").text(t.Name||"Untitled"),a.find(".options").remove(),a.on("click",G).data("label",t),w.append(a);var n=$("<option></option>");n.text(t.Name||"Untitled").val(t.Token),x.append(n)}}}(),function(e){if(void 0!==m){console.log("getTemplateData response");try{var t=m.templateData;b.html(""),M(t,!1),$(".folio-item.team-temp").remove(),$(".folio-item.my-temp").remove();var a=E("empty-state-my-temp"),n=E("empty-state-team-temp");a.hide(),n.hide(),b.prepend(a),b.prepend(n),"function"==typeof e&&e()}catch(e){console.trace("getTemplateData error",e)}}}(function(){console.log("eventManager.raiseEvent('reInitMixerTemplates')"),function(){m.templateTab||(m.templateTab=".xtensio-temp");s&&s.destroy();var e=P.find(".tmp-sort .item.active").data("value");e=void 0===e?"used:desc":e,s=mixitup(y,{animation:{duration:400},selectors:{target:".folio-item"},load:{filter:m.templateTab,sort:e},callbacks:{onMixEnd:function(e){},onMixFail:function(e){N(!1),console.log("No items could be found matching the requested filter")}},debug:{enable:!0},controls:{enable:!1}}),clearTimeout(r),r=setTimeout(function(){s.forceRefresh()},1e3)}(),s.filter("all"),N(!1),setTimeout(function(){U()},2e3)})),$(".folios-container.templates .content .tmp-sort").change(function(){s.sort($(this).data("value"))})}function U(){f.show(),h.hide(),u.addClass("template-sub-active")}function N(e){console.log("toggleLoading ",e,l),e?l.show():l.hide()}function L(){var e=$(this).attr("id"),t="",a="";switch(console.log("-- id --",e),b.find(".empty-state-team-temp").hide(),b.find(".empty-state-my-temp").hide(),b.find(".cont-template-request").hide(),g.find(".x-select.tmp-labels-dropdown").hide(),S.find(".label-name").hide(),e){case"all-templates-button":w.find(".item").removeClass("active"),$("#all-templates-button").addClass("active"),B();var n="".concat(m.baseUrl,"/#xtensiotemplates-all");window.history.replaceState("object or string","Xtensio Templates",n);case"all-temps-button":var o=$.trim(window.location.hash.substr(1).toLowerCase()).replace("xtensiotemplates-","");if(o&&"all"!=o)var i=setInterval(function(){var e=$("#tmp-labels-container").find(".item.".concat(o));e.length&&(e.trigger("click"),clearInterval(i))},50);else t=".xtensio:not(.feat)",a="Xtensio Templates",$("#tmp-labels-container").show(),$("#all-templates-button").show(),$(".template-search-input-group").removeClass("hidden"),$("#tmp-labels-container .item").removeClass("active"),$("#templates-items-container .cont-template-request").show(),$("#tmp-dashboard-content .x-select.tmp-labels-dropdown").show(),S.find(".label-name").show(),B(),m.templateTab=".xtensio-temp"}s&&s.filter(t),S.addClass("normal").find(".label-name").text(a)}function O(e){$allFolios=$("#templates-items-container .as-template"),s.filter($allFolios.filter(".".concat(e,", .blank")))}function R(e){if(0<v.find("."+e).length){v.removeClass("hidden");var t=v.find(".folio-item");t.css("display",""),t.not("."+e).css("display","none")}else v.addClass("hidden")}function B(){v.find(".folio-item").css("display",""),v.removeClass("hidden")}function G(){var e=$(this),t=e.data("label");if(console.log(t),C.find(".item").removeClass("active"),e.addClass("active"),$("#templates-items-container .state").hide(),S.find(".label-name").css({paddingLeft:"10px"}),S.find(".label-name").css({display:"inline-block"}),R(t.Token),t&&"own"==t.Token&&(S.find(".label-color").hide(),$("#templates-items-container").find(".own").removeClass("hidden")),!t)return s.filter(".xtensio"),S.addClass("normal").find(".label-name").text("Xtensio Templates"),void $("#templates-items-container .state").hide();S.removeClass("normal"),S.find(".label-name").text(t.Name),S.find(".label-color").css("background-color",t.color),O(t.Token);var a="".concat(m.baseUrl,"/#xtensiotemplates-").concat(t.Name.toLowerCase().split(" ").join("-"));window.history.replaceState("object or string","Xtensio Templates",a)}},app.popup.getAddMembers=function(e,t,a){var n=$("#tmp-add-member"),o=n.find(".no, .icon-Close"),i=n.find(".ok"),s=n.find("input");return n.find(".loading-animation").html(t.spinner),i.click(function(){console.log(s.val())}),t.reg(n,o),function(e){t.show(n)}},app.popup.getTeamUserActionBlocked=function(e,n,t){var o,i,a=app.strings.popups,s=a.folioStatsMsgPG,r=a.folioStatsMessageTM,l=a.templateStatsMsgPG,d=a.templateStatsMessageTM,c=a.saveCustomTemplatesMsgPG,u=a.saveCustomTemplatesMsgMember,m=a.createLinkPrivacyMsgMember,p=a.changeLinkPrivacyMsgMember,f=a.customLinksMsgPG,h=a.customLinksMsgMember,g=a.passwordProtectionMsgMember,v=a.passwordProtectionMsgNotOwner,b=a.cannotPerformAction,T=app.acl.helper(e).getMainPlanName;return o=b,function(e,t,a){switch(i='<div class="msg text-center">Sorry, '+(t||"Free Guests")+" are not allowed to ","pwd"==e?i+="edit password of this folio.":"collab"==e?i+="modify the Collaborators.":"duplicate"==e?i+="duplicate folios.":"create"==e?i=(t||"Free Guests")+" are not allowed to create folios. You can only edit folios that you are added to as a collaborator. ":"link"==e?i+="modify link sharing settings.":"transfer"==e?i+="transfer folio.":"label"==e?i+="create new channels.":"non-team-member"==e?"Guests"==t||"Premium Guests"==t?i='<div class="msg text-center">Sorry, Premium Guests can only invite existing team members':i+="invite non team members.":i+="invite-member"==e?"add new paid users to the team.":"add-remove-collab"==e?"add/remove people.":"perform this action.",i+=" Please contact your admin for more access.",e){case"existing-sfg":i="This user is already a free guest on this team. Please contact your team admin to upgrade.";break;case"stats":i="guest"==t?s:r(T());break;case"template-stats":i="guest"==t?l:d(T());break;case"password-protect":i=g;break;case"password-protect-biz":i=v(t);break;case"edit-link":i="Premium Guests"==t?f:h;break;case"team-member-collab":i="Team members can only add collaborators that are already part of the team. If you'd like to add new users to the team, please reach out to your team owner for more access.";break;case"guest-collab":case"add-remove-collab":i="Guests cannot add collaborators. Please reach out to the team owner for more access.";break;case"new-folio-public":i=m(t,T());break;case"new-folio-private":i=p(t,T());break;case"save-as-template":i="Guests"==t?c:u;break;case"leave-folio":i=leaveFolioMsgGuest;break;case"fg-add-to-channel":i="You cannot add Free Guests to channels"}n.message({heading:o,message:i,btnText:"Ok",notMini:!0,bodyCentered:!0,handleOK:a||!1})}},app.popup.getTransferFolioToSpace=function(l,d,c,u,e){var m=$("#tmp-transfer-folio-to-space"),n=m.find(".no-show"),t=m.find(".cancel, .icon-Close"),o=m.find(".teams"),a=m.find(".btn-decline"),p=0,f=null,h=null,g=!1,v=0,b="",i="",T=!1,s=!1,r=!1;function y(n,o,i){console.log("transferFolioToSpace => doSaveFolio..."),console.log("token teamId url",n,o,i),c.getFolioByToken({token:n,success:function(e){var a=JSON.parse(e.Data);c.getFolioCollaborators({token:f,success:function(t){console.log("response collaborators",t),c.getWorkspaceChannels({teamId:o,success:function(e){console.log("response channels",e),g=!1,m.find(".loading-animation").hide(),l.saveFolioTransferWithTeam={FolioName:a.FolioName,Token:n,collaborators:JSON.parse(t.Data),labels:JSON.parse(e.Data),baseUrl:i},console.log("saveFolioTransferWithTeam",l.saveFolioTransferWithTeam),d.saveFolio()},error:function(e){console.log("error in getWorkspaceChannels",e)}})},error:function(e){console.log("error in getFolioCollaborators",e)}})},error:function(e){console.log("error in getFolioByToken",e)}})}m.find(".loading-animation").html(d.spinner);function C(e,s,r){return function(){var t,a,n,o,i;T?(n=e,o=s,i=r,console.log("transferFolioToSpace => moveToAnySpace..."),g=!0,m.find(".loading-animation").show(),c.moveUserFolios({userEmail:l.userEmail,source:v,destination:n,folios:f,success:function(e){var t=$("#folio-items-container").find(".folio-item-shell[data-token='"+f+"']");t.animate({width:0,opacity:0,padding:0},500,"linear",function(){t.remove()}),y(f,n,o)},error:function(e){if(g=!1,m.find(".loading-animation").hide(),5==e.StatusCode)d.plusPrompt("create",null,!0);else if(10==e.StatusCode)d.plusPrompt("create",null,!1,!0);else if(7==e.StatusCode){var t=u.getUserPlanByST(i.ST),a=-1<t.search(/business/gi)?"pro":t;u.doUpgradePopup(d,a.toLowerCase(),"",i)}else d.error(e.Message)}})):(t=e,a=s,g||(console.log("transferFolioToSpace => addFolioToId..."),g=!0,m.find(".loading-animation").show(),c.setUserDefinedTeam({notificationId:p,teamId:t,success:function(){c.processTransfer({data:{verb:"accept",secret:h,teamId:t},success:function(){if(0==t&&l.Team.Id==v&&b==l.userName&&l.isHome){var e=$("#folio-items-container").find(".folio-item-shell[data-token='"+f+"']");e.animate({width:0,opacity:0,padding:0},500,"linear",function(){e.remove()})}y(f,t,a)},error:function(e){g=!1,m.find(".loading-animation").hide(),5==e.StatusCode?d.plusPrompt("create",null,!0):10==e.StatusCode?d.plusPrompt("create",null,!1,!0):d.error(e.Message)}})},error:function(e){d.error(e.Message)}})))}}function k(e){return function(){0==e.search(/https/)?window.location.href=e+"#accepttransfer/"+f:window.location.href=window.location.protocol+"//"+e+"#accepttransfer/"+f}}return a.click(function(){!0===s&&!0===r?$("#n-panel .item.notificationItemToken-"+f+" .no").click():c.processTransfer({data:{verb:"reject",secret:h},success:function(){location.reload()},error:function(e){d.error(e.Message)}})}),d.reg(m,t),function(e){console.trace("on transferFolioToSpace"),s=e.skipPersonal,r=e.outsideRequest,e&&e.sameUser?(T=e.sameUser,f=e.Data.Token,v=e.Data.TeamID,b=e.Owner):e&&(p=e.Id,f=e.Data.Token,h=e.Data.Code,v=e.Data.TeamID,b=e.Owner),e.verb&&(i=e.verb),console.log("verb",i),"reject"===i?a.trigger("click"):(!function(){if(console.log("transferFolioToSpace => init..."),!0===s&&!0===r&&m.addClass("outside-transfer"),l.UserTeams&&l.Team&&0!=l.Team){o.empty();for(var e=$(n.html()),t=0;t<l.UserTeams.length;t++){var a=!1;5!=l.UserTeams[t].Role&&(console.log(T,l.UserTeams[t].Id,l.Team.Id),T&&l.UserTeams[t].Id==l.Team.Id&&(a=!0),a||(e=$(n.html()),4!=l.UserTeams[t].Role&&5!=l.UserTeams[t].Role||(e.find("h3").hide(),e.find(".left").hide(),e.find(".right").hide(),e.find("h3").text(l.UserTeams[t].Name).hide()),e.find("h3").text(l.UserTeams[t].Name),!0===r?e.on("click",k(l.UserTeams[t].TeamUrl)):e.on("click",C(l.UserTeams[t].Id,l.UserTeams[t].TeamUrl,l.UserTeams[t])),o.append(e)))}}}(),d.show(m))}},app.popup.getTransferTeamFolio=function(a,n,e,o,t){var i,s,r,l={search:1,busy:2,found:3,notFound:4,sent:5},d=$("#tmp-team-transfer"),c=d.find(".paper"),u=d.find(".popup-header h1"),m=c.find(".email").val(""),p=c.find(".msg-box"),f=d.find(".keep-collaborator"),h=f.find(".keep-cb"),g=!1,v=p.find(".msg"),b=p.find(".msg-content"),T=p.find(".close-msg-btn"),y=c.find(".error"),C=c.find(".found").find(".name"),k=c.find(".not-found"),w=k.find(".name"),x=c.find(".add-msg"),P=c.find(".popup-cta"),S=c.find(".result"),D=c.find(".full-name").val(""),F=c.find(".back-btn"),I=d.find(".team-select"),M=a.token,E=!1;function A(e){var t=c.height()+16;switch(i=e,m.prop("readonly",!0),c.css("min-height",""),c.removeClass("busy search sent found not-found"),i){case l.busy:c.css("min-height",t).addClass("busy"),f.hide();break;case l.found:c.addClass("found"),C.text(s),P.text("Transfer"),g&&f.show();break;case l.notFound:c.addClass("not-found"),w.text(r),P.text("Invite & Transfer"),f.hide();break;case l.sent:c.addClass("sent"),P.addClass("no").removeClass("yes").text("Close"),S.find(".name").text(s||D.val()+" signs up and"),f.hide();break;default:c.addClass("search"),m.prop("readonly",!1),P.text("Search")}}function U(){A(l.busy);var e=h.hasClass("selected");console.log("keepOwnerAsCollaborator",e),g||(e=!1),o.transfer({data:{token:M,name:s||D.val(),email:r,message:v.val(),AllowOutside:E,keepOwnerAsCollaborator:e},success:function(e){A(l.sent)},error:function(e){A(l.search),y.show().text(e.Message||"There was an error. Please try later.")}})}return c.find(".loading-animation").html(n.spinner),h.click(function(e){e.preventDefault(),h.toggleClass("selected"),console.log(h.hasClass("selected"))}),x.click(function(){x.hide(),b.show()}),T.click(function(){x.show(),b.hide(),v.val("")}),F.click(function(){m.val(""),A(l.search)}),P.click(function(){switch(i){case l.search:""==(r=$.trim(m.val()))&&(r=I.find(".item.active").data("value"))&&m.val(r);var e=validator.isEmail(r);e&&r==a.userEmail&&a.Team&&0<a.Team.Id&&1==a.Team.Role?n.transferFolioToSpace({sameUser:!0,Data:{Token:M,TeamID:a.Team.Id,Owner:r}}):e?(y.hide(),A(l.busy),o.findUser({email:r,success:function(e){g=!1,a.Team&&0<a.Team.Id&&a.Team.Role<4&&e.Message&&(E?A(l.found):o.listTeamMembers({data:{teamId:a.Team.Id},success:function(e){for(var t=!1,a=0;a<e.Data.Data.length;a++)e.Data.Data[a].Email==r&&(t=!0,s=e.Data.Data[a].UserName,5==e.Data.Data[a].Role&&(t=!1,A(l.search),y.show().text(e.Message||"This user is a Free Guest on this team."),!0));t?(g=!0,console.log("states.found"),A(l.found)):n.message({heading:"Can not transfer folio",message:"You can transfer your folio's ownership only to another team member. Please contact your team admin if you need to transfer your folio over to someone outside your team.",btnText:"Ok",notMini:!0})},error:function(e){y.show().text(e.Message||"There was an error. Please try later.")}})),a.Team&&0<a.Team.Id&&a.Team.Role<4&&!e.Message?n.message({heading:"User Not found",message:"Team folios can only be transferred to existing Xtensio users. Please ask this person to create a free Xtensio account and try again.",btnText:"Ok",notMini:!0}):(s=e.Message||s,A(e.Message?l.found:l.notFound))},error:function(){A(l.search),y.show().text("There was an error. Please try later.")}})):y.show().text("Invalid Email");break;case l.found:U();break;case l.notFound:s=D.val(),k.toggleClass("no-name",!s),s&&U();break;default:n.close()}}),d.find(".is-team-admin").click(function(){n.transferTeamFolio(M,{allowOutside:!0})}),n.reg(d,d.find(".icon-Close"),function(){$(document).off(".enterOnTransfer")}),function(e,t){c.addClass("busy"),E=!1,f.hide(),t&&(E=t.allowOutside||!1),E?(d.addClass("is-outside"),u.html('Transfer Ownership<br><span style="font-size: 16px;">Outside Team</span>')):(d.removeClass("is-outside"),u.html("Transfer Ownership")),console.log(t),a.Team&&0<a.Team.Id&&5==a.Team.Role?n.teamUserActionBlocked("transfer"):a.Team&&0<a.Team.Id&&4==a.Team.Role?n.teamUserActionBlocked("transfer","Premium Guests"):(a.Team&&0<a.Team.Id&&(1==a.Team.Role||2==a.Team.Role)&&!E?d.addClass("team-allow-out"):d.removeClass("team-allow-out"),M=e||M,y.hide(),A(l.search),m.val(""),P.addClass("yes"),T.trigger("click"),$(document).on("keydown.enterOnTransfer",function(e){13==(e.keyCode||e.which)&&P.click()}),o.listTeamMembers({data:{teamId:a.Team.Id},success:function(e){I.find(".filter-popup-menu .item").remove();for(var t=0;t<e.Data.Data.length;t++)4!=e.Data.Data[t].Role&&5!=e.Data.Data[t].Role&&e.Data.Data[t].Email!=a.userEmail&&I.find(".filter-popup-menu").append('<div class="item" data-value="'+e.Data.Data[t].Email+'">'+(e.Data.Data[t].FullName||e.Data.Data[t].Email)+"</div>");c.removeClass("busy")},error:function(e){y.show().text(e.Message||"There was an error. Please try later."),c.removeClass("busy")}}),n.show(d))}},app.popup.getTrialExpirePopup=function(t,s,o,e,n,a){var i=$("#tmp-trial-expire"),r=i.find(".cancel, .popup-close"),l=i.find(".loading-animation"),d=!1,c=l.html(s.spinner),u=!1,m=!1;function p(){var e;t.Team&&t.Team.Plan&&(e=t.Team.Plan),function(e,t){console.log("plan",e),console.log("origin",d),$("#app-load-animation").show();var a={data:{plan:e||0,renew:0},success:function(e){console.log("response downgrade",e),t(e)},error:function(e){s.error(e.Message||"There was an error. Please try later.")},complete:function(){$("#app-load-animation").hide()}};d&&"cancel"===d?o.changePlan(a):(a.plan=0,o.cancelPlan(a))}(e,function(){c.hide(),a.raiseEvent("plusCancelled"),s.downgradeNoticePopup()})}return i.find(".tr-upgrade").click(function(e){e.preventDefault(),!0===m?s.billing(1,!1,"cardDetailsOnly"):s.universalBlocker()}),i.find(".tr-downgrade").click(function(e){e.preventDefault(),s.push(i),s.confirmDowngradePopup()}),s.reg(i,r),function(e,t,a){d=t||!1,m=a,e&&!0===e&&(u=!0,i.find(".popup-content").css({opacity:0}),c.show(),u||(i.find(".popup-content").css({opacity:1}),s.push(i)),n.hasTeam()?p():n.getData(1,function(e,t,a,n){o.getUserActiveFoliosCount({success:function(e){var i=e.Data;o.getUserTemplateCount({success:function(e){var t,a,n=e.Data;if(1<i||0<n){var o={btnText:"Go to Dashboard",notMini:!0,handleOK:function(){s.close()}};1<i&&n<1?(t="Uh oh - You have more than 1 folio!",a="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard.",o.noClose=!0):1<i&&0<n?(t="Uh oh - You have more than 1 folio and saved templates",a="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard.",o.cancelText="Nevermind"):i<2&&0<n&&(t="Uh oh - You have saved templates!",a="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.",o.cancelText="Nevermind"),c.hide(),o.heading=t,o.message=a,s.message(o),setTimeout(function(){$("#tmp-downgrade-bar").show(),$("#tmp-downgrade-bar .downgrade-bar").show()},1e3)}else p()},error:function(e){console.log("getUserTemplateCount error: ",e)}})},error:function(e){console.log("getUserActiveFoliosCount error: ",e)}})})),setTimeout(function(){e||i.addClass("dark"),c.hide(),s.show(i)},200),!0===m&&setInterval(function(){!1===$("#popup-container").is(":visible")&&s.show(i)},1e3)}},app.styleGuide.colors=function(o){var l=this,a=$("#tmp-style-guide");return{updateSwatchSelectedText:function(e,t,a){var n=t.find(".palette-res-item").length;e.html("<h3>"+a+" of "+n+" selected</h3>")},generateSelectedIcon:function(e){return'<i class="icon-CheckMark" style="color: '.concat(o.getColorContrast(e),'"></i>')},markColorDefault:function(e,t){var a=o.rgb2hex(t.css("backgroundColor")),n=o.getColorContrast(a);e.find(".palette-item").html(""),t.html('<i class="icon-Star" style="color: '+n+'"></i>')},toggleColorContent:function(e,t){e.find(".color-content-tabs").hide(),".color-mid-content"===t?e.find(".color-bot-content").show():e.find(".color-bot-content").hide(),e.find(t).show()},getArrayColors:function(e){var a=[];return e.forEach(function(e,t){-1!==e[0].indexOf("#")&&a.push(o.trimUppercase(e[0]))}),a},showMsg:function(e,t,a){var n="success"===a?"success":"error";e.html(t).removeClass("error").removeClass("success").addClass(n).show("slow"),setTimeout(function(){e.hide("slow").removeClass(n)},7e3)},savePalette:function(e,t,a,n,o,i){o.savePalette({data:{colors:JSON.stringify(e),team_Id:t.TeamId,styleGuideId:t.Id||0,append:"add"===a?1:0},success:function(e){console.log("savePalette",e),window.location.hash="managecolors",setTimeout(function(){window.location.reload()},50)},error:function(e){l.colors().showMsg(n,"There was a problem processing your request. Try again later.","error"),console.log("savePalette error",e)},complete:function(){i(!1)}})},getMaxSwatch:function(e,t){return"add"===e?t-a.find(".palette-item").length:t},checkSelected:function(e,t,a,n){var o=e.find(".palette-res-item.selected").length,i=l.colors().getMaxSwatch(t,n);if(console.log("max",i),console.log("counter",o),i<o){var s=0,r=o-i;console.log("difference",r),e.find(".palette-res-item.selected").each(function(e,t){s<r&&($(t).removeClass("selected").html(""),s++)})}o=e.find(".palette-res-item.selected").length,l.colors().updateSwatchSelectedText(a,e,o)}}},app.styleGuide.fonts=function(a){var o=this;return{createFontFace:function(e){var t=document.createElement("style");t.className="font-face-tag",t.appendChild(document.createTextNode("            @font-face {                font-family: '"+e.FontLocalName+"';                font-weight: "+e.FontWeight+";                 font-style: "+e.FontStyle+";                 src: url("+e.FontUrl+")  format('woff2');                unicode-range: "+e.UnicodeRange+";             }            ")),document.head.appendChild(t)},getSearchFontList:function(e){var t=$(".autocomplete-items");return t.length||((t=$("<div>")).addClass("autocomplete-items").css({width:e.css("width")}),e.parent().append(t)),t},applyFont:function(e,t){$("#edit-sections, #modules-preview-main").css({"font-family":"'"+t.family+"', "+e})},showFontMsg:function(e,t,a){var n="success"===a?"success":"error";e.html(t).removeClass("error").removeClass("success").addClass(n).show("slow"),setTimeout(function(){e.hide("slow").removeClass(n)},7e3)},fontTemplate:function(e,t){return e.find(".loading-animation").html(a.spinner),e.find(".owner").text(t.owner),$family=e.find(".title .family"),$family.text(t.title),$family.css({"font-family":t.family}),e},isFontDefault:function(e,t){return e==t},isFontDefaultFallback:function(e,t){return e==t},addFontToFroala:function(e,t){console.log("adding font to froala ",e.family);var a=$('<li role="presentation">'),n=$('<a class="fr-command">'),o=$("#dropdown-menu-fontFamily-1 .fr-dropdown-list[role=presentation]");n.attr({"data-id":e.id,tabindex:"-1",role:"option","data-cmd":"fontFamily","data-param1":"'"+e.family+"', "+t,title:e.title,"aria-selected":"false"}).attr("style","font-family : '"+e.family+"', "+t+";").text(e.title),a.append(n),o.append(a)},removeFontFromFroala:function(e){console.log("removing font from froala ",e.family);var t="li a[data-param1^='\\'"+e.family+"\\',']",a=$("#dropdown-menu-fontFamily-1 .fr-dropdown-list[role=presentation]").find(t);console.log("xtensio/system/google",t),console.log("font to remove",a),a.length?a.closest("li").remove():console.log(a,"not found")},toggleSpinner:function(e,t){"enable"==e?(t.removeClass("loading"),t.find(".fa-spinner").remove(),t.prop("disabled",!1)):(t.addClass("loading"),t.append('<i class="fa fa-spinner fa-spin"></i>'),t.prop("disabled",!0))},toggleAutocomplete:function(e,t,a){o.fonts().toggleSpinner(e,t),"enable"==e?(a.prop("disabled",!1),a.attr("placeholder","Search Fonts (Google Fonts, Xtensio, System)")):(a.prop("disabled",!0),a.attr("placeholder","Loading fonts..."))},uploadFontData:function(e,t){return{data:e.FontJson,id:e.SourceIdentifier,title:e.Name,default:t,owner:e.SourceString,family:e.FontJson.FontLocalName}},initialFontData:function(e,t){return{data:e.FontJson,id:e.SourceIdentifier,title:e.Name,default:o.fonts().isFontDefault(t,e.SourceIdentifier),owner:e.SourceString,family:e.FontJson.FontLocalName?e.FontJson.FontLocalName:e.FontJson.IdString}},autocompleteFontData:function(e,t,a,n){return{label:e.Name,value:t?a.IdString:a.FontLocalName,data:{data:a,id:e.SourceIdentifier,title:e.Name,default:o.fonts().isFontDefault(n,e.SourceIdentifier),owner:e.SourceString,family:t?a.IdString:a.FontLocalName}}},searchFontData:function(e,t,a){return{data:e,id:t.SourceIdentifier,title:t.Name,default:o.fonts().isFontDefault(a,t.SourceIdentifier),owner:t.SourceString,family:e.FontLocalName}}}},app.popup.getAddTeamMemberPopup=function(e,t,a){var n=$("#tmp-add-team-member"),o=n.find(".cancel, .icon-Close"),i=n.find(".loading-animation"),s=n.find("#member-search");n.find(".loading-animation").html(t.spinner);return s.on("submit",function(e){var t=$(e.target[0]).val();return i.show(),validator.isEmail(t)&&a.findUser({email:t,success:function(e){i.hide(),console.log(e)},error:function(e){e.Message}}),!1}),t.reg(n,o),function(){t.show(n),i.hide()}},app.popup.getChoosePlanPopup=function(e,t,a,n){var o=$("#tmp-choose-plan"),i=o.find(".select"),s=o.find(".ok");return t.reg(o,o.find(".icon-Close")),i.click(function(e){$(this).toggleClass("selected"),s.toggleClass("disabled",!(0<o.find(".select.selected").length)),e.preventDefault()}),function(e){e?t.push(o):t.show(o)}},app.popup.getPersonalChannelPopup=function(e,t,a,n){var o=$("#tmp-personal-channel"),i=o.find(".cancel, .popup-close"),s=o.find(".loading-animation").html(t.spinner),r=!1,l=o.find(".changes-applied"),d=$("#pchannel_name"),c=$("#pcollab-channel-cont"),u=o.find(".add-new"),m=o.find(".private-button"),p=o.find(".create-channel");function f(e){r=!e,e?(s.hide(),p.removeClass("disable")):(s.show(),p.addClass("disable"))}function h(e,t){t=t||"success",s.hide(),l.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){l.addClass("hidden"),r=!1},3e3)}return p.click(function(){if(!r){f(!1);var e=a.sanitizeText(d.val().trim());if(d.val(e),e.length<3)return h("Please provide a valid channel name.","error"),p.removeClass("disable"),void f(!0);a.createLabel({name:e,success:function(e){t.close(),window.location.reload()},error:function(e){h(e.Message||"Error creating new channel. Please try again later","error")},complete:function(){f(!0)}})}}),t.reg(o,i),function(e){d.val(""),l.addClass("hidden"),c.hide(),u.show(),m.addClass("perma-disable"),u.addClass("perma-disable"),o.find('[for="channel_access"]').addClass("perma-disable"),o.find('[for="collab"]').addClass("perma-disable"),e,t.show(o)}},app.popup.getSetupTeamPopup=function(e,t){return function(){e.PersonalSpaceFolios<=0||e.DisableP||t.message({heading:"Welcome to "+e.Team.Name+"!<br><h3>Let's finalize your setup.</h3>",message:'<div style="margin: 0 -20px; text-align: center;"><h3 style="margin-bottom: 10px;">Would you like to import any folios from your personal dashboard?</h3><span style="font-family: Proxima-Bold;">Tip:</span> This option is also available under your profile menu.</div>',btnText:"Import Folios",cancelText:"Skip",noClose:!0,notMini:!0,isSwitchCta:!0,okClass:"ok-blue",handleOK:function(){t.importFolioPopup()},handleNo:function(){t.close()}})}},app.popup.getSfgUpgradePopup=function(s,r,l,e){var d,c=$("#tmp-sfg-upgrade"),t=c.find(".popup-content"),a=c.find(".paper"),u=c.find(".popup-header"),n=a.find(".success-panel"),m=a.find(".sfg-user"),o=a.find(".status"),i=a.find(".cancel, .popup-close"),p=a.find(".btn-cancel"),f=a.find(".add-collab"),h=(a.find(".custom-msg"),a.find(".msg-content .icon-Close"),t.find(".loading-animation")),g="",v="",b="";function T(){if(h.show(),console.log("username???",v),m.find(".email").text(g),m.find(".email").val(g),m.find(".item input.email").attr("readonly",!0),0<s.Team.Id&&(1===s.Team.Role||2===s.Team.Role)){var e,t=function(){var e=0;switch(s.Team.ST){case 19:case 25:e=30;break;case 14:case 22:e=300;break;case 31:e=20;break;case 28:e=180}return e}();e=22==s.Team.ST||28==s.Team.ST?"You will be charged $"+t+"/year/user. All payments are non-refundable.":"You will be charged $"+t+"/mo/user. All payments are non-refundable.",console.log("config.Team.ST",s.Team.ST),console.log("msg",e),m.find(".msg-mem").html(e),h.hide()}else h.hide()}h.html(r.spinner);var y=function(e,t){h.hide(),o.text(e),o.show("slow"),"error"==t?(o.addClass("error"),o.removeClass("success")):(o.removeClass("error"),o.addClass("success")),setTimeout(function(){o.hide("slow")},3e3)};n.find(".back-to").click(function(){r.close()}),m.find(".back-to, .cancel, .btn-cancel").click(function(){r.close()}),p.click(function(){r.close()}),f.click(function(){if(h.show(),g){var e=m.find(".role").data("value")?m.find(".role").data("value"):4,t=m.data("email")||g;console.log("apiData???",t,e,b,d),a=t,n=e,o=b,i=d,l.changeMemberAccess({userEmail:a,userRole:n,teamId:s.Team.Id,folioToken:o,accessType:i,success:function(e){h.show(),setTimeout(function(){r.message({heading:"Success",message:"<b>"+a+"</b> has been successfully upgraded to <b>"+C(n)+"</b>",btnText:"Ok",notMini:!0,handleOK:function(){}})},2e3),h.hide()},error:function(e){h.hide(),y(e.Message,"error")}})}else y("Please add an Email to invite","error");var a,n,o,i});var C=function(e){if(s.TeamRoles)for(var t=0;t<s.TeamRoles.length;t++)if(e===s.TeamRoles[t].Id)return s.TeamRoles[t].Name;return"Error in Team ID"};return r.reg(c,i),function(e,t,a,n){var o,i;console.log("sfg data??",e,t,a,n),b=a,d=n,v=e,o=g=t,l.findUser({email:o,success:function(e){console.log("name:::",e.Message),u.find(".username").text(v||e.Message)},error:function(e){h.hide(),y(e.Message,"error")}}),i=a,l.getFolioByToken({token:i,success:function(e){JSON.parse(e.Data)},error:function(e){console.log("error",e)}}),T(),r.show(c)}},app.popup.getStyleGuidePopup=function(o,r,s,e,a,t,l,n){$("#dropdown-menu-fontFamily-1 .fr-dropdown-list[role=presentation]");var i,d,c,u,m,p,f,h,g=app.styleGuide.colors(l),v=g.updateSwatchSelectedText,b=g.generateSelectedIcon,T=g.markColorDefault,y=g.toggleColorContent,C=g.getArrayColors,k=g.showMsg,w=g.savePalette,x=g.checkSelected,P=g.getMaxSwatch,S=app.styleGuide.fonts(r),D=S.createFontFace,F=S.getSearchFontList,I=S.applyFont,M=S.showFontMsg,E=S.fontTemplate,A=S.isFontDefault,U=S.isFontDefaultFallback,N=S.addFontToFroala,L=S.removeFontFromFroala,O=S.toggleSpinner,R=S.toggleAutocomplete,B=S.uploadFontData,_=S.initialFontData,G=S.autocompleteFontData,H=S.searchFontData,Y=app.core.padlocks(a,n,o,e),j=app.acl.helper(o),z='<span class="default"><i class="icon icon-Star"></i> Default Font</span>',q='<span class="make-default"><i class="icon icon-Star"></i> Make Default</span>',V=$("#tmp-style-guide"),K=V.find("#template-user-font-entry"),J=V.find("#template-search-font-entry"),W=V.find("#user-font-list"),X=V.find(".cancel, .popup-close"),Z=V.find(".search-font"),Q=V.find(".popup-cta.search"),ee=V.find(".tabs > span[data-to]"),te=V.find(".tab"),ae=(V.find(".msg"),V.find("#team-name")),ne=V.find("#restore-defaults"),oe=V.find(".loading-animation.forpopup"),ie={},se={},re="proxima-light",le="Proxima-Light, Helvetica, sans-serif",de="No fonts found matching search keywords",ce=15,ue=!1,me=!1,pe="",fe=V.find(".upload-font"),he=V.find(".color-palette-cont"),ge=V.find("#colorinput"),ve=$("#colorpicker"),be='<div class="add-item"><span>+</span></div>',Te=V.find(".color-message"),ye=V.find(".font-message"),Ce=V.find(".loading-animation.color-loader"),ke=!1,we=V.find(".save-palette"),xe=24,$e="",Pe=V.find(".color-tab"),Se=V.find(".url-selected-swatch"),De=V.find(".results-url .colors-found"),Fe=V.find(".results-url"),Ie=V.find(".results-url .update-color-palette"),Me="add",Ee=V.find(".upload-selected-swatch"),Ae=V.find(".results-upload .colors-found"),Ue=V.find(".results-upload"),Ne=V.find(".results-upload .update-color-palette"),Le="add",Oe=V.find(".btn-upload"),Re=V.find(".popup-header-note-styleguide");function Be(e){if(console.log("loading font: ",e),ie[e.IdString])return!1;ie[e.IdString]="Loaded",D(e)}V.find(".loading-animation").html(r.spinner),ae.text(o.Team.Name),r.reg(V,X),e.addListener("aclDataLoaded",function(){Y.setStyleGuidePreviewLocks()});var _e=function(){r.show(V),oe.show(),s.restoreDefaultFonts({data:{team_Id:d.TeamId,styleGuideId:d.Id},success:function(e){se={},oe.hide();for(var t=!1,a=0;a<DbFonts.length;a++)DbFonts[a].TeamId==o.Team.Id&&(t=DbFonts[a]);if(!t)return!1;W.empty(),(c=$.map(t.TeamFonts,function(e){var t=U(re,e.SourceIdentifier);return t&&(m=e.SourceIdentifier),B(e,t)})).length&&c.forEach(function(e,t){je(e,"styleguide")})},error:function(e){return console.log(e),!1}})},Ge=function(){r.show(V)};function He(){ue||(R("disable",Q,Z),Z.xautocomplete({container:$("#tmp-style-guide"),source:function(n){s.getAllFonts({success:function(e){var t=JSON.parse(e.Data),a=$.map(t,function(t){if(t.Name)try{var e=JSON.parse(t.FontJson),a="Xtensio"==t.SourceString||"System"==t.SourceString;return G(t,a,e,m)}catch(e){console.log(t,e)}});R("enable",Q,Z),n(a)},error:function(e){return console.log(e),!1}})},minLength:3,errorMsg:de,select:function(e,t,a,n){},close:function(e,t){t.each(function(){$(e).closest(".autocomplete-items").get(0)!=$(this).get(0)&&$(this).remove()})},addElement:function(e,t,a,n,o,i){return Ye(i)}}),Je(),ue=!0)}function Ye(a){var n='<i class="icon icon-CheckMark"></i>',e=a.data.IdString in se;Be(a.data),(u=E($(J.html()),a)).addClass("search-font-entry"),p=u.find(".title .default");var o=u.find(".title .family");return e?o.append(n):p.append('<span class="add-font btn popup-cta">Add to Team</span>'),u.find(".add-font").on("click",function(e){var t=this;if(!j.styleGuideAllowed())return Ke(),!1;!function(e,t,a){e.append('<i class="fa fa-spinner fa-spin"></i>');var n=t.id,o=e.closest(".font-entry");if(Object.keys(se).length>=ce)return ze("You can't add more than "+ce+" fonts to style guide.",o);if(se[n])return;Ve(se[n]=t,o,"search",function(e){a()})}($(this),a,function(){O("disable",$(t)),$(t).remove(),o.append(n)})}),u}function je(t,e){se[t.id]=t,"styleguide"==e?console.log("font already added by froalasetup"):"Xtensio"!=t.owner&&"System"!=t.owner&&(console.log("fonts added by search fonts "),Be(t.data),N(t,le)),(u=E($(K.html()),t)).addClass("user-font-entry"),u.attr("id",t.id),u.attr("data-default",t.default),p=u.find(".title .default"),A(m,t.id)?(I(le,t),p.append(z)):p.append(q),u.find(".make-default").on("click",function(e){if(!j.styleGuideAllowed())return Ke(),!1;var t=$(this).closest(".user-font-entry").attr("id");!function a(e,t){var n=e.closest(".font-entry");var o=n.closest("#user-font-list");var i=se[t];n.addClass("loading");s.makeDefault({data:{fontStringIdentifier:i.id,team_Id:d.TeamId,styleGuideId:d.Id},success:function(e){!1,$("[data-default]").attr("data-default",!1),n.attr("data-default",!0),m=i.id,qe(i.family+" is now default font for the style guide.",n);JSON.parse(e.Data);I(le,i),n.removeClass("loading").addTimedClass("done",3e3),$fontDefaultEntry=o.find(".default .default").parent(),$fontDefaultEntry.empty().html(q),$fontDefaultEntry.find(".make-default").on("click",function(e){if(!j.styleGuideAllowed())return Ke(),!1;var t=$(this).closest(".user-font-entry").attr("id");a($(this),t)}),n.find(".default:eq(0)").empty().html(z)},error:function(e){n.removeClass("loading"),console.log(e)}})}($(this),t)}),u.find(".remove").on("click",function(e){if(!j.styleGuideAllowed())return Ke(),!1;!function(e,t){var a=t.id,n=e.closest(".font-entry");if(n.addClass("loading"),"true"==n.attr("data-default"))return n.removeClass("loading"),ze("Default font can not be removed from the style guide.",n);s.removeFont({data:{fontStringIdentifier:t.id,team_Id:d.TeamId,styleGuideId:d.Id},success:function(e){!1,qe(t.family+" is removed from the style guide.",n),se[a]&&delete se[a],n.remove(),L(t),n.removeClass("loading")},error:function(e){n.removeClass("loading"),console.log(e)}})}($(this),t)}),W.append(u)}var ze=function(e,t){if(t)var a=t.find(".inline-msg");a.html(e).removeClass("success").addClass("error").show("slow"),setTimeout(function(){a.hide("slow").removeClass("error")},5e3),oe.hide()},qe=function(e,t){if(t)var a=t.find(".inline-msg");a.html(e).addClass("success").removeClass("error").show("slow"),setTimeout(function(){a.hide("slow").removeClass("success")},5e3),oe.hide()};function Ve(t,a,e,n){s.addFont({data:{fontStringIdentifier:t.id,team_Id:d.TeamId,styleGuideId:d.Id},success:function(e){!1,a?qe(t.family+" is added to the style guide.",a):M(ye,t.family+" is added to the style guide.","success"),je(t,"search"),n()},error:function(e){a&&a.removeClass("loading"),console.log(e)}})}function Ke(){var e=app.strings.popups,t=e.pleaseUpgradeAccount,a=e.cannotPerformAction,n=e.styleGuidePreviewMsgOwner,o=e.styleGuidePreviewMsgAdmin,i=j.isOwner(),s={heading:i?t:a,message:i?n:o,notMini:!0,bodyCentered:!0,btnText:i?"See Plans":"Ok"};i&&(s=_objectSpread({},s,{cancelText:"Nevermind",handleOK:function(){r.universalBlocker()}})),r.push(V),r.message(s)}function Je(){me||(me=!0,ve.minicolors({inline:!0,letterCase:"lowercase",control:"brightness",opacity:!1,scale:1.9,change:function(e,t){if(e){try{ge.val(e),V.find(".minicolors-swatch-color").css({backgroundColor:e})}catch(e){console.log("error in color picker",error)}$(this).select()}},theme:"bootstrap"}),o.StyleGuides&&void 0!==o.StyleGuides&&(void 0!==o.StyleGuides[0].maxNumberOfColors&&(xe=o.StyleGuides[0].maxNumberOfColors),void 0!==o.StyleGuides[0].StylePickerApi&&($e=o.StyleGuides[0].StylePickerApi),console.log("maxColorSwatches",xe),console.log("stylePickerApi",$e)),function(e){if(void 0!==o.StyleGuides){he.html("");for(var t=o.StyleGuides[0].TeamColors,a=t.length>xe?xe:t.length,n=0;n<a;n++)he.append('<div class="palette-item" style="background-color: '+t[n].HexCode+'"></div>'),t[n].IsDefault&&T(he,he.find(".palette-item").last());et()}}($(this)),ge.keyup(function(){var e=$(this).val().toString(),t=/(^#[0-9A-F]{6}$)/i.test(e);t&&-1!==e.indexOf("#")&&(console.log("input value is",e),ve.minicolors("value",e))}),he.on("click",".palette-item",function(){var e=l.rgb2hex($(this).css("backgroundColor"));ve.minicolors("value",e),Qe($(this))}),he.on("click",".add-item",function(){if(!j.styleGuideAllowed())return Ke(),!1;Ze(!0);var t=setInterval(function(){var a=!0,n=l.generateRandomColor(),e=l.getColorBrightness(n);e<123?a=!1:V.find(".palette-item").each(function(e){var t=l.rgb2hex($(this).css("backgroundColor"));l.trimUppercase(t)===n&&(a=!1)}),a&&(clearInterval(t),s.addColor({data:{hexCode:n,team_Id:d.TeamId,styleGuideId:d.Id||0},success:function(e){console.log("addColor response",e),!1,k(Te,"Color added to your list.","success"),V.find(".add-item").remove(),he.append('<div class="palette-item" style="background-color: '+n+'"></div>'),Qe(V.find(".palette-item:last")),et()},error:function(e){k(Te,"There was a problem processing your request. Try again later.","error"),console.log("addColor error",e)},complete:function(){Ze(!1)}}))},500)}),V.find(".save-color").click(function(){if(!j.styleGuideAllowed())return Ke(),!1;Ze(!0);var a=l.trimUppercase(l.rgb2hex(ve.minicolors("value"))),e=""!==f.html(),n=!0;console.log("oldHex",h),console.log("hex",a),console.log("isDefault",e),l.trimUppercase(h)!==a?(V.find(".palette-item").each(function(e){var t=l.rgb2hex($(this).css("backgroundColor"));a===l.trimUppercase(t)&&(n=!1)}),n?s.updateColor({data:{oldHexCode:h,newHexCode:a,isDefault:e,team_Id:d.TeamId,styleGuideId:d.Id||0},success:function(e){console.log("updateColor response",e),!1,k(Te,"Color is updated.","success"),f.css("backgroundColor",a),h=a},error:function(e){k(Te,"There was a problem processing your request. Try again later.","error"),console.log("updateColor error",e)},complete:function(){Ze(!1)}}):(Ze(!1),k(Te,"Selected color already exists.","error"))):Ze(!1)}),V.find(".undo").click(function(){if(!j.styleGuideAllowed())return Ke(),!1;console.log("revert to ",h),ve.minicolors("value",h)}),V.find(".make-color-default").click(function(){if(!j.styleGuideAllowed())return Ke(),!1;Ze(!0);var e=l.rgb2hex(ve.minicolors("value"));s.makeColorDefault({data:{hexCode:e,team_Id:d.TeamId,styleGuideId:d.Id||0},success:function(e){console.log("makeColorDefault response",e),!1,k(Te,"Selected color is now the default color.","success"),T(he,f)},error:function(e){k(Te,"There was a problem processing your request. Try again later.","error"),console.log("makeColorDefault error",e)},complete:function(){Ze(!1)}})}),V.find(".icon-btn.delete").click(function(){if(!j.styleGuideAllowed())return Ke(),!1;""===f.html()?(Ze(!0),s.removeColor({data:{hexCode:h,team_Id:d.TeamId,styleGuideId:d.Id||0},success:function(e){console.log("removeColor response",e),!1,k(Te,"Selected color is deleted from your list.","success"),f.addClass("hide-palette"),setTimeout(function(){f.remove(),Qe(V.find(".palette-item:eq(0)")),et()},400)},error:function(e){k(Te,"There was a problem processing your request. Try again later.","error"),console.log("removeColor error",e)},complete:function(){Ze(!1)}})):(console.log("error, cant delete default color"),k(Te,"Can not delete the default color. Please make another color default to delete the selected color.","error"))}),V.find(".restore-link").click(function(e){if(!j.styleGuideAllowed())return Ke(),!1;e.preventDefault(),r.push(V),r.message({heading:"Restore colors to default",message:"Your colors list will be updated with default Xtensio colors. This can not be undone.",btnText:"Restore",cancelText:"Cancel",notMini:!0,okClass:"ok-blue",handleOK:function(){Ze(!0),s.restoreDefaultColors({data:{team_Id:d.TeamId,styleGuideId:d.Id||0},success:function(e){console.log("restoreDefaultColors",e),window.location.hash="managecolors",setTimeout(function(){window.location.reload()},50)},error:function(e){k(Te,"There was a problem processing your request. Try again later.","error"),console.log("restoreDefaultColors error",e)},complete:function(){Ze(!1)}})}})}),V.find(".pick-url-btn").click(function(){var o,e,t=V.find(".url-input").val();Fe.hide(),Ie.hide(),console.log("url input is",t),console.log(l.isValidURL(t)),-1===t.indexOf("http://")&&-1===t.indexOf("https://")&&(t="http://"+t),l.isValidURL(t)?(e=$e+(o=t),Ze(!0),$.ajax({url:e}).done(function(e){if(console.log("stylePickerApi response",e),void 0!==e.coloursBg&&void 0!==e.coloursText){var t=$.merge(C(e.coloursBg),C(e.coloursText)),a=[];$.each(t,function(e,t){-1===a.indexOf(t)&&a.push(t)}),console.log("websiteColors",a),De.html(""),a.forEach(function(e,t){De.append('<div class="palette-res-item" style="background-color: '+e+'"></div>')}),v(Se,De,0),Fe.show(),Ie.show(),k(Te,"Colors are successfully retrieved from "+o,"success")}else{var n=void 0!==e.error?e.error:"Your URL did not return any valid color values.";k(Te,n,"error"),Ze(!1)}}).fail(function(e){console.log("stylePickerApi error",e),k(Te,"There was a problem processing your request. Try again later.","error")}).always(function(){Ze(!1)})):k(Te,"Please provide a valid website URL")}),Ie.click(function(){if(!j.styleGuideAllowed())return Ke(),!1;We(Fe,Me)}),Fe.on("click",".palette-res-item",function(){if(!j.styleGuideAllowed())return Ke(),!1;var e=l.rgb2hex($(this).css("backgroundColor")),t=b(e);$(this).toggleClass("selected"),$(this).hasClass("selected")?$(this).html(t):$(this).html(""),Xe($(this),Fe,Se,Me)}),V.find(".results-url .x-select .item").on("click",function(){return j.styleGuideAllowed()?ke?void 0:(Me=$(this).attr("data-value"),V.find(".results-url .x-select .text").text($(this).text()),console.log("siteUpdateSwatch",Me),x(Fe,Me,Se,xe),!0):(Ke(),!1)}),Oe.click(function(){if(!j.styleGuideAllowed())return Ke(),!1;V.find(".uploader").click()}),V.find(".uploader").change(function(){var e=this.files&&this.files[0];if(e){Ze(!0),Ue.hide(),Ne.hide();var t=V.find("#uploadswatch-form")[0];s.uploadSwatch(t,e,{source:1,success:function(e){if(console.log("uploadSwatch response",e),!1,e.Data&&void 0!==e.Data){var t=$.parseJSON(e.Data),a=[],n=[];console.log("dataArr",t),t.forEach(function(e,t){a.push(e.HexCode)}),$.each(a,function(e,t){-1===n.indexOf(t)&&n.push(t)}),console.log("swatchColors",n),Ae.html(""),n.forEach(function(e,t){Ae.append('<div class="palette-res-item" style="background-color: '+e+'"></div>')}),v(Ee,Ae,0),Ue.show(),Ne.show(),Ze(!1),k(Te,"Colors are successfully retrieved from swatch file","success")}else{var o=void 0!==e.Message?e.Message:"There was a problem processing your file.";k(Te,o,"error"),Ze(!1)}},error:function(e){Ze(!1),console.log("uploadSwatch error",e),k(Te,"There was a problem processing your request. Try again later.","error")}})}}),V.find(".results-upload .x-select .item").on("click",function(){return j.styleGuideAllowed()?ke?void 0:(Le=$(this).attr("data-value"),V.find(".results-upload .x-select .text").text($(this).text()),console.log("uploadUpdateSwatch",Le),x(Ue,Le,Ee,xe),!0):(Ke(),!1)}),Ue.on("click",".palette-res-item",function(){if(!j.styleGuideAllowed())return Ke(),!1;var e=l.rgb2hex($(this).css("backgroundColor")),t=b(e);$(this).toggleClass("selected"),$(this).hasClass("selected")?$(this).html(t):$(this).html(""),Xe($(this),Ue,Ee,Le)}),Ne.click(function(){if(!j.styleGuideAllowed())return Ke(),!1;We(Ue,Le)}),Pe.click(function(){var e;e=$(this),Pe.removeClass("selected"),e.addClass("selected"),e.hasClass("color-picker")?y(V,".color-mid-content"):e.hasClass("color-site")?(Fe.hide(),Ie.hide(),y(V,".color-site-content")):e.hasClass("color-upload")&&(Ue.hide(),Ne.hide(),y(V,".color-upload-content"))}),app.plugin.tooltip(),Qe(V.find(".palette-item:eq(0)")))}function We(e,i){var a=e.find(".palette-res-item.selected"),t=a.length,n="Limit reached. You can't have more than "+xe+" colors in you palette.",o=!0;(console.log("counter",t),console.log("updateSwatchType",i),0===t)?(o=!1,n="Please select at least one color."):"add"===i?xe-V.find(".palette-item").length<t&&(o=!1):"replace"===i&&xe<t&&(o=!1);o?(r.push(V),r.message({heading:"Update Color List",message:"Your color list will be updated with the selected colors. This can not be undone.",btnText:"Update",cancelText:"Cancel",notMini:!0,okClass:"ok-blue",handleOK:function(){Ze(!0);var t=[],o=he.find(".palette-item");a.each(function(e){var a=l.trimUppercase(l.rgb2hex($(this).css("backgroundColor"))),n=!0;console.log("hex",a),console.log("checkDupes","add"===i),-1===t.indexOf({HexCode:a,IsDefault:!1})&&("add"===i&&o.each(function(e,t){l.trimUppercase(l.rgb2hex($(t).css("backgroundColor")))===a&&(n=!1)}),n&&t.push({HexCode:a,IsDefault:!1}))}),"replace"===i&&(t[0].isDefault=!0),console.log("colorArray",t),w(t,d,i,Te,s,Ze)}})):k(Te,n,"error")}function Xe(e,t,a,n){var o=t.find(".palette-res-item.selected").length;o<=P(n,xe)?v(a,t,o):e.hasClass("selected")&&(e.removeClass("selected"),e.html(""),k(Te,"Limit reached. You can't have more than "+xe+" colors in you palette.","error"))}function Ze(e){(ke=e)?(V.addClass("busy"),V.find(".pick-url-btn").addClass("disable-ui"),Ie.addClass("disable-ui"),we.addClass("disable-ui"),V.find(".icon-btn").addClass("disable-ui"),Ce.show()):(V.removeClass("busy"),V.find(".pick-url-btn").removeClass("disable-ui"),Ie.removeClass("disable-ui"),we.removeClass("disable-ui"),V.find(".icon-btn").removeClass("disable-ui"),Ce.hide())}function Qe(e){f=e;var t=l.rgb2hex(f.css("backgroundColor"));h=t,ve.minicolors("value",t),he.find(".palette-item").removeClass("selected"),e.addClass("selected")}function et(){V.find(".palette-item").length<xe&&0===V.find(".add-item").length&&he.append(be)}function tt(){d&&(W.empty(),(c=$.map(d.TeamFonts,function(e){return _(e,m)})).length&&c.forEach(function(e,t){je(e,"styleguide")}))}return Q.on("click",function(e){if(!j.styleGuideAllowed())return Ke(),!1;e.stopPropagation(),O("enable",Q),(i=F(Z)).empty();var t=Z.val();if(t.length<3)return i.html("You need to type at least 3 characters"),!1;s.searchFonts({data:{searchQuery:t},success:function(e){var t=JSON.parse(e.Data);(c=$.map(t,function(e){return H(JSON.parse(e.FontJson),e,m)})).length?c.forEach(function(e){var t;t=Ye(e),(i=F(Z)).append(t)}):i.html(de),O("enable",Q)},error:function(){return!1}})}),ne.on("click",function(){if(!j.styleGuideAllowed())return Ke(),!1;r.message({heading:"Warning",message:"You are going to restore fonts for style guide.",btnText:"Go ahead",cancelText:"Cancel",handleOK:_e,handleNo:Ge})}),fe.click(function(e){if(j.uploadCustomFontsAllowed()){if(Object.keys(se).length>=ce)return M(ye,"You can't add more than "+ce+" fonts to style guide.","error"),!1;V.find(".font-uploader").click()}else r.fontUploadBlocker(r,o,V)}),V.find(".font-uploader").change(function(){var e=this.files&&this.files[0],t=V.find("#uploadfont-form")[0];e&&(Ze(!0),M(ye,"Uploading font...","success"),s.uploadCustomFont(t,e,{success:function(e){if(console.log("uploadCustomFont response",e),"Error"===e.Status)M(ye,e.Message,"error");else if(e.Data&&void 0!==e.Data){$("#user-font-list").children().length;var t=JSON.parse(e.Data);Ve(B(t,!1),!1)}else console.log("Error parsing response data");Ze(!1),V.find(".font-uploader").val("")},error:function(e){console.log("uploadCustomFont error",e),M(ye,e.Message,"error"),Ze(!1),V.find(".font-uploader").val("")}}))}),ee.on("click",function(){var e=$(this).addClass("selected");ee.not(e).removeClass("selected"),current=e.index(),te.removeClass("selected").filter(":eq("+current+")").addClass("selected")}),V.find(".tabs span:eq(1)").click(function(){Je()}),function(){var t;j.isBusinessPlan()||(j.isOwner()?(Re.find(".others").hide(),Re.find(".owner").show(),Re.find(".btn-seeplans").click(function(e){e.preventDefault(),r.universalBlocker()})):(Re.find(".others").show(),Re.find(".owner").hide()),Re.show()),t=function(){(o.editMode||o.tryMode)&&(V.find(".popup-close").click(function(){j.styleGuideAllowed()&&app.editor.upgradeStyleGuide(l)}),d&&""===o.userEmail&&(defaultFontId=d.DefaultFontFamily,d.TeamFonts.forEach(function(e){e.SourceIdentifier===defaultFontId&&I(le,{family:e.FontJson.FontLocalName})})));var e=$.trim(window.location.hash.substr(1));if(!0,("styleguide"==e||"managecolors"==e)&&(pe=e,a.hasTeam()&&(a.isOwner()||a.isAdmin())))return console.log("showing styleguide before waiting to load menu",(new Date).getTime()),tt(),r.show(V,e),He(),!0;"styleguide"!==e&&""!==e||l.doSetFocus(Z,1),function(){if(!j.styleGuidePreviewAllowed())return app.popup.styleGuideBlocker(a,r,j);var e=$.trim(window.location.hash.substr(1));pe=""===e?"styleguide":e,console.log("before popup show ",W),r.show(V,pe),He()}(),tt(),Y.setStyleGuidePreviewLocks()},Ze(!0),""===o.userEmail&&o.StyleGuides?d=o.StyleGuides[0]:o.isTeam&&o.Team.Id&&s.getStyleGuides({data:{team_Id:o.Team.Id},success:function(e){try{d=JSON.parse(e.Data)[0],m=d.DefaultFontFamily,re=d.FallbackFontFamily,ce=d.maxNumberOfFonts}catch(e){console.log(item,e)}Ze(!1),t()}}),d=!1,t()}},app.popup.getTeamChannelPopup=function(o,i,n,s,r,l){var d=$("#tmp-team-channel"),e=d.find(".cancel, .popup-close"),c=d.find(".loading-animation").html(i.spinner),u=!1,a=d.find(".changes-applied"),m=$("#tmp-channel-single-email"),p=$("#channel_name"),f=$("#collab-channel-input"),h=d.find(".add-collaborators"),g=$("#collab-channel-cont"),v=$("#collab-channel-list"),t=d.find(".add-new"),b=d.find(".private-button"),T=[],y=[],C=!1,k=d.find(".add-btn"),w=[],x="private",P=d.find(".create-channel"),S='<i class="icon-PadlockBig"></i> Private <span class="desc">Only channel members can access and edit</span>',D='<i class="icon-Down-Arrow"></i>',F=!1,I=app.strings.popups,M=I.collabNotAvailableMsg,E=I.pleaseUpgradeAccount,A=app.acl.helper(o),U=A.privateLinksAllowed,N=A.getMainPlanName,L=A.getNextPlanToUpgrade,O=A.collabActive;function R(e){var t=$(m.html());t.find(".pending-actions").remove();var a,n="";e.email&&(n=e.email.toLowerCase().trim()),t.find(".name").html(e.fullName||n),t.find(".email").html(n||e.fullName),t.find(".remove").on("click",(a=e,function(){if(u=!0,c.show(),a.owner)B("Cannot remove channel owner.","error");else{var e=o.userEmail;if(a.email!==e.toLowerCase().trim()){var t=[];w.forEach(function(e){e!==a.email&&t.push(e)}),w=t,$(this).closest(".item").remove(),B((a.fullName||a.email)+" has been removed from channel.")}else B("Cannot remove yourself as collaborator.","error")}})),t.find(".role").css("display","none"),t.find(".isOwner").text("Channel Owner"),e.owner?(ownerEmail=n,t.find(".remove").hide()):t.find(".isOwner").css("opacity",0),e.owner?v.prepend(t):v.append(t)}function B(e,t){t=t||"success",c.hide(),a.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){a.addClass("hidden"),u=!1},3e3)}function _(e){u=!e,e?(c.hide(),P.removeClass("disable")):(c.show(),P.addClass("disable"))}function G(){i.message({heading:E,message:M(N(),L()),btnText:"See Plans",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){i.universalBlocker()}})}return t.click(function(){0!=O()?(g.show(),t.hide(),C=!0):G()}),b.click(function(){var e=$(this).find(".item.active").data("name");0!=O()||"private"!=e||G()}),b.change(function(){var e=$(this).data("value"),t="";console.log("action",e),"private"===e?(t=S,h.show(),C&&g.show()):(t='<i class="icon-UsersGroup"></i> Team Visible <span class="desc">All team members can access and edit</span>',h.hide(),g.hide()),b.find(".text").html(t+D),x=e}),k.click(function(e){if(e.preventDefault(),r.isPremiumGuest())i.teamUserActionBlocked("guest-collab");else{var t=s.standardizeEmail(f.val()),a=s.findIndex(t,"UserName",y);if(console.log("email",t),console.log("email indexof teamMembersListWithPending",-1===s.findIndex(t,"UserName",y)),validator.isEmail(t))if(-1===w.indexOf(t))if(-1===a)if(1===o.Team.Role||2===o.Team.Role){var n={heading:"This User is Not on Your Team Yet",message:"Please add this user as a team member or premium guest before giving them access to this channel.",bodyCentered:!0,notMini:!0,btnText:"Invite People",cancelText:"Cancel",handleOK:function(){i.teamManagePopup()}};i.push(d),i.message(n)}else i.teamUserActionBlocked("team-member-collab");else if(y[a].Id)w.push(t),f.val(""),R({email:t}),B("Collaborator added successfully.","success"),console.log("collabEmails",w);else{n={heading:"This User is Not on Your Team Yet",message:"This user has not accepted the team invitation yet. Please add them as a channel collaborator again once they've joined the team.",bodyCentered:!0,btnText:"Ok",enterAsOK:!0,notMini:!0};i.push(d),i.message(n)}else B("Collaborator already added.","error");else B("Please provide a valid email address.","error")}}),P.click(function(){if(!u){_(!1);var e=n.sanitizeText(p.val().trim());if(p.val(e),e.length<3)return B("Please provide a valid channel name.","error"),P.removeClass("disable"),void _(!0);var t=w.indexOf(o.userEmail);-1!==t&&w.splice(t,1);var a={data:{name:e,title:null,desc:null,newAccessType:"private"===x?1:2,membersAdded:w.join(","),isPrivate:U(),isIndexed:!1},success:function(e){console.log("createCollabChan res",e);var t=e.Message;!1===F?l.raiseEvent("channelAdd",{channelToken:t,goToNewChannelCb:function(e){$("#all-labels-container .item[data-name='"+e+"']").click()}}):(l.raiseEvent("channelAdd",{channelToken:t,openLabelsPopup:!0}),F=!1),i.close()},error:function(e){console.log("createCollabChan error",e),B(e.Message||"Error creating new channel. Please try again later","error"),_(!0)}};console.log("apiData",a),n.createCollabChan(a)}}),i.reg(d,e,function(){!0===F&&(i.labels(null,null,null,!0),F=!1)}),function(e){e&&(F=e.openLabelsPopupOnClose),_(!1),$("#new-team-channel-form").hide(),i.show(d),n.listALLMembers({data:{teamId:o.Team.Id},success:function(e){console.log("listALLMembers response",e),e.Data.Data.members.forEach(function(e,t){y.push(e),e.Id&&T.push(e)}),_(!0),p.val(""),C=!1,w=[],a.addClass("hidden"),v.empty(),g.hide(),t.show(),h.show(),b.find(".item").removeClass("active"),b.find("div[data-name='private']").addClass("active"),b.find(".text").html(S+D),f.easyAutocomplete({getValue:"UserName",data:T,theme:"bootstrap",list:{match:{enabled:!0}}}),w.push(o.userEmail),R({email:o.userEmail,fullName:o.userName,owner:!0}),$("#new-team-channel-form").show(),s.doSetFocus(p)},error:function(e){console.log("listALLMembers error",e)}})}},app.popup.getTeamChannelManagePopup=function(d,i,c,e,s,r,t){var u,m,p,f,h=$("#tmp-team-channel-manage"),a=h.find(".cancel, .popup-close"),o=$("#tmp-channel-single-email"),n=$("#all-labels-container"),g=h.find(".changes-applied"),v=[],b=[],T=[],l=!1,y=$("#collab-manage-channel-input"),C=h.find(".add-btn"),k=$("#collab-manage-channel-list"),w=k.find(".guests.title"),x=k.find(".members.title"),P=$(".save-list"),S="",D=h.find(".recent-members"),F=D.find(".recent-container"),I=[],M=$("#tmp-channel-single-recent"),E=h.find(".private-button"),A='<i class="icon-PadlockBig"></i> Private',U='<i class="icon-UsersGroup"></i> Team Visible',N="private",L=!1,O=h.find(".loading-animation").html(i.spinner),R=[],B=app.acl.helper(d),G=app.strings.popups,H=G.collabNotAvailableMsg,Y=G.pleaseUpgradeAccount;function j(e){if(D.hide(),F.empty(),I=[],2!==m.AccessType&&0<v.length){var t=_.reverse(v),a=3<t.length?3:t.length;console.log("reversed",t),console.log("maxNumToGet",a),console.log("collabEmails",T);for(var n=0;n<t.length;n++){var o=t[n].Email,i=""===t[n].FullName?o:t[n].FullName;if(console.log("memberEmail",o),I.length<a&&-1===T.indexOf(o)&&o!==f.Email){var s=$(M.html());s.click(function(e){var t=$(this).find(".email").text();y.val(t),X(e)}),I.push(o),s.find(".name").text(i),s.find(".email").text(o),F.append(s)}}console.log("recentList",I),0<I.length&&D.show()}e&&"function"==typeof e&&e()}function z(e){T.push(e.email),function(e){var t=$(o.html()),a="";e.email&&(a=e.email.toLowerCase().trim());t.find(".name").html(e.fullName||a),t.find(".email").html(a||e.fullName),t.find(".remove").on("click",(n=e,function(){if(n.owner)q("Cannot remove channel owner.","error");else{n.fullName||n.email;var e=$(this);i.push(h),i.message({heading:"Are you sure?",message:"Removing this user will revoke their editing access to all folios given at channel level. It will also remove any folios they own from the channel. You can still add collaborators to individual folios.",btnText:"Yes, Remove User",cancelText:"Cancel",bodyCentered:!0,enterAsOK:!0,notMini:!0,handleOK:function(){W(n.email,!0,function(){var t=[];T.forEach(function(e){e!==n.email&&t.push(e)}),T=t,e.closest(".item").remove(),j(),q((n.fullName||n.email)+" has been removed from list."),V()})}})}})),t.find(".role").css("display","none"),t.find(".isOwner").text("Channel Owner"),!0===e.isPending&&t.data("email",a).data("role",e.Role).data("accessType",e.AccessType).data("folioToken",e.FolioToken);var n;e.owner?(ownerEmail=a,t.find(".remove").hide(),k.find(".owner-list").empty().append(t)):(t.find(".isOwner").css("opacity",0),e.isGuest?(t.find(".remove").show(),k.find(".guests.list").append(t)):(2===m.AccessType?t.find(".remove").hide():t.find(".remove").show(),k.find(".members.list").append(t)),!0===e.isPending&&t.addClass("pending"),V())}(e)}function q(e,t){t=t||"success",O.hide(),g.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){g.addClass("hidden"),l=!1},3e3)}function V(){0<k.find(".guests.list").children().length?w.show():w.hide(),0<k.find(".members.list").children().length?x.show():x.hide()}function K(e){l=!e,e?(O.hide(),P.removeClass("disable")):(O.show(),P.addClass("disable"))}function J(){i.message({heading:Y,message:H(B.getMainPlanName(),B.getNextPlanToUpgrade()),btnText:"See Plans",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){i.universalBlocker()}})}function W(e,t,a){K(!1),c.addRemoveChannelCollaborator({data:{labelToken:u,memberEmail:e,remove:t},success:function(e){console.log("addRemoveChannelCollaborator response",e),a&&"function"==typeof a&&a()},error:function(e){console.log("addRemoveChannelCollaborator error",e),q(e.Message||"Error processing save list, please try again later","error")},complete:function(){K(!0)}})}function X(e){if(e.preventDefault(),r.isPremiumGuest())i.teamUserActionBlocked("guest-collab");else{var t=s.standardizeEmail(y.val()),a=_.findIndex(b,["Email",t]),n=_.find(b,["Email",t]);if(n&&5===n.Role)i.teamUserActionBlocked("fg-add-to-channel");else if(console.log("email",t),console.log("email indexof teamMembersList",-1===a),validator.isEmail(t))if(-1===T.indexOf(t))if(-1===a)if(1===d.Team.Role||2===d.Team.Role){var o={heading:"This User is Not on Your Team Yet",message:"Please add this user as a team member or premium guest before giving them access to this channel.",bodyCentered:!0,notMini:!0,btnText:"Invite People",cancelText:"Cancel",handleOK:function(){console.log("popup.teamManagePopup ",u),i.teamManagePopup(void 0,void 0,u)}};i.push(h),i.message(o)}else i.teamUserActionBlocked("team-member-collab");else if(b[a].Id)W(t,!1,function(){y.val(""),z({email:t,isGuest:4===b[a].Role}),j(),q("Collaborator email address added successfully.","success"),console.log("collabEmails",T)});else{o={heading:"This User is Not on Your Team Yet",message:"This user has not accepted the team invitation yet. Please add them as a channel collaborator again once they've joined the team.",bodyCentered:!0,btnText:"Ok",enterAsOK:!0,notMini:!0};i.push(h),i.message(o)}else q("Email address already added.","error");else q("Please provide a valid email address.","error")}}function Z(l){K(!1),c.listALLMembers({data:{teamId:d.Team.Id},success:function(e){v=[],R=[],b=[],console.log("listALLMembers response",e);for(var t,a=e.Data.Data.members,n=0;n<a.length;n++)t=a[n],b.push(t),t.Id&&v.push(t),console.log(t.Id,t.ChannelToken,u,R,t.Email),null==t.Id&&-1===_.findIndex(R,{Email:t.Email})&&R.push(t);console.log("teamMembersList",v),console.log("nonUserMembersList",R),console.log("teamMembersListWithPending",b),T=[],g.addClass("hidden"),k.find(".owner-list").empty(),k.find(".members.title").hide(),k.find(".members.list").empty(),k.find(".guests.title").hide(),k.find(".guests.list").empty(),y.easyAutocomplete({getValue:function(e){return e.FullName+" "+e.Email},data:v,theme:"bootstrap",list:{match:{enabled:!0},onChooseEvent:function(){var e=y.getSelectedItemData();console.log(e),y.val(e.Email)}}});var o,i,s,r=_.findIndex(d.labels,["Token",u]);-1!==r?(2===(m=d.labels[r]).AccessType?(o="All team members will have access to this channel. <br>You can also add premium guests as additional collaborators.",i=U,N="team"):(i=A,N="private",o="Only you and the individual collaborators you add to this channel will have access."),s='<span class="text-current">'+i+'</span><i class="icon-Down-Arrow"></i>',E.find(".text").html(s),E.find(".item").removeClass("active"),E.find("div[data-name='"+N+"']").addClass("active"),h.find(".popup-header .access-desc").html(o),console.log("channelData",m)):console.log("Error getting current label data");h.find(".popup-header .channel").text(S),c.getChannelCollaborators({data:{token:u},success:function(a){console.log("getChannelCollaborators response",a),c.getLabelOwner({data:{token:u},success:function(e){console.log("getLabelOwner response",e),z({email:(f=JSON.parse(e.Data)).Email,fullName:f.FullName,owner:!0}),p=JSON.parse(a.Data),console.log("collaboratorsData",p),0<p.length&&p.forEach(function(e,t){var a=_.findIndex(v,["Email",e.Email]),n=!1;-1!==a&&(n=4===v[a].Role),-1===T.indexOf(e.Email)&&e.Email!==f.Email&&z({email:e.Email,fullName:e.FullName,owner:!1,isGuest:n})}),j(l);for(var t=0;t<R.length;t++)(2==m.AccessType&&R[t].Role<4||2!=m.AccessType&&R[t].ChannelToken===u)&&-1===_.findIndex(T,R[t].Email)&&z({email:R[t].Email,fullName:R[t].FullName,owner:!1,isGuest:4==R[t].Role,isPending:!0,Role:R[t].Role,AccessType:R[t].AccessType,FolioToken:R[t].FolioToken})},error:function(e){console.log("getLabelOwner error",e),q(e.Message||"Error fetching channel owner details","error")},complete:function(){K(!0)}})},error:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){console.log("getChannelCollaborators error",e),q(e.Message||"Error fetching channel collaborators list","error")})})},error:function(e){console.log("listALLMembers error",e),q(e.Message||"Error fetching team members list","error")}})}return E.click(function(){var e=$(this).find(".item.active").data("name");console.log($(this),$(this).find(".item.active"),e),0!=B.collabActive()||"private"!=e||J()}),E.change(function(){if(!l){var e=function(e){var t="private"===e?A:U;t='<span class="text-current">'+t+'</span><i class="icon-Down-Arrow"></i>',E.find(".text").html(t)},t=$(this).data("value");if(0==B.collabActive()&&"team"==t)return void J();var a=$("#all-labels-container").find(".item.active").data("name"),n=_.findIndex(d.labels,["Token",a]);-1!==n&&(console.log("config.labels[labelID]",d.labels[n]),N=2===d.labels[n].AccessType?"team":"private"),console.log("private-button change",t),console.log("labelToken",a),e(t);var o="Are you sure you want to make this channel private? Your team members will be removed from folios within this channel. You can still add individual collaborators to the channel and folios.";"team"===t&&(o="Are you sure you want to make this channel team visible? All of your team members will have editing access to all folios added to this channel."),i.push(h),i.message({heading:"Channel Access Change",message:o,btnText:"Ok",cancelText:"Cancel",bodyCentered:!0,enterAsOK:!0,notMini:!0,handleOK:function(){K(!1),c.changeChannelAccess({data:{labelToken:a,newAccessType:"private"===t?1:2},success:function(e){N=t,console.log("changeChannelAccess response",e)},error:function(e){t=N,console.log("changeChannelAccess err",e)},complete:function(){K(!0),E.find(".item").removeClass("active"),E.find("div[data-name='"+t+"']").addClass("active"),e(t)}})},handleNo:function(){K(!0),e(N)}})}}),C.click(X),k.on("click",".pending-actions .b",function(){var t=$(this),a=t.closest(".item");t.text("Sending ...").css("cursor","default"),c.resendTeamUser({userEmail:a.data("email"),userRole:a.data("role"),teamId:d.Team.Id,folioToken:a.data("folioToken"),accessType:a.data("accessType"),success:function(e){t.text("Invitation Sent!"),a.find(".action").addClass("active"),setTimeout(function(){t.text("Resend Invitation").css("cursor","pointer"),a.find(".action").removeClass("active")},3e3)},error:function(e){q(e.Message,"error")},complete:function(){}})}),t.addListener("refreshMemberData",function(){L&&setTimeout(function(){Z()},200)}),i.reg(h,a),function(){L=!0,i.show(h),$("#collab-manage-channel-cont").hide();var e=n.find(".active");console.log("$channelEl",e),u=e.data("name"),S=e.find("span.name").text(),u,S,console.log("channelToken",u),console.log("channelName",S),Z(function(){$("#collab-manage-channel-cont").show(),s.doSetFocus(y,1)})}},app.popup.getTeamCollaborationPopup=function(l,d,c,r,o,e,t){var u=$("#tmp-team-collaboration"),m={main:1,notUser:2,aUser:3,pendingUser:4},i=$("#collab-single-person"),a=u.find(".toggle"),n=u.find(".changes-applied"),s=$("#team-single-recent"),p=$(".recently-added"),f=u.find(".header-collaboration-blocker"),h=u.find(".popup-content"),g=h.find(".list"),v=h.find(".selected"),b=v.find(".a-user"),T=v.find(".not-user"),y=u.find(".loading-animation"),C=u.find("#member-search"),k=C.find("#member_search"),w=u.find(".search-btn"),x=u.find(".popup-header h1.am-h .team"),P=u.find(".popup-header p.am-h .email"),S=u.find(".team-add"),D=(u.find(".team-add div"),u.find(".add-team-member")),F=u.find(".add-team-member"),I=F.find(".custom-msg"),M=F.find(".msg-content .icon-Close"),E=(u.find(".success-panel"),!0),A=!1,U=!1,N="",L="",O=0,R=null,B=[],_=[],G={},H=app.core.padlocks(o,e,l,t);function Y(){if(o.isFreeWithTeam()&&o.isPremiumGuest())d.teamUserActionBlocked("guest-collab");else{var e=A?"OK":"See Plans",t=A?null:"Nevermind";d.push(u),d.message({heading:"Please Upgrade Your Account",message:"Collaboration is available only on premium plans. Please upgrade or switch to your team dashboard to add people",btnText:e,cancelText:t,notMini:!A,handleOK:function(){A?d.close():d.universalBlocker()}})}}y.html(d.spinner),w.on("click",function(){E&&U||Y()}),o.getData(1,function(e,t,a,n){e=null==e?{}:e,console.log("data.ST",e.ST),14!==e.ST&&19!==e.ST||(A=!0),l.Team&&0<l.Team.Id&&4!==l.Team.Role&&5!==l.Team.Role&&(U=!0),o.hasTeam()?(o.isSingleFolioGuest()||o.isPremiumGuest())&&(tip="Guests can not add collaborators.",E=!1):(o.isFree()||o.isPlus())&&(E=!1),H.setCollaboratorLocks(u,E)},!0);function j(e){for(var t=0;t<B.length;t++)if(c.standardizeEmail(B[t].Email)===e&&0<B[t].Privilege&&null===B[t].Accepted)return!0;return!1}function z(e,t,a,n){switch(u.removeClass("belong-to-team"),N=t?c.standardizeEmail(t.email):"",v.removeClass("not-user"),u.removeClass("team-deny-non-xtensio add-paidmem add-guest"),v.find(".not-user input.email").attr("readonly",!1),e){case m.main:h.removeClass("selected"),h.find(".back-button").removeClass("hidden");break;case m.notUser:if(h.addClass("selected"),h.find(".back-button").addClass("hidden"),l.Team&&0!=l.Team.Id&&!a.teamMember){if(2<l.Team.Role){if(3!==l.Team.Role){var o=4===l.Team.Role?"Premium Guests":"Team Members";return void d.teamUserActionBlocked("invite-member",o)}S.find(".r1").addClass("disabled"),S.find(".r2").addClass("disabled")}else S.find(".r1").removeClass("disabled"),S.find(".r2").removeClass("disabled");n?(u.addClass(n),v.find(".username").text(L)):u.addClass("add-mem"),x.text(l.Team.Name),P.text(t.email),S.find(".email").text(N),S.find(".team").text(l.Team.Name),v.find(".email").val(L),v.find(".full-name").val(""),v.addClass("not-user").removeClass("a-user pending-user"),v.find(".not-user input.email").attr("readonly",!0)}else v.find(".email").val(N),v.addClass("not-user").removeClass("a-user pending-user");break;case m.aUser:if(h.addClass("selected"),h.find(".back-button").addClass("hidden"),l.Team&&0!=l.Team.Id&&!a.teamMember){if(2<l.Team.Role){if(3!==l.Team.Role){o=4===l.Team.Role?"Premium Guests":"Team Members";return void d.teamUserActionBlocked("invite-member",o)}S.find(".r1").addClass("disabled"),S.find(".r2").addClass("disabled")}else S.find(".r1").removeClass("disabled"),S.find(".r2").removeClass("disabled");n?(u.addClass(n),v.find(".username").text(L)):u.addClass("add-mem"),x.text(l.Team.Name),P.text(N),S.find(".email").text(N),S.find(".team").text(l.Team.Name),h.addClass("selected"),h.find(".back-button").addClass("hidden"),v.find(".email").val(L),v.addClass("a-user").removeClass("not-user pending-user"),v.find(".a-user input.email").attr("readonly",!0)}else l.Team&&0!=l.Team.Id&&a.teamMember&&(u.addClass("belong-to-team"),v.find(".team-role").text(" ("+a.RoleName+")"),v.find(".acc-lvl-txt").hide()),v.data("email",N).find(".username").text(t.name||N),v.find(".email").val(N),v.addClass("a-user").removeClass("not-user pending-user");break;case m.pendingUser:h.addClass("selected"),h.find(".back-button").addClass("hidden"),v.data("email",N).find(".username").text(t.name),v.addClass("pending-user").removeClass("not-user a-user")}}function q(e){v.addClass(e),u.find(".popup-close").addClass(e),V("",{email:L},e)}function V(n,o,i){if(C.find("input").val(""),u.removeClass("add-mem add-sfg contact-supp non-user-add"),l.Team&&o&&0!=l.Team.Id){var s=c.standardizeEmail(o.email);r.findUser({email:s,success:function(e){if(e.Message)n=j(s)?m.pendingUser:m.aUser,r.listALLMembers({data:{teamId:l.Team.Id},success:function(e){for(var t={isXUser:!0,teamMember:!1},a=0;a<e.Data.Data.members.length;a++)c.standardizeEmail(e.Data.Data[a].Email)===s&&(t.teamMember=!0,t.RoleName=e.Data.Data[a].RoleName,t.Role=e.Data.Data[a].Role);l.Team&&4===l.Team.Role&&!t.teamMember&&d.teamUserActionBlocked("non-team-member","Premium Guests"),5===t.Role?K("This user is already a Free Guest on this team.","error"):z(n,o,t,i),u.find(".loading-animation").hide()},error:function(e){u.find(".loading-animation").hide()}});else{var t={teamMember:!1,RoleName:"",Role:0,isXUser:!1};z(n=m.notUser,o,t,i)}},error:function(e){K(e.Message,"error")}})}else z(n,o,null,i)}function K(e,t,a){t=t||"success",y.hide(),a||V(m.main),n.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){n.addClass("hidden")},3e3)}function J(e,t,a,n){if(u.hasClass("belong-to-team"))y.hide(),K("A request has been sent to "+t),W(e,t,null,parseInt(a),n);else if(u.hasClass("add-guest")){X({Email:e,FullName:t,TeamId:l.Team.Id,Message:n,FolioToken:"",Accepted:null,AccessType:a,Privilege:a,Role:5})?(y.hide(),K(e+" has been added as a Free Guest."),W(e,t,null,parseInt(a),n)):K(e+" is already added on your list.","error")}else if(u.hasClass("add-paidmem")||u.hasClass("add-pg")){u.hasClass("add-paidmem")?3:u.hasClass("add-pg")&&4,X({Email:e,FullName:t,TeamId:l.Team.Id,Message:n,FolioToken:"",Accepted:null,AccessType:a,Privilege:a,Role:O})?(y.hide(),u.find(".success-panel .list-mems span").text(L),u.addClass("success"),W(e,t,null,parseInt(a),n)):K(e+" is already added on your list.","error")}}function W(e,t,a,n,o){var i={};i.Email=e,i.FullName=t,i.Accepted=a,i.Privilege=n,i.Message=o;var s=c.standardizeEmail(i.Email);if(validator.isEmail(s))if(s!==l.userEmail){if(l.Team&&5===l.Team.Role)return d.teamUserActionBlocked("collab"),!1;var r;0<(r=i,Faltu(B).filter(function(e){return e.Email&&e.Email==r.Email&&0<e.Privilege}).get()).length?K("User is already added on your list.","error"):B.push(i),ie()}else K("You cannot add your email address as collaborator.","error");else K("Please provide a valid email address.","error")}function X(e){var t,a=!1;c.standardizeEmail(e.Email);return l.Team&&5===l.Team.Role?(d.teamUserActionBlocked("collab"),!1):(0<(t=e,Faltu(_).filter(function(e){return e.Email&&e.Email==t.Email&&0<e.Privilege}).get()).length?K("User is already added on your list.","error"):(_.push(e),a=!0),a)}function Z(a){$.each(B,function(e,t){t&&t.Email===a.Email&&(B[e].Privilege=0,B[e].Accepted=null)}),Q(a),oe(),ie()}function Q(a){$.each(_,function(e,t){t&&t.Email===a.Email&&(_[e].Privilege=0,_[e].Accepted=null)}),oe()}function ee(e,t){e.Email==l.userEmail?l.isHome?d.close():d.archive(folio,function(){window.location.href="/"}):(y.show(),t.remove(),Z(e),y.hide(),e.Accepted?K((e.FullName||e.Email)+" has been removed from folio."):K("Invitation for "+(e.FullName||e.Email)+" has been cancelled."))}function te(t){return function(){if(l.Team&&5===l.Team.Role)return d.teamUserActionBlocked("collab"),!1;var a,n,e=$(this);a=e.data("value"),n=t.Email,$.each(B,function(e,t){t&&t.Email===n&&(B[e].Privilege=a,B[e].Accepted=null)}),t.Privilege=e.data("value"),K((t.FullName||t.Email)+" can "+(1==t.Privilege?"now view only.":"view and edit now."))}}function ae(e){var t=9;if(l.Team&&0<l.Team.Id&&(t=function(e){if(R)for(var t=0;t<R.length;t++)if(R[t].Email==e)return R[t].Role;return 0}(e.Email)),0!==e.Privilege&&!1!==e.Accepted){var a=3===e.Privilege&&e.Email===l.userEmail&&!0===e.Accepted;3===e.Privilege&&e.Email===l.userEmail&&!0===e.Accepted&&(owner=e);var s,n=e.Privilege<3&&e.Email==l.userEmail,o=$(i.html());o.data("person",e).addClass(2<e.Privilege||n?"owner":"collabo").find(".isOwner").text(n?"You":"Owner"),o.addClass(null===e.Accepted&&0<e.Privilege&&e.Privilege<3?"pending":""),o.addClass("team-role-"+t).attr("team-role",t),o.find(".name").text(e.FullName||e.Email),o.find(".email").text(e.Email||e.FullName),setTimeout(function(){o.find(".role").trigger("val",["value",e.Privilege]).on("change",te(e))},500),o.find(".remove").on("click",(s=e,function(){var o=!1,i=$(this).closest(".person");if(l.Team&&l.Team.Id)return y.show(),void r.listALLMembers({data:{teamId:l.Team.Id},success:function(e){for(var t=0;t<e.Data.Data.length;t++)e.Data.Data[t].Email==s.Email&&5===e.Data.Data.members[t].Role&&(a=s,n=i,y.hide(),n.remove(),3!==a.Privilege?(Q(a),Z(a),K((a.FullName||a.Email)+" has been removed from folio.")):K("Cannot remove Folio owner.","error"),o=!0);var a,n;!o&&l.Team&&5===l.Team.Role?(d.teamUserActionBlocked("collab"),y.hide()):o||ee(s,i)},error:function(e){y.hide(),K(err.Message,"error")}});ee(s,i)})).attr("data-tip",e.Accepted?a||n?"Leave Folio":"Remove Collaborator":"Cancel Invitation"),e.Email!=l.userEmail&&3===e.Privilege?o.find(".remove").remove():e.Email===G.Email&&a&&o.find(".remove").remove(),g.append(o)}}function ne(){var a=0;g.empty(),$.each(B,function(e,t){0<t.Privilege&&t.Accepted&&a++,t.Privilege=void 0===t.Privilege?1:t.Privilege,ae(t)}),a>(l.isHome?0:1)&&g.addClass("hasCollabs"),app.plugin.tooltip(),app.menu.xSelect()}f.find("a.btn").on("click",function(e){e.preventDefault(),window.location.hash="seeplans"}),I.click(function(){F.find(".msg-content").show("slow")}),M.click(function(){F.find(".msg-content").hide("slow")}),D.find(".invite-confirm").click(function(){var e=D.find(".block:eq(1) .left input").val(),t=D.find(".block:eq(1) .right input").val(),a=D.find(".block:eq(2) .role .popup-menu .item.active").data("value"),n=D.find(".opts .msg-content textarea").val();validator.isEmail(e)?(y.show(),J(e,t,a,n)):K("Please provide a valid email address.","error",1)}),y.html(d.spinner),S.find(".get-in-touch").click(function(){window.$crisp&&($crisp.push(["set","message:text",["I would like to add a new team member."]]),$crisp.push(["do","chat:open"]))}),S.find(".add-single-folio-guest").click(function(){q("add-guest")}),S.find(".add-member").click(function(){d.push(),d.teamManagePopup(!0)}),h.on("click",".pending-user .btn.yes",function(){K("An invitation has been sent again to "+function(e){for(var t=0;t<B.length;t++)if(c.standardizeEmail(B[t].Email)===e)return B[t];return null}(c.standardizeEmail(v.data("email"))).FullName)}),h.on("click",".pending-actions .b",function(){var e=$(this),t=e.closest(".person");t.data("person");y.show(),e.text("Sending ...").css("cursor","default"),y.hide(),e.text("Invitation Sent!"),t.find(".actions").addClass("active"),setTimeout(function(){e.text("Resend Invitation").css("cursor","pointer"),t.find(".actions").removeClass("active")},3e3)}),v.find(".cancel").click(function(){V(m.main)}),T.find(".add-collab").on("click",function(){var e=T.find(".full-name").val(),t=T.find(".email").val(),a=T.find(".role").data("value")?T.find(".role").data("value"):2,n=T.find(".msg-area.open").length?T.find("textarea").val():"";validator.isEmail(t)?(y.show(),l.Team&&0<l.Team.Id?J(t,e,a,n):(y.hide(),K("A request has been sent to "+e),W(t,e,null,parseInt(a),n))):K("Please provide an valid email address.","error",1)}),b.find(".add-collab").on("click",function(){y.show();var e=b.find(".username").text(),t=b.find(".role").data("value")?b.find(".role").data("value"):2,a=v.find(".email").val()||L,n=b.find(".msg-area.open").length?T.find("textarea").val():"";l.Team&&0<l.Team.Id?J(a,e,t,n):(K("A request has been sent to "+e),W(a,e,null,parseInt(t),b.find(".msg-area.open").length?b.find("textarea").val():""))}),C.on("submit",function(e){if(!E)return event.preventDefault(),!1;var t=c.standardizeEmail($(e.target[0]).val());return L=t,l.Team&&5===l.Team.Role?d.teamUserActionBlocked("collab"):(y.show(),validator.isEmail(t)?r.findUser({email:t,success:function(e){if(y.hide(),o.isFreeWithTeam()&&o.isTeamMember())return e.Message&&""!=e.Message&&null!=e.Message?void r.getMember({data:{teamId:l.Team.Id,email:t},success:function(e){teamUser=e.Data.Data,null!==teamUser.Id?(j(t)?val=m.pendingUser:val=m.aUser,V(val,{name:teamUser.FullName,email:t})):d.teamUserActionBlocked("team-member-collab")},error:function(e){console.log("getMember error??",e.Message)}}):void d.teamUserActionBlocked("team-member-collab");V(e.Message?j(t)?m.pendingUser:m.aUser:m.notUser,{name:e.Message,email:t})},error:function(e){K(e.Message,"error")}}):K("Please provide a valid email address.","error")),!1});var oe=function(){p.empty(),C.removeClass("hasRecent");var o=0;$.each(R,function(e,t){var a;if(!(3<=o)&&(!function(e){for(var t=c.standardizeEmail(e.Email),a=0;a<B.length;a++)if(c.standardizeEmail(B[a].Email)===t&&0<B[a].Privilege&&!0===B[a].Accepted)return!0;return!1}(t)&&!j(t.Email))){var n=$(s.html());n.find(".name").text(t.FullName||t.Email),n.find(".email").text(t.Email||t.FullName),n.on("click",(a=t,function(){E&&U?(L=a.Email||a.FullName,V(m.aUser,{name:a.FullName,email:a.Email})):Y()})),p.append(n),C.addClass("hasRecent"),o++}})};function ie(){ne(),oe()}return h.on("click",".team-role-5 .resend-team-inv, .team-role-0 .resend-team-inv",function(){var e=$(this),t=e.closest(".person");t.data("person");y.show(),e.text("Sending ...").css("cursor","default"),y.hide(),e.text("Invitation Sent!"),t.find(".actions").addClass("active"),setTimeout(function(){e.text("Remind").css("cursor","pointer"),t.find(".actions").removeClass("active")},3e3)}),S.find(".r1").click(function(){if($(this).hasClass("disabled")){var e=4==l.Team.Role?"Premium Guests":"Team Members";d.teamUserActionBlocked("invite-member",e,function(e,t){d.show(u)})}else 4==l.Team.Role?d.teamUserActionBlocked("non-team-member","Premium Guests"):(u.find(".popup-header h1.am-h .mem").text("Team Member "),u.find(".popup-header p.am-h").addClass("hidden"),l.Team&&l.Team.ST&&(14==l.Team.ST||19==l.Team.ST||22==l.Team.ST||25==l.Team.ST||28==l.Team.ST||31==l.Team.ST)||o.isFreeWithTeam()?(D.find(".block:eq(1) .left input").val(L),O=3,q("add-paidmem")):u.addClass("contact-supp"))}),S.find(".r2").click(function(){if($(this).hasClass("disabled")){var e=4==l.Team.Role?"Premium Guests":"Team Members";d.teamUserActionBlocked("invite-member",e,function(e,t){d.show(u)})}else 4==l.Team.Role?d.teamUserActionBlocked("non-team-member","Premium Guests"):(u.find(".popup-header h1.am-h .mem").text("Premium Guest "),u.find(".popup-header p.am-h").addClass("hidden"),l.Team&&l.Team.ST&&(14==l.Team.ST||19==l.Team.ST||22==l.Team.ST||25==l.Team.ST||28==l.Team.ST||31==l.Team.ST)?(D.find(".block:eq(1) .left input").val(L),O=4,q("add-paidmem")):u.addClass("add-pg"))}),S.find(".r3").click(function(){4==l.Team.Role?d.teamUserActionBlocked("non-team-member","Premium Guests"):(u.find(".popup-header h1.am-h .mem").text("Free Guest "),S.find(".add-single-folio-guest").trigger("click"))}),d.reg(u,u.find(".popup-close, .btn-close, .back-to, .back-button"),function(){a.off("click"),d.saveFolio(1,B,_)}),function(e){var t;u.removeClass("success"),R=null,u.find(".loading-animation").show(),y.show(),B=[],_=[],console.log("config??",l.userEmail),G={Email:l.userEmail,FullName:l.FullName,Privilege:3,Accepted:!0},"undefined"!=e&&0<e.length?e.forEach(function(e){B.push(e)}):"undefined"!=G.Email&&B.push(G),ne(),u.find(".popup-header h1.am-h .mem").text(""),u.find(".popup-header p.am-h").removeClass("hidden"),l.Team&&0<l.Team.Id?r.listALLMembers({data:{teamId:l.Team.Id},success:function(e){u.find(".loading-animation").hide(),R=e.Data.Data.members,V(1),ne(),oe(),a.parent().removeClass("open"),a.on("click",function(){$(this).parent().toggleClass("open")}),y.hide()},error:function(e){u.find(".loading-animation").hide()}}):(u.find(".loading-animation").hide(),V(1),ne(),oe(),a.parent().removeClass("open"),a.on("click",function(){$(this).parent().toggleClass("open")}),y.hide()),t=E?"15px":"130px",E||o.isFreeWithTeam()?(u.find(".popup-content").removeClass("remove-top-border"),f.addClass("hidden"),k.removeClass("disable-btns")):(u.find(".popup-content").addClass("remove-top-border"),f.removeClass("hidden"),k.addClass("disable-btns")),u.find(".icon-Close").css({top:t}),d.show(u)}},app.popup.getTeamManagePopup=function(g,v,r,b,o,T,i){var s,l,y,C=$("#tmp-team-manage"),e=C.find(".cancel, .popup-close"),t=C.find(".add-role"),d=C.find(".status"),k=$("#tmp-team-manage-single"),c=$("#invite-email"),u=$("#invite-name"),a=C.find(".invite-form .btn-invite"),n=C.find(".invite-form"),m=3,w=C.find(".members-list"),p=[],f=!1,h=C.find(".loading-animation.forpopup"),x=C.find(".disclaimer"),P=C.find(".free-desc-txt"),S=C.find(".signup-disclaimer"),D=C.find(".disclaimer+.tipped-icon"),F=C.find(".select-plan"),I=C.find(".btn-skip-step"),M=!1,E=0,A=0,U=!1,N="",L=app.strings.popups,O=L.collabNotAvailableMsg,R=L.collabNotAvailableMsgMember,B=L.pleaseUpgradeAccount,G=L.cannotPerformAction,H=L.maxUsersMsgOwner,Y=L.maxUsersMsgAdmin;L.minUsersMsg;function j(e,t,a){V(!1);var n=[{email:e,fullName:t,role:a,message:"",folioToken:"",accessType:0,TeamID:g.Team.Id}];"string"==typeof N&&0<N.length&&(n[0].ChannelToken=N),r.addMembers({data:{teamMembers:n},success:function(e){q("User added to team successfully!"),ee()},error:function(e){V(!0),q(e.Message,"error")}})}function z(){var e=b.getUrlVars();e.plan?v.payment("","signUpMode",null,e.plan):v.payment("showPlans","signUpMode")}function q(e,t){var a=e||"Error found",n="error"===t?"error":"success";clearTimeout(s),d.removeClass("success"),d.removeClass("error"),d.text(a),d.addClass(n),d.show(),s=setTimeout(function(){d.hide("slow")},5e3)}function V(e){f=!e,e?(h.hide(),w.removeClass("disabled"),n.removeClass("disabled")):(w.addClass("disabled"),n.addClass("disabled"),h.show())}function K(e){if(g.TeamRoles)for(var t=0;t<g.TeamRoles.length;t++)if(e===g.TeamRoles[t].Id)return g.TeamRoles[t].Name;return console.log("ERROR gtting role name, defaulted to Team Member"),"Team Member"}function J(t,a,e,n,o,i){var s=i.closest(".each");s.addClass("loading"),r.changeMemberAccess({userEmail:t,userRole:a,teamId:g.Team.Id,folioToken:e,accessType:n,success:function(e){setTimeout(function(){s.removeClass("done");for(var e=0;e<p.length;e++)p[e].Email==t&&(p[e].Role=a,p[e].RoleName=K(a));Q(p)},500)},error:function(e){q(e.Message,"error")},complete:function(){s.removeClass("loading")}})}function W(n,o,i){v.push(C),v.confirmRemoveMember(n,o,function(){V(!1),r.removeMember({userEmail:n,success:function(e){var t;w.find(".each:eq("+i+")").hide("slow",function(){w.find(".each:eq("+i+")").remove()});var a=_.filter(p,function(e){return e.Email===n&&(t=e),e.Email!==n});p=a,X(t),Z(),v.message({heading:"Success",message:o+" has been successfully removed from your team.",btnText:"Ok",notMini:!0,bodyCentered:!0})},error:function(e){q(e.Message,"error")},complete:function(){V(!0)}})})}function X(e,t){e&&(4===e.Role?t?E++:E--:t?A++:A--)}function Z(){var e=parseInt(E),t=parseInt(A)+1,a=1===p.length?"active user.":"active users.",n=e+t,o=1===n?"seat":"seats",i=1===e?"guest":"guests",s=1===t?"member":"members",r=y.planName(),l=-1!==r.indexOf("BasicAccess")||-1!==r.indexOf("FullAccess");(y.isFreePlan()||l)&&C.find(".team-text").hide(),C.find(".team-text .num").text(n),C.find(".team-text .seat-txt").text(o),C.find(".team-text .num-team").text(t),C.find(".team-text .mem-txt").text(s),C.find(".team-text .num-guest").text(e),C.find(".team-text .guest-txt").text(i),C.find(".ws-text .ac-text").text(a),C.find(".ws-text .num").text(p.length||0)}function Q(e){w.empty(),e.forEach(function(e,t){var a,n,o,i,s,r,l,d=e.FullName||e.Email,c=$(k.html()),u=e.Email===g.userEmail?" (You)":"",m=1===e.NumberOfChannelMemberships?"channel":"channels",p=1===e.NumberOfFolios?"folio":"folios",f=1===e.NumberOfTemplates?"template":"templates",h=e.NumberOfChannelMemberships+" "+m+", "+e.NumberOfFolios+" "+p+", "+e.NumberOfTemplates+" "+f+".";c.data("each",e).addClass(1===e.Role?"owner":"").find(".is-owner").text("Team Owner"),c.find(".loading-animation").html(v.spinner),c.find(".name").text(d+u),c.find(".email").text(e.Email),U?c.find(".access").hide():c.find(".access-txt").text(h),c.find(".action .popup-menu .item[data-value="+e.Role+"]").addClass("active"),c.find(".action .role .text").text(K(e.Role)),c.find(".remove").on("click",(a=e.Email,n=t,i=""!==(o=d)?o:a,function(){if(U){var e=g.teamMembersOnSignUp;g.teamMembersOnSignUp=e.filter(function(e){return e.Email!==a}),ee()}else y?W(a,i,n):T.addListener("aclDataLoaded",function(){return W(a,i,n)})})),c.find(".action .popup-menu .item").on("click",(s=e.Email,r=t,l=e.Role,function(){var e=$(this),t=e.data("value"),a=e.closest(".each");C.find(".members-list .each:eq("+r+"1) .action .role .text").text(K(t)),a.find(".action .item").removeClass("active"),e.addClass("active"),t!==l&&(5===l?(v.push(C),v.confirmAddMember(b.toggleSelectRole(t),1,function(){J(s,t,"","",0,e)})):J(s,t,"","",0,e))})),1===e.Role?w.prepend(c.addClass("owner")):(5!==e.Role&&c.find(".action .popup-menu .item[data-value=5]").remove(),w.append(null===e.Accepted?c.addClass("pending"):c.addClass("team-member")))}),Z(),app.menu.xSelect()}function ee(e,t){var a;V(!1),c.val(""),u.val(""),c.removeClass("error"),"string"==typeof e&&(g.Team=JSON.parse(e),g.UserTeams=[],g.UserTeams[0]=g.Team),console.log("config.Team ",g.Team),g.Team&&(a=g.Team.Id),U?0===g.teamMembersOnSignUp.length?r.listALLMembers({data:{teamId:a},success:function(e){p=e.Data.Data.members,console.log("teamMemList ",p),g.teamMembersOnSignUp.push(p[0]),g.userEmail=p[0].Email,Q(p),t&&"function"==typeof t&&t()},error:function(e){q(e.Message,"error")},complete:function(){V(!0)}}):(Q(g.teamMembersOnSignUp),V(!0)):r.listALLMembers({data:{teamId:a},success:function(e){console.log("listALLMembers",e),p=e.Data.Data.members,E=e.Data.Data.GuestSeatsPurchased,A=e.Data.Data.MemberSeatsPurchased,Q(p),t&&"function"==typeof t&&t()},error:function(e){q(e.Message,"error")},complete:function(){V(!0)}})}function te(e){var t=y,a=t.isOwner,n=t.isAdmin;o.hasTeam()?a()||n()?v.message({heading:B,message:O(y.getMainPlanName(),y.getNextPlanToUpgrade()),btnText:"See Plans",bodyCentered:!0,notMini:!0,cancelText:"Nevermind",handleOK:function(){v.universalBlocker()}}):v.message({heading:G,message:R,btnText:"Ok",bodyCentered:!0,notMini:!0}):v.message({heading:B,message:"Manage Team Members is only available on premium plans. Please upgrade or switch to your team dashboard.",btnText:"See Plans",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){v.universalBlocker()}})}function ae(){y.isFreePlan()?(x.hide(),D.hide(),P.show()):(x.show(),P.hide()),S.hide()}return h.html(v.spinner),t.change(function(){f||(m=$(this).data("value"),t.find(".text").html(b.toggleSelectRole(m)))}),a.click(function(e){e.preventDefault();var t=y.maxUsers();if(p.length>=t)1==y.isOwner()?v.message({heading:B,message:H(y.planDisplayName(),t,y.getNextPlanToUpgrade()),btnText:"Upgrade",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){v.universalBlocker()}}):1==y.isAdmin()&&v.message({heading:G,message:Y(y.planDisplayName(),t),btnText:"Ok",notMini:!0,bodyCentered:!0});else if(!f){V(!1);var a=c.val(),n=u.val(),o=!0,i="";if(c.removeClass("error"),function(e){var t=p;U&&(t=g.teamMembersOnSignUp);for(var a=0;a<t.length;a++){var n=b.standardizeEmail(t[a].Email);if(n===e&&null==t[a].Accepted&&null==t[a].ProcessedTime)return!0}return!1}(a=b.standardizeEmail(a))&&(o=!(i="You have already invited this user.")),function(e){for(var t=0;t<p.length;t++){var a=b.standardizeEmail(p[t].Email);if(a===e&&1==p[t].Accepted&&null!=p[t].ProcessedTime)return!0}return!1}(a)&&(o=!(i="This user is already a member.")),validator.isEmail(a)||(i="Please provide a valid email address.",c.addClass("error"),o=!1),o)if(U)g.teamMembersOnSignUp.push({Email:a,FullName:n,Role:m,Accepted:null,AccessType:0,Id:null,IsOwner:!1,NumberOfChannelMemberships:0,NumberOfFolios:0,NumberOfTemplates:0,Privilege:null,ProcessedTime:null,UserName:a}),q("User added to team successfully!"),ee();else if(0==y.isFreePlan()&&(1==y.isOwner()||1==y.isAdmin())&&parseInt(A)+parseInt(E)+1<=p.length){V(!0);var s=p.length;v.confirmAddMember(b.toggleSelectRole(m),s,function(){j(a,n,m),X({Role:m},!0),Z(),v.teamManagePopup(void 0,void 0,N)})}else j(a,n,m),X({Role:m},!0),Z();else q(i,"error"),V(!0)}}),F.click(z),I.click(z),w.on("click",".pending-actions .b",function(){var t=$(this),a=t.closest(".each"),e=a.data("each");V(!1),t.text("Sending ...").css("cursor","default"),r.resendTeamUser({userEmail:e.Email,userRole:e.Role,teamId:g.Team.Id,folioToken:e.FolioToken,accessType:e.AccessType,success:function(e){t.text("Invitation Sent!"),a.find(".action").addClass("active"),setTimeout(function(){t.text("Resend Invitation").css("cursor","pointer"),a.find(".action").removeClass("active")},3e3)},error:function(e){q(e.Message,"error")},complete:function(){V(!0)}})}),T.addListener("refreshMemberData",function(){M&&ee()}),v.reg(C,e),function(e,t,a){if((y=app.acl.helper(g)).addUsersAllowed()){var n=void 0;M=!0,C.find(".members").hide(),N=a,console.log("addUserToChanToken ",N),"object"===_typeof(e)&&"signUp"==e.mode&&(C.addClass("signUpMode").addClass("no-close"),n=e.data,U=!0,x.hide(),S.show(),$(".ws-text").hide(),i.tipped(g,r,b,!0),void 0===g.teamMembersOnSignUp&&(g.teamMembersOnSignUp=[])),t?C.find(".members").show():ee(n,function(){C.find(".members").show()}),v.show(C),U||(!function(){if(!(0,y.addUsersAllowed)())return te();var e=$.trim(window.location.hash.substr(1));l=""===e?"managepeople":e,v.show(C,l)}(),y?ae():T.addListener("aclDataLoaded",function(){return ae()}))}else te()}},app.popup.getTeamSettingPopup=function(t,a,n,e,o){var i=app.acl.helper(t),s=i.aclLock,r=i.teamSettingsAllowedInMenu,l=$("#tmp-team-settings"),d=(l.find(".btn-upload"),l.find(".right")),c=l.find(".team-logo img"),u=l.find(".team-url"),m=l.find(".left input"),p=l.find(".cta-btns"),f=l.find(".cancel, .popup-close"),h=p.find(".btn.popup-cta.update"),g=l.find(".url-info"),v=l.find(".msg"),b=t.Team.Name,T=t.Team.TeamUrl,y=t.Team.LogoUrl,C=null;l.find(".loading-animation").html(a.spinner),a.reg(l,f);var k=function(e){v.html(e).removeClass("success").addClass("error").show("slow"),setTimeout(function(){v.hide("slow").removeClass("error")},5e3),l.find(".loading-animation").hide()};d.click(function(){l.find(".uploader").trigger("click")}),g.click(function(e){$(e.target).is(g.find(".icon-Close"))?g.removeClass("show-info"):g.addClass("show-info")}),l.find(".uploader").change(function(){l.addClass("busy");var e=this.files&&this.files[0];e&&(form=l.find("#ts-uploadimage-form")[0],l.find(".loading-animation").show(),n.uploadTeamImage(form,e,{type:"logo",isProgress:!1,success:function(e){console.log("res",e),C=e.Data,y=e.Message,c.attr("src",y).prop("title",b),l.find(".loading-animation").hide()},error:k}))});return h.click(function(){var e;e=C?y:"",b=m.val(),l.find(".loading-animation").show(),n.saveTeam({data:{email:"",teamId:t.Team.Id,imageID:C,members:[],data:{Name:b,Status:t.Team.Status,TeamUrl:"",LogoURL:e}},success:function(e){var t;t="Updated Successfully.",v.html(t).addClass("success").removeClass("error").show("slow"),setTimeout(function(){v.hide("slow").removeClass("success")},5e3),l.find(".loading-animation").hide(),C&&(l.find(".loading-animation").hide(),$("#logo-bar .app-title a").html('<img style="max-width: 80px; max-height: 40px; margin-top: -4px; max-height:calc(100% - 4px);" src="'+y+'">').css({textAlign:"center"}))},error:function(e){k(e.Message),l.find(".loading-animation").hide()}})}),function(){c.attr("src",y),u.text(T),m.val(b),o.doSetFocus(m),s(function(){if(!r())return!1;var e=$.trim(window.location.hash.substr(1));hashVal=""===e?"teamsettings":e,a.show(l,hashVal)})}},app.menutcopy=function(o,i,e,s,r,t){var a=$("#tmp-copy-template-topbar"),n=a.find(".ok.edit-preview-template"),l=a.find(".present"),d=app.editor.present(e),c=a.find(".white-curved-arrow"),u=a.find(".try-xtensio-text"),m=!1;if(console.log("config.EditTemplate: ",o.EditTemplate,o.isUserTemplate,o),console.log("enableExampleTemplateHeaders",o.enableExampleTemplateHeaders),1==o.enableExampleTemplateHeaders&&(1==o.showHeader||2==o.showHeader)){$homePage=$("#home-page");var p=$("#tmp-header-template"),f=$("#tmp-footer-template"),h=$("#tmp-faq");if(0===$homePage.find("#tmp-header-template").length){var g=p.find(".cont-right .use-temp"),v=1==o.showHeader?"Template":"Example",b=p.find(".back-link");p.find(".cont-center h1").text(o.seoTitle),p.find(".cont-center p").text(o.seoDescription),p.find(".cont-left img").attr("src",o.seoImage),p.find(".cont-right .use-num").text(o.useCount),b.text("< See All ".concat(v,"s")),g.text("Use ".concat(v)),o.lastModified?p.find(".cont-right .last-updated span").text(o.lastModified):p.find(".cont-right .last-updated").hide(),b.click(function(){var e="https://xtensio.com/examples/?_ga=2.65959978.561003538.1581718826-910912414.1580898754";if(""!==o.userName){var t="Example"===v?"examples":"xtensiotemplates";e="".concat(o.baseUrl,"/#").concat(t)}window.location.href=e}),o.relatedFolios&&0<o.relatedFolios.length&&o.relatedFolios.forEach(function(e){var t=$($("#tmp-header-item").html());t.find("h4").text(e.FolioTitle),t.find("img").attr("src",e.FolioThumbnail),t.find("a").attr("href",e.FolioUrl),t.find(".img").hover(function(){$(this).stop().animate({scrollTop:$(this).find("img").height()},5e3)},function(){$(this).stop().animate({scrollTop:0},2e3)}),p.find(".comparison .container").append(t)}),o.folioLabels&&0<o.folioLabels.length&&o.folioLabels.forEach(function(e){return p.find(".cont-center .tags").append($("<span>".concat(e.Name,"</span>")))}),$homePage.prepend(p)}if(0===$homePage.find("#tmp-faq").length){$homePage.append(h),h.find(".item-faq .i-btn, .item-faq .text").click(function(){var e;e=$(this).parent(),$that=e.find(".i-btn"),e.find(".item-full").slideToggle(200,function(){$(this).is(":visible")?($that.html('<i class="fa fa-minus-circle"></i>'),a.find(".item-full").not($(this)).slideUp(400,function(){$(this).parent().find(".i-btn").html('<i class="fa fa-plus-circle"></i>')})):$that.html('<i class="fa fa-plus-circle"></i>')})})}if(0===$homePage.find("#tmp-footer-template").length){var T=f.find(".get-started");$homePage.append(f)}}""!==o.userName?(n.text("Edit this Folio"),c.css("display","none"),u.text("").css("display","none")):(c.css("display","inline-block"),u.html("Start editing your "+o.FolioName.toLowerCase()+" and other collateral").css("display","inline-block"),n.text("Get Started - Free")),"true"==o.EditTemplate||o.isUserTemplate||o.isTeamTemplate?((o.isUserTemplate||o.isTeamTemplate)&&0<o.Team.Id&&(a.find("i.icon-Logo").remove(),a.find(".app-title a").append('<img src ="'+o.Team.LogoUrl+'" title="'+o.Team.Name+'" style="max-height:35px;margin-top: -12px;">'),a.find(".text").text(o.FolioName)),(o.isUserTemplate||o.isTeamTemplate)&&n.text("Use This Template"),$(document).click(function(e){s.close(),m&&(m=!1,$("body").removeClass("signupPopupOpen"),console.log("signup popup closed"))}),$("#popup-container .popup-content").click(function(e){e.stopPropagation()}),0<$("#antiForgeryContainer").length?$("#antiForgeryContainer").after(a):$("body").prepend(a),$("#home-page").css({paddingTop:"50px"})):$("body").append(l.addClass("fly")),o.presentationMode||l.hide(),"dash-explore"==o.EditTemplate&&(l.addClass("fly").css({top:"55px"}).show(),$("#tmp-dashboard-content .folios-container.explore").append(l));r.setLock(function(e,t){}),l.on("click",function(){a.hide(),l.hide();var e=$("#home-page").css("paddingTop");$("#home-page").css({paddingTop:"0px"}),d.start(function(){a.show(),l.show(),$("#home-page").css({paddingTop:e})})}),o.userName||a.find(".app-title a").attr("href","https://xtensio.com");var y=o.lastTeamUrl||"https://app.xtensio.com";a.find(".user-info a").attr("href",y),n.on("click",function(){$(this);var e=o.token,t=o.FolioName?"Untitled ("+o.FolioName+")":"Untitled";if(console.log("Fname: "+t),o.redirectToTeamSignup)console.log("popup.signupPlansPopup"),s.signupPlansPopup();else if(o.userName){var a=!!o.UserTeams&&0<o.UserTeams.length;console.log("in copytemplatemenu.js"),a?o.UserTeams&&0<o.UserTeams.length&&r.checkFoliosLimitReached(i,s,function(){console.log("token name",e,t),s.addFolioToSpace(e,t)}):r.checkFoliosLimitReached(i,s,function(){r.doPersonalTemplateCopy(t,e,s)})}else!o.t||"library@xtensio.com"!=o.folioUserName&&"template@xtensio.com"!=o.folioUserName?($("body").addClass("signupPopupOpen"),m=!0,s.signUp(!0)):r.redirectFromContent();return!1}),setTimeout(function(){g&&g.click(function(e){e.preventDefault();$(this);var t=o.token;return r.processTemplateCopy(t,s,function(){return m=!0}),!1}),T&&T.click(function(e){e.preventDefault();$(this);var t=o.token,a=o.FolioName?"Untitled ("+o.FolioName+")":"Untitled";if(console.log("Fname: "+a),o.redirectToTeamSignup)console.log("popup.signupPlansPopup"),s.signupPlansPopup();else if(o.userName){var n=!!o.UserTeams&&0<o.UserTeams.length;console.log("in copytemplatemenu.js"),n?o.UserTeams&&0<o.UserTeams.length&&r.checkFoliosLimitReached(i,s,function(){console.log("token name",t,a),s.addFolioToSpace(t,a)}):r.checkFoliosLimitReached(i,s,function(){r.doPersonalTemplateCopy(a,t,s)})}else!o.t||"library@xtensio.com"!=o.folioUserName&&"template@xtensio.com"!=o.folioUserName?($("body").addClass("signupPopupOpen"),m=!0,s.signUp(!0)):r.redirectFromContent();return!1})},1e3)},app.main=function(o,e){consologs(o);var t,a,n,i=$("#notify-popup"),s=app.strings.general,r=s.freeSharedFolioMsg,l=s.freeSharedFolioCTA;function d(e){var t=$("#tmp-power-by-footer");if(t.removeClass("hidden"),isChannelOwner=o.Team&&1==o.Team.Role,"normal"==e&&isChannelOwner){var a=t.find(".power-by-footer"),n=l;a.addClass("footer-on-free"),a.html(r+n),$("body").addClass("showFreeBanner"),a.find("a.see-plans").click(function(e){return e.preventDefault(),app.popup.universalBlocker(),!1})}else t.find("upgrade"==e?".normal":".upgrade").addClass("hidden"),t.find("."+e).removeClass("hidden");return t}app.isconsole="localhost"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||o.isAdmin;var c=["#66D7C4","#FFD271","#FD9F4D","#F67157","#E95F5E","#FFFFFF","#DCBB9F","#76D5E5","#6486A5","#2E5668","#D45D77","#9D557C","#7E8589","#FFFFFF","#000000","#052B3E"];function u(e){var a=[];return e.forEach(function(e,t){a.push(e.HexCode)}),a}if(o.Team&&0!==o.Team.Id&&void 0!==o.StyleGuides?c=u(o.StyleGuides[0].TeamColors):void 0!==o.DefaultColors&&(c=u(o.DefaultColors)),o.colors=c,app.menu.xSelect(),o.isBlocked||o.IsDelinquent)location.href="/";else{if(o.getPass||e&&e.GetPass)app.popup.folioPass(o);else{var m,p,f,h,g=app.core.main(o,e),v=g.eventManager,b=g.pageManager,T=g.store,y=g.modStore,C=g.folioStore,k=g.configStore,w=g.appHub,x={};if(t=g.utility,a=g.apiHelper,n=g.plusHelper,$("body").toggleClass("tryModeEditor",!0===o.tryMode),app.plugin.main(o,g,e,n,t),(o.dashboardMode||o.editMode||o.tryMode||o.EditTemplate||o.isProject)&&(x=app.popup.main(o,v,t,a,b,n,y,T,e,C,k,w)),o.checkoutMode){$("body").append('<div class="checkout-loader-container"></div>');var P=$(".checkout-loader-container");P.html($("#tmp-checkout-overlay").html()),P.show(),o.checkLoadTimeout=setTimeout(function(){$("#app-load-animation").css({zIndex:9999999}).show()},3e3)}if(o.isProject)return o.banner&&$("#view-project").after(d("normal")),void((o.getPass||e&&e.GetPass)&&app.popup.folioPass(o));var S,D,F,I,M,E='<style id="folio-style" type="text/css">'+(C.get("style")||"")+"</style>";if($("head").append(E),m=o.editMode||o.tryMode?app.menu.main(o,e,g,x):{},f=(p=app.managers.main(o,e,g,m,x,t)).modManager,h=p.rddm,app.factory.main(o,e,g,m,x,f,h,t),o.editMode||o.tryMode)e.IsUserTemplate&&$("#tmp-collaborators").remove(),app.common.main(o,a,v,t,x,T,w,e,app.plugin,n),app.editor.main(o,e,a,v,b,x,t,T,f,C,n),b.setupEditPage(o,e,f),t.implementDefaultFont(o),o.banner&&d("upgrade"),e.Version<1&&1!=T.get("upgrade-"+o.token)&&x.message({heading:"Upgrade Editor?",message:"This folio was created using an older version of our text editor.<br/>(Upgrading may affect the existing formatting minimally,<br/> but gives you super powers.)",btnText:"Use New Editor",cancelText:"Keep Existing",handleNo:function(){T.set("upgrade-"+o.token,1)},handleOK:function(){x.busy(),a.upgradeFolio({success:function(){x.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully upgraded. You need to refresh this page.",handleOK:function(){location.reload()}})},error:function(e){x.error(e.Message)}})}}),app.editor.viewOnly(e),0<$("#tmp-secondary-bar").length&&($(".module-container").length<1||$(".empty-module-container").length==$(".module-container").length)&&$("#tmp-secondary-bar .add-module-button").trigger("click"),window.IntersectionObserver&&(D=new IntersectionObserver(function(e){var t=!0,a=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)entry=o.value,entry.isIntersecting?$(entry.target).find(".section-settings").addClass("fixed-menu"):$(entry.target).find(".section-settings").removeClass("fixed-menu")}catch(e){a=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}},{rootMargin:"-200px 0px -200px 0px"})),setTimeout(function(){var t="";$("#edit-sections").on("mouseover",".module-container",function(){if(!(S=$(this)).hasClass("canvas-module-container")&&!S.hasClass("empty-module-container")){if(1===S.parents(".canvas-module-container").length){var e=S.parents(".canvas-module-container");L($("#edit-sections .module-container"),!1),L($("#edit-sections .module.empty-module:not(.empty-canvas-cont)"),!1),t=e.attr("id"),L(e,!0)}else t="",L($("#edit-sections .module-container"),!1),L($("#edit-sections .module.empty-module:not(.empty-canvas-cont)"),!1);L(S,!0)}}),$("#edit-sections").on("mouseover",".canvas-module-container",function(){t!==$(this).attr("id")&&(N(),t=$(this).attr("id"),L($(this),!0))}),$("#edit-sections").on("mouseover",".module.empty-module:not(.empty-canvas-cont)",function(){t="",N(),L($(this),!0)}),$("#edit-sections").on("mouseover",".edit-div",function(){S&&S.parents(".edit-div").get(0)===this||(t="",N(),L($(this),!0))})},500),$(window).on("resize scroll",function(){null!==F&&clearTimeout(F),F=setTimeout(function(){(!M||M&&!t.isElementInViewport(I))&&U()},350)}),U();else $("#edit-page").remove(),f.activatePreview(),app.dash.archivedFolioTopBanner(o,x,e,n),app.menutcopy(o,a,v,x,n,t),$("#home-page").after($("#presentation-buttons").addClass("public"));app.editor.addWatermark(o,x,n,a)}var A;A=0,o.UserTeams&&o.editMode&&0<o.UserTeams.length&&(A=o.DisableP?parseInt(o.UserTeams.length):parseInt(o.UserTeams.length)+1,console.log("userSpaces mainJs??",A),1===A||1<A&&(o.Team&&0!=o.Team.Id?(i.find(".logged-in .text").html("You are logged into team: <b>"+o.Team.Name+"</b>"),$("#tmp-dash-topbar .upgrade-btn, #tmp-primary-bar .upgrade-btn").remove()):i.find(".logged-in .text").html("You are logged into your <b>Personal Account</b>"),i.removeClass("on").addClass("logged-in").show(),setTimeout(function(){i.hide("slow").removeClass("logged-in")},2500)))}function U(){N(),$("#edit-sections").find(".edit-div").each(function(){if(t.isElementInViewport($(this)))return $(this).find(".section-content").trigger("mouseover"),!1})}function N(){L($("#edit-sections .module-container"),!1),L($("#edit-sections .module.empty-module:not(.empty-canvas-cont)"),!1)}function L(a,e){if(e){var t=a.closest(".edit-div"),n=t.find('div[title="Section Settings"]'),o=a.hasClass("edit-div");if($(".edit-div").removeClass("active-edit-div"),o?(n=a.find('div[title="Section Settings"]'),a.addClass("active-edit-div").find(".section-content").addClass("highlight")):(t.addClass("active-edit-div"),a.addClass("highlight")),!n.hasClass("btn drop-down-open")){var i=.9*window.innerHeight,s=o?a:t,r=s.find(".section-settings");I=s,$('div[title="Section Settings"]').each(function(e){var t=$(this).closest(".section-settings");t.removeClass("fixed-menu"),t.find(".button-panel").fadeOut(200,function(){t.find(".button-panel").hide()}),$(this).removeClass("drop-down-open"),$(this).closest(".drop-down-container").removeClass("showing"),t.find(".move-menu").hide(),t.find(".more-menu").hide(),D&&D.unobserve(a.closest(".edit-div").get(0))}),s.height()>=i&&(r.addClass("fixed-menu"),D&&D.observe(s.get(0))),n.trigger("click"),M=!0}}else a.removeClass("highlight"),M=I=!1}},app.dashboard=function(e){consologs(e),console.log(e),e.isDashboard=!0;e.colors=["#66D7C4","#FFD271","#D45D77","#9D557C","#3C688F","#1ab9d3","#fd9f4c","#c93555","#7e8589","#dcbc9f"],e.myLabel={ID:0,Name:"My Templates",TimeStamp:0,Token:"own",HasPass:!1,GetPass:!1,Private:!0,Title:"",Description:"",Data:null,FolioTokens:null,color:"#FF0000"},e.xtensioLabel={ID:0,Name:"Xtensio Templates",TimeStamp:0,Token:"xtensio",HasPass:!1,GetPass:!1,Private:!0,Title:"",Description:"",Data:null,FolioTokens:null,color:"#FF0000"};var t,a=app.core.main(e),n=a.utility,o=a.apiHelper,i=a.eventManager,s=a.pageManager,r=a.store,l=a.appHub,d=a.modStore,c=a.plusHelper,u=a.configStore;app.plugin.main(e,a,null,c,n),t=app.popup.main(e,i,n,o,s,c,d,r,void 0,void 0,u,l);var m=document.location.href,p=$.trim(window.location.hash.substr(1));-1<(m=m.toLowerCase()).indexOf("teams/create")?t.signUpTeam():-1<m.indexOf("/templates")?t.anonymousTemplatesPage():-1<m.indexOf("/examples")?t.anonymousExamplesPage():e.isSignup?t.signUp():e.loginState?t.signIn():"signup-plans"===p||e.redirectToTeamSignup?t.signUpTeam():(app.common.main(e,o,i,n,t,r,l,{},app.plugin,c),app.dash.main(e,i,o,n,t,c),app.menu.xSelect(),"not-set"!=e.ExploreTabFolioToken?($("#tmp-dash-topbar .explore").show(),$("#tmp-dash-topbar .explore").click(function(){0<$("#tmp-dashboard-content .explore.not-populated").length&&(app.dash.getExploreFolio(e,o,t),$("#tmp-dashboard-content .explore.not-populated").removeClass("not-populated"))})):($("#tmp-dash-topbar a.explore").hide(),$("#tmp-dashboard-content .explore.not-populated").removeClass("not-populated")));var f=$("#notify-popup"),h=0;e.UserTeams&&0<e.UserTeams.length&&(h=e.DisableP?parseInt(e.UserTeams.length):parseInt(e.UserTeams.length)+1,console.log("userSpaces??",h),1===h||1<h&&(e.Team&&0!=e.Team.Id?(f.find(".logged-in .text").html("You are logged into team: <b>"+e.Team.Name+"</b>"),(0==c.isFreeWithTeam()||c.isFreeWithTeam()&&!c.isOwner())&&($("#tmp-dash-topbar, #tmp-primary-bar").addClass("hide-upgrade-btn"),$("#tmp-dash-topbar .upgrade-btn, #tmp-primary-bar .upgrade-btn").remove())):f.find(".logged-in .text").html("You are logged into your <b>Personal Account</b>"),f.removeClass("on").addClass("logged-in").show(),setTimeout(function(){f.hide("slow").removeClass("logged-in")},2500)),h=0)},app.charts.lineChart=function(o){return{generateLineChart:function(){this.g.append("path").datum(this.data).attr("fill","none").attr("stroke","steelblue").attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",1).attr("class","line").attr("d",this.line).style("stroke",this.strokeColor),this.addCircles(),this.$container.addClass("line-chart-generated")},addCircles:function(){var a=this,e=o.editMode?"ns-resize":"pointer";a.svg.selectAll("circle").data(a.data).enter().append("circle").attr("r",a.circleRadius).attr("cx",function(e,t){return a.xScale(t)}).attr("cy",function(e){return a.getCircleYScale(e)}).style("cursor",e).style("fill",a.strokeColor).on("mouseover",function(e){d3.select(this).attr("r",a.circleRadius+3),o.showTooltip(a.containerEl,e.pointIndex),o.showDeleteBtn(a.containerEl,e.pointIndex)}).on("mouseout",function(e){d3.select(this).attr("r",a.circleRadius),o.hideTooltip(a.containerEl,e.pointIndex),o.hideDeleteBtn(a.containerEl,e.pointIndex)}),!0===o.editMode&&a.svg.selectAll("circle").call(a.drag)},getCircleYScale:function(e){return this.yScale(e.Height)},reColor:function(e){this.strokeColor=e,this.svg.selectAll(".line").style("stroke",this.strokeColor),this.svg.selectAll("circle").style("fill",this.strokeColor)},setStrokeColor:function(e){this.strokeColor=e},setWidthHeight:function(){var e=this;0<e.$container.width()?(e.width=e.$container.width(),e.height=e.$container.height(),e.sizeSuffix="px",e.height=e.height-e.margin.top-e.margin.bottom):(e.width="100",e.height="100",e.sizeSuffix="%")},reRenderLineChart:function(e){var t=this;t.yAxisMax=e.yAxisMax,t.data=e.Items,t.setWidthHeight(),t.indexifyData(),t.xScale.domain([0,t.data.length-1]).range(t.getXScaleRange()),t.yScale.range([t.height,0]),t.yScaleForTooltip.range([t.height,0]),t.svg.attr("width",t.width+t.sizeSuffix).attr("height",t.height+t.sizeSuffix).attr("viewBox","0 0 "+t.width+" "+t.height),t.svg.selectAll(".line").attr("d",t.line),t.svg.selectAll("circle").remove(),t.addCircles()},indexifyData:function(){for(var e=0;e<this.data.length;e++)this.data[e].pointIndex=e},getXScaleRange:function(){var e=this.data.length,t=this.width/e;return[t/2,this.width-t/2]},setXYScales:function(){this.xScale=d3.scale.linear().domain([0,this.data.length-1]).range(this.getXScaleRange()),this.yScale=d3.scale.linear().domain([0,100]).range([this.height,0]),this.yScaleForTooltip=d3.scale.linear().domain([0,100]).range([this.height,0])},init:function(e,t){var n=this;n.isInitDone=!0,n.arrayOfPoints=[],n.data=t.Items,""!==t.Theme&&void 0!==t.Theme&&(n.strokeColor=t.Theme),n.yAxisMax=t.yAxisMax,n.$container=e,n.containerEl=e[0],n.chartEl=e.find(".svg-line-chart")[0],n.circleRadius=4,n.margin={top:0,right:0,bottom:0,left:0},n.setWidthHeight(),n.setXYScales(),n.line=d3.svg.line().x(function(e,t){return n.xScale(t)}).y(function(e){return n.yScale(e.Height)}),n.svg=d3.select(n.chartEl).attr("width",n.width+n.sizeSuffix).attr("height",n.height+n.sizeSuffix).attr("preserveAspectRatio","xMinYMid").attr("viewBox","0 0 "+n.width+" "+n.height),n.g=n.svg.append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),n.drag=d3.behavior.drag().on("dragstart",function(e){d3.select(this).classed("active",!0)}).on("drag",function(e){var t=n.yScale.invert(d3.event.y);if(t<=100&&0<=t){var a=n.yScaleForTooltip.invert(d3.event.y);e.Height=parseFloat(t).toFixed(2),n.data[e.pointIndex].Height=parseFloat(t).toFixed(2),n.data[e.pointIndex].Val=parseInt(t*n.yAxisMax/100).toString(),d3.select(this).attr("cy",n.getCircleYScale(e)),n.svg.selectAll("path").attr("d",n.line),o.updateTooltip(n.containerEl,e.pointIndex,a)}else d3.event.sourceEvent.preventDefault()}).on("dragend",function(e){d3.select(this).classed("active",!1),o.updateDataCb(n.containerEl)}),n.indexifyData(),n.generateLineChart()}}},app.charts.pie=function(){return{draw:function(a){var t=a.$el.closest(".module-container");function e(e){return t.hasClass(e)}var n=d3.layout.pie().sort(null),o=a.$el.width();if(o<1&&(e("col-sm-2")?o=170:e("col-sm-3")?o=170:e("col-sm-4")?o=170:e("col-sm-5")?o=220:e("col-sm-6")?o=270:e("col-sm-7")?o=320:e("col-sm-8")?o=370:e("col-sm-9")?o=380:e("col-sm-10")?o=390:e("col-sm-11")?o=390:e("col-sm-12")&&(o=390)),0<o){a.$el.empty();var i=d3.select(a.$el.get(0)).append("svg").attr("width",o).attr("height",o).append("g"),s=Math.ceil(o/2);i.attr("transform","translate("+s+","+s+")");var r=d3.svg.arc().innerRadius(.98*s).outerRadius(Math.floor(.8*s));i.text("");var l=i.selectAll("path").data(n(a.items));l.enter().append("path").attr("fill",function(e,t){return a.colorFunc(t)}).attr("d",r),l.exit().remove()}}}},app.editor.collaboratorsMenu=function(s,n,e,t,l,o,a){var i,r=[],d=[],c=[],u=$("#tmp-collaborators"),m=u.find(".others"),p=m.find(".person"),f=$("#tmp-single-collab"),h=app.acl.helper(s),g=h.collabActive,v=h.getMainPlanName,b=h.getNextPlanToUpgrade,T=(h.addUsersAllowed,h.isPremiumGuest),y=app.strings.popups,C=y.collabNotAvailableMsg,k=y.pleaseUpgradeAccount;function w(){var e=$(this).data("email"),t=s.currentlyEditing[e];t&&t.active&&t.module.bringInView()}function x(e){m.find(".person:not(.add)").remove();var i=0;if(e&&e.Collaborators&&$.each(e.Collaborators,function(e,t){if(0<t.Privilege&&t.Email!=s.userEmail){var a=t.FullName,n=t.Email;if(++i<=5){var o=$(f.html());o.on("click",w).attr("data-tip",a).attr("data-email",n).find(".initials").text(l.getInitials(a||n)),m.prepend(o.addClass(c[n]))}else r.push(a),d.push(n)}}),i&&(u.find(".add-new").addClass("hidden"),m.find(".add").removeClass("hidden")),5<i){var t=m.find(".person:not(.add)").last();r.unshift(t.attr("data-tip")),d.unshift(t.attr("data-email")),t.removeClass("active").attr("data-html","true").attr("data-tip",r.join("<br/>")).attr("data-email",d.join("-")).find(".initials").text("+"+(i-5+1))}a.isSingleFolioGuest(),p.attr("data-tip","Add / Remove People"),app.plugin.tooltip()}u.on("click",".add-new, .add",function(){s.tryMode?t.universalBlocker():0!=g()?a.isFreeGuest()?t.teamUserActionBlocked("add-remove-collab","Guests"):T()?t.teamUserActionBlocked("guest-collab"):0<s.Team.Id&&1==g()&&0==T()&&t.collaborators(n):t.message({heading:k,message:C(v(),b()),btnText:"See Plans",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){t.universalBlocker()}})}),x(n),o.addListener("collabChange",x),o.addListener("editorStatus",function(a){setTimeout(function(){!function(t){var e=u.find("[data-email*='"+t.email+"']");if(e.attr("data-html")){var a=e.attr("data-email").split("-"),n=e.attr("data-tip").split("<br/>")[a.findIndex(function(e){return e==t.email})],o=u.find(".person").filter(function(){return!$(this).hasClass("active")&&!$(this).hasClass("editing")&&!$(this).attr("data-html")});if(o.length){var i=$(o[0]),s=i.attr("data-tip"),r=i.attr("data-email");i.find(".initials").text(l.getInitials(n)),i.attr("data-original-title",n).attr("data-tip",n).attr("data-email",t.email),e.attr("data-tip",e.attr("data-tip").replace(n,s)).attr("data-original-title",e.attr("data-tip")).attr("data-email",e.attr("data-email").replace(t.email,r))}}}(a);var e=s.currentlyEditing[a.email],t=1==a.status?e&&e.active?"editing":"active":"";m.find('.person[data-email*="'+a.email+'"]').removeClass("active editing").addClass(t),c[a.email]=t,clearTimeout(i),e&&(e.active&&(e.name=function(e){for(var t=0;t<n.Collaborators.length;t++)if(n.Collaborators[t].Email==e)return n.Collaborators[t].FullName;return!1}(a.email),i=setTimeout(function(){s.currentlyEditing[a.email].active=!1,e.module.listEditors(),console.log("raise editor Status"),o.raiseEvent("editorStatus",a)},1e4)),1!=a.status&&(e.active=!1),e.module.listEditors())},500)}),$(".app-title .icon-Edit").after(u)},app.editor.copyFolio=function(l,d,c,u,m,e,a){var n,t=$("#tmp-secondary-bar"),o=".copy-folio-btn";app.core.padlocks(m,e,u,c).setCopyFolioLock(),m.isTryMode()&&m.doTryOverride("<span>Duplicate Folio</span> ",t.find(o),'<i class="icon-Duplicate"></i>'),t.on("click",o,function(){if(m.isTryMode())d.universalBlocker();else{if(m.isSingleFolioGuest())return void d.teamUserActionBlocked("create","Free Guests");if(m.isPremiumGuest())return void d.teamUserActionBlocked("create","Premium Guests");m.getData(1,function(e,t,a,n){var o=0,i={},s=e.ST;if(u.ST=s,console.log("Editor copyFolio inside getData:::",e,t,a,n),a&&(10!=e.ST&&11!=e.ST||u.IsDelinquent||(o=5,i.currUser="Plus",i.limit=5)),t&&10!=e.ST&&11!=e.ST&&3!=e.ST&&16!=e.ST&&(ispro=!0),t||(o=1,i.currUser="Free",i.limit=1),u.IsDelinquent&&(o=1,i.currUser="Free",i.limit=1),m.isFreeWithTeam()&&(o=2,i.currUser="Free",i.limit=2),!t||10!=e.ST&&11!=e.ST&&16!=e.ST&&3!=e.ST||(isplus=!0,o=5,i.currUser="Plus",i.limit=5),28===s||31===s){var r=0<u.Team.Id?10:1;o=r,i.currUser="ProBusiness",i.limit=r}console.log("limit",o,a,t,u.IsDelinquent),u.Team&&u.Team.IsDelinquent?app.dash.downgrade(u,d,i,l,m,c):0<o&&(console.log("user limit:::",o),l.getUserActiveFoliosCount({success:function(e){var n=e.Data;console.log("user active folios:::",n),l.getUserTemplateCount({success:function(e){var t=e.Data,a=n+t;if(0===u.Team.Id&&(m.isProBusiness()||m.isProTeamMember()||m.isBusiness())||m.isFreeWithTeam()){if((u.IsDelinquent||o<=n||0<t)&&(i.foliosCount=e.Data,1===a))return void d.message({heading:"Please Upgrade Your Account",message:"Folio Limit reached for Free User. Please upgrade to a premium plan for more folios and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){d.universalBlocker()}})}else"ProBusiness"===i.currUser&&l.getUserTeamsAndFolios({userEmail:u.userEmail,success:function(e){console.log("getUserTeamsAndFolios response",e);var t=_.find(JSON.parse(e.Data),{Id:u.Team.Id});void 0!==t?(t.TotalFolios>o||m.isSubscriptionExpired())&&app.dash.downgrade(u,d,i,l,m,c):console.log("getUserTeamsAndFolios teamDetails ERR",u.Team.Id)},error:function(e){console.log("getUserTeamsAndFolios error",e)}})},error:function(e){$comp.removeClass("busy"),console.log("error: ",e)}})},error:function(e){console.log("error: ",e)}}))}),m.checkFoliosLimitReached(l,d,function(){l.getWorkspaceChannels({teamId:u.Team.Id,success:function(e){console.log("copyFolio Editor response channels",e),u.labels=JSON.parse(e.Data);var t="Copy - "+a.FolioName;u.duplicateFolioItem={FolioName:t,Token:a.Token,IsDuplicate:!0},d.saveFolio(),u.saveFolioSuccess&&(n=u.saveFolioSuccess),console.log("saveFolioSuccess: ",n)},error:function(e){console.log("error in getWorkspaceChannels",e)}})})}return!1})},app.editor.froala=function(s,e,t,n,r,a,l){var d,c=app.acl.helper(s).styleGuideAllowed,u=($("#tmp-style-guide"),' <i class="icon-Color-Scheme"></i>'),m="Manage/Add Colors",p=$('<div class="btn-picker"><i class="fa fa-eyedropper"></i></div>'),f=app.core.padlocks(r,a,s,t);function h(){d?n.universalBlocker():(n.styleGuidePopup(),setTimeout(function(){$("#tmp-style-guide .popup-header .tabs span:eq(1)").trigger("click")},1e3))}$(document.body).on("click",".froala-manage-color-link",function(e){e.preventDefault(),e.stopPropagation(),h()}),$(document.body).on("click",".color.icon-Color-Scheme",function(e){e.preventDefault(),e.stopPropagation(),r.isTryMode()&&r.doTryOverride(m,$(".manage-color-link"),u)}),d=r.isTryMode(),function(){var a=setInterval(function(){if(0<$("#dropdown-menu-fontFamily-1").find("ul.fr-dropdown-list").length&&app.acl.data){var e=$('<div class="froala-styleguide-link '.concat(c()?"":"locked",'">')),t="Manage Fonts".concat(c()?"":'<i class="fa fa-lock" data-html="true" data-original-title="" title=""></i>');d?(r.doTryOverride("Manage Fonts ",e,'<i class="icon-Font">Aa</i>'),e.on("click",function(e){e.preventDefault(),e.stopPropagation(),n.universalBlocker()})):e.html(t).on("click",function(e){e.preventDefault(),e.stopPropagation(),n.styleGuidePopup()}).append('<i class="icon-Font">Aa</i>'),e.appendTo($("#dropdown-menu-fontFamily-1").find("ul.fr-dropdown-list").parent()),f.setLockStyleGuide(),clearInterval(a)}},500);d&&(r.doTryOverride(m,$(".manage-color-link"),u),$("#edit-page").on("click",".bg-panel-btn",function(){r.doTryOverride(m,$("#edit-page .manage-color-link"),u)}),$("#edit-page").on("click",".background",function(){r.doTryOverride(m,$("#edit-page .manage-color-link"),u)})),$("#edit-page, .nav-settings").on("click",".theme-picker .manage-color-link",function(e){e.preventDefault(),e.stopPropagation(),h()});var o=setInterval(function(){if(0<$(".fr-color-hex-layer").parent().length&&app.acl.data){var e=$('<div class="froala-manage-color-link '.concat(c()?"":"locked",'">')),t="Manage/Add Colors".concat(c()?"":'<i class="fa fa-lock" data-html="true" data-original-title="" title=""></i>'),a=e.html(t),n=$(".fr-color-hex-layer").parent();n.find(".fr-input-line input"),$('<div id="picker-container"></div>').appendTo($(".fr-color-hex-layer")),(a=r.doTryOverride(m,e,u,a)).appendTo($(".fr-color-hex-layer")),n.find(".fr-input-line").css("position","relative"),n.find(".fr-input-line").append(p),f.setLockStyleGuide(),p.colorPicker({opacity:!1,doRender:!0,forceAlpha:!1,positionCallback:function(e){var t=this.$UI;return e.hasClass("btn-picker")?t.appendTo("#picker-container"):t.appendTo(e.parent().find(".picker-container")),{left:0,top:0}},renderCallback:function(e,t){var a=e.parent().find("input[type=text]");!0!==t&&a.addClass("fr-not-empty").val("#"+this.color.colors.HEX)}}),n.find(".fr-submit").click(function(){$(".cp-color-picker").hide()}),clearInterval(o)}},500),i=setInterval(function(){if(0<$(".fr-table-colors").parent().length&&app.acl.data){var e=$('<div class="froala-manage-color-link '.concat(c()?"":"locked",'">')),t="Manage/Add Colors".concat(c()?"":'<i class="fa fa-lock" data-html="true" data-original-title="" title=""></i>'),a=e.html(t);clearInterval(i),$(".fr-table-colors").parent().css("height","260px"),$(".fr-table-colors").parent().find(".fr-color-hex-layer").css({paddingBottom:0,height:"75px"});var n=[];$(".fr-table-colors").html(""),0!==s.Team.Id&&void 0!==s.StyleGuides?n=l.getColors(s.StyleGuides[0].TeamColors):void 0!==s.DefaultColors&&(n=l.getColors(s.DefaultColors));var o=0;$.each(n,function(e,t){var a=$('<span class="fr-command" tabindex="-1" role="button" data-param1="'+t+'" data-cmd="tableCellBackgroundColor"></span>').css("background-color",t).html('<span class="fr-sr-only">Color '+t+" </span>");$(".fr-table-colors").append(a),7==++o&&(o=0,$(".fr-table-colors").append($("<br>")))}),(a=r.doTryOverride(m,e,u,a)).appendTo($(".fr-table-colors").parent()),f.setLockStyleGuide()}},500)}(),t.addListener("aclDataLoaded",function(){f.setLockStyleGuide()})},app.editor.main=function(e,t,a,n,o,i,s,r,l,d,c){e.currentlyEditing={};var u=app.plugin.lockedTip(e,n),m=$("#tmp-power-by-footer"),p=this.topBar(t,n,i,c,e),f=app.strings.general,h=f.freeSharedFolioMsg,g=f.freeSharedFolioCTA;this.createSecondaryBar(e,t,a,n,l,i,o,p,d,c,u),this.templateMessage(e,t,r),this.wizardEditor(e,n,i),this.collaboratorsMenu(e,t,a,i,s,n,c),this.copyFolio(a,i,n,e,c,u,t);var v=m.find(".power-by-footer"),b={heading:"Upgrade to premium plan",message:"By upgrading to any of our premium plans, you can remove Xtensio branding from your shared folios.",btnText:"Upgrade",cancelText:"Cancel",bodyCentered:!0,notMini:!0,handleOK:function(){i.billing()}},T=$("#home-page");function y(){0==T.find(".watermark-on-free").length&&0==T.find(".watermark-on-free-shared").length&&(T.append('<div class="watermark-on-free"></div>'),T.find(".watermark-on-free").hide())}if(c.isFreeWithTeam()||c.isTryMode()){console.log("user is free user!");var C=g;v.addClass("footer-on-free"),v.html(h+C),$("body").addClass("showFreeBanner"),v.find("a.see-plans").click(function(e){e.preventDefault(),console.log("universal blocker invoked"),i.universalBlocker()}),y()}else void 0!==e&&e.isTrial?(console.log("user is on trial"),y()):(v.removeClass("footer-on-free"),m.find("a:not(.normal)").click(function(){return i.message(b),!1}));T.append(m),c.getExpirationDate()&&app.dash.expiredTrials(e,i,c),this.froala(e,a,n,i,c,u,s)},app.editor.present=function(i){var t,s,a=document,n=null,o=$("body")[0],r=$("#presentation-buttons"),l=r.find(".left-btn"),d=r.find(".right-btn"),c=r.find(".exit"),u=$("#home-page"),m=o.requestFullscreen||o.mozRequestFullScreen||o.webkitRequestFullscreen,p=!1;function f(e){if(!p){p=!0,e=e||0,document.body.scrollTop=document.documentElement.scrollTop=0;var t=$(".preview-div.current").css("min-height",""),a=t.index(),n=s-1;console.log("index",a),0<e&&a<n?t.add(t.next()).toggleClass("current"):e<0&&0<a&&t.add(t.prev()).toggleClass("current"),a+=e;var o=window.innerHeight+($("body").hasClass("showFreeBanner")?-70:0);t=$(".preview-div.current").css("min-height",o),l.toggleClass("disable",a<=0),d.toggleClass("disable",n<=a),i.raiseEvent("resize"),setTimeout(function(){$(document).scrollTop(0),p=!1,u.prop("tabIndex",u.prop("tabIndex")),u.focus()},10)}}function h(){if(a.fullscreenElement||a.mozFullScreen||a.webkitIsFullScreen){var e=a.cancelFullscreen||a.mozCancelFullScreen||a.webkitCancelFullScreen;e&&e.call(a)}r.hide(),$("html").css({backgroundColor:"","overflow-y":""}),$(".preview-div").css("min-height",""),$(".preview-available").removeClass("hidden"),$(window).off(".presentFix"),$("body, .preview-div").removeClass("present current"),clearTimeout(n),$("body").removeClass("idle"),$(a).off(".idleMouse .present"),t&&t()}function g(e){var t=e.which;32==t||39==t?f(1):37==t?f(-1):27==t&&h()}return{stop:h,start:function(e){t=e,$("html").css({backgroundColor:"#fff","overflow-y":"auto"}),$("body, .preview-div").addClass("present"),$(".preview-div:first-child").addClass("current"),m&&m.call(o),$(a).on("keydown.present",g),setTimeout(function(){r.show(),f()},100),$(".preview-available").addClass("hidden"),$(a).on("mousemove.idleMouse",function(){clearTimeout(n),$("body").removeClass("idle"),n=setTimeout(function(){$("body").addClass("idle")},2e3)}),l.click(function(){f(-1)}),d.click(function(){f(1)}),c.click(h),$(window).on("resize.presentFix",f),s=$(".preview-div").length,console.log("totalSlides",s)}}},app.editor.createSecondaryBar=function(a,s,e,t,r,l,d,n,o,i,c){var u=app.acl.helper(a),m="preview"==$.trim(window.location.hash.substr(1)),p=!1;m&&setTimeout(function(){setTimeout(function(){$("#top-bar").show()},50),q(2),m=!1},0);var f,h=!0,g=0,v=0,b={edit:1,preview:2,present:3},T=app.editor.present(t),y=app.core.padlocks(i,c,a,t),C=$("#tmp-secondary-bar"),k=C.find(".navs-preview"),w=C.find(".export"),x=C.find(".share"),P=C.find(".embed"),S=C.find(".add-people"),D=C.find(".add-module-button"),F=C.find(".more-opts"),I=C.find(".navs-share"),M=C.find(".transfer"),E=C.find(".present"),A=C.find(".settings"),U=C.find(".navs-archive"),N=C.find(".save-as-template"),L=C.find(".navs-delete-template"),O=C.find(".navs-revision"),R=C.find(".navs-stats"),B=C.find(".nav-save-section"),G=$("#folio-bar"),H=$("#tmp-primary-bar, #tmp-secondary-bar .left, #tmp-secondary-bar .right > *:not(.preview-available), #intercom-container, .nav-save-section > *"),Y=C.find(".nav-share-menu.popup-menu"),j=C.find(".nav-settings.popup-menu"),z=C.find(".navs-buttons-container .export-anonymous");function q(e){switch(e){case b.edit:h=!0,$("body").removeClass("preview-mode-on"),n.toggle(1),G.removeClass("preview"),H.removeClass("visible-hidden"),I.addClass("in-edit-mode").removeClass("in-preview-mode"),k.addClass("in-edit-mode").removeClass("in-preview-mode"),$("#home-page .watermark-on-free").hide(),d.showPage("edit-page"),$(".image-outer").data("ui-sortable")&&$(".image-outer").sortable("enable");break;case b.preview:h=!1,$("body").addClass("preview-mode-on"),n.toggle(0,m?0:400),G.addClass("preview"),H.addClass("visible-hidden"),I.addClass("in-preview-mode").removeClass("in-edit-mode"),k.addClass("in-preview-mode").removeClass("in-edit-mode"),$("#home-page .watermark-on-free").show(),d.showPage("home-page"),$(".image-outer").data("ui-sortable")&&$(".image-outer").sortable("disable");break;case b.present:h=!1,$("body").removeClass("preview-mode-on"),n.toggle(0),I.removeClass("in-edit-mode"),k.removeClass("in-edit-mode"),d.showPage("home-page"),T.start(function(){q(1)}),$("#home-page .watermark-on-free").show(),$(".image-outer").data("ui-sortable")&&$(".image-outer").sortable("disable")}}function V(e){var a,n="",o=$("#home-page"),t=r.getExport(),i={$el:o,cb:function(e,t){n="",str="",$("head").find(".module-style, #folio-style").each(function(e,t){str+="<style>"+t.innerHTML+"</style>"}),n=str,(a=d.isCurrent(d.pages.home))||d.showPage(d.pages.home),o.css("width",Math.max($(window).width(),1367)+"px"),setTimeout(function(){r.activatePreview(),n+=o.html(),t(n),o.css("width",""),a?r.activatePreview():d.showPage(d.pages.edit),r.saveData()},1e3)}};!0===e&&(i.isAnonymousPNGExport=!0),l.exp(s,t,i)}G.append(C),t.addListener("activatePreview",function(){r.activatePreview(),(p=d.isCurrent(d.pages.home))||d.showPage(d.pages.home)}),t.addListener("revertPreview",function(){p||d.showPage(d.pages.edit)}),y.setLockStatsSaveAsTemplate(),t.addListener("plusUnlocked",function(){y.setLockStatsSaveAsTemplate()}),t.addListener("plusCancelled",function(){y.setLockStatsSaveAsTemplate()}),C.click(function(){var e=Date.now();e-v<1e3?g++:g=0,v=e,5==g&&($("body").addClass("show-adv"),$(".button-panel .cls-btn").removeClass("hidden-btn"))}),A.click(function(){l.message({heading:"Folio Styles",btnText:"Save",showArea:1,areaPlaceholder:"Folio Styles",rows:10,areaText:o.get("style"),handleOK:function(e,t){o.set("style",t);var a='<style id="folio-style">'+t+"</style>";$("head #folio-style").remove(),$("head").append(a)}})}),E.click(function(){q(3)}),k.click(function(){1<s.Role&&q(h?2:1)}),M.click(function(){a.Team&&0<a.Team.Id?l.transferTeamFolio():l.transferFolio()}),U.click(function(){u.isPremiumGuest()||u.isFreeGuest()||l.archive(s,function(){window.location.href=window.location.href.replace("edit","folio")})}),L.click(function(){l.message({heading:"Are you sure?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes",notMini:!0,handleOK:function(){e.deleteUserTemplate({token:s.Token,op:"del",success:function(){$("#dashboard-page > .loader").hide(),window.location=a.baseUrl},error:function(e){$("#dashboard-page > .loader").hide(),l.message({heading:"Oops!",message:e.Message,btnText:"Ok",enterAsOK:!0})}})},cancelText:"Cancel",handleNo:function(){l.close()}})}),D.click(function(){var e=s.Modules[0].Data.Theme;l.addModule(r.addModule,0,e)}),s.Role<3&&(M.hide(),U.addClass("leave").html('Leave Folio <i class="icon-Transfer"></i>'),s.Role<2&&(O.addClass("hidden"),U.css({marginTop:"12px"}),B.addClass("view-only").tooltip("disable")),f=function(e){var t=JSON.parse(e.Data),a=_.map(_.filter(t,{AccessType:2}),"LabelToken");s.Labels.some(function(e){return a.includes(e)})&&U.hide()},e.getWorkspaceChannels({teamId:a.Team.Id,success:function(e){console.log("getWorkspaceChannels response",e),f&&"function"==typeof f&&f(e)},error:function(e){console.log("getWorkspaceChannels error",e),l.error(e.Message)}})),(u.isPremiumGuest()||u.isFreeGuest())&&U.hide(),i.isTryMode()?(w.hide(),U.remove(),M.remove(),L.remove(),i.doTryOverride("<span>Get Link</span> ",P,'<i class="fa fa-code">'),i.doTryOverride("Add People ",S,'<i class="icon-Add-People"></i>'),i.doTryOverride("<span>Embed</span>",x,'<i class="icon-Link"></i>'),i.doTryOverride("Revision History ",O,'<i class="icon-RevisionHistory"></i>'),i.doTryOverride("<span>Folio Stats</span> ",R,'<svg class="svg-icon svg-icon-stats"><use xlink:href="#svg-icon-stats"></use></svg>'),i.doTryOverride("<span>Save as Template</span>",N,'<svg class="svg-icon svg-icon-stats"><use xlink:href="#svg-saveas-template"></use></svg>'),B.find(".info").hide(),z.show(),O.click(function(){return l.universalBlocker()}),R.click(function(){return l.universalBlocker()}),N.click(function(){return l.universalBlocker()}),P.click(function(){return l.universalBlocker()}),x.click(function(){return l.universalBlocker()}),S.click(function(){return l.universalBlocker()}),B.click(function(){return l.universalBlocker()}),z.click(function(){!0===a.exportEnabled?V():l.downloadBlocker(s,r.getExport(),d,null,V)})):(B.click(function(){1<s.Role&&l.folioVersion(a,s.Token)}),x.click(function(){l.shareLink(s)}),P.click(function(){l.shareLink(s,null,null,null,!0)}),S.click(function(){$("#tmp-collaborators .add-new").click()}),z.hide(),w.click(V),O.click(function(){l.folioVersion(a,s.Token)}),N.click(function(){if((0,app.acl.helper(a).personalTemplatesAllowed)()){var e=s.Token,t=s.FolioName+" - Template";l.createTemplatePopup(t,e)}else l.saveCustomTemplateBlocker(l,a)}),R.click(function(){if(u.statsAllowed()){var e=s.IsUserTemplate||!1,t=s.UsedCount||0;l.folioStats(a.token,s.FolioName,{isTemplate:e,UsedCount:t})}else l.statsBlocker("folio")}),s.IsUserTemplate?(U.remove(),M.remove(),R.find("span").text("Template Stats"),N.remove()):L.remove(),y.setShareFolioAddPeopleLock(S,a)),app.plugin.popupMenu(F,j,null,["folio-color-scheme","theme-picker"]),app.plugin.popupMenu(I,Y,null,[])},app.editor.saveSpinner=function(e,t){var a=1,n=2,o=$("#tmp-secondary-bar").find(".nav-save-section").attr("class","nav-save-section info"),i=o.find(".info .saved-time");switch(e){case a:o.removeClass("saved").addClass("saving");break;case n:o.removeClass("saving").addClass("saved"),i.text(dayjs(t||Date.now()).locale("en").format("lll")),setTimeout(function(){o.removeClass("saved")},2500)}},app.editor.upgradeStyleGuide=function(t){function n(e){return e==s||t.rgb2hex(e)==s}var e,a=[],o=[],i=$(".color-palette-cont").children(".palette-item"),s=i.find(".icon-Star").parent().css("background-color");i.each(function(e){a.push(t.rgb2hex($(this).css("background-color")))}),$(".color-palette-cont").children(".palette-item").find(".icon-star").parent().css("background-color"),i.each(function(e){o.push($(this).css("background-color"))}),e=o.map(function(e){return $('<div class="color-btn col-sm-3 col-xs-3"><i class="icon-CheckMark"></i></div>').css("background-color",e).data("color",t.rgb2hex(e)).addClass(n(e)?"selected":"")}),$(".color-list").html(e),$("#color-1").on("click",function(e){var t;e.preventDefault(),(t=a.map(function(e,t){var a='<span class="fr-command fr-select-color '+(n(e)?"fr-active-item":"")+'" style="background: '+e+';" tabindex="-1" aria-selected="false" role="button" data-cmd="textColor" data-param1="'+e+'"><span class="fr-sr-only">Color '+e+"C&nbsp;&nbsp;&nbsp;</span>"+(n(e)?'<span class="fr-selected-color" aria-hidden="true"></span>':"")+"</span>";return t%7==6&&(a+="<br>"),a})).push('<span class="fr-command fr-select-color" data-cmd="textColor" tabindex="-1" role="button" data-param1="REMOVE" title="Clear Formatting"><i class="fa fa-eraser" aria-hidden="true"></i><span class="fr-sr-only">Clear Formatting</span></span>'),$(".fr-color-set").html(t),$(this).off()})},app.editor.templateMessage=function(e,t,a){var n="hideTemplateMessage:"+t.ParentID;if(t.TemplateMessage&&"true"!==a.get(n)){var o=$("#template-message-wrapper");$("#template-message").html(t.TemplateMessage);var i=$('<span class="close-btn"></span>');o.prepend(i),i.on("click",function(){a.set(n,"true"),o.slideToggle(150),setTimeout(function(){o.remove()},1e3)})}},app.editor.topBar=function(e,t,a,n,o){var i,s=!0,r={duration:400,queue:!1},l=$(document),d=$("body"),c=$("#top-bar"),u=($("#n-panel"),parseInt($(".edit-div").css("padding-top"))),m=d.hasClass("showFreeBanner");return d.css("padding-top",86),t.addListener("resize",function(){s?setTimeout(function(){c.css("top",0),d.css({paddingTop:86})},0):c.animate({top:-$("#top-bar").height()},r)}),t.addListener("free-exceedsize",function(){app.popup.imgUploadBlocker(n,a,o)}),{toggle:function(e,t){void 0!==t&&(r.duration=t),s=e;var a=l.scrollTop(),n=$("#top-bar").height();s?(n<a?$("html, body").animate({scrollTop:a+n-$("#preview-bottom").height()},r):0<a&&$("html, body").animate({scrollTop:l.scrollTop()-i},r),d.animate({paddingTop:86},r),c.animate({top:i},r)):(i=parseInt(c.css("top")),n<a?($("html, body").scrollTop(a-n+$(".preview-available").height()+u),d.css("padding-top",0)):d.animate({paddingTop:0},r),m?c.css({top:-n}):c.animate({top:-n},r))}}},app.editor.viewOnly=function(e){e&&1===e.Role&&($("#edit-page").hide(),$(".folio-name").attr("readonly",!0),$(".others .person.add").remove(),$(".user-options .left").css("padding","5px 30px 3px").html('<p style="line-height: 28px;margin-bottom: 0;">You only have access to view this folio.</p>').css("font-size","14px"),$(".navs-preview").addClass("view-only").find(".preview").html("View Only"))},app.editor.addWatermark=function(i,o,s,e){function r(e,t,a){var n;console.log("banner",i.banner),console.log(a,e,s.isFreeWithTeam(),h),0===i.banner||a&&!e&&!h?($("#tmp-power-by-footer").addClass("hidden"),d.length&&d.find(".watermark").remove()):(!function(e){console.log("mode",e);var t=$("#tmp-power-by-footer");if(t.removeClass("hidden").find("upgrade"==e?".normal":".upgrade").addClass("hidden"),t.find("."+e).removeClass("hidden"),"free-user"===e){var a=t.find(".power-by-footer"),n=v;a.addClass("footer-on-free"),a.html(g+n),$("body").addClass("showFreeBanner"),a.find("a.see-plans").click(function(e){return e.preventDefault(),o.universalBlocker(),!1})}}(t?"free-user":"upgrade"),0==(n=$("#home-page")).find(".watermark-on-free-shared").length&&0==n.find(".watermark-on-free").length&&n.append('<div class="watermark-on-free-shared"></div>'))}var l=i.isTrial||i.Team&&i.Team.IsTrial,d=(i.Team&&!i.Team.IsTrial&&(i.Team.plusExpireTime,Date.now()),$("#home-page .persona-canvas.canvas-module-container .canvas-module > .header-container")),c=$(location).attr("href"),u=0<=c.indexOf("/folio/"+i.token),m=0<=c.indexOf("/channel/"),p=i.Team&&0<i.Team.Id,t=!i.userName,f=i.Team&&1==i.Team.Role||i.userName==i.folioUserName,h=p&&(0==i.Team.ST||34==i.Team.ST),a=app.strings.general,g=a.freeSharedFolioMsg,v=a.freeSharedFolioCTAWM;e&&e.getCreditsLeft&&!i.tryMode&&e.getCreditsLeft({success:function(e){console.log("getCreditsLeft response",e);var t=JSON.parse(e.Data),a=t.LimitsImposed&&0<t.CreditsLeft,n=!(i.plusExpireTime>=Date.now()||a);if(u||m){var o=n;n=!(!(i.PlusEnd<Date.now()||l)||!o)}s.setLock(function(e,t){(n&&!i.isChannel&&!p||l)&&d.length&&(u||m?d.append('<div class="watermark"><a href="https://www.xtensio.com" target="_blank" ><div class="logo"></div></a></div>'):d.append('<div class="watermark"><a href="'+c+'#billing"><div class="logo"></div></a></div>')),r(l,f,p)})},error:function(e){console.log("getCreditsLeft error",e)}}),t&&r(l,f,p)},app.editor.wizardEditor=function(e,t,a){var n,o='NEXT <i class="fa fa-angle-right"></i>',i=function(e){return'<p style="color: #ffd371;">'+e+" / 4</p>"},s=function(e){return'<text style="color: #00bd9c;" class="title">'+e+"</text><br>"},r=[{selector:".add-module-button",event:"next",description:i(1)+s("Add new content")+"Add images, videos, charts/graphs, lists and forms to customize your content. <br>Click and edit anything with the toolbar.",nextButton:{className:"wiz-nxt-btn",text:o},showSkip:!1,showNext:!0},{onBeforeStart:function(){$(".nav-image-button.more-opts").click()},selector:".nav-settings.popup-menu",event:"next",delay:600,description:i(2)+s("Manage folio settings")+"Update the folio color scheme with one click to match your branding.",nextButton:{className:"wiz-nxt-btn",text:o},showSkip:!1,showNext:!0},{onBeforeStart:function(){$(".navs-share.in-edit-mode").click()},selector:".nav-share-menu.popup-menu",event:"next",delay:600,description:i(3)+s("Share your work")+"Send a link, add collaborators, embed it on your website, present <br>a slideshow or export a PDF/PNG.",nextButton:{className:"wiz-nxt-btn",text:o},showSkip:!1,showNext:!0},{selector:".user-text",event:"next",description:i(4)+s("Upgrade for more")+"Sign up to save your work on a custom dashboard and access other premium features like collaboration, link sharing, document management and more! <br><br>Have an account already? Sign in and your work will be saved to your dashboard.",nextButton:{className:"wiz-nxt-btn",text:"OK"},showSkip:!1,showNext:!0}];t.addListener("runTryWizard",function(){console.log("run try wizard"),a.close(),(n=new EnjoyHint).setScript(r),n.runScript()})},app.managers.main=function(e,t,a,n,o,i){var s;return{modManager:s=this.getModManager(e,t,a,n,o,i),rddm:this.getRddm(e,t,a,s)}},app.managers.getModManager=function(c,u,e,t,n,m){var p,a,o,i,s,f={},h=u.TagStore,r=app.modHelper,g=(m=e.utility,e.appHub),l=e.apiHelper,d=e.plusHelper,v=e.eventManager,b=e.pageManager,T=m.obtain(u.Modules,"Type","DataModule"),y=r.getGuiModules(u,m);function C(e){Date.now()-1e3<=a||r.createLayoutData(u,m,function(e){T.Data.Sections=e,a=Date.now(),T.save()})}function k(){return Math.max.apply(null,h)}function w(){c.tryMode?l.getTempTagStore({success:function(e){"Success"==e.Status&&(h=e.Data.TagStore)}}):l.getTagStore({success:function(e){"Success"==e.Status&&(h=e.Data.TagStore)}})}function x(e){var t=(e=parseInt(e)||k())+1;return t<k()||m.obtain(u.Modules,"Tag",t)||m.obtain(T.Data.Sections,"Tag",t)?x(t):(clearTimeout(o),o=setTimeout(w,1e4),h.push(t),parseInt(t))}v.addListener("removeCollabs",function(){var a=u;$.each(a.Collaborators,function(e,t){l.changeCollaborator({data:{verb:"drop",role:t.Privilege,token:a.Token,email:t.Email},success:function(e){console.log(e.Message),window.location="/"},error:function(e){5==e.StatusCode&&n.error(e.Message)}})})}),p={getNewTag:x,removeMod:function(e){return m.removeFromList(u.Modules,m.obtain(u.Modules,"Tag",e.Tag))},currentAction:(s=Date.now(),function(e){return e&&(i=e,s=Date.now()),i&&Date.now()-s<=3e3?i:""}),getModule:function(e){return m.obtain(u.Modules,"Tag",e,"Key","ID")},getFactory:function(e){return f[e.Type]},registerFactory:function(e){if(!e.type||f[e.type])throw console.log(e),{name:e.type+" is invalid."};f[e.type]=e},addModule:function(e,o,t,a,n,i){if("Canvas"==e&&o&&o.Data.Mods){$.each(o.Data.Mods,function(e,t){var a=x(),n={Key:a,Tag:a,Type:t.Type,Data:$.extend(!0,{},t.Data)};t.Tag=a,n.Syncd=o.Syncd,u.Modules.push(n)});var s=o.Tag;h&&h.indexOf(s)<0?h.push(s):(h||(h=[]),s=x()),o.Tag=s}var r,l,d=function(e,t,a,n,o,i){var s,r=f[e],l=u.Modules[0].Data.Theme;s=t?$.extend(t,{Key:m.uniqueId()}):{Key:m.uniqueId(),Type:e,Data:{Type:e}},i&&(s.ID=i.ID,s.Tag=i.Tag),u.Modules.push(s);var d="Scale"==e||"Bar"==e||"DonutChart"==e||"DataCollection"==e||"Vertical Bar"==e||"TaskList"==e;return("Scale"==e||"Bar"==e||"DonutChart"==e||"DataCollection"==e||"Vertical Bar"==e||"TaskList"==e)&&(s.Data.Head=1),d&&(s.Data.Titlehide=1),"Scale"==e&&(s.Data.Header="Scale Chart"),"Bar"==e&&(s.Data.Header="Bar Graph"),"Vertical Bar"==e&&(s.Data.Header="Bar/Line Chart"),"DonutChart"==e&&(s.Data.Header="Pie Chart"),"DataCollection"==e&&(s.Data.Header="This is a form field to collect emails."),"TaskList"==e&&(s.Data.Header="Task List"),n||($("#modules-preview-main .preview-div:last-child").find(".section-content").length||p.createSection(),n=$("#edit-sections .edit-div:last-child").find(".section-content"),o=$("#modules-preview-main .preview-div:last-child").find(".section-content")),r.initModule(m,s,t,o,n,void 0,d,l),a&&s.bringInView(),c.setNewBlankCanvas=!1,s}(e,o,"EmptyModule"!=e&&null==t?1:t,a,n,i);return"EmptyModule"!=e&&(d.Syncd||d.CanvasMod?d.Tag=d.Tag:(d.Tag=s||x(),h.indexOf(d.Tag)<0&&h.push(d.Tag),d.factory.renderPreview(d),r=d,g.sync({Tag:l||r.$editNode.closest(".edit-div").data("Tag")},"Sec_AddModule",{Syncd:!0,Tag:r.Tag,Type:r.Type,Data:r.Data})),d.editObj.afterAddModuleCb&&(console.log("moduleManager addModule afterAddModuleCb "),d.editObj.afterAddModuleCb()),d.factory.renderPreview(d),d.save(C)),d},copyModule:function(e,t){f[e.Type];var a=$.extend(!0,{},e.Data),n=x(e.Tag),o={Key:n,Tag:n,Type:e.Type,Data:a};return u.Modules.push(o),"Canvas"==e.Type&&$.each(a.Mods,function(e,t){var a=x(t.Tag),n=p.getModule(t.Tag);if(n){var o={Key:a,Tag:a,Type:n.Type,Data:$.extend(!0,{},n.Data)};t.Tag=a,u.Modules.push(o),g.saveMod(o)}}),t&&t(o),g.saveMod(o,C),o},duplicateModule:function(a){console.log("dubplicate",a);var n=f[a.Type],o=a.$editNode.closest(".section-content"),i=a.$previewNode.closest(".section-content"),s=p.copyModule(a,function(e){var t=s||e;n.initModule(m,t,0,i,o,a),n.renderPreview(t),"dup"==p.currentAction()&&t.bringInView(),"Canvas"===t.Type&&0===t.Data.Mods.length&&m.generateEmptyCanvasModule(t.$editNode,t.$previewNode)});return s},getExport:function(){return T.Data.Exports||(T.Data.Exports={}),T.Data.Exports},getDonutData:function(){return T.Data.Donut||(T.Data.Donut={showError:!0}),T.Data.Donut},saveData:function(e){T.save()},saveLayout:C,activatePreview:function(e){if(e&&e.modId){var t=p.getModule(e.modId);t&&t.factory&&t.factory.renderPreview(t)}else $.each(T.Data.Sections,function(e,t){$.each(t.ModIds,function(e,t){var a=p.getModule(t);a&&a.factory&&a.factory.renderPreview(a)})})},duplicateSection:function(e,t,a){(e=$.extend(!0,{},e)).Tag=e.newTag,delete e.newTag;var n=p.createSection(e),i=n[0].find(".section-content"),s=n[1].find(".section-content");return p.addModule("EmptyModule"),t.find(".section-content > .module-container").each(function(e,t){var a,n,o=m.obtain(u.Modules,"Key",$(t).data("key"));o&&"EmptyModule"!=o.Type&&(n=f[o.Type],a=p.copyModule(o),n.initModule(m,a,0,s,i))}),t.after(n[0]),a.after(n[1]),"dup"==p.currentAction()&&$("html,body").animate({scrollTop:i.offset().top},400),e}},T.save=function(e){g.saveMod(T,e)};var P=c.editMode||c.tryMode;return p=$.extend(p,r.sectionHelper(p,c,u,t,m,b,n,f,T,y,P,g,l,d))},app.managers.getRddm=function(e,t,a,n){var o=a.appHub,i=a.utility,s={},r=$(document),l=$("body"),d=i.swapElementsInArray,c=i.moveElementToPosInArr,u=app.managers.resizeManager(r,o),m=app.managers.dragManager(r,l,s,o,i,n);return r.on("touchend mouseup touchcancel mouseleave",function(){u.end(),m.end()}),setTimeout(function(){e.presentationMode||(app.modHelper.dragImages(t.Modules,o,d),app.modHelper.dragTags(t.Modules,o,d),app.modHelper.dragTaskList(t.Modules,o,c))},0),{addModule:function(a){"Images"==a.Type?setTimeout(function(){app.modHelper.dragImages(t.Modules,o,d)},0):"Tag"==a.Type?setTimeout(function(){app.modHelper.dragTags(t.Modules,o,d)},0):"TaskList"==a.Type&&setTimeout(function(){app.modHelper.dragTaskList(t.Modules,o,c)},0),(s[a.Key]=a).noResize||u.add(a),a.noDrag||(m.add(a),o.reg(a,"Pos",function(e,t){m.move(a,t)}))},removeModule:function(e){u.remove(e),m.remove(e),delete s[e.Key]},dragManager:m}},app.managers.dragManager=function(e,t,a,c,d,u){var i,s,m,p,f,h=null,g=null,v=0,b=0,T=0,r=$("<div>"),n=$('<div style="background-color: gray;position: absolute; z-index: 9999999;">'),o=$('<div style="background-color: red;position: absolute; z-index: 99999;">'),l=$('<div style="position: absolute; height: 100%; z-index: 9999; left: 0; top: 0; width: 100%;">').hide(),y=$('<div style="position: absolute; z-index: 9990; left: 50%; top: 0; width: 1200px; margin-left: -600px;">'),C=$("#modules-edit-main").append(y).append(n).append(o),k=$("#modules-preview-main"),w=$('<div class="empty" style="display: inline-block; background-color: #F5F6F7; border: 1px dotted #4a7aa2; margin: 12px 0;">&nbsp;</div>');t.append(l);var x=function(e,t,a,n){var o=0;1200<C.width()&&(o=(C.width()-1200)/2),e.css({left:t.pageX-i-o,top:t.pageY-C.offset().top-s+14})};return e.on("touchmove mousemove",function(t){if(h){var e=Date.now();if(e-v<30)return;var a,n,o,i,s=t.pageX,r=t.pageY;v=e;var l=$(window).scrollTop();if(t.screenY>T+6&&t.clientY>window.innerHeight-140?($("html,body").animate({scrollTop:l+140},200),T=t.screenY):t.screenY<T-6&&t.clientY<140&&($("html,body").animate({scrollTop:l-140},200),T=t.screenY),x(h.$editNode,t),e-b<300)return;b=e,C.find(".edit-div").each(function(){var e=this;if(n=$(this),(a=n.offset()).bottom=a.top+n.height(),r>=a.top&&r<=a.bottom)return(o=n.find("> .section-content > .module-container")).each(function(){if(i=$(this),(a=i.offset()).right=a.left+i.width(),a.bottom=a.top+i.height(),s<a.right&&r<a.bottom)return h&&"Canvas"==h.Type||!d.isPointInRect(a,{x:s,y:r})||!i.hasClass("canvas-module-container")?(w.hasClass("animatable")||p===e||(p=e,w.addClass("animatable"),f=w.height(),w.height("1px")),$("#edit-page .empty").remove(),s<a.right-i.width()/3&&r<a.bottom-i.height()/2?i.before(w):i.after(w),w.height(f),setTimeout(function(){w.removeClass("animatable")},200),g=null):((g=u.getModule(i.data("key"))).editObj.move(t),w.remove()),!1}),o.filter(".canvas-module-container").each(function(){i=$(this);var e=u.getModule(i.data("key"));e!=g&&e.editObj.cancel()}),!1})}}),document.addEventListener("dragstart",function(e){e.stopImmediatePropagation(),$(e.target).hasClass("fr-uploading")?e.preventDefault():$(e.target).is("img")&&(m=e.target,$(".fr-image-resizer").removeClass("fr-active"))},!1),document.addEventListener("dragend",function(e){m=!1},!1),document.addEventListener("dragover",function(e){$(e.target).parent().hasClass("image-inner"),e.preventDefault()},!1),document.addEventListener("drop",function(e){if(e.preventDefault(),e.stopImmediatePropagation(),$(e.target).parents(".image-outer").length){var t=$(m).attr("src");if(t){var a=u.getModule($(e.target).closest(".module-container").data("key")),n=u.getModule($(m).closest(".module-container").data("key")),o=$(m).closest(".fr-element"),i=$(e.target).closest(".image-inner").index()+1;if(!a)return;a.editObj.addItem();var s=a.Data.Items.length-1,r=$(e.target).closest(".image-outer").children().last();a.Data.Items[s].Url=t,r.find("img").attr("src",t);var l=r.detach(),d=a.Data.Items.pop();$(e.target).closest(".image-inner").after(l),a.Data.Items.splice(i,0,d),a.save(),c.sync(a,"Items",a.Data.Items),m.parentNode&&m.parentNode.removeChild(m),n.Data.Html=o.html(),n.save(),c.sync(n,"Html",o.html())}}},!1),{end:function(){var e,t,a,n,o;h&&(h.detach&&h.detach(),g&&"Canvas"!=h.Type?(g.dragEnd(h),o=h):(a=h.$editNode,n=h.$previewNode),g&&g.Type&&"Canvas"===g.Type&&g.$editNode.find(".empty-canvas-cont").remove(),h.$editNode.removeClass("active default-drag-bg-color").css({position:"",opacity:"",left:"",top:"","z-index":""}),a&&(t=w.closest(".edit-div").index(),r.append(n),w.before(a),e=a.index(),k.find('.preview-div:eq("'+t+'")').find(".section-content").insertAt(e,n)),h.$editNode.find(".fr-embedly").each(function(){$(this).html($(this).data().originalEmbed)}),c.sync(h,"Pos",[e,t]),$("body").removeClass("disable-select"),u.saveLayout(),o&&o.resize?o.resize():h&&h.resize&&h.resize(),g=h=null,l.hide(),w.remove(),$(".empty").remove())},add:function(o){o.$editNode.find(".move").on("mousedown",function(e){if(!$("body").hasClass("no-internet")){var t=$(this).offset();i=e.pageX-t.left,s=e.pageY-t.top,$("body").addClass("disable-select");var a=o.$editNode;a.addClass("active").css({position:"absolute",opacity:.6,"z-index":100}),o.Data.BgColor&&a.addClass("default-drag-bg-color"),h=o;var n=2*parseInt(w.css("border-width").replace("px"))+2;w.css({height:a.height()-n,width:a.width()-n}),a.after(w),y.append(a),x(a,e),l.show()}return!1})},move:function(e,t){var a,n,o,i;null!==t[0]&&(o=e.$editNode,i=e.$previewNode,o&&(a=t[0],n=t[1],r.append(i).append(o),k.find('.preview-div:eq("'+n+'")').find(".section-content").insertAt(a,i),C.find('.edit-div:eq("'+n+'")').find(".section-content").insertAt(a,o)))},remove:function(e){}}},app.managers.resizeManager=function(e,t){var i=null,s=!1,r=0,l="#modules-edit-main .grid-div",d=function(){null!==i&&(t.sync(i,"Cols",i.Data.Cols),i.$editNode.removeClass("re-sizing"),i=null,$("body").removeClass("disable-select re-sizing"))};return $(l).on("mouseenter",".grid-div-content",function(){if(null===i)d();else{var e=0,t=i,a=t.$editNode.position().left-t.$editNode.closest(".section-content").offset().left;0<a&&(e=Math.ceil(a/($(l).width()/6)));var n=$(this).closest(".col-xs-2").index()-e;if(n*=2,0<t.$editNode.find(".donut-module").length)if(s){if(t.Data.Cols-(n-r)<=2)return!1}else if(2==r&&n<r)return!1;if(n!=r){var o=n-r;t.$editNode.removeClass("col-sm-"+t.Data.Cols),t.$previewNode.removeClass("col-sm-"+t.Data.Cols),s?(t.Data.Cols=Math.max(2,Math.min(12,t.Data.Cols-o)),r=n):0<n+2&&(t.Data.Cols=Math.max(2,Math.min(12,n+2)),r=n),t.$editNode.addClass("col-sm-"+t.Data.Cols),t.$previewNode.addClass("col-sm-"+t.Data.Cols),t.resize&&t.resize(t)}}}),{end:d,add:function(t){var e=$('<div class="resize-grip right"><div class="resize-rect"></div></div>');t.$editNode.prepend(e),e.on("mousedown touchstart",function(e){e.preventDefault(),r=t.Data.Cols-1,i=t,$("body").addClass("disable-select re-sizing"),i.$editNode.addClass("re-sizing"),s=!1}),e=$('<div class="resize-grip left"><div class="resize-rect"></div></div>'),t.$editNode.prepend(e),e.on("mousedown touchstart",function(e){e.preventDefault(),r=0,i=t,$("body").addClass("disable-select re-sizing"),i.$editNode.addClass("re-sizing"),s=!0})},remove:function(e){e.$editNode.find(".resize-grip").remove()}}},app.modHelper.createLayoutData=function(o,i,s){var r=[],l=!0;$("#edit-sections .edit-div").each(function(e,t){var a=$(t),n={Order:e+1,Tag:a.data("Tag"),ModIds:[]};a.data("bgUrl")&&(n.BgUrl=a.data("bgUrl"),n.BgPositionX=a.data("BgPositionX"),n.BgPositionY=a.data("BgPositionY"),n.BgSize=a.data("BgSize")),a.data("bgColor")&&(n.BgColor=a.data("bgColor")),a.find(".section-content > .module-container").each(function(e,t){var a=i.obtain(o.Modules,"Key",$(t).data("key"));if(a&&"EmptyModule"!=a.Type){if(!a.Tag)return l=!1,a.save(function(){app.modHelper.createLayoutData(o,i,s)}),!1;n.ModIds.push(a.Tag),a.editObj.saveMods&&a.editObj.saveMods()}}),r.push(n)}),l&&s(r)},app.modHelper.dragImages=function(a,m,r){function p(e){var t=$(e).closest(".module-container").attr("data-key");return a.find(function(e){return e.Key==t})}function n(){var n=null;$(".text-module > .edit-content").find(".fr-element").sortable({activate:function(e,t){n=$(t.item[0]).index()},receive:function(e,t){!function(e,t){var a=e.width();e.find("img").clone().insertAfter($(t).find(".image-inner")).addClass("fr-fil fr-draggable").width(a),$(t).find(".image-inner").remove();var n=p(t);n&&(n.Data.Html=$(t).html(),n.save(),m.sync(n,"Html",$(t).html()))}(t.item,this);var a=p(t.sender);a.Data.Items.splice(n,1),a.save(),m.sync(a,"Items",a.Data.Items)}})}function o(e,t,a){var n,o,i,s,r=p(e),l=p(t.sender),d=$(t.item[0]),c=d.index(),u=l.Data.Items.splice(a,1);r.Data.Items.splice(c,0,u[0]),r.save(),m.sync(r,"Items",r.Data.Items),n=d,o=r,i=u[0],s=r.Data.Items,n.find(".edit-btn").uploader({module:o,custom:"imgMod",success:function(e){var t,a=(t=e.Message)&&t.toString().replace("&amp;","&");i.Url=a,n.find("img").attr("src",a),m.sync(o,"Items",s)}}),l.save(),m.sync(l,"Items",l.Data.Items)}$(".image-outer").sortable({oldPosition:null,animation:200,cursor:"move",items:"> .image-inner",handle:"img",connectWith:".text-module > .edit-content .fr-element, .image-outer",activate:function(e,t){this.oldPosition=$(t.item[0]).index()},start:function(e,t){this.oldPosition=$(t.item[0]).index(),n(),$(this).sortable("refresh")},receive:function(e,t){o(this,t,this.oldPosition)},update:function(e,t){var a,n,o,i,s;null==t.sender&&t.item.parent().is($(this))&&(n=t,o=(a=this).oldPosition,i=p(a),s=$(n.item[0]).index(),r(i.Data.Items,o,s),i.save(),m.sync(i,"Items",i.Data.Items))},stop:function(e,t){$(".text-module > .edit-content").find(".fr-element").is(":ui-sortable")&&($(".text-module > .edit-content").find(".fr-element").sortable("destroy"),$(this).sortable("refresh"))}})},app.modHelper.dragTags=function(i,s,r){function a(e,t,a){var n,o=(n=$(e).closest(".module-container").attr("data-key"),i.find(function(e){return e.Key==n}));r(o.Data.Items,t,a),o.save(),s.sync(o,"Items",o.Data.Items)}$(".tag-container").sortable({cursor:"move",animation:200,items:"> .tag",cancel:"[contenteditable]",oldPosition:null,start:function(e,t){this.oldPosition=$(t.item[0]).index()},stop:function(e,t){newPosition=$(t.item[0]).index(),newPosition!=this.oldPosition&&a(this,this.oldPosition,newPosition)}})},app.modHelper.dragTaskList=function(a,d,r){function c(e){var t=$(e).closest(".module-container").attr("data-key");return a.find(function(e){return e.Key==t})}$(".task-list-container").sortable({oldPosition:null,animation:200,cursor:"move",handle:".item-drag-handle",items:"> .task-list-item",connectWith:".task-list-container",activate:function(e,t){this.oldPosition=$(t.item[0]).index()},start:function(e,t){this.oldPosition=$(t.item[0]).index(),$(this).sortable("refresh"),function(e){var t=c(e);t.editObj.hideSelectStatusDropDown();var a=t.$editNode.find(".module-buttons.drop-down-container");a.removeClass("showing"),a.find(".drop-down").hide()}(this)},receive:function(e,t){var a,n,o,i,s,r,l;n=t,o=(a=this).oldPosition,i=c(a),s=c(n.sender),r=$(n.item[0]).index(),l=s.Data.Items.splice(o,1),i.Data.Items.splice(r,0,l[0]),i.save(),d.sync(i,"Items",i.Data.Items),s.save(),d.sync(s,"Items",s.Data.Items),i.editObj.reinit(a),i.editObj.updateProgress(),s.editObj.updateProgress()},update:function(e,t){var a,n,o,i,s;null==t.sender&&t.item.parent().is($(this))&&(n=t,o=(a=this).oldPosition,i=c(a),s=$(n.item[0]).index(),r(i.Data.Items,o,s),i.save(),d.sync(i,"Items",i.Data.Items))},stop:function(e,t){$(this).sortable("refresh")}})},app.modHelper.getGuiModules=function(e,t){for(var a,n=[],o=0;o<e.Modules.length;o++){var i=e.Modules[o];i.Key=i.Tag||t.uniqueId(),i.Data=JSON.parse(i.Data),i.lastSavedData=JSON.stringify(i.Data),(a=i.Records)&&$.each(a,function(e,t){t.Created=new Date(t.Created),t.Data=JSON.parse(t.Data)}),"DataModule"!=i.Type&&n.push(i)}return n},app.modHelper.sectionHelper=function(p,s,f,h,g,v,b,T,y,r,l,C,e,k){var w,x=h.changeImage,P=h.setCallback,d=$("#edit-sections"),c=$("#modules-preview-main");$("#modules-preview-header");var u=function(e){var t=$('<div class="preview-div clearfix"><div class="section-content clearfix"></div></div>');return e.BgUrl&&(t.css("backgroundImage","url("+e.BgUrl+")"),e.BgPositionY&&t.css("backgroundPositionY",e.BgPositionY),e.BgPositionX&&t.css("backgroundPositionX",e.BgPositionX),e.BgSize&&t.css("backgroundSize",e.BgSize),w=e.BgUrl),e.BgColor&&t.css("backgroundColor",e.BgColor),t},S=function(e,t){if("up"==e){var a=t.prev();a.length&&t.insertBefore(a)}else if("down"==e){var n=t.next();n.length&&t.insertAfter(n)}else"top"==e?t.parent().prepend(t):"bottom"==e&&t.parent().append(t)};var m=function(i,s){i.Tag=i.Tag||function e(){for(var t=y.Data.Sections,a=g.uniqueId(!0),n=0;n<t.length;n++)if(t[n].Tag==a||g.obtain(f.Modules,"Tag",a))return e();return a}();var r=$('<div class="edit-div clearfix"><div class="section-content clearfix"></div></div>').data("Tag",i.Tag).data("bgUrl",i.BgUrl).data("BgPositionX",i.BgPositionX).data("BgPositionY",i.BgPositionY).data("BgSize",i.BgSize).data("bgColor",i.BgColor);function a(e){S(e,r),S(e,s),"move"==p.currentAction()&&$("html,body").animate({scrollTop:r.offset().top},400)}function t(e){var o=[];r.find(".module-container").each(function(e,t){var a=g.obtain(f.Modules,"Key",$(t).data("key"));if(a){var n=T[a.Type];o.push(a.ID),a.noDelete=!0,n.removeModule(a,1)}}),e||app.factory.apiHelper.deleteModules(o),r.remove(),s.remove()}function n(e){i.BgColor=e,i.BgUrl="",r.data("bgColor",e),r.data("bgUrl",""),r.css("backgroundColor",e),r.css("backgroundImage",""),r.css("backgroundPositionX",""),r.css("backgroundPositionY",""),r.css("backgroundSize",""),s.css("backgroundColor",e),s.css("backgroundImage",""),s.css("backgroundPositionX",""),s.css("backgroundPositionY",""),s.css("backgroundSize","")}function o(e){i.BgColor="",i.BgUrl=e;var t=r.data("bgUrl");x(t,e),r.data("bgUrl",e),r.data("bgColor",""),g.changeBg(b,r,e),s.css("backgroundImage","url("+e+")")}function l(e){r.data("BgPositionX",e),r.css("backgroundPositionX",e),s.css("backgroundPositionX",e)}function d(e){r.data("BgPositionY",e),r.css("backgroundPositionY",e),s.css("backgroundPositionY",e)}function c(e){r.data("BgSize",e),r.css("backgroundSize",e),s.css("backgroundSize",e)}function u(e){l(e.backgroundPositionX),d(e.backgroundPositionY),c(e.backgroundSize)}function e(){x(i.BgUrl,""),i.BgColor="",i.BgUrl="",r.data("bgUrl",""),r.data("bgColor",""),r.css("backgroundImage",""),r.css("backgroundColor",""),s.css("backgroundImage",""),s.css("backgroundColor","")}i.BgUrl?(x("",i.BgUrl),r.css("backgroundImage","url("+i.BgUrl+")"),i.BgPositionY&&r.css("backgroundPositionY",i.BgPositionY),i.BgPositionX&&r.css("backgroundPositionX",i.BgPositionX),i.BgSize&&r.css("backgroundSize",i.BgSize),r.find(""),w=i.BgUrl):i.BgColor&&r.css("backgroundColor",i.BgColor),C.reg(i,"Sec_AddModule",function(e,t){p.addModule(t.Type,t,0,r.find(".section-content"),s.find(".section-content"))}),C.reg(i,"Sec_Move",function(e,t){a(t)}),C.reg(i,"Sec_Remove",function(){t(!0)}),C.reg(i,"Sec_Duplicate",function(e,t){i.newTag=t,p.duplicateSection(i,r,s)}),C.reg(i,"Sec_BgColor",function(e,t){n(t)}),C.reg(i,"Sec_BgURL",function(e,t){P(null),o(t)}),C.reg(i,"Sec_BgPositionX",function(e,t){l(t)}),C.reg(i,"Sec_BgPositionY",function(e,t){d(t)}),C.reg(i,"Sec_BgSize",function(e,t){c(t)}),C.reg(i,"Sec_BgReset",e);var m=h.sectionButtons(i,{addModule:function(){var e=f.Modules[0].Data.Theme;b.addModule(function(e,t){p.addModule(e,t,1,r.find(".section-content"),s.find(".section-content"))},0,e)},handleExport:function(){var a,n="",o=$("#home-page");b.exp(f,p.getExport(),{$el:s,target:"section",cb:function(e,t){n="",(a=v.isCurrent(v.pages.home))||v.showPage(v.pages.home),o.css("width",e+"px"),setTimeout(function(){p.activatePreview();var e=$('<div><div class="container-fluid"><div class="row" id="modules-preview-main">'+$("<div>").append(s.clone()).html()+"</div></div></div>");$("head").find(".module-style, #folio-style").each(function(e,t){n+="<style>"+t.innerHTML+"</style>"}),n+=e.html(),n+=$("#tmp-power-by-footer").get(0).outerHTML,t(n),o.css("width",""),a?p.activatePreview():v.showPage(v.pages.edit),p.saveData()},20)}})},move:function(e){p.currentAction("move"),a(e),C.sync(i,"Sec_Move",e),p.saveLayout()},del:function(e){e?(t(),C.sync(i,"Sec_Remove",""),setTimeout(p.saveLayout,1e3)):b.message({heading:"Delete section?",message:"You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",handleOK:function(){t(),C.sync(i,"Sec_Remove",""),setTimeout(p.saveLayout,1e3)}})},dup:function(){var e=!!r.find(".persona-canvas").length,t=C.getModuleCount("persona-canvas"),a=app.consts.freePersonaLimit,n=k.isFreeWithTeam()||k.isTryMode();if(console.log("isPersonaLimmited",n),e&&n&&a<=t)k.showFreePersonaBlocker(b);else{p.currentAction("dup");var o=p.duplicateSection(i,r,s);C.sync(i,"Sec_Duplicate",o.Tag),p.saveLayout()}},bgColor:function(e){n(e),C.sync(i,"Sec_BgColor",e),p.saveLayout()},bgUrl:function(t){w=t,b.bgImageAdjust(r,t,function(e){o(t),u(e),C.sync(i,"Sec_BgURL",t),C.sync(i,"Sec_BgPositionX",e.backgroundPositionX),C.sync(i,"Sec_BgPositionY",e.backgroundPositionY),C.sync(i,"Sec_BgSize",e.backgroundSize),p.saveLayout()})},adjustBgFn:function(){b.bgImageAdjust(r,w,function(e){o(w),u(e),C.sync(i,"Sec_BgURL",w),C.sync(i,"Sec_BgPositionX",e.backgroundPositionX),C.sync(i,"Sec_BgPositionY",e.backgroundPositionY),C.sync(i,"Sec_BgSize",e.backgroundSize),p.saveLayout()})},resetBg:function(){e(),C.sync(i,"Sec_BgReset",""),p.saveLayout()}});return r.prepend(m.$node),r};return{createSection:function(e){var t,a=e||{},n=u(a);return c.append(n),l&&(t=m(a,n),d.append(t)),[t,n]},init:function(){var e,t;e=y.Data.Sections,t=_.concat(_.flatten(_.map(e,"ModIds"))),_.isEqual(t,_.uniq(t))||b.message({heading:"Your Folio is Corrupt",message:"There was a glitch with the network that caused a bug in this folio. Please contact support and we'll get this fixed for you. Sorry for the inconvenience!",btnText:"Contact Support",noClose:!0,notMini:!0,handleOK:function(){var e=window.location.href;window.$crisp&&($crisp.push(["set","message:text",["My folio "+e+" is corrupt. Can you please look into it?"]]),$crisp.push(["do","chat:open"]))}}),$.each(y.Data.Sections,function(e,t){if(!(1==s.IsMod&&t.ModIds.length<=0)){var a,n,o;for(o=u(t),c.append(o),l&&(n=m(t,o),d.append(n),n=n.find(".section-content")),o=o.find(".section-content"),e=0;e<t.ModIds.length;e++){var i=p.getModule(t.ModIds[e]);i&&i.Tag&&(a=g.obtain(r,"Tag",i.Tag))&&T[a.Type].initModule(g,a,1,o,n)}p.addModule("EmptyModule")}})}}},app.factory.bgColor=function(e,t,a){e.$editNode&&e.$editNode.css("backgroundImage",""),e.$previewNode.css("backgroundImage",""),delete e.Data.BgUrl,e.$editNode&&e.$editNode.css("backgroundColor",t),e.$previewNode.css("backgroundColor",t),e.Data.BgColor=t,a||this.appHub.sync(e,"BgColor",t)},app.factory.bgUrl=function(e,t,a){e.$editNode&&this.utility.changeBg(this.popup,e.$editNode,t),e.$previewNode.css("backgroundImage","url("+t+")"),this.changeImage(e.Data.BgUrl,t),delete e.Data.BgColor,e.Data.BgUrl=t,a||this.appHub.sync(e,"BgUrl",t)},app.factory.bgPositionY=function(e,t,a){e.$editNode&&e.$editNode.css("backgroundPositionY",t.backgroundPositionY),e.$previewNode.css("backgroundPositionY",t.backgroundPositionY),e.Data.BgPositionY=t.backgroundPositionY,a||this.appHub.sync(e,"BgPositionY",t.backgroundPositionY)},app.factory.bgPositionX=function(e,t,a){e.$editNode&&e.$editNode.css("backgroundPositionX",t.backgroundPositionX),e.$previewNode.css("backgroundPositionX",t.backgroundPositionX),e.Data.BgPositionX=t.backgroundPositionX,a||this.appHub.sync(e,"BgPositionX",t.backgroundPositionX)},app.factory.bgSize=function(e,t,a){e.$editNode&&e.$editNode.css("backgroundSize",t.backgroundSize),e.$previewNode.css("backgroundSize",t.backgroundSize),e.Data.BgSize=t.backgroundSize,a||this.appHub.sync(e,"BgSize",t.backgroundSize)},app.factory.resetBg=function(e,t){delete e.Data.BgColor,delete e.Data.BgUrl,"Canvas"==e.Type?(e.$editNode&&e.$editNode.css("backgroundColor","rgba(0,0,0,0)"),e.$previewNode.css("backgroundColor","rgba(0,0,0,0)"),e.Data.BgColor="rgba(0,0,0,0)"):(e.$editNode&&e.$editNode.css("backgroundColor",""),e.$previewNode.css("backgroundColor","")),e.$editNode&&e.$editNode.css("backgroundImage","").css("backgroundPositionY","").css("backgroundPositionX","").css("backgroundSize",""),e.$previewNode.css("backgroundImage","").css("backgroundPositionY","").css("backgroundPositionX","").css("backgroundSize",""),t||this.appHub.sync(e,"ResetBg","")},app.factory.createStyle=function(e,t,a,n){var o="",i="#ed-"+e+" ",s=",#pr-"+e+" ",r=n||["h1","h2","h3","h4",".title > *:not(.fr-wrapper):first-child",".title .fr-view > *:first-child"],l="<style id=style"+e+' type="text/css" class="module-style">';t&&($.each(r,function(e,t){o+=i+t,o+=s+t+","}),o=o.slice(0,-1),o+="{ color: "+t+";}"),o+=i+s+"{ border-color:"+t+";border-style:solid;border-width:0;}",$.each(a,function(e,t){$.each(t.selectors,function(e,t){o+=i+t,o+=s+t+","}),o=o.slice(0,-1),o+="{"+t.prop+":"+t.value+";}"}),l+=o+"</style>",$("head #style"+e).remove(),$("#folio-style").before(l);var d,c=$("#folio-style").text().split("}"),u=c.length,m="<style id=stylefs"+e+' type="text/css" class="module-style">';for(d=0;d<u;d++){if(c[d].length)c[d]=$.trim(c[d])+"}",m+="#ed-"+e+c[d].replace(/,(\s)*./g,",#ed-"+e+".")+("#ed-"+e+" "+c[d].replace(/,(\s)*./g,",#ed-"+e+"."))+("#pr-"+e+c[d].replace(/,(\s)*./g,",#pr-"+e+"."))+("#pr-"+e+" "+c[d].replace(/,(\s)*./g,",#pr-"+e+"."))}m+="</style>",$("head #stylefs"+e).remove(),$("#folio-style").before(m)},app.factory.createDOMNodes=function(e,t,a,n){var o,i,s='<div class="header-container"><div class="header fr-view"></div></div>',r=e.Data,l=e.previewObj,d=e.editObj,c=e.Data.Theme||"#4C7BA0",u="module-container col-xs-12 col-sm-"+r.Cols+" "+(r.CssClass||r.FormatClass||"");e.containerClassName&&(u+=" "+e.containerClassName),(o=e.$previewNode=$('<div id="pr-'+e.Key+'"></div>')).addClass(u),r.BgColor&&o.css("backgroundColor",r.BgColor),r.BgUrl&&(o.css("backgroundImage","url("+r.BgUrl+")"),r.BgPositionY&&o.css("backgroundPositionY",r.BgPositionY),r.BgPositionX&&o.css("backgroundPositionX",r.BgPositionX),r.BgSize&&o.css("backgroundSize",r.BgSize)),n?o.insertAfter(n.$previewNode):t&&t.append(o),o.append(l.$node),"EmptyModule"!=e.Type&&l.$node.prepend(s),l.mount&&l.mount(),(this.config.editMode||this.config.tryMode)&&((i=e.$editNode=$('<div data-key="'+e.Key+'" id="ed-'+e.Key+'"></div>')).append('<div class="others"></div>'),i.css({borderWidth:1==r.Border?"1px":"0"}),i.addClass(u),r.BgColor&&i.css("backgroundColor",r.BgColor),r.BgUrl&&(i.css("backgroundImage","url("+r.BgUrl+")"),this.changeImage("",r.BgUrl),r.BgPositionX&&i.css("backgroundPositionX",r.BgPositionX),r.BgPositionY&&i.css("backgroundPositionY",r.BgPositionY),r.BgSize&&i.css("backgroundSize",r.BgSize)),n?i.insertAfter(n.$editNode):a&&a.append(i),"EmptyModule"!=e.Type&&d.$node.prepend(s),i.append(this.menu.modButtons(this,e,d).$node),i.append(d.$node),d.$node.find("> .header-container").css({display:1==r.Head?"":"none"}).toggleClass("hide-header-container",1!=r.Head).find(".header").editor(e,r,"Header",{allowEnter:!0,cleanPTags:!0}),this.rddm.addModule(e),d.mount&&d.mount(),e.Data.Titlehide&&e.$editNode.addClass("remove-title")),e.Data.Titlehide&&e.$previewNode.addClass("remove-title"),e.applyStyle&&(e.applyStyle(c),e.editObj&&e.editObj.applyStyle&&e.editObj.applyStyle(c))},app.factory.handleExport=function(a,e){var n=this;a.$editNode.addClass("keep-open");var o,i="",s=$("#home-page");a.Data.Exports||(a.Data.Exports={}),n.popup.exp(n.folio,a.Data.Exports,{$el:a.$previewNode,isMod:!0,target:"module",cb:function(e,t){i="",(o=n.pageManager.isCurrent(n.pageManager.pages.home))||n.pageManager.showPage(n.pageManager.pages.home),s.css("width",e+"px"),setTimeout(function(){n.modManager.activatePreview();var e=$('<div><div class="container-fluid"><div class="row" id="modules-preview-main"><div class="preview-div clearfix"><div class="section-content clearfix">'+$("<div>").append(a.$previewNode.clone()).html()+"</div></div></div></div></div>");$("head").find(".module-style, #folio-style").each(function(e,t){i+="<style>"+t.innerHTML+"</style>"}),i+=e.html(),i+=$("#tmp-power-by-footer").get(0).outerHTML,t(i),s.css("width",""),o?n.modManager.activatePreview():n.pageManager.showPage(n.pageManager.pages.edit),a.save(),a.$editNode.removeClass("keep-open")},200)}})},app.factory.fixData=function(e){var n=this;$.each(e,function(e,a){a&&$.each(a,function(e,t){"Items"==e?n.fixData(t):("object"===_typeof(t)&&(t=JSON.stringify(t)),a[e]=n.$div.html(t).html())})})},app.factory.initModule=function(e,i,t,a,n,o,s,r){var l=this,d=i.Data;try{d="string"==typeof d?JSON.parse(d):d}catch(e){}try{t&&$.each(d,function(e,t){t&&("Items"==e?l.fixData(t):d[e]=l.decoder&&l.decoder(l.$div,e,t)||t)})}catch(e){console.log("initModule fix error",e)}i.factory=l,d.Cols=d.Cols||l.cols,i.save=function(e){l.appHub.saveMod(i,e)},i.Data.Theme||(i.Data.Theme=r),l.setupModule&&l.setupModule(i),i.previewObj=l.getPreview(i),(l.config.editMode||l.config.tryMode)&&(i.editObj=l.getEdit(i),i.listEditors=function(){var e,t=l.config.currentlyEditing,a=i.$editNode.find(".others");for(var n in a.empty(),t)if((e=t[n]).active&&e.module.Tag==i.Tag){$('.module-container .user[data-email="'+n+'"]').remove();var o=$('<span class="user" data-email="'+n+'" data-tip="'+e.name+'">'+app.core.utility().getInitials(e.name)+"</span>");a.append(o)}}),l.createDOMNodes(i,a,n,o),(l.modules[i.Key]=i).showSpinner=function(){i.$editNode.prepend($("#spinner-container > .loading-animation").clone())},i.hideSpinner=function(){i.$editNode.find(".loading-animation").remove()},i.bringInView=function(){var e=$("#ed-"+i.Key),t=$("#pr-"+i.Key),a=0<e.length?e:t,n=a.offset();a.addClass("active"),n&&$("html,body").animate({scrollTop:n.top-100},600,function(){setTimeout(function(){a.removeClass("active")},2e3)})},"Canvas"===i.Type&&(0!==d.Mods.length&&e.canvasHasChildren(i.$editNode)||e.generateEmptyCanvasModule(i.$editNode,i.$previewNode)),setTimeout(function(){app.plugin.tooltip(!0)},500)},app.factory.main=function(e,t,a,n,o,i,s,r){var l=this;l.config=e,l.folio=t,l.$div=$("<div>"),l.$store=$("<div>"),l.$modItemsDiv=$("#module-items"),l.apiHelper=a.apiHelper,l.appHub=a.appHub,l.eventManager=a.eventManager,l.pageManager=a.pageManager,l.store=a.store,l.utility=a.utility,l.modStore=a.modStore,l.menu=n,l.modManager=i,l.popup=o,l.rddm=s,l.changeImage=n.changeImage,l.editBase=app.mods.getEditBase(e,a.appHub,a.eventManager),l.renderPreview=function(e){var t=e.Data,a=t.Theme||"#4C7BA0";e.$previewNode.css({border:1==t.Border?"1px solid "+a:""}),e.$previewNode.find("> .module .header-container").css({display:1==t.Head?"":"none"}).toggleClass("hide-header-container",1!=t.Head).find(".header").html(t.Header),e.renderPreview()};var d=function(e){var t=$.extend({},l,{modules:{},type:e.type,options:e,cols:e.cols||12});return i.registerFactory(t),t},c=app.mods;c.dataCollectionFactory(d),c.textFactory(d,r),c.donutFactory(e,d,r),c.canvasFactory(d,r),c.rowBreakFactory(d),c.plainHtmlFactory(d),c.emptyModuleFactory(d),c.imagesFactory(d),c.videosFactory(d,i,o),c.barFactory(d,r),c.vertBarFactory(d,r),c.taskListFactory(d,r),c.scaleFactory(d,r),c.tagFactory(d,r),c.socialFactory(d),i.init()},app.factory.shareModule=function(e,t){this.popup.shareLink(e,[t.ID],t.Type)},app.factory.removeModule=function(e,t,a){var o=this,n=function(){if(o.rddm.removeModule(e),o.menu.detach(),e.$editNode.remove(),e.$previewNode.remove(),o.modManager.removeMod(e),e.noDelete||o.apiHelper.deleteModule(e),"Canvas"==e.Type){var n=[];$.each(e.Data.Mods,function(e,t){var a=o.modManager.getModule(t.Tag);a&&(n.push(a.ID),o.modManager.removeMod(a))}),o.apiHelper.deleteModules(n)}delete o.modules[e.Key],o.modManager.saveLayout(),a&&a()};if(t)n();else{var i="Canvas"==e.Type?"canvas":"module";o.popup.message({heading:"Delete "+i+"?",message:"You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",handleOK:n})}},app.mods.barFactory=function(e,a){var n=e({type:"Bar",cols:4});n.decoder=function(e,t,a){return a},n.setupModule=function(t){var e=t.Data;e.Head=e.Head||2,e.Txt=e.Txt||1,e.Title=e.Title||"<p>Bar Graph</p>",e.Items=e.Items||[{Name:"<p>Bar 1</p>",Val:50},{Name:"<p>Bar 2</p>",Val:75},{Name:"<p>Bar 3</p>",Val:25}],t.applyStyle=function(e){a.clearHeaderColors(this),n.createStyle(t.Key,e,[{prop:"background-color",value:e,selectors:[".slider-bar"]},{prop:"color",value:e,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]},{prop:"background-color",value:e,selectors:[".fr-cta-btn"]},{prop:"color",value:a.getColorContrast(e),selectors:[".fr-cta-btn-link"]}])}},n.getPreview=app.mods.barPreview(n),(n.config.editMode||n.config.tryMode)&&(n.getEdit=app.mods.barEdit(n,app.mods.sliderBaseFunc(n.appHub,"width")))},app.mods.canvasFactory=function(e,s){var r=e({type:"Canvas",cols:12}),l=(s=r.utility,Date.now(),null);function d(n,e){var t=n.Data,o=1,i=[];$.each(t.Mods,function(e,t){var a=r.modManager.getModule(t.Tag);if(!a.Tag)return clearTimeout(l),l=setTimeout(function(){d(n)},1e3),o=0,!1;i.indexOf(a.Tag)<0&&i.push(a.Tag),t.Tag=a.Tag,a.save()}),o&&i.length==t.Mods.length&&r.appHub.saveMod(n,function(){e&&e(),n.saved&&n.saved()})}r.decoder=function(e,t,a){return a},r.include=function(a,n,e){var o=a.Data;e||(a.editObj.saveMods(),d(a)),n.detach=function(){var t=o.Theme;try{t=(t=JSON.parse(n.lastSavedData)).Theme}catch(e){t=o.Theme}o.Theme=t,n.Data.Theme=t,n.editObj.applyStyle&&(n.editObj.applyStyle(o.Theme),r.appHub.sync(n,"Theme",o.Theme));var e=r.utility.obtain(o.Mods,"Tag",n.Tag||n.Key);e&&(r.utility.removeFromList(o.Mods,e),n.detach=null,n.clone=null,r.appHub.sync(a,"Mods",o.Mods))},n.clone=function(){a.editObj.clone(n)}},r.setupModule=function(i){var e=i.Data;i.noResize=!0,i.containerClassName="canvas-module-container",e.Header=e.Header||"Title",e.Theme=e.Theme||"",e.Mods=e.Mods||[],e.Arr=e.Arr||[3,6,3],e.Head=e.Head||2,e.Border=e.Border||2;$.each(e.Mods,function(e,t){var a,n=r.modManager.getModule(t.Tag);if(n){var o=r.modManager.getFactory(n);o&&(o.initModule(s,n,1),r.include(i,n,!0))}else t.Module&&((a=t.Module).Sync=!i.New,r.modManager.addModule(a.Type,a,!1))}),i.save=function(e){i.editObj.saveMods(),d(i,e)},i.applyStyle=function(e){r.createStyle(i.Key,e,[{prop:"background-color",value:e,selectors:[".canvas-module > .header-container"]},{prop:"background-color",value:e,selectors:[".canvas-module  .quote"]},{prop:"margin",value:"0 auto",selectors:[""]}],[".nope"])},r.editBase(i,{})},r.getPreview=app.mods.canvasPreview(r),(r.config.editMode||r.config.tryMode)&&(r.getEdit=app.mods.canvasEdit(r,s))},app.mods.dataCollectionFactory=function(e,t){var a=e({type:"DataCollection",cols:12});a.decoder=function(e,t,a){return"ButtonText"==t?e.html(a).text():a},a.setupModule=function(t){t.Data.ButtonText=t.Data.ButtonText||"Join Us!",t.Data.Message=t.Data.Message||"<h3>Give them a good reason.</h3>",t.applyStyle=function(e){a.createStyle(t.Key,0,[{prop:"background-color",value:e,selectors:[".module-info-inner",".dc-join-us"]},{prop:"background-color",value:d3.rgb(e).darker(.2).toString(),selectors:[".module-info-inner:hover",".dc-join-us:hover"]},{prop:"color",value:e,selectors:[".header"]}])}},a.getPreview=app.mods.dataCollectionPreview(a),(a.config.editMode||a.config.tryMode)&&(a.getEdit=app.mods.dataCollectionEdit(a))},app.mods.donutFactory=function(e,t,a){var o=$("<div>"),i=t({type:"DonutChart",cols:8});i.createColorFunc=function(t,e){var a=d3.rgb(e).brighter(3.7).toString();if(a.length<7)for(var n=7-a.length,o=0;o<n;o++)a=a.replace("#","#0");var i={colorStart:e,colorEnd:a},s=d3.interpolateRgb(i.colorStart,i.colorEnd);return function(e){return s(e/t)}},i.decoder=function(e,t,a){return a};var n=app.mods.donutBaseFunc(e,i);i.setupModule=function(n){var e,t=n.Data;if(n.breakup=[],t.Title=t.Title||"<p>Pie Chart</p>",t.Label=t.Label||"<h2>Click to edit label</h2>",t.Theme=t.Theme||"",!t.Items)for(t.Items=[],e=1;e<=5;e++)t.Items.push({Val:"<p>20% &nbsp;Segment "+e+"</p>"});$.each(t.Items,function(e,t){var a=parseInt(o.html($.trim(t.Val)).text());isNaN(a)||n.breakup.push(a)}),n.applyStyle=function(e){n.colorFunc=i.createColorFunc(t.Items.length,e),i.createStyle(n.Key,e,[{prop:"color",value:e,selectors:[".header",".donut-label"]},{prop:"margin",value:"0 auto",selectors:[""]},{prop:"background-color",value:e,selectors:[".fr-cta-btn"]},{prop:"color",value:a.getColorContrast(e),selectors:[".fr-cta-btn-link"]}])}},i.getPreview=app.mods.donutPreview(i,n),(i.config.editMode||i.config.tryMode)&&(i.getEdit=app.mods.donutEdit(i,n))},app.mods.emptyModuleFactory=function(e){var t=e({type:"EmptyModule",cols:12});t.setupModule=function(e){e.noResize=!0,e.noDrag=!0,e.Data.Cols=12,e.containerClassName="empty-module-container"},t.getPreview=function(e){return e.renderPreview=function(){},{$node:$('<div class="module empty-module"></div>')}},(t.config.editMode||t.config.tryMode)&&(t.getEdit=function(e){var t=$('<button class="btn add-btn blue-btn">+ Add</button>');return t.on("click",function(){t.closest(".edit-div").find(".add-mod-btn").trigger("click")}),{$node:$('<div class="module empty-module"><p>No modules added yet.</p></div>').append(t)}})},app.mods.imagesFactory=function(e,t){var a=e({type:"Images",cols:2}),n="/img/placeholder-img.png";a.defImg=n,a.decoder=function(e,t,a){return a},a.setupModule=function(t){var e=t.Data;e.Align=e.Align||"left",e.Html=e.Html||"Images",e.Items=e.Items||[{Url:n,Val:100,Caption:"Image Caption",ShowCaption:0}],e.Head=e.Head||2,e.Txt=e.Txt||2,t.applyStyle=function(e){a.createStyle(t.Key,e,[{prop:"color",value:e,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.imagesPreview(a),(a.config.editMode||a.config.tryMode)&&(a.getEdit=app.mods.imagesEdit(a))},app.mods.plainHtmlFactory=function(e){var i=$("#tmp-edit-plainhtml").html(),n=$("#tmp-prev-plainhtml").html(),t=e({type:"PlainHtml",cols:6});t.setupModule=function(e){e.Data.Html=e.Data.Html||"<p>Write your HTML and style it anyway you want!</p><p>You can also use Twitter Bootstrap classes to style your HTML!</p>"},t.getPreview=function(e){var t=$(n),a=t.find(".content-box");return e.renderPreview=function(){a.html(e.Data.Html)},{$node:t}},(t.config.editMode||t.config.tryMode)&&(t.getEdit=function(t){var e=$(i),a=e.find(".text-area"),n=Date.now(),o=e.find(".edit-btn");return a.val(t.Data.Html),a.on("keydown",function(){var e=Date.now();8e3<e-n&&(t.Data.Html=a.val(),t.save(),n=e)}),a.on("blur",function(){t.Data.Html=$(this).val(),"normal",e.removeClass("edit").addClass("normal"),t.save()}),o.on("click",function(){"edit",e.removeClass("normal").addClass("edit"),a.focus()}),{$node:e}})},app.mods.rowBreakFactory=function(e){var a=$("#tmp-edit-row-break").html(),t=$("#tmp-prev-row-break").html(),n=e({type:"RowBreak",cols:12});n.setupModule=function(e){e.noResize=!0,e.Data.Cols=12,e.containerClassName="row-break-module"},n.getPreview=function(e){return e.renderPreview=function(){},{$node:$(t)}},(n.config.editMode||n.config.tryMode)&&(n.getEdit=function(e){var t=$(a);return n.editBase(e,{}),{$node:t}})},app.mods.scaleFactory=function(e,a){var n=e({type:"Scale",cols:4});n.decoder=function(e,t,a){return a},n.setupModule=function(t){var e=t.Data;e.Head=e.Head||2,e.Txt=e.Txt||1,e.Title=e.Title||"<p>Scale Chart</p>",e.Items=e.Items||[{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:30},{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:70},{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:50}],t.applyStyle=function(e){n.createStyle(t.Key,e,[{prop:"background-color",value:e,selectors:[".slider-bar"]},{prop:"color",value:e,selectors:[".header-container .header"]},{prop:"margin",value:"0 auto",selectors:[""]},{prop:"background-color",value:e,selectors:[".fr-cta-btn"]},{prop:"color",value:a.getColorContrast(e),selectors:[".fr-cta-btn-link"]}])}},n.getPreview=app.mods.scalePreview(n),(n.config.editMode||n.config.tryMode)&&(n.getEdit=app.mods.scaleEdit(n,app.mods.sliderBaseFunc(n.appHub,"left")))},app.mods.socialFactory=function(e,t){var a=e({type:"Social",cols:4});a.decoder=function(e,t,a){return a},a.setupModule=function(t){var e=t.Data;e.Align=e.Align||"center",t.applyStyle=function(e){a.createStyle(t.Key,e,[{prop:"color",value:e,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.socialPreview(a),(a.config.editMode||a.config.tryMode)&&(a.getEdit=app.mods.socialEdit(a))},app.mods.tagFactory=function(e,a){var n=e({type:"Tag",cols:4});n.decoder=function(e,t,a){return a},n.setupModule=function(t){var e=t.Data;e.Align=e.Align||"left",e.Items=e.Items||[{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"}],t.applyStyle=function(e){n.createStyle(t.Key,e,[{prop:"color",value:e,selectors:[".header"]},{prop:"background-color",value:e,selectors:[".tag-inner"]},{prop:"color",value:a.getColorContrast(e),selectors:[".tag-inner p"]},{prop:"margin",value:"0 auto",selectors:[""]},{prop:"background-color",value:e,selectors:[".fr-cta-btn"]},{prop:"color",value:a.getColorContrast(e),selectors:[".fr-cta-btn-link"]}])}},n.getPreview=app.mods.tagPreview(n),(n.config.editMode||n.config.tryMode)&&(n.getEdit=app.mods.tagEdit(n))},app.mods.taskListFactory=function(e,t){var o={next:{txt:"Next",val:"next",icon:""},inprogress:{txt:"In Progress",val:"inprogress",icon:""},completed:{txt:"Completed",val:"completed",icon:""}},r="completed",a=e({type:"TaskList",cols:4});a.decoder=function(e,t,a){return a};var n={toggleItemStatus:function(e,t){e.toggleClass("hideItemStatus",0==t)},toggleProgress:function(e,t){e.toggleClass("hideProgress",0==t)},toggleCompleted:function(e,t){e.toggleClass("hideCompleted",0==t)},setStatus:function(e,t){var a=e.parent(),n="object"===_typeof(o[t])?o[t].txt:"";n="string"==typeof n?n:"",e.removeClass(function(e,t){return(t.match(/(^|\s)icon-\S+/g)||[]).join(" ")}).data("tip",n),a.removeClass(function(e,t){return(t.match(/(^|\s)status-\S+/g)||[]).join(" ")}),""!==t&&(e.addClass("icon-"+t).data("tip",n),a.addClass("status-"+t))},setProgress:function(e,t,a,n){for(var o=e.length,i=0,s=0;s<o;s++)e[s].Status===r&&i++;t.text(i),a.text(o),n.animate({width:i/o*100+"%"},"slow")}};a.setupModule=function(t){var e=t.Data;e.Head=e.Head||2,e.Txt=e.Txt||1,e.Title=e.Title||"<p>Task List</p>",e.showItemStatus=e.showItemStatus||1,e.showProgress=e.showProgress||1,e.showCompleted=e.showCompleted||1,e.Items=e.Items||[{Name:"Item 1",Desc:"Description",Status:""},{Name:"Item 2",Desc:"Description",Status:""},{Name:"Item 3",Desc:"Description",Status:""},{Name:"Item 4",Desc:"Description",Status:""},{Name:"Item 5",Desc:"Description",Status:""}],t.applyStyle=function(e){a.createStyle(t.Key,e,[{prop:"background-color",value:e,selectors:[".task-list-item"]},{prop:"background-color",value:e,selectors:[".task-list-progress"]},{prop:"color",value:e,selectors:[".header"]}])}},a.getPreview=app.mods.taskListPreview(a,o,r,n),(a.config.editMode||a.config.tryMode)&&(a.getEdit=app.mods.taskListEdit(a,o,r,n))},app.mods.textFactory=function(e,a){var o=$("#tmp-edit-text").html(),i=$("#tmp-prev-text").html(),s="loading"in HTMLImageElement.prototype,r=e({type:"Text",cols:4});r.setupModule=function(t){var e=t.Data;e.Align=e.Align||"left",e.Theme=e.Theme||"",null==e.Html&&(e.Html="<h2>Text Module</h2><h4>Point. Click. Type.</h4><p>This is a pretty straightforward text editor. You can even place images, videos, tables, and links.</p>"),t.applyStyle=function(e){r.createStyle(t.Key,e,[{prop:"color",value:e,selectors:[".header","a",".text-module .name","h2 + ol","h2 + ul",".text-module .fr-view > ul li::before",".text-module .fr-view > ol li::before"]},{prop:"background-color",value:e,selectors:[".fr-cta-btn"]},{prop:"color",value:a.getColorContrast(e),selectors:[".fr-cta-btn-link"]},{prop:"margin",value:"0 auto",selectors:[""]},{prop:"color",value:e,selectors:[".text-module .fr-view > ol li::before"]}])}},r.getPreview=function(e){var t=e.Data,a=$(i),n=a.find(".text-content");return e.renderPreview=function(){if($("#tmp-export").hasClass("show"))n.html(t.Html).css("text-align",t.Align);else{var e=t.Html.replace("<img",s?'<img loading="lazy" ':'<img class="lazyload" data-');n.html(e).css("text-align",t.Align)}},{$node:a}},(r.config.editMode||r.config.tryMode)&&(r.getEdit=function(e){var t=e.Data,a=$(o).css("text-align",t.Align),n=a.find(".editor");return r.editBase(e,{}),n.editor(e,t,"Html",{allowEnter:!0}),{changeTheme:function(){n.unstyle()},align:function(){a.css("text-align",t.Align)},$node:a}})},app.mods.vertBarFactory=function(e,a){var n=e({type:"Vertical Bar",cols:4});n.decoder=function(e,t,a){return a},n.setupModule=function(t){var e=t.Data;e.Head=e.Head||2,e.Txt=e.Txt||1,e.Title=e.Title||"<p>Bar/Line Chart</p>",e.Items=e.Items||[{Name:"<p>Bar 1</p>",Val:"50",Height:"50"},{Name:"<p>Bar 2</p>",Val:"75",Height:"75"},{Name:"<p>Bar 3</p>",Val:"25",Height:"25"},{Name:"<p>Bar 4</p>",Val:"50",Height:"50"},{Name:"<p>Bar 5</p>",Val:"75",Height:"75"},{Name:"<p>Bar 6</p>",Val:"25",Height:"25"}],e.yAxisMax=e.yAxisMax||"100",e.graphType=e.graphType||"Bar",t.applyStyle=function(e){n.createStyle(t.Key,e,[{prop:"background-color",value:e,selectors:[".slider-bar"]},{prop:"color",value:e,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]},{prop:"background-color",value:e,selectors:[".fr-cta-btn"]},{prop:"color",value:a.getColorContrast(e),selectors:[".fr-cta-btn-link"]}])}},n.getPreview=app.mods.vertBarPreview(n),(n.config.editMode||n.config.tryMode)&&(n.getEdit=app.mods.vertBarEdit(n,app.mods.sliderBaseFunc(n.appHub,"height")))},app.mods.videosFactory=function(e,t,a,n){var s=[{test_regex:/^.*((youtu.be)|(youtube.com))\/((v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))?\??v?=?([^#\&\?]*).*/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)?([0-9a-zA-Z_\-]+)(.+)?/g,url_text:"https://www.youtube.com/embed/$1?$2",html:'<iframe width="640" height="360" src="{url}&wmode=opaque" frameborder="0" allowfullscreen></iframe>',provider:"youtube"},{test_regex:/^.*(?:vimeo.com)\/(?:channels(\/\w+\/)?|groups\/*\/videos\/\u200b\d+\/|video\/|)(\d+)(?:$|\/|\?)/,url_regex:/(?:https?:\/\/)?(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:[a-zA-Z0-9_\-]+)?(\/[a-zA-Z0-9_\-]+)?/i,url_text:"https://player.vimeo.com/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"vimeo"},{test_regex:/^.+(dailymotion.com|dai.ly)\/(video|hub)?\/?([^_]+)[^#]*(#video=([^_&]+))?/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:dailymotion\.com|dai\.ly)\/(?:video|hub)?\/?(.+)/g,url_text:"https://www.dailymotion.com/embed/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"dailymotion"},{test_regex:/^.+(screen.yahoo.com)\/[^_&]+/,url_regex:"",url_text:"",html:'<iframe width="640" height="360" src="{url}?format=embed" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',provider:"yahoo"},{test_regex:/^.+(rutube.ru)\/[^_&]+/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:rutube\.ru)\/(?:video)?\/?(.+)/g,url_text:"https://rutube.ru/play/embed/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',provider:"rutube"},{test_regex:/^(?:.+)vidyard.com\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/,url_regex:/^(?:.+)vidyard.com\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/g,url_text:"https://play.vidyard.com/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"vidyard"}],o=e({type:"Videos",cols:4}),i="/img/placeholder-img.png";o.defImg=i,o.decoder=function(e,t,a){return a},o.setupModule=function(t){var e=t.Data;e.Align=e.Align||"left",e.Html=e.Html||"Videos",e.Items=e.Items||[{Url:i,Val:100}],e.Head=e.Head||2,e.Txt=e.Txt||2,e.VideoUrl=e.VideoUrl||"",e.VideoUrl,t.applyStyle=function(e){o.createStyle(t.Key,e,[{prop:"color",value:e,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}};var r=function(e){for(var t,a=s,n=0;n<a.length;n++)if(a[n].test_regex.lastIndex=0,a[n].test_regex.test(e)){var o=a[n].url_text;a[n].url_regex.lastIndex=0;var i=a[n].url_regex.exec(e)[1];o=o.replace("$1",i),t=a[n].html.replace("{url}",o)}return t};o.getPreview=app.mods.videosPreview(o,r),(o.config.editMode||o.config.tryMode)&&(o.getEdit=app.mods.videosEdit(o,r,t,a))},app.mods.donutBaseFunc=function(e,u){return{pie:app.charts.pie(),mount:function(){var e=this;u.eventManager.addListener("resize",function(){e.drawPie()})},updateLabel:function(){var e=this.$pieDiv.height()/2||this.getVal(this.$pieDiv,0)/2;e&&this.$pieDiv.closest(".donut-module").find(".donut-label").find("h2").css("font-size",Math.max(50,e/2)+"%")},drawChart:function(e){e.pie.draw({$el:e.$pieDiv,items:e.module.breakup,colorFunc:e.module.colorFunc}),e.updateLabel()},getVal:function(e,t){var a=e.closest(".module-container");function n(e){return a.hasClass(e)}var o,i=e.height();return n("col-sm-2")?(i=i||170,o=!0):n("col-sm-3")?(i=i||170,o=!1):n("col-sm-4")?(i=i||170,o=!1):n("col-sm-5")?(i=i||220,o=!1):n("col-sm-6")?(i=i||270,o=!1):n("col-sm-7")?(i=i||320,o=!1):n("col-sm-8")?(i=i||370,o=!1):n("col-sm-9")?(i=i||380,o=!1):n("col-sm-10")?(i=i||390,o=!1):n("col-sm-11")?(i=i||390,o=!1):n("col-sm-12")&&(i=i||390,o=!1),0==t?i:1==t?o:2==t?i:void 0},drawPie:function(){var e,t,a=this,n=a.$pieDiv.parent(),o=a.$breakup.parent(),i=a.parentPage==u.pageManager.pages.edit?".edit-content":".module";if(a.stack=a.$pieDiv.closest(i).width()<400,e=a.$pieDiv.height(),t=(t=a.$breakup.height())||200,a.stack=a.$pieDiv.closest(i).width()<400,a.$pieDiv.parents(".module-container").hasClass("col-sm-2")?(e=e||220,a.stack=!0):a.$pieDiv.parents(".module-container").hasClass("col-sm-4")?(e=e||170,a.stack=!1):a.$pieDiv.parents(".module-container").hasClass("col-sm-6")?(e=e||270,a.stack=!1):a.$pieDiv.parents(".module-container").hasClass("col-sm-8")?(e=e||370,a.stack=!1):a.$pieDiv.parents(".module-container").hasClass("col-sm-10")?(e=e||390,a.stack=!1):a.$pieDiv.parents(".module-container").hasClass("col-sm-12")&&(e=e||390,a.stack=!1),a.$pieDiv.width(),a.stack)n.add(o).css({width:"100%","max-width":"100%"}),o.css({"padding-left":"10px"}),a.$pieDiv.add(a.$breakup).css("margin-top",""),a.drawChart(a);else{n.add(o).css({width:"","max-width":"","padding-left":""}),a.drawChart(a);var s=e/2,r=a.$pieDiv.closest(".donut-module").find(".donut-label");if(s){a.stack||(s=Math.max(s,t/2));var l=a.$breakup.find(".breakup-row").length,d=a.$breakup.find(".breakup-row").height()||40,c=0;c=(l%2||(c=l*d/2),(l-1)*d/2),s-r.height()/2-c-3}}this.updateLabel()}}},app.mods.getEditBase=function(s,t,r){return function(n,a){var o=n.Data;function i(){n.factory.renderPreview(n),n.factory.folio.Role<2&&n.save()}a.align&&t.reg(n,"Align",function(e,t){o.Align=t,n.menuCb("Align"),a.align(),i()}),t.reg(n,"Cols",function(e,t){var a=o.Cols;o.Cols=t,n.$editNode.removeClass("col-sm-"+a).addClass("col-sm-"+t),n.$previewNode.removeClass("col-sm-"+a).addClass("col-sm-"+t),"DonutChart"!=n.Type&&"Vertical Bar"!=n.Type||n.factory.eventManager.raiseEvent("resize")}),t.reg(n,"Head",function(e,t){o.Head=t,n.menuCb("Head"),i()}),a.txt&&t.reg(n,"Txt",function(e,t){o.Txt=t,n.menuCb("Txt"),a.txt()}),t.reg(n,"Theme",function(e,t){o.Theme=t,n.menuCb("Theme"),a.theme&&a.theme(),i()}),a.itemVal&&t.reg(n,"Items",function(e,t){o.Items.length==t.length?$.each(t,function(e,t){o.Items[e].Val=t.Val,o.Items[e].Url=t.Url,"Videos"==n.Type?(o.Items[e]=t,a.itemVal(e,t)):"Vertical Bar"==n.Type?(o.Items[e].Height=t.Height,a.itemVal(e,t.Height),a.vertSlider(e,t.Height,t.Val)):a.itemVal(e,t.Val,t.Url)}):(a.$items.empty(),o.Items=t,$.each(t,a.addItem)),i()}),t.reg(n,"BgColor",function(e,t){o.BgColor=t,n.menuCb("BgColor")}),t.reg(n,"BgUrl",function(e,t){o.BgUrl=t,n.menuCb("BgUrl")}),t.reg(n,"BgPositionX",function(e,t){o.BgPositionX=t,n.menuCb("BgPositionX")}),t.reg(n,"BgPositionY",function(e,t){o.BgPositionY=t,n.menuCb("BgPositionY")}),t.reg(n,"BgSize",function(e,t){o.BgSize=t,n.menuCb("BgSize")}),t.reg(n,"ResetBg",function(e,t){n.menuCb("ResetBg")}),t.reg(n,"Border",function(e,t){o.Border=t,n.menuCb("Border"),i()}),t.reg(n,"DuplicateModule",function(e,t){n.menuCb("DuplicateModule")}),t.reg(n,"RemoveModule",function(e,t){n.menuCb("RemoveModule"),r.raiseEvent("moduleRemoved",{})}),t.reg(n,"Editor",function(e,t){s.currentlyEditing[t]={time:Date.now(),active:!0,module:n},r.raiseEvent("editorStatus",{email:t,status:1})}),setTimeout(function(){s.editMode&&s.tryMode&&n.$editNode.on("keydown click",function(){if("Canvas"!=n.Type){var e=s.currentlyEditing[s.userEmail];(!e||e.module.Tag!=n.Tag||5e3<=Date.now()-e.time)&&(t.sync(n,"Editor",s.userEmail),s.currentlyEditing[s.userEmail]={time:Date.now(),module:n})}})},50)}},app.mods.sliderBaseFunc=function(e,i){return function(e,t,o,a){var n=e.Data;e.factory.editBase(e,{addItem:t,$items:o,itemVal:function(e,t){o.find("> div:eq("+e+")").find(".slider-bar").css(i,t+"%")},vertSlider:function(e,t,a){var n=o.find("> div:eq("+e+")");n.find(".slider-tooltip").css("bottom",parseFloat(t)+4+"%"),n.find(".slider-val .fr-element").text(a)},txt:function(){a.css("display",1==n.Txt?"":"none")},theme:function(){a.unstyle()}})}},app.mods.barEdit=function(c,n){var o=$("#tmp-edit-bar").html(),u=$("#tmp-edit-bar-row").html();return function(s){var r=s.Data,e=$(o),t=e.find(".title").css("display",1==r.Txt?"":"none"),l=e.find(".pairs");function d(e){c.appHub.sync(s,e,r[e])}t.editor(s,r,"Title",{allowEnter:!0});var a=function(e,t){var a=$(u),n=a.find(".name"),o=a.find(".slider-container"),i=a.find(".item-close-btn");n.editor(s,t,"Name",{index:e,cleanPTags:!0}),o.percentSlider({obj:t,sync:d}),i.on("click",function(){c.utility.removeFromList(r.Items,t),n.unMount(),a.remove(),d("Items")}),l.append(a)};return $.each(r.Items,function(e,t){a(e,t)}),n(s,a,l,t),{$node:e,addItem:function(){var e={Name:"<p>Bar "+(r.Items.length+1)+"</p>",Val:50};a(r.Items.length,e),r.Items.push(e)},changeTheme:function(e){t.unstyle()},toggleTxt:function(){t.css("display",1==r.Txt?"":"none")},unMount:function(){t.unMount(),e.find(".name").unMount()}}}},app.mods.canvasEdit=function(g,v){var b,T,y=$("#tmp-edit-canvas").html(),C=$("#tmp-canvas-resize-col").html(),k=g.appHub,w=g.eventManager,x=g.modManager;v=g.utility;function P(e){$.each(e.Data.Mods,function(e,t){var a=x.getModule(t.Tag);a&&a.resize&&a.resize()})}function S(){if(b){var e,t=b.Data,a=0,n=t.Arr[T],o=t.Arr[T+1],i=n+o,s=$(this).index();for(e=0;e<T;e++)a+=t.Arr[e];return o=i-(n=1+s-a),0<n&&0<o&&(t.Arr[T]=n,t.Arr[T+1]=o,b.editObj.setLayout(),b.save()),P(b),k.sync(b,"CanvasColResize",{col:T,first:n,second:o}),!1}}return function(i){var e,r,l,s=i.Data,d=$(y),t=d.find(".edit-content"),c=t.find(".mods-inner"),u=t.find(".resize-bars"),a=d.find(".grid-div-wrapper"),n=d.find(".grid-div"),m=$('<div class="empty" style="border: 1px dotted blue; margin-top: 12px;">');for(u.on("mousedown",".resize-grip",function(e){w.raiseEvent("docClick",e),b=i,T=$(this).index(),$("body").addClass("disable-select"),a.show()}),e=0;e<s.Arr.length;e++)c.append($("<div>"));for(d.on("mouseup mouseleave",function(){b&&(b=null,$("body").removeClass("disable-select"),a.hide())}),e=0;e<12;e++){var o=$('<div class="col col-xs-1"></div>)');o.on("mouseenter",S),n.append(o)}function p(a){var e,t=s.Arr.length;if(console.log("$node",d),t!==a){var n,o,i;if(a<t){for(o=c.find(".col:eq("+(a-1)+")"),n=a;n<t;n++)s.Arr[a-1]+=s.Arr[n],i=c.find(".col:eq("+n+")").find(".module-container"),o.append(i);c.find(".col").each(function(e,t){a-1<e&&t.remove()}),1===a&&v.addEmptyMod(d,d.parent(),".edit-content .col:eq(0)")}else{for(n=t;n<a;n++)c.append($("<div>")),s.Arr[n]=1;for(e=a-t,n=-1;n<0&&(n=t-1),1<s.Arr[n]&&(s.Arr[n]-=1,e-=1),n--,0<e;);}s.Arr.length=a}}function f(e,t,a){var n=0;t=x.addModule(e,t,0,$("<div>"),$("<div>"));1<c.find(".col").length&&(n=1),c.find(".col:eq("+n+")").insertAt(0,t.$editNode),t.resize&&t.resize(),h.saveMods(),g.include(i,t),t.save(),c.find(".empty-canvas-cont").remove(),a&&a(t)}i.drag=function(i,s){s=s-d.find(".header").height()-30,c.find(".module-container").each(function(e,t){var a=$(t),n=a.closest(".col").position(),o=a.position();if(o.left+=n.left,o.top+=n.top,o.right=o.left+a.width(),o.bottom=o.top+a.height(),v.isPointInRect(o,{x:i,y:s}))return s>o.bottom/2?m.insertAfter(a):m.insertBefore(a),!1})},i.dragCancel=function(){m.remove()},i.dragEnd=function(e){var t,a;(a=m.closest(".col").index())<0&&(a=0,c.find(".col:eq(0)").prepend(m)),t=m.index(),k.sync(i,"CanvasModPos",{col:a,index:t,Tag:e.Tag}),c.find(".col:eq("+a+")").insertAt(t,e.$editNode),$(".empty").remove();var n,o=!1;try{o="string"==typeof(n=JSON.stringify(i.Data.Theme))&&JSON.parse(n)}catch(e){o=!1}o&&(e.editObj.applyStyle&&(e.editObj.applyStyle(o),k.sync(e,"Theme",o)),e.Data.Theme=o,e.applyStyle&&e.applyStyle(o)),g.include(i,e),k.sync(i,"Mods",s.Mods),e&&e.resize&&e.resize()},k.reg(i,"CanvasCol",function(e,t){p(t),h.setLayout()}),k.reg(i,"CanvasModPos",function(e,t){var a=$("#ed-"+t.Tag).parent(".col").index(),n=$("#ed-"+t.Tag).index();a==t.col&&n<t.index&&(t.index+=1);var o=x.getModule(t.Tag);c.find(".col:eq("+t.col+")").insertAt(t.index,o.$editNode),o.$editNode.find(".fr-embedly").each(function(){$(this).html($(this).data().originalEmbed)})}),k.reg(i,"CanvasColResize",function(e,t){var a=i.Data;a.Arr[t.col]=t.first,a.Arr[t.col+1]=t.second,P(i),i.editObj.setLayout()}),k.reg(i,"CanvasAddMod",function(e,t){t.Syncd=!0,f(t.Type,t)});var h={$node:d,mount:function(){$.each(s.Mods,function(e,t){var a=x.getModule(t.Tag)||t.Module;a&&(c.find(".col:eq("+t.Col+")").insertAt(t.Row,a.$editNode),a.editObj&&a.editObj.mount&&a.editObj.mount())})},applyStyle:function(n,e){c.css({border:1==s.Border?"":"1px dashed "+n}),e&&$.each(s.Mods,function(e,t){var a=x.getModule(t.Tag);a&&(v.clearHeaderColors(a),a.Data.ThemeOverride&&(a.Data[a.Data.ThemeOverride]=n,"BgColor"==a.Data.ThemeOverride&&g.bgColor(a,n,!0)),a.Data.Theme=n,a.applyStyle&&a.applyStyle(n),a.editObj&&a.editObj.applyStyle&&a.editObj.applyStyle(n),a.save())})},addModule:function(){g.popup.addModule(function(t){f(t,{Type:t,Data:{Type:t,Theme:s.Theme}},function(e){k.sync(i,"CanvasAddMod",{Tag:e.Tag,Type:t,Data:e.Data,CanvasMod:!0}),h.$node.find(".empty-canvas-cont").remove()})},1)},clone:function(e){var t=x.copyModule(e);x.getFactory(t).initModule(v,t),e.$editNode.after(t.$editNode),i.factory.include(i,t),t.resize&&t.resize(),t.save(),i.save()},setLayout:function(){var n,o=0;u.empty(),$.each(s.Arr,function(e,t){var a=isNaN(t)?1:t;c.find(">div:eq("+e+")").attr("class","col col-sm-"+a),0<e&&(o+=8.33*s.Arr[e-1],n=$(C).css("left","calc("+o+"% - 0px)"),u.append(n))})},saveMods:function(){s.Mods=[],c.find(".col").each(function(a,e){$(e).find(".module-container:not(.empty-module-container)").each(function(e,t){(t=x.getModule($(t).data("key")))&&s.Mods.push({Tag:t.Tag||t.Key,Col:a,Row:e})})})},changeColumns:function(e){p(e),h.setLayout(),i.save(),P(i),k.sync(i,"CanvasCol",e)},move:function(e){var a,n,o,t=e.pageX,i=e.pageY,s={x:t,y:i};c.find("> .col").each(function(e,t){if(n=$(t),n.width(),(a=n.offset()).top-=150,a.right=a.left+n.width()+10,a.bottom=a.top+c.height()+100,v.isPointInRect(a,s))return m.hasClass("animatable")||l===t||(l=t,m.addClass("animatable"),m.height("1px")),$("#edit-page .empty").remove(),n.prepend(m),n.find(".module-container").each(function(e,t){if(o=$(t),a.top=o.offset().top,a.bottom=a.top+o.height(),i>a.top&&i<a.bottom)return m.hasClass("animatable")||r===t||(r=t,m.addClass("animatable"),m.height("1px")),i<a.top+o.height()/2?o.before(m):o.after(m),m.height("100px"),setTimeout(function(){m.removeClass("animatable")},200),!1}),m.height("100px"),setTimeout(function(){m.removeClass("animatable")},200),!1}),m.index()<0&&c.find(".col:eq(0)").append(m)},cancel:function(){m.height("1px"),m.remove()}};return w.addListener("moduleRemoved",function(e){console.log("module removed:",e),console.log("current canvas",i),"Canvas"===i.Type&&i.Data&&i.Data.Mods&&0===i.Data.Mods.length&&!v.canvasHasChildren(i.$editNode)&&v.generateEmptyCanvasModule(i.$editNode,i.$previewNode)}),h.setLayout(),setTimeout(P,0,i),h}},app.mods.dataCollectionEdit=function(m){var p=$("#tmp-edit-dc").html();return function(t){var a,n,e=t.Data,o=0,i=$(p),s=i.find(".module-info-inner"),r=i.find(".dc-join-us"),l=i.find(".total"),d=i.find(".new-items"),c=i.find(".msg");t.Records=t.Records||[];try{t.Store=JSON.parse(t.Store||"{}")}catch(e){t.Store={}}function u(e,t){n+=e,o+=t,l.text(n+" RESPONSE"+(1==n?"":"S")),d.text(o+" New")}return t.Store.viewed=t.Store.viewed||JSON.stringify(new Date(2016,4,30).getTime()),a=new Date(JSON.parse(t.Store.viewed)),n=t.Records.length,$.each(t.Records,function(e,t){if(t.Created<a)return!1;o++}),l.text(n+" RESPONSE"+(1==n?"":"S")),d.text(o+" New"),s.on("click",function(){u(0,-o),m.popup.signupPerformance(t.ID,t.Records,{n:m.folio.FolioName,t:m.folio.Token})}),c.editor(t,e,"Message",{allowEnter:!0}),r.editor(t,e,"ButtonText"),m.modStore.reg(t.ID,t.Store),m.eventManager.addListener("newSignUp",function(e){e.Data.ModId==t.ID&&u(1,1)}),u(0,0),function e(){t.ID?m.popup.signupPerformance.reg(t.ID,t.Records,{n:m.folio.FolioName,t:m.folio.Token}):setTimeout(e,500)}(),m.editBase(t,{}),{$node:i}}},app.mods.donutEdit=function(m,p){var f=$("#tmp-edit-donut-main").html(),s=$("#tmp-edit-donut-row").html(),l=$("<div>"),h=function(e,t,a){var n=0,o=!0,i=m.modManager.getDonutData();e.breakup=[];for(var s=0;s<t.length;s++){var r=parseFloat(l.html($.trim(t[s].Val)).text());isNaN(r)||(n+=r,e.breakup.push(r))}i.showError&&(o=100==n),a.closest(".breakup-col").find(".item-close-btn").toggleClass("hidden",1==e.breakup.length),a.toggleClass("hidden",o)},g=function(e,t){var a=e.module,n=a.Data;t&&(a.colorFunc=m.createColorFunc(n.Items.length,t)),h(a,n.Items,e.$error),e.$breakup.find(".breakup-row").each(function(e){$(this).find(".color").css("background-color",a.colorFunc(e))}),e.drawPie(),a.factory.renderPreview(a)},v=function(e,t,a){var n=e.module,o=$(s),i=o.find(".value");i.editor(n,t,"Val",{index:a,onSave:function(){g(e)},changed:function(){1<$("<div>"+t.Val+"</div>").find("p").length&&(t.Val="<p>"+$(t.Val).text()+"</p>",i.find(".fr-view").html(t.Val)),setTimeout(function(){g(e)},500)}}),e.$breakup.append(o)};return function(t){var e=t.Data,a=e.Theme||"",n=e.Items,o=$(f),i=o.find(".title"),s=o.find(".donut-pie-container"),r=o.find(".donut-label"),l=o.find(".donut-breakup"),d=o.find(".invalid-100"),c=$.extend({parentPage:m.pageManager.pages.edit,$node:o,$pieDiv:s,$breakup:l,$error:d,module:t,data:e,breakup:n,changeTheme:function(e){i.unstyle(),t.applyStyle(e),c.applyStyle(e)},applyStyle:function(e){g(c,a=e)},addItem:function(){u(),m.appHub.sync(t,"PieItems",-1)},render:function(){g(c)}},p);$.each(n,function(e,t){v(c,t,e)});var u=function(){var e={Val:"<p>10% &nbsp;Segment  "+(n.length+1)+"</p>"};v(c,e,n.push(e)-1),g(c,a)};return m.appHub.reg(t,"PieItems",function(e,t){t<0?u():(l.find(".breakup-row").eq(t).remove(),n.splice(t,1),g(c,a))}),l.on("click",".item-close-btn",function(){var e=$(this).closest(".breakup-row");m.appHub.sync(t,"PieItems",e.index()),n.splice(e.index(),1),e.remove(),g(c,a),t.save()}),d.find(".item-close-btn").on("click",function(){m.modManager.getDonutData().showError=!1,h(t,n,d),d.find(".error-check").get(0).checked&&(m.eventManager.raiseEvent("donutError"),m.modManager.saveData())}),m.eventManager.addListener("donutError",function(){h(t,n,d)}),i.editor(t,e,"Title",{allowEnter:!0}),r.editor(t,e,"Label",{allowEnter:!0,changed:function(){c.updateLabel()}}),t.resize=function(){c.drawPie()},m.editBase(t,{}),c}},app.mods.imagesEdit=function(S){var D="loading"in HTMLImageElement.prototype,F=S.appHub,I=S.apiHelper,n=$("#tmp-edit-images").html(),M=$("#tmp-edit-image-item").html();return function(v){var b,T,y,C,k=v.Data,e=$(n),t=e.find(".title").css("display",1==k.Txt?"":"none"),w=e.find(".image-outer").css("text-align",k.Align);function x(e){return e&&e.toString().replace("&amp;","&")}function P(e,t){switch(t){case 1:e.hasClass("image-module-img-active")?w.find(".image-inner").removeClass("image-module-img-active custom-link-popup-active"):(w.find(".image-inner").removeClass("image-module-img-active custom-link-popup-active"),e.addClass("image-module-img-active"));break;case 2:break;case 3:e.addClass("custom-link-popup-active");break;case 4:e.removeClass("custom-link-popup-active image-module-img-active")}}function a(e,i){if(i){console.log("addItem ",i);var t=Math.min(100,i.Val||33)+"%",a=$(M),s=a.find("img"),n=a.find(".toolbar-edit-btn"),o=a.find(".toolbar-link-btn"),r=a.find(".img-caption"),l=a.find(".logo-resize-handle"),d=(a.find(".logo-resize-handle-ne"),a.find(".logo-resize-handle-nw"),a.find(".logo-resize-handle-se"),a.find(".toolbar-close-btn")),c=a.find(".custom-link-popup .img-link-input"),u=a.find(".custom-img-toolbar .toolbar-open-link-btn"),m=a.find(".custom-img-toolbar .toolbar-edit-link-btn"),p=a.find(".custom-img-toolbar .toolbar-unlink-btn"),f=a.find(".custom-img-toolbar .toolbar-caption-btn");a.css("width",t),r.editor(v,i,"Caption",{allowEnter:!1}),i.link&&0<i.link.toString().length&&"https://"!==i.link&&a.addClass("img-has-link"),1==i.ShowCaption&&a.addClass("img-has-caption"),a.on("click",function(e){var t=$(e.target);(console.log(e.target),t.hasClass("image-inner")||"img"===t.prop("tagName").toLowerCase())&&P($(this).closest(".image-inner"),1)}),d.on("click",function(){S.utility.removeFromList(k.Items,i),v.save(),F.sync(v,"Items",k.Items),a.remove()}),l.on("mousedown touchstart",function(e){e.stopPropagation(),b=i,C=(T=a).width(),y=e.clientX,$(".fr-active").removeClass("fr-active"),$("body").addClass("disable-select")}),a.find(".logo-resize-handle-nw, .logo-resize-handle-ne, .logo-resize-handle-se, .logo-resize-handle").on("mousedown touchstart",function(e){e.stopPropagation(),-1<e.target.className.search("logo-resize-handle-ne")||-1<e.target.className.search("logo-resize-handle-se")?resizingEast=!0:resizingEast=!1,b=i,C=(T=a).width(),y=e.clientX,$(".fr-active").removeClass("fr-active"),$("body").addClass("disable-select")}),n.uploader({module:v,custom:"imgMod",success:function(e){var o=x(e.Message);if(i.Url=o,s.attr("src",o),F.sync(v,"Items",k.Items),!S.config.tryMode)try{I.fetchImageData({url:-1===o.indexOf("http")?"https:"+o:o,success:function(e){console.log("fetchImageData response",e);var t=e.description.captions[0].text,a=o.replace("//xtensiowebjobdev.azureedge.net/images/big/",""),n=e.description.tags.join(",");s.attr("alt",t),i.alt=t,F.sync(v,"Items",k.Items),I.setImageData({imageUrl:a,imageTags:n,imageDesc:t,success:function(e){console.log("setImageData response",e)},error:function(e){console.log("setImageData err",e)}})},error:function(e){console.log("fetchImageData err",e)}})}catch(e){console.log("fetchImageData try catch err",e)}}}),a.find(".custom-link-popup .img-link-insert-btn").on("click",function(){var e=c.val();e=S.utility.replaceHttp(e),i.link=e,F.sync(v,"Items",k.Items),P(a,4),a.addClass("img-has-link")}),o.on("click",g),m.on("click",g),u.on("click",function(){window.location.href=i.link}),p.on("click",function(){i.link="",F.sync(v,"Items",k.Items),a.removeClass("img-has-link")}),f.on("click",function(){i.ShowCaption=1!=i.ShowCaption?1:0,1==i.ShowCaption?a.addClass("img-has-caption"):a.removeClass("img-has-caption"),F.sync(v,"Items",k.Items)});var h=x(i.Url);s.attr(D?"src":"data-src",h),D?s.attr("loading","lazy"):s.addClass("lazyload"),w.append(a)}function g(){var e=i.link?x(i.link):"https://";P(a,3),c.val(e)}}return t.editor(v,k,"Html",{allowEnter:!0}),$(document).on("touchend mouseup touchcancel mouseleave",function(){if(b){$("body").removeClass("disable-select");var e=w.width();b.Val=Math.round(100*T.width()/e),T.css("width",b.Val+"%"),b=null,F.sync(v,"Items",k.Items)}}),$(document).on("touchmove mousemove",function(e){if(b){var t,a=w.width();t=resizingEast?C+y-e.clientX:C+e.clientX-y,T.css("width",Math.max(50,Math.min(a,t))+"px")}}),$.each(k.Items,a),S.editBase(v,{addItem:a,$items:w,itemVal:function(e,t,a){var n=x(a);w.find("> div:eq("+e+")").css("width",t+"%").find("img").attr("src",n)},align:function(){w.css("text-align",k.Align)},txt:function(){t.css("display",1==k.Txt?"":"none")},theme:function(){t.unstyle()}}),{$node:e,changeTheme:function(e){t.unstyle()},addItem:function(){var e={Url:S.defImg,Val:100,Caption:"Image Caption",ShowCaption:0};a(k.Items.length,e),k.Items.push(e),$(".image-outer").data("ui-sortable")&&$(".image-outer").sortable("refresh")},align:function(){w.css("text-align",k.Align)},toggleTxt:function(){t.css("display",1==k.Txt?"":"none")},unMount:function(){t.unMount()}}}},app.mods.scaleEdit=function(u,n){var o=$("#tmp-edit-scale").html(),m=$("#tmp-edit-scale-row").html();return function(r){var l=r.Data,e=$(o),t=e.find(".title").css("display",1==l.Txt?"":"none"),d=e.find(".pairs");function c(e){u.appHub.sync(r,e,l[e])}t.editor(r,l,"Title",{allowEnter:!0});var a=function(e,t){var a=$(m),n=a.find(".name-1"),o=a.find(".name-2"),i=a.find(".slider-container"),s=a.find(".item-close-btn");n.editor(r,t,"Name1",{index:e,cleanPTags:!0}),o.editor(r,t,"Name2",{index:e,cleanPTags:!0}),i.thumbSlider({obj:t,sync:c}),s.on("click",function(){u.utility.removeFromList(l.Items,t),r.save(),n.unMount(),o.unMount(),a.remove(),c("Items")}),d.append(a)};return $.each(l.Items,a),n(r,a,d,t),$.extend({$node:e,changeTheme:function(e){t.unstyle()},addItem:function(){var e={Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:50};a(l.Items.length,e),l.Items.push(e),c("Items")},toggleTxt:function(){t.css("display",1==l.Txt?"":"none"),r.save()},unMount:function(){t.unMount(),e.find(".name-1, name-2").unMount()}})}},app.mods.socialEdit=function(k){var e=new Image,t=new Image;e.src="/img/instagramdark.png",t.src="/img/instagramhover.png";var w=$("#tmp-edit-social").html(),x=function(e,t,a,n,o,i,s,r){t.toggleClass("active",!!e.FacebookUrl),a.toggleClass("active",!!e.TwitterUrl),n.toggleClass("active",!!e.LinkedInUrl),o.toggleClass("active",!!e.PinterestUrl),i.toggleClass("active",!!e.YoutubeUrl),s.toggleClass("active",!!e.InstagramUrl),r.toggleClass("active",!!e.CustomUrl)},P=function(e,t,a,n,o,i,s,r){t.closest(".field-items").toggleClass("active",!!e.FacebookUrl),a.closest(".field-items").toggleClass("active",!!e.TwitterUrl),n.closest(".field-items").toggleClass("active",!!e.LinkedInUrl),o.closest(".field-items").toggleClass("active",!!e.PinterestUrl),i.closest(".field-items").toggleClass("active",!!e.YoutubeUrl),s.closest(".field-items").toggleClass("active",!!e.InstagramUrl),r.closest(".field-items").toggleClass("active",!!e.CustomUrl)};return function(a){var n=a.Data,e=$(w).css("text-align",n.Align),t=e.find(".social-info-box"),o=e.find(".social-info"),i=o.find(".edit-btn"),s=t.find(".social-info-close"),r=t.find(".facebook input, .twitter input, .linkedin input, .pinterest input, .youtube input, .instagram input, .custom-link input"),l=t.find(".facebook input"),d=t.find(".twitter input"),c=t.find(".linkedin input"),u=t.find(".pinterest input"),m=t.find(".youtube input"),p=t.find(".instagram input"),f=t.find(".custom-link input"),h=o.find(".facebook"),g=o.find(".twitter"),v=o.find(".linkedin"),b=o.find(".pinterest"),T=o.find(".youtube"),y=o.find(".instagram"),C=o.find(".custom");return x(n,h,g,v,b,T,y,C),P(n,l,d,c,u,m,p,f),l.val(n.FacebookUrl),d.val(n.TwitterUrl),c.val(n.LinkedInUrl),u.val(n.PinterestUrl),m.val(n.YoutubeUrl),p.val(n.InstagramUrl),f.val(n.CustomUrl),r.on("blur",function(){var e=$(this),t=$(this).data("name");n[t]=e.val(),x(n,h,g,v,b,T,y,C),P(n,l,d,c,u,m,p,f),a.save()}),s.add(i).on("click",function(){return $(".top-comp").removeClass("top-comp"),e.closest(".module").toggleClass("no-resize"),e.closest(".module-container").toggleClass("top-comp"),e.closest(".edit-div").toggleClass("top-comp"),t.slideToggle(150),$(".social-info-box").not(t).hide(),!1}),e.click(function(){return!1}),k.editBase(a,{}),{$node:e,align:function(){e.css("text-align",n.Align)}}}},app.mods.tagEdit=function(d){var a=$("#tmp-edit-tag").html(),c=$("#tmp-edit-tag-item").html();return function(i){var s=i.Data,e=$(a),r=e.find(".tag-container").css("text-align",s.Align);function l(e){d.appHub.sync(i,e,s[e])}s.Theme=s.Theme||"";var t=function(e,t){var a=$(c),n=a.find(".tag-inner"),o=a.find(".tag-close");n.editor(i,t,"Name",{index:e,allowEnter:!1}),r.append(a),o.on("click",function(){n.unMount(),a.remove(),d.utility.removeFromList(s.Items,t),l("Items"),i.save()})};return $.each(s.Items,t),d.editBase(i,{$items:r,itemVal:function(e,t){},align:function(){r.css("text-align",s.Align)},addItem:t}),{$node:e,addItem:function(){var e={Name:"<p>Tag</p>"};t(s.Items.push(e)-1,e),l("Items")},align:function(){r.css("text-align",s.Align)},unMount:function(){r.find(".tag-inner").unMount()}}}},app.mods.taskListEdit=function(g,e,t,a){var v=$("#tmp-edit-task-list").html(),b=$("#tmp-edit-task-list-row").html(),T=a.toggleItemStatus,y=a.toggleProgress,C=a.toggleCompleted,k=a.setStatus,w=a.setProgress;return e.Close={txt:"Reset Status",val:"",icon:""},function(s){var t,a,r,n,o,i,l,d,c,u,m=s.Data;function p(e){t=void 0!==e?e:$(v),a=t.find(".title").css("display",1==m.Txt?"":"none"),r=t.find(".task-list-container"),n=t.find(".progress-toggle-wrap"),o=n.find(".items-completed"),i=n.find(".total-items"),l=n.find(".task-list-toggle"),d=n.find(".task-list-progress"),c=t.find(".select-status"),u=null}function f(e){g.appHub.sync(s,e,m[e])}var h=function(e,t){var a=$(b),n=a.find(".item-title"),o=a.find(".item-desc"),i=a.find(".item-status");n.editor(s,t,"Name",{index:e,cleanPTags:!0,changed:function(){f("Items")}}),o.editor(s,t,"Desc",{index:e,cleanPTags:!0,noBrOnEmpty:!0,changed:function(){f("Items")}}),k(i,t.Status),r.append(a)};return p(),T(t,m.showItemStatus),y(t,m.showProgress),C(t,m.showCompleted),a.editor(s,m,"Title",{allowEnter:!0}),$.each(m.Items,function(e,t){h(e,t)}),r.on("click",".item-close",function(){var e=$(this).closest(".task-list-item"),t=e.find(".item-title"),a=e.index(),n=m.Items[a];g.utility.removeFromList(m.Items,n),t.unMount(),e.hide("slow",function(){$(this).remove()}),w(m.Items,o,i,d),f("Items")}),r.on("click",".item-status",function(e){var t=(u=$(this)).closest(".task-list-container").next(".select-status"),a=u.parent().position();t.css("top",a.top+30+"px").css("left",a.left+35+"px"),t.toggle()}),w(m.Items,o,i,d),$.each(e,function(e,t){var a=$('<button class="btn settings-btn" data-status="'+t.val+'"><span>'+t.txt+'</span><i class="icon-'+e+'"></i></button>');a.click(function(){if(null!==u){var e=$(this),t=m.Items[u.parent().index()],a=e.data("status");k(u,a),void 0!==t&&(t.Status=a),f("Items"),e.parent().hide(),u=null,w(m.Items,o,i,d)}}),a.appendTo(c)}),l.click(function(){m.showCompleted="1"==m.showCompleted?"0":"1",C(t,m.showCompleted),f("showCompleted")}),g.editBase(s,{}),{$node:t,addItem:function(){var e={Name:"Item "+(m.Items.length+1),Desc:"Description",Status:""};h(m.Items.length,e),m.Items.push(e),w(m.Items,o,i,d),app.plugin.tooltip(!0)},changeTheme:function(e){a.unstyle()},toggleTxt:function(){a.css("display",1==m.Txt?"":"none")},mount:function(){console.log("taskList mount")},unMount:function(){a.unMount(),t.find(".name").unMount()},applyStyle:function(e,t){console.log("taskList applyStyle")},afterAddModuleCb:function(){console.log("taskList afterAddModuleCb")},toggleItemStatus:function(e){m.showItemStatus=parseInt(e).toString(),T(t,e),f("showItemStatus")},toggleProgress:function(e){m.showProgress=parseInt(e).toString(),y(t,e),f("showProgress")},updateProgress:function(){w(m.Items,o,i,d)},reinit:function(e){p($(e).closest(".task-list-module"))},hideSelectStatusDropDown:function(){c.hide()}}}},app.mods.vertBarEdit=function(C,l){var c=$("#tmp-edit-vert-bar").html(),k=$("#tmp-edit-vert-bar-row").html();return function(d){var u,m=d.Data,t=$(c),a=t.find(".title").css("display",1==m.Txt?"":"none"),p=t.find(".pairs"),e=t.find(".y-axis-max"),n=t.find(".vert-line-chart-container"),o=!1,f=app.charts.lineChart({updateDataCb:function(e){u=$(e).closest(".vert-bar-module"),r(m.yAxisMax)},showTooltip:function(e,t){(u=$(e).closest(".vert-bar-module")).find(".slider-outer:eq("+t+") .slider-tooltip").show(),u.find(".slider-outer").not(":eq("+t+")").find(".slider-tooltip").css("display",""),clearTimeout(this.timeout)},hideTooltip:function(e,t){u=$(e).closest(".vert-bar-module"),this.timeout=setTimeout(function(){u.find(".slider-outer").eq(t).find(".slider-tooltip").css("display","")},200)},showDeleteBtn:function(e,t){(u=$(e).closest(".vert-bar-module")).find(".slider-outer:eq("+t+")").addClass("line-chart-hover"),u.find(".slider-outer").not(":eq("+t+")").removeClass("line-chart-hover"),clearTimeout(this.timeoutX)},hideDeleteBtn:function(e,t){u=$(e).closest(".vert-bar-module"),this.timeoutX=setTimeout(function(){u.find(".slider-outer").eq(t).removeClass("line-chart-hover")},1e3)},updateTooltip:function(e,t,a){u=$(e).closest(".vert-bar-module");var n=parseInt(m.yAxisMax*m.Items[t].Height/100);T(u.find(".slider-outer").eq(t).find(".slider-tooltip"),a,m.yAxisMax,n)},editMode:!0});d.resize=function(){o=!0,setTimeout(function(){f.$container=n,f.reRenderLineChart(m),o=!1},100)};var h="show-num-error",s="show-max-error";function g(e,t,a){var n=(u=e.closest(".vert-bar-module")).find(".y-axis-max"),o=n.find(".fr-element"),i=n.attr("oldyaxismax");void 0===t?t=o.text():o.text(t),function(){for(var e,t=0,a=0;a<m.Items.length;a++)e=parseInt(m.Items[a].Val),t=t<e?e:t;return t}()<=parseInt(t)?(b(s),i!=t&&(r(t),m.yAxisMax=t.toString(),f.reRenderLineChart(m),n.attr("oldyaxismax",t),!0===a&&y("yAxisMax",i))):(v(s),o.text(i))}function v(e){u.find(".invalid-100").removeClass(h+" "+s+" hidden").addClass(e)}function b(e){var t=u.find(".invalid-100");t.removeClass(e),!1===t.hasClass(h)&&!1===t.hasClass(s)&&t.addClass("hidden")}function T(e,t,a,n){a=void 0===a?m.yAxisMax:a,void 0===n&&(n=parseInt(a*t/100)),e.css("bottom","calc("+parseFloat(t)+"% + 10px)");var o=e.find(".slider-val");o.attr("oldval",n),o.find(".fr-element").text(n)}function r(o){console.log("updateItems ",o),$.each(m.Items,function(e,t){var a=Math.ceil(t.Val/o*100);t.Height=a.toString();var n=u.find(".slider-outer").eq(e);n.find(".slider-bar").css("height",a+"%"),T(n.find(".slider-tooltip"),a,o)}),y("Items")}function y(e,t){if("yAxisMax"===e)var a,n=(a=new diff_match_patch).patch_make(m[e],a.diff_main(t,m[e],!0));else n=m[e];C.appHub.sync(d,e,n)}t.addClass("graph-type-"+m.graphType),a.editor(d,m,"Title",{allowEnter:!0}),e.attr("oldyaxismax",m.yAxisMax),e.editor(d,m,"yAxisMax",{allowEnter:!1,noHtml:!0,changed:function(e){g(e.$el)}});var i=function(e,c){var t=$(k),a=t.find(".name"),n=t.find(".slider-container"),o=t.find(".slider-tooltip"),i=t.find(".slider-tooltip-name"),s=t.find(".slider-val"),r=t.find(".item-close-btn"),l=m.yAxisMax;a.editor(d,c,"Name",{index:e,cleanPTags:!0,allowEnter:!1,noHtml:!0,changed:function(){i.html(a.html()),y("Items")}}),i.editor(d,c,"Name",{index:e,cleanPTags:!0,allowEnter:!1,noHtml:!0,changed:function(){a.html(i.html()),y("Items")}}),s.attr("oldval",c.Val),s.editor(d,c,"Val",{index:e,allowEnter:!1,noHtml:!0,changed:function(e){console.log("$tooltipVal changed ",e);var t=e.$el,a=t.closest(".slider-val");u=t.closest(".vert-bar-module");var n,o,i,s,r=parseInt(t.text()),l=a.attr("oldval");if(r<0&&(t.text("0"),a.attr("oldval","0"),r=0),isNaN(r))t.text(l),v(h);else if(r>m.yAxisMax)g(t,r,!0),b(h);else{b(h);var d=parseFloat(100*r/m.yAxisMax).toFixed(2);c.Val=r.toString(),c.Height=d.toString(),n=t.closest(".slider-inner"),o=d,i=m.yAxisMax,s=r.toString(),n.find(".slider-bar").css("height",o+"%"),T(n.find(".slider-tooltip"),o,i,s),f.reRenderLineChart(m),y("Items")}}}),n.percentVertSlider({obj:c,setTooltipPosVal:T,yAxisMax:l,sync:y}),r.on("click",function(){C.utility.removeFromList(m.Items,c),a.unMount(),t.remove(),f.reRenderLineChart(m),y("Items")}),p.append(t),T(o,c.Height)};return $.each(m.Items,function(e,t){i(e,t)}),$(window).on("resize orientationchange",function(){!1===o&&d.resize()}),l(d,i,p,a),{$node:t,addItem:function(){var e={Name:"<p>Bar "+(m.Items.length+1)+"</p>",Val:"50",Height:"50"};i(m.Items.length,e,m.yAxisMax),m.Items.push(e),f.reRenderLineChart(m)},changeTheme:function(e){console.log("changeTheme ",e),a.unstyle()},toggleTxt:function(){a.css("display",1==m.Txt?"":"none")},mount:function(){!0!==f.isInitDone?f.init(n,m):f.reRenderLineChart(m)},unMount:function(){a.unMount(),t.find(".name").unMount()},applyStyle:function(e,t){!0===f.isInitDone?f.reColor(e):f.setStrokeColor(e)},changeGraphType:function(e){m.graphType=e,t.removeClass("graph-type-Bar graph-type-Line").addClass("graph-type-"+e),"Line"===e&&f.reRenderLineChart(m),y("graphType")},afterAddModuleCb:function(){!0!==f.isInitDone&&f.init(n,m)}}}},app.mods.videosEdit=function(v,b,T,y){var C=v.appHub,n=$("#tmp-edit-videos").html(),k=$("#tmp-edit-video-item").html();return function(d){var c,u,m,p,f=d.Data,e=$(n),t=e.find(".title").css("display",1==f.Txt?"":"none"),h=e.find(".video-outer").css("text-align",f.Align);function g(){if(c){$("body").removeClass("disable-select");var e=h.width();h.height();c.width=Math.round(100*u.width()/e),c.height=u.height(),u.css("width",c.width+"%"),c=null,C.sync(d,"Items",f.Items),T.activatePreview({modId:d.Tag}),u.removeClass("video-disable")}}function a(e,a){var t=$(k),n=t.find(".edit-btn"),o=t.find(".link-btn"),i=t.find(".embed-btn"),s=t.find(".logo-resize-handle"),r=t.find(".close-btn"),l=t.find(".fr-video");t.css("width","100%"),r.on("click",function(){v.utility.removeFromList(f.Items,a),d.save(),C.sync(d,"Items",f.Items),t.remove(),T.activatePreview({modId:d.Tag})}),s.on("mousedown touchstart",function(e){a.$videoContainer=t,c=a,p=(u=t).width(),t.height(),m=e.clientX,e.clientY,$("body").addClass("disable-select")}),n.uploader({module:d,custom:"videoMod",success:function(e){var t=e.Message;a.VideoUrl=t,l.html(b(t)),C.sync(d,"Items",f.Items),T.activatePreview({modId:d.Tag})}}),o.click(function(){v.popup.message({input:a.VideoUrl||" ",enterAsOK:!0,emptyError:"Please provide a valid URL.",heading:"Enter Video Url",cancelText:"Cancel",handleOK:function(e){0<e.length?l.html(b(e)):l.html(""),a.VideoUrl=e,a.EmbedCode=" ",d.VideoUrl=e,d.EmbedCode=" ",a.VideoUrl&&h.find(".video-inner").css({"background-image":""}),C.sync(d,"Items",f.Items),T.activatePreview({modId:d.Tag}),h.find(".loading-animation").show(),setTimeout(function(){h.find(".loading-animation").hide()},3e3),g()}})}),i.click(function(){v.popup.message({input:a.EmbedCode||" ",enterAsOK:!0,emptyError:"Please provide a valid embed code.",heading:"Enter Video Embed Code",cancelText:"Cancel",handleOK:function(e){var t=e.replace(/<\/?(?!iframe)\w*\b[^>]*>/gi,"");0<e.length?l.html(t):l.html(""),a.EmbedCode=t,a.VideoUrl=" ",d.EmbedCode=t,d.VideoUrl=" ",a.EmbedCode&&h.find(".video-inner").css({"background-image":""}),C.sync(d,"Items",f.Items),T.activatePreview({modId:d.Tag}),h.find(".loading-animation").show(),setTimeout(function(){h.find(".loading-animation").hide()},3e3),g()}})}),l.html(b(a.VideoUrl)),(a.VideoUrl||a.EmbedCode)&&h.find(".video-inner").css({"background-image":""}),t.css("width",a.width+"%"),h.append(t),h.find(".loading-animation").html(y.spinner),setTimeout(function(){T.activatePreview({modId:d.Tag})},1e3),setTimeout(function(){h.find(".loading-animation").hide()},3e3)}return t.editor(d,f,"Html",{allowEnter:!0}),$(document).on("touchend mouseup touchcancel mouseleave",g),$(document).on("touchmove mousemove",function(e){if(c){u.addClass("video-disable");var t=h.width(),a=Math.max(50,Math.min(t,p+e.clientX-m));u.css("width",a+"px")}}),$.each(f.Items,a),v.editBase(d,{addItem:a,$items:h,itemVal:function(e,t){h.find("> div:eq("+e+")").css({width:t.width+"%"}),t.VideoUrl&&h.find(".video-inner").css({"background-image":""}),d.Data.Items[e].VideoUrl!=t.VideoUrl&&(h.find(".loading-animation").show(),setTimeout(function(){h.find(".loading-animation").hide()},3e3),h.find("> div:eq("+e+")").find(".fr-video").html(b(t.VideoUrl))),T.activatePreview({modId:d.Tag})},align:function(){h.css("text-align",f.Align),T.activatePreview({modId:d.Tag})},txt:function(){t.css("display",1==f.Txt?"":"none"),T.activatePreview({modId:d.Tag})},theme:function(){t.unstyle(),T.activatePreview({modId:d.Tag})}}),{$node:e,changeTheme:function(e){t.unstyle(),T.activatePreview({modId:d.Tag})},align:function(){h.css("text-align",f.Align),T.activatePreview({modId:d.Tag})},toggleTxt:function(){t.css("display",1==f.Txt?"":"none"),T.activatePreview({modId:d.Tag})},unMount:function(){t.unMount(),T.activatePreview({modId:d.Tag})}}}},app.mods.barPreview=function(e){var i=$("#tmp-prev-bar").html(),s=$("#tmp-prev-bar-row").html();return function(e){var t=$(i),a=t.find(".title"),n=t.find(".pairs"),o=e.Data;return e.renderPreview=function(){a.html(o.Title).css("display",1==o.Txt?"":"none"),n.empty(),$.each(o.Items,function(e,t){var a=$(s);a.find(".name").html(t.Name),a.find(".slider-bar").css({width:Math.ceil(t.Val)+"%"}),n.append(a)})},{$node:t}}},app.mods.canvasPreview=function(o){var i=$("#tmp-prev-canvas").html();return function(e){var a=e.Data,t=$(i),n=t.find(".mods-inner");return e.renderPreview=function(){n.empty();for(var e=0;e<a.Arr.length;e++){var t=$("<div>").attr("class","col col-sm-"+a.Arr[e]);n.append(t)}$.each(a.Mods,function(e,t){var a=o.modManager.getModule(t.Tag);a&&(n.find(".col:eq("+t.Col+")").insertAt(t.Row,a.$previewNode),o.renderPreview(a))})},{$node:t}}},app.mods.dataCollectionPreview=function(s){var r=$("#tmp-prev-dc").html(),l=$("#spinner-container > .loading-animation");return function(t){var e=$(r),a=l.clone().addClass("small").hide(),n=e.find(".msg"),o=e.find(".dc-join-us"),i=e.find(".dc-email-input");return e.find(".module-info").attr("data-module",t.ID),e.find(".module-info").attr("data-text",t.Data.ButtonText),o.prepend(a),o.on("click",function(){var e=i.val();e&&validator.isEmail(e)?(o.prop("disabled",!0),i.removeClass("email-invalid"),a.show(),s.apiHelper.saveModuleRecord({moduleId:t.ID,dataObj:{email:e},success:function(){a.hide(),i.val(""),o.text("Submitted")},error:function(){a.hide(),o.text("Error. Try again."),o.prop("disabled",!1),setTimeout(function(){o.text(t.Data.ButtonText)},3e3)}})):i.addClass("email-invalid")}),t.renderPreview=function(){n.html(t.Data.Message);var e=$("<div></div>").html(t.Data.ButtonText).text();o.text(e)},{$node:e}}},app.mods.donutPreview=function(d,c){var u=$("#tmp-prev-donut-main").html(),m=$("#tmp-prev-donut-row").html();return function(n){var e=n.Data,t=e.Items,a=$(u),o=a.find(".title"),i=a.find(".donut-pie-container"),s=a.find(".donut-label"),r=a.find(".donut-breakup"),l=$.extend({$node:a,parentPage:d.pageManager.pages.home,$pieDiv:i,$breakup:r,module:n},c);return n.renderPreview=function(){o.html(e.Title),s.html(e.Label),r.empty(),$.each(t,function(e,t){var a=$(m);a.find(".value").html(t.Val),a.find(".color").css("background-color",n.colorFunc(e)),r.append(a)}),l.drawPie()},l}},app.mods.imagesPreview=function(e){var o=$("#tmp-prev-images").html(),d="loading"in HTMLImageElement.prototype;return function(e){var t=$(o),a=e.Data,n=t.find(".title"),l=t.find(".image-outer");return e.renderPreview=function(){n.html(a.Html).css("display",1==a.Txt?"":"none"),l.empty().css("text-align",a.Align),$.each(a.Items,function(e,t){if(t){var a=t.Url&&t.Url.toString().replace("&amp;","&"),n=$("#tmp-export").hasClass("show")?"src":d?'loading="lazy" src':'class="lazyload" data-src',o=1==t.ShowCaption?"<span class='img-caption'>"+t.Caption+"</span>":"",i=1==t.ShowCaption?"img-has-caption":"",s='<div class="image-inner '.concat(i,'"><img ').concat(n,'="').concat(a,'" />').concat(o,"</div>");t.link&&0<t.link.toString().length&&"https://"!==t.link&&(s='<div class="image-inner '.concat(i,'"><a href="').concat(t.link,'" target="_blank"><img ').concat(n,'="').concat(a,'" /></a>').concat(o,"</div>")),t.alt&&""!==t.alt&&(s=s.replace("<img ".concat(n,'="').concat(a,'" />'),"<img ".concat(n,'="').concat(a,'" alt="').concat(t.alt,'" />')));var r=$(s);r.css({width:Math.min(100,t.Val||33)+"%"}),l.append(r)}})},{$node:t}}},app.mods.scalePreview=function(e){var i=$("#tmp-prev-scale").html(),s=$("#tmp-prev-scale-row").html();return function(e){var t=e.Data,a=$(i),n=a.find(".title"),o=a.find(".pairs");return e.renderPreview=function(){n.html(t.Title).css("display",1==t.Txt?"":"none"),o.empty(),$.each(t.Items,function(e,t){var a=$(s);a.find(".name-1").html(t.Name1),a.find(".name-2").html(t.Name2),a.find(".slider-bar").css({left:Math.round(t.Val)+"%"}),o.append(a)})},{$node:a}}},app.mods.socialPreview=function(e){var o=$("#tmp-prev-social").html();return function(e){var t=e.Data,a=$(o),n=a.find(".social-info-static");return e.renderPreview=function(){if(a.find(".header-container .header").html(t.Header),a.css("text-align",t.Align).addClass("module"),n.empty(),t.FacebookUrl&&(/^(?:f|ht)tps?\:\/\//.test(t.FacebookUrl)||(t.FacebookUrl="https://"+t.FacebookUrl),n.append('<a target="_blank" class="facebook active" href="'+t.FacebookUrl+'"><i class="icon-SocialFacebook"></i></a>')),t.TwitterUrl&&(/^(?:f|ht)tps?\:\/\//.test(t.TwitterUrl)||(t.TwitterUrl="https://"+t.TwitterUrl),n.append('<a target="_blank" class="twitter active" href="'+t.TwitterUrl+'"><i class="icon-SocialTwitter"></i></a>')),t.LinkedInUrl&&(/^(?:f|ht)tps?\:\/\//.test(t.LinkedInUrl)||(t.LinkedInUrl="https://"+t.LinkedInUrl),n.append('<a target="_blank" class="linkedin active" href="'+t.LinkedInUrl+'"><i class="icon-SocialLinkedin"></i></a>')),t.PinterestUrl&&(/^(?:f|ht)tps?\:\/\//.test(t.PinterestUrl)||(t.PinterestUrl="https://"+t.PinterestUrl),n.append('<a target="_blank" class="pinterest active" href="'+t.PinterestUrl+'"><i class="icon-SocialPinterest"></i></a>')),t.YoutubeUrl&&(/^(?:f|ht)tps?\:\/\//.test(t.YoutubeUrl)||(t.YoutubeUrl="https://"+t.YoutubeUrl),n.append('<a target="_blank" class="youtube active" href="'+t.YoutubeUrl+'"><i class="icon-SocialYoutube"></i></a>')),t.InstagramUrl&&(/^(?:f|ht)tps?\:\/\//.test(t.InstagramUrl)||(t.InstagramUrl="https://"+t.InstagramUrl),n.append('<a target="_blank" class="instagram active" href="'+t.InstagramUrl+'"><i class="img-instagram"></i></a>')),t.CustomUrl){var e=$.trim(t.CustomUrl);t.CustomUrl.indexOf("http")<0&&(e="https://"+e),n.append('<a target="_blank" class="custom active" href="'+e+'"><i class="icon-SocialLink"></i></a>')}},{$node:a}}},app.mods.tagPreview=function(e){var o=$("#tmp-prev-tag").html(),i=$("#tmp-prev-tag-item").html();return function(e){var t=$(o),n=t.find(".tag-container"),a=e.Data;return e.renderPreview=function(){n.empty().css("text-align",a.Align),$.each(a.Items,function(e,t){var a=$(i);a.find(".tag-inner").html(t.Name),n.append(a)})},{$node:t}}},app.mods.taskListPreview=function(e,t,a,n){var d=$("#tmp-prev-task-list").html(),c=$("#tmp-prev-task-list-row").html(),u=n.toggleItemStatus,m=n.toggleProgress,p=n.toggleCompleted,f=n.setStatus,h=n.setProgress;return function(e){var t=e.Data,a=$(d),n=a.find(".title").css("display",1==t.Txt?"":"none"),r=a.find(".task-list-container"),o=a.find(".progress-toggle-wrap"),i=o.find(".items-completed"),s=o.find(".total-items"),l=o.find(".task-list-progress");return e.renderPreview=function(){n.html(t.Title),u(a,t.showItemStatus),m(a,t.showProgress),p(a,t.showCompleted),r.empty(),$.each(t.Items,function(e,t){var a,n,o,i,s;a=t,n=$(c),o=n.find(".item-title"),i=n.find(".item-desc"),s=n.find(".item-status"),o.html(a.Name),i.html(a.Desc),f(s,a.Status),r.append(n)}),h(t.Items,i,s,l),app.plugin.tooltip(!0)},{$node:a}}},app.mods.vertBarPreview=function(e){var l=$("#tmp-prev-vert-bar").html(),d=$("#tmp-prev-vert-bar-row").html();return function(e){var t=$(l),a=t.find(".title"),n=t.find(".pairs"),o=t.find(".y-axis-max"),i=t.find(".vert-line-chart-container"),s=e.Data,r=app.charts.lineChart({showTooltip:function(e,t){$vertBarModule=$(e).closest(".vert-bar-module"),$vertBarModule.find(".slider-outer").eq(t).find(".slider-tooltip").show()},hideTooltip:function(e,t){$vertBarModule=$(e).closest(".vert-bar-module"),$vertBarModule.find(".slider-outer").eq(t).find(".slider-tooltip").css("display","")},updateDataCb:function(){},updateTooltip:function(){},showDeleteBtn:function(){},hideDeleteBtn:function(){}});return e.renderPreview=function(){t.removeClass("graph-type-Bar graph-type-Line").addClass("graph-type-"+s.graphType),a.html(s.Title).css("display",1==s.Txt?"":"none"),o.text(s.yAxisMax),n.empty(),$.each(s.Items,function(e,t){var a=$(d);a.find(".name").html(t.Name),a.find(".slider-bar").css({height:parseFloat(t.Height)+"%"}),a.find(".slider-tooltip").css({bottom:"calc("+parseFloat(t.Height)+"% + 10px)"}),a.find(".slider-tooltip-name").html(t.Name),a.find(".slider-val").text(t.Val),n.append(a)}),i.find("svg").empty(),r.init(i,s)},{$node:t}}},app.mods.videosPreview=function(e,i){var s=$("#tmp-prev-videos").html(),r=$("#tmp-edit-video-item").html();return function(e){var t=$(s),a=e.Data,n=t.find(".title"),o=t.find(".video-outer");return e.renderPreview=function(){n.html(a.Html).css("display",1==a.Txt?"":"none"),o.empty().css("text-align",a.Align),$.each(a.Items,function(e,t){var a=$(r);a.removeClass("edit"),a.find(".edit-btn").remove(),a.find(".link-btn").remove(),a.find(".embed-btn").remove(),a.find(".logo-resize-handle").remove(),a.find(".loading-animation").remove(),a.find(".close-btn").remove();var n=a.find(".fr-video");a.css("width",t.width+"%"),t.VideoUrl&&" "!==t.VideoUrl?n.html(i(t.VideoUrl)):t.EmbedCode&&" "!==t.EmbedCode&&n.html(t.EmbedCode),o.append(a),console.log("preview",e,t)})},{$node:t}}},app.popup.getAddModule=function(d,t,c,u,m,e,r){app.wType;var o,p,f,n=$("#tmp-add-module-popup"),i=(n.find("input"),n.find("h1")),a=n.find(".icon-Close"),s=n.find(".addModule-moduleblock"),l=n.find(".addModule-canvasblock"),h=(n.find(".addModule-importblock"),n.find(".addModule-eachfoliocont"),n.find("#addModule-select-folio-dropdown")),g=n.find("#addModule-select-folio-dropdown  li"),v=n.find("#addModule-select-folio-dropdown .addModule-textholder"),b=n.find(".tabs span"),T=n.find(".paper"),y=$("#tmp-new-mod-req"),C=$("#tmp-add-mod-item").html(),k="app.xtensio.tech"==location.hostname?1:0,w=!1,x=c.token,P=function(){var e=r.getModuleCount(),t=$(this);console.log("getModuleCount",e),100<=e?D(function(){return S(t)}):S(t)};function S(e){var t=e.data("item"),a=$(".active-edit-div").eq(0);0===a.length&&(a=$(".edit-div:last-child"));var n=$(".preview-div").eq(a.index()).find(".section-content");a=a.find(".section-content"),p(t.name,void 0,void 0,a,n),d.close()}function D(e){w?e():(w=!0,d.message({heading:"Your Folio Is Getting Too Big",message:"Please consider dividing your work into multiple folios.",btnText:"Ok",enterAsOK:!0,notMini:!0,bodyCentered:!0,handleOK:function(){e()}}))}function F(e){var i,s=[],r=[],l={};t.templateMods({name:e.template,token:x,success:function(o){setTimeout(function(){if(console.log("templateMods response",o),!1!==c.setNewBlankCanvas){_.remove(o.Data,function(e){return"Text"===e.Type});var e=o.Data.length-1,t=JSON.parse(o.Data[e].Data);t.Mods=[],o.Data[e].Data=JSON.stringify(t)}console.log("res.Data",o.Data),$.each(o.Data,function(e,t){if(t.Data=JSON.parse(t.Data),"DataModule"==t.Type)s=t.Data.Sections[0].ModIds;else if(-1<s.indexOf(t.Tag)){if(t.Data.Theme=f||"",r.push(t),t.Store){var a=JSON.parse(t.Store).style;if(k&&console.log(a),a!=i){$("#folio-style").append(a),i=a;var n=u.get("style")||"";n=-1<n.indexOf(a)?n:n+a,u.set("style",n)}}}else t.Data.Theme=f||"",l[t.Tag]=t;e==o.Data.length-1&&$.each(r,function(e,t){t.Data.Mods&&$.each(t.Data.Mods,function(e,t){var a=l[t.Tag];t.Type=a.Type,t.Data=a.Data}),t.New=!0,p(t.Type,t)}),app.editor.addWatermark(c,d,m)})},100)},error:function(e){d.error(e.Message)}}),d.close()}var I=function(a,e,n){a.empty(),$.each(e,function(e,t){(o=$(C)).data("item",t),t.isNew&&o.append("<div class='new-label'>New</div>"),t.img&&o.find("i").addClass(t.img),"Videos"==t.name&&(o.prepend('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25.55 27.68"><defs><style>.cls-av-1{fill:none;stroke-width: 0;}.cls-av-1,.cls-av-2{fill-rule:evenodd;}.cls-av-2{fill:#fff;}</style></defs><title>0Asset 36</title><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path class="cls-av-1" d="M0,26.42c0,1.1.79,1.57,1.75,1L24.83,14.8c1-.53,1-1.39,0-1.92L1.75.22C.79-.31,0,.16,0,1.26Z"/><polygon class="cls-av-2" points="2.24 24.81 22.24 13.84 2.24 2.87 2.24 24.81"/></g></g></svg>'),o.find("i").remove()),o.find("p").text(t.text),o.click(n).addClass(e<5?"r-1":"").addClass(4==e||9==e||14==e?"c-last":""),a.append(o)})},M=[{name:"Text",text:"Text",img:"text"},{name:"TaskList",text:"Task List",img:"task-list",isNew:!0},{name:"Images",text:"Image",img:"img"},{name:"Videos",text:"Video",img:"img"},{name:"DonutChart",text:"Pie Chart",img:"pie"},{name:"Scale",text:"Scale Chart",img:"scale"},{name:"Bar",text:"Bar Graph",img:"bar"},{name:"Vertical Bar",text:"Bar / Line Graph",img:"vert-bar",isNew:!0},{name:"Tag",text:"Tags",img:"tags"},{name:"DataCollection",text:"Email Form",img:"form"},{name:"Social",text:"Social",img:"social"},{name:"RowBreak",text:"Row Break",img:"row"}],E=[{name:"Canvas",text:"Canvas",img:"canvas",template:"blank-canvas"}].concat(M);I(s,M,P),I(l,[{name:"Persona",text:"Persona",img:"persona",template:"user-persona"},{name:"Business",text:"Business Canvas",img:"canvas",template:"business-model-canvas"},{name:"Lean",text:"Lean Canvas",img:"canvas",template:"lean-canvas"},{name:"SWOT",text:"SWOT Analysis",img:"swot",template:"swot-analysis"},{name:"Canvas",text:"Canvas",img:"canvas",template:"blank-canvas"}],function(){var e=$(this).data("item"),t=app.consts.freePersonaLimit,a=m.isFreeWithTeam()||m.isTryMode();if(console.log("isPersonaLimmited",a),e.template){var n=0,o=r.getModuleCount();switch(e.template){case"user-persona":n=a?t:14;break;case"business-model-canvas":n=23;break;case"swot-analysis":n=6;break;case"lean-canvas":n=15;break;default:n=1}o+=n;var i=r.getModuleCount("persona-canvas");if("user-persona"==e.template&&a&&t<=i)return void m.showFreePersonaBlocker(d);if(100<o){if(0===c.Team.ST)return void m.showFreeModuleBlocker(d,100);D(function(){return F(e)})}else F(e)}else{var s={Tag:0,New:!0,Type:"Canvas",Data:{BgColor:"rgba(0,0,0,0)",Cols:"12",Type:"Canvas",Mods:[{Col:0,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 1</h3><p>Just like the rest of your folio, you can add and remove modules to your canvas, drag them in and out.</p>',Head:2}},{Col:1,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 2</h3><p>You can even change the number of columns and adjust their widths.</p>',Head:2}},{Col:2,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 3</h3><p>Changing the color scheme updates all modules within this canvas.</p>',Head:2}}]}};p(e.name,s),d.close()}}),n.find(".addModule-canvasblock .block").last().hide(),s.append(y);var A=function(e){T.add(b).removeClass("selected"),b.filter(":eq("+e+")").addClass("selected"),T.filter(":eq("+e+")").addClass("selected")};return b.click(function(){A($(this).index())}),h.click(function(){$(this).toggleClass("active")}),g.click(function(){v.text($(this).text())}),d.reg(n,a),function(e,t,a){p=e,f=a,I(s,t?M:E,P),s.append(y),t?(A(0),b.css("visibility","hidden"),i.text("Add Module")):(i.text("Add"),b.css("visibility","")),d.show(n)}},app.popup.getBgImageAdjust=function(n){var o,r,l,t,d,c,u,m,p,f,h,g,i=$("#tmp-popup-bg-image-adjust"),e=i.find(".cancel, .popup-close.icon-Close"),s=(i.find(".loading-animation").html(n.spinner),i.find(".bg-image-wrap"),i.find(".bg-image-to-adjust")),a=i.find(".set-bg"),v=i.find(".set-bg-cancel");function b(e){if(0<parseInt(e.w)){var t=d/e.w,a=c/e.h,n=Math.round(t*e.x*(f/d)),o=Math.round(a*e.y*(h/c)),i=Math.round(t*f),s=Math.round(i/p);g={backgroundPositionX:100*n/(i-f)+"%",backgroundPositionY:100*o/(s-h)+"%",backgroundSize:"cover"}}}return s.on("load",function(){void 0!==t&&t.destroy&&t.destroy();var e=$(this);e.css("height","auto"),l=f/h,u=e.width(),m=e.height(),p=u/m,s.Jcrop({setSelect:function(){if(d=u,c=Math.round(u/l),"none"==r.css("backgroundImage"))return[0,0,d,c];var e=Math.round(parseFloat(r.css("backgroundSize"))),t=Math.round(parseFloat(r.css("backgroundPositionX"))),a=Math.round(parseFloat(r.css("backgroundPositionY")));Math.round(f*e/100),Math.round(h*e/100);var n=Math.round(100*u/e),o=Math.round(n/l),i=Math.round((u-n)*t/100),s=Math.round((m-o)*a/100);return[i,s,Math.round(i+n),Math.round(s+o)]}(),aspectRatio:l,onChange:b,onSelect:b},function(){t=this})}),a.click(function(){o(g),s.attr("src",""),t.destroy()}),v.click(function(){s.attr("src",""),t.destroy(),n.close()}),n.reg(i,e),function(e,t,a){o="function"==typeof a?a:function(){},f=(r=e).width(),h=r.height(),s.attr("src",t),n.show(i)}},app.popup.getExpOption=function(s,e,r){var l,d=$("#tmp-exp-option"),t=d.find(".ok"),c=d.find(".scale"),u=d.find(".page-margin"),m=d.find(".sec-margin"),p=d.find(".mod-margin"),f=d.find(".msg");return t.on("click",function(){var e,t,a,n,o=0,i=l.expOpt;if(e=c.val(),t=u.val(),a=m.val(),n=p.val(),d.find(".error").removeClass("error"),validator.isInt(t)||(u.addClass("error"),o=1),validator.isInt(a)||(m.addClass("error"),o=1),validator.isInt(n)||(p.addClass("error"),o=1),f.toggleClass("error",0<o),o)return!1;i.Scale=e,i.Margin=t,i.SecMargin=a,i.ModMargin=n,r.set("exp-opt-"+l.Token,JSON.stringify(i)),s.close()}),s.reg(d,d.find(".icon-Close, .no")),function(e){l=e;var t={Scale:1,Margin:15,SecMargin:12,ModMargin:12},a=r.get("exp-opt-"+l.Token);if(a)try{t=JSON.parse(a)}catch(e){}l.expOpt=t,c.val(t.Scale),u.val(t.Margin),m.val(t.SecMargin),p.val(t.ModMargin),s.show(d)}},app.popup.getExport=function(s,r,a,l,n,o){var d,h,c,u,i,m,p,g,f,v,b,T=$("#tmp-export"),e=T.find(".popup-header"),t=e.find("h1"),y=e.find(".tabs").find("span"),C=y.filter(".pdf"),k=y.filter(".png"),w=T.find(".js-pdf"),x=T.find(".x-select"),P=T.find(".no, .icon-Close"),S=T.find(".yes"),D=T.find(".cta-btns"),F=T.find(".loading-animation").html(r.spinner),I=T.find(".exp-option"),M=T.find(".png-msg"),E=T.find(".pdf-msg"),A=T.find(".gen-msg"),U=$("#pdf-col"),N=$("#thumb-col"),L=T.find(".popup-header-note-nocreds"),O=T.find(".popup-header-note"),R=T.find(".popup-header-free"),B=$(".thumbnail-controls"),_=$(".thumbnail-container"),G=T.find(".spinner-cont"),H=T.find(".png-spinner"),Y=T.find(".break .sec"),j=T.find(".break .cimg"),z=T.find(".break .rb"),q=T.find(".break .autofill"),V=0,K=0,J=!0,W=!1,X=!0;function Z(e){S.find(".fa, i").remove(),e&&S.append('<i class="fa fa-lock"></i>')}function Q(){i=!0,b&&(J=b.downloadPdfAllowed()||s.exportEnabled&&o.isTryMode(),W=b.isOwner(),J||le())}n.addListener("plusUnlocked",function(){Q()}),n.addListener("plusCancelled",function(){Q()}),y.click(function(){i||(h.format=$(this).hasClass("png")?"PNG":"PDF",te())}),I.click(function(){r.push(T),r.expOption(d)});B.find(".arr-left").on("click",function(e){e.preventDefault(),$(".carousel").carousel("prev"),ee()}),B.find(".arr-right").on("click",function(e){e.preventDefault(),$(".carousel").carousel("next"),ee()});var ee=function(){V=_.find(".active").index()+1,B.find("#thumb-counter").text(V+" / "+K)},te=function(){if(console.log("ExportPreviewEnabled",s.ExportPreviewEnabled),console.log("ExportPreviewInitialLoadEnabled",s.ExportPreviewInitialLoadEnabled),console.log(_typeof(s.ExportPreviewInitialLoadEnabled)),console.log("ExportPreviewSaveToBlobEnabled",s.ExportPreviewSaveToBlobEnabled),X&&s.ExportPreviewEnabled&&(h.format="PDF",h.mode="screen",h.orient="landscape",i=!0,s.ExportPreviewInitialLoadEnabled&&setTimeout(function(){S.click()},500),X=!1),h.format=h.format||"PDF",h.paper=h.paper||"612x792",S.removeAttr("target"),y.removeClass("selected"),_.removeClass("cont-landscape"),B.hide(),E.hide(),M.hide(),A.hide(),ie(),T.find(".paper").hasClass("hide-cancel")||(s.ExportPreviewEnabled?S.attr("href","#").removeClass("download").find("span").html("Preview and Export "+h.format):S.attr("href","#").removeClass("download").find("span").html("Export "+h.format)),t.text("Export "+h.format),c.target?T.find(".break").hide():T.find(".break").show(),"PNG"==h.format){_.hide(),k.addClass("selected"),w.hide();var e="<div class='thumbnail-container'><div class='img'><img src='/img/thumb-placeholder.jpg' class='placeholder' /> </div></div>";e+="Export your "+(c.target||"folio")+" as a single PNG",M.html(e).show(),J||Z(!1)}else J||Z(!0),h.orient=h.orient||"landscape",w.show(),C.addClass("selected"),T.find(".selection, .select, .radio").removeClass("selected"),T.find(".for-"+(h.mode||"screen")).addClass("selected").find(".change-mode").addClass("selected"),Y.addClass(h.sec?"selected":""),z.addClass(h.rb?"selected":""),j.addClass(h.cimg?"selected":""),q.addClass(h.autofill?"selected":""),T.find('.radio[data-val="'+(h.orient||"landscape")+'"]').addClass("selected"),console.log("settings data",h),setTimeout(function(){h.autofill?(z.removeClass("disable-op"),j.addClass("disable-op")):h.sec&&(z.addClass("disable-op"),j.removeClass("disable-op"))},10),function(e){T.find(".x-select span"),T.find(".x-select .item").removeClass("active");var t=T.find('.x-select .item[data-value="'+e+'"]').addClass("active").text();T.find(".x-select .text").text(t)}(h.paper||"612x792"),s.ExportPreviewEnabled?(_.show(),N.show(),U.removeClass("do-full"),E.html("Click the Preview and Export button to generate preview").show(),h.mode&&"screen"!==h.mode?(x.removeClass("disable-select"),"landscape"===h.orient?(_.html('<div class="img"><img src="/img/thumb-placeholder_landscape.jpg" class="placeholder" /></div>'),_.addClass("cont-landscape"),G.find(".loader").addClass("landscape")):(_.html('<div class="img"><img src="/img/thumb-placeholder.jpg" class="placeholder" /></div>'),_.removeClass("cont-landscape"),G.find(".loader").removeClass("landscape"))):(_.html('<div class="img"><img src="/img/thumb-placeholder.jpg" class="placeholder" /></div>'),_.removeClass("cont-landscape"),G.find(".loader").removeClass("landscape"),x.addClass("disable-select"))):(N.hide(),U.addClass("do-full"));return!1},ae=function(e,t){$(e).hover(function(e){$(this).stop().animate({scrollTop:$(this).find(t).height()},5e3)},function(e){$(this).stop().animate({scrollTop:0},2e3)})};T.find(".change-mode").on("click",function(){if(!i)return h.mode=$(this).data("mode"),te()}),T.find(".orientation .radio").on("click",function(){if(!i&&"print"===h.mode)return h.orient=$(this).data("val"),h.mode="print",te()}),T.find(".break .select").on("click",function(){if(!i&&"print"===h.mode){var e=$(this).data("val");return h[e]=!h[e],h.mode="print",$(this).hasClass("sec")?h.autofill=!h[e]:$(this).hasClass("autofill")&&(h.sec=!h[e]),te()}}),T.find(".dropdown").on("change",function(){if(!i&&"print"===h.mode)return h.paper=this.value,h.mode="print",te()}),T.find(".x-select .item").on("click",function(){var e=$(this);if(!i&&"print"===h.mode)return h.paper=e.attr("data-value"),h.mode="print",T.find(".x-select .text").text(e.text()),te(),!0});var ne=function(e){if(i=!0,D.addClass("disable-btns"),n.raiseEvent("saveBeforeExport",function(){return console.log("save folio on export")}),void 0!==s.teamDefaultColorStyles&&""!==s.teamDefaultColorStyles&&(console.log("implementing team default color"),e=s.teamDefaultColorStyles.toString()+e),e=function(e){var t=".watermark-on-free, .watermark-on-free-shared {";t+="display: block !important; position: absolute; height: ".concat($(document).height(),"px; background-size: 100%; background-repeat: repeat-y; background-position: center top;"),t+=" }";var a="<style id='watermark' type='text/css'>  ".concat(".watermark-on-free, .watermark-on-free-shared { opacity: 0 !important; display: none; }","  </style>"),n="<style id='watermark' type='text/css'>  ".concat(t,"  </style>");return e=(b.brandingRemoved()||J)&&!0!==c.isAnonymousPNGExport?a.toString()+e:n.toString()+e}(e),e=function(){var e="";$(".font-face-tag").each(function(){e+=$(this)[0].outerHTML});var t=$("#defaultFont");return 0<t.length&&(e+=t[0].outerHTML),e}()+e,console.log("data",h),console.log("settings before processing",u),h&&u&&!u.OnePage&&h.sec&&h.cimg){var t;switch(h.paper){case"612x792":t=u.Landscape?986:1651;break;case"612x1008":t=u.Landscape?849:2101,u.Landscape&&(u.BrowserWidth=1400);break;case"792x1224":t=u.Landscape?1035:2163,u.BrowserWidth=u.Landscape?1600:1400;break;case"842x1190":t=u.Landscape?1132:1979,u.BrowserWidth=u.Landscape?1600:1401;break;case"595x842":t=u.Landscape?884:1805,u.Landscape&&(u.BrowserWidth=1251);break;case"421x595":t=u.Landscape?902:1766;break;default:t=986,console.log("NO PAPER MATCH FOUND!!")}var a=".preview-div { min-height: "+t+"px !important; page-break-after: always !important; } ";e=("<style id='preview-div-h' type='text/css'> "+(a+=".preview-div .section-content { page-break-after: auto !important; }")+" </style>").toString()+e,console.log("applying full image/color page"),console.log("page height: ",t),console.log("settings.BrowserWidth: ",u.BrowserWidth)}console.log("str",e),c.isAnonymousPNGExport?l.exportFolio({format:h.format,html:e,settings:u,success:function(e){console.log("exportFolio response",e),(p=e.Message)&&se(e)},error:function(e){console.log("error ",e)},complete:function(){$("body").removeClass("anon-download-busy"),D.removeClass("disable-btns"),x.removeClass("disable-select")}}):l.exportFolio({format:h.format,html:e,settings:u,success:function(f){console.log("exportFolio response",f),p=f.Message.replace("/get-export/","");var e=s.ExportPreviewSaveToBlobEnabled?f.Data.exportPreviewThumbPath:"/get-preview-thumbnail/"+p,t=s.ExportPreviewSaveToBlobEnabled?f.Data.exportPreviewPath:"/get-preview/"+p;if(clearTimeout(g),o.isTryMode())se(f);else if("PDF"===h.format)if(s.ExportPreviewEnabled)if("print"===h.mode){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="arraybuffer",a.onload=function(e){var t=e.target.response,a=UTIF.decode(t);_.html('<div id="carousel-" class="carousel slide" data-ride="carousel"><div class="carousel-inner" role="listbox"></div></div>'),console.log("page count: "+a.length);for(var n=0;n<a.length;n++){UTIF.decodeImage(t,a[n]);var o=UTIF.toRGBA8(a[n]),i=document.createElement("canvas");i.width=a[n].width,i.height=a[n].height;for(var s=i.getContext("2d"),r=s.createImageData(i.width,i.height),l=0;l<o.length;l++)r.data[l]=o[l];s.putImageData(r,0,0);var d=0===n?"item active":"item",c=$("<div />",{class:"img"}).append(i),u=$("<div />",{class:d}).append(c),m=c.find("canvas").width(),p=c.find("canvas").height()*(250/m);u.find("canvas").css({width:"250px",height:p+"px"}),_.find(".carousel-inner").append(u)}$(".carousel").carousel({interval:!1}),1<n&&(B.show(),K=n,V=1,B.find("#thumb-counter").text(V+" / "+K)),E.html("Your "+h.format+" is ready to download."),"landscape"===h.orient&&_.addClass("cont-landscape"),ae(".img","canvas"),oe(f,"",!1)},a.send()}else _.html("<div class='img'><img id='pdfImg' src='"+e+"' /></div>"),E.html("Your "+h.format+" is ready to download."),ae(".img","img"),oe(f,"pdfImg");else{var n="Your "+h.format+" is ready to download.";A.html(n).show(),oe(f),w.hide(),_.hide()}else{n="Preview<br><div class='thumbnail-container'><div class='img'><img id='pngImg' src='"+e+"' /> </div></div>";n+="Your "+h.format+" is ready to download.",M.html(n),ae(".img","img"),oe(f,"pngImg")}},error:function(e){E.text(e.Message),M.text(e.Message),ie(),clearTimeout(g)},complete:function(){$("#tmp-power-by-footer").show(),$("body").removeClass("anon-download-busy"),D.removeClass("disable-btns"),x.removeClass("disable-select")}})},oe=function(e,t,a){var n=s.ExportPreviewSaveToBlobEnabled?e.Data.exportPath:e.Message;if(a=void 0===a||a,i=!1,clearTimeout(g),a){var o=$("#"+t);o.prop("complete")?ie():o.on("load",function(){ie()})}else setTimeout(function(){ie()},1e3);D.removeClass("disable-btns"),x.removeClass("disable-select"),S.attr("href",n).addClass("download").find("span").html('<i class="fi-download"></i> Download')},ie=function(){F.hide(),G.hide(),H.hide()},se=function(e){var t="";e&&(t=(t=(t=e.Message.split("/"))[t.length-1]).split("?")[0],a.toggleExitIntent(!1,s),window.location.href=e.Data.exportPath,a.toggleExitIntent(!0,s)),!0!==c.isAnonymousPNGExport&&l.setTempExportCount({exportKey:t,success:function(e){console.log("setTempExportCount ",e),l.getTempExportCount({exportKey:t,success:function(e){if(console.log("getTempExportCount ",e),parseInt(e.Message)%5==1){if(o.isTryMode())return void re()}else r.close()},error:function(e){},complete:function(){}})},error:function(e){},complete:function(){}})},re=function(e){r.close(T),r.downloadBlocker(null,null,null,!0)};S.on("click",function(e){if($("#tmp-power-by-footer").hide(),S.hasClass("download")||e.preventDefault(),"PDF"===h.format&&(!J||v&&0===f))i={heading:"Please Upgrade Your Account",message:"Exporting PDFs is a premium feature. Please upgrade to a subscription plan for unlimited PDF downloads.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){r.universalBlocker()}},W||(i.message="Exporting PDFs is a premium feature. Please contact the team owner to upgrade your account.",i.heading="You Cannot Perform this Action",i.cancelText=null,i.btnText="Ok",i.handleOK=null),r.push(T),r.message(i);else{if(!S.hasClass("download")){var t=$.extend({paper:"612x792"},h);u=d.expOpt||{},m=u.Scale||1,u.Margin||0;1367<$(window).width()&&$(window).width();if(null==t.paper&&(t.paper="612x792"),"print"==t.mode&&"PDF"==t.format){var a=t.paper.split("x");u.Landscape="landscape"==t.orient,u.Width=a[0],u.Height=a[1],u.Breaks=t.sec?1:0,u.Breaks|=t.pers?2:0,u.Breaks|=t.rb?4:0,u.BrowserWidth=1276*m,u.Landscape||"421x595"!=t.paper||(u.BrowserWidth=1250*m)}else u.OnePage=!0,u.Fit=!0,u.BrowserWidth=1370,u.Width=1367,u.Height=0<c.$el.height()?c.$el.height():0;return u.ExportPreviewEnabled=null!=s.ExportPreviewEnabled&&"not-set"!=s.ExportPreviewEnabled,u.IsFreeUser=!1,console.log(u.IsFreeUser),console.log("settings",u),"PDF"===t.format?s.ExportPreviewEnabled?(E.html("Generating preview. <br>This may take up to a minute...").show(),u.OnePage?G.find(".loader").removeClass("landscape"):"landscape"===t.orient?G.find(".loader").addClass("landscape"):G.find(".loader").removeClass("landscape"),G.show()):F.show():"PNG"===t.format&&H.show(),s.isTeam&&s.Team.Id?l.getStyleGuides({data:{team_Id:s.Team.Id},success:function(e){u.styleGuide=JSON.parse(e.Data),c.cb(u.BrowserWidth,function(e){u.Height=Math.min(14400,u.Height||Math.round(.75*c.$el.height())),ne(e)})}}):c.cb(u.BrowserWidth,function(e){u.Height=Math.min(14400,u.Height||Math.round(.75*c.$el.height())),ne(e)}),console.log("export settings",u),n=t.format,o="Still working on it...","PNG"===n&&(o="<div class='thumbnail-container'><div class='img'><img src='/img/thumb-placeholder.jpg' class='placeholder' /> </div></div>",o+="Still working on it..."),g=setTimeout(function(){"PNG"===n?M.html(o):E.html(o)},1e4),x.addClass("disable-select"),!1}setTimeout(function(){p&&s.ExportPreviewSaveToBlobEnabled&&$.post("/ReportExportSuccess/"+p),r.close(T)},300)}var n,o,i});var le=function(){i=!0,R.hide(),L.hide(),l.getCreditsLeft({success:function(e){console.log("getCreditsLeft response",e);var t=JSON.parse(e.Data),a=d&&d.Role||2;f=t.CreditsLeft,v=t.LimitsImposed,console.log("userFolioRole",a),f<=0?(J=!1,b.isOwner()?(L.find(".owner").show(),L.find(".btn-seeplans").click(function(e){e.preventDefault(),r.universalBlocker()})):L.find(".others").show(),Z(!0),k.html("PNG (Free)"),C.html('PDF <i class="fa fa-lock"></i>'),L.show(),T.addClass("no-creds")):(T.removeClass("no-creds"),J=!0,de(),O.show())},error:function(e){console.log("error: ",e)},complete:function(){i=!1}})},de=function(){var e=0===f?"PURCHASE EXPORT CREDITS":"PURCHASE MORE EXPORT CREDITS",t=0===f?" to download.":".",a=1===f?"credit":"credits";O.find(".cred-count").text(f+" "+a),b.isFreePlan()?b.isOwner()?(O.find("a.purchase-btn").text(e),O.find(".supplement").text(t)):b.isAdmin()?(O.find("span.txt-or").text(""),O.find(".supplement").text(""),O.find("a.upgrade-btn").remove()):O.find("h3").html("Please contact your team admins for more credits. <p>Each PDF or PNG download requires 1 export credit.</p>"):(O.find("a.purchase-btn").text(e),O.find(".supplement").text(t))};return O.find(".upgrade-btn").click(function(e){e.preventDefault(),r.universalBlocker()}),O.find(".purchase-btn").click(function(e){e.preventDefault(),r.universalBlocker(),$("#tmp-payment").css("opacity",0),setTimeout(function(){$("#tmp-payment .btn-credits, .btn-creds").trigger("click"),setTimeout(function(){$("#tmp-payment").css("opacity",1)},200)},1e3)}),r.reg(T,P),function(e,t,a){if(d=e,c=a,(h=t).cimg=!0,h.sec=!0,h.autofill=!1,h.rb=!1,h.orient="landscape",b=app.acl.helper(s),"string"==typeof s.ExportPreviewInitialLoadEnabled&&(s.ExportPreviewInitialLoadEnabled="not-set"!==s.ExportPreviewInitialLoadEnabled&&JSON.parse(s.ExportPreviewInitialLoadEnabled.toLowerCase())),"string"==typeof s.ExportPreviewEnabled&&(s.ExportPreviewEnabled="not-set"!==s.ExportPreviewEnabled&&JSON.parse(s.ExportPreviewEnabled.toLowerCase())),"string"==typeof s.ExportPreviewSaveToBlobEnabled&&(s.ExportPreviewSaveToBlobEnabled="not-set"!==s.ExportPreviewSaveToBlobEnabled&&JSON.parse(s.ExportPreviewSaveToBlobEnabled.toLowerCase())),X=!0,c.isAnonymousPNGExport)return(u=d.expOpt||{}).OnePage=!0,u.Fit=!0,u.BrowserWidth=1370,u.Width=1367,u.Height=0<c.$el.height()?c.$el.height():0,h.format="PNG",$("body").addClass("anon-download-busy"),void c.cb(u.BrowserWidth,function(e){u.Height=Math.min(14400,u.Height||Math.round(.75*c.$el.height())),ne(e)});te(),1===d.Role?(T.find(".readonly").removeClass("hidden"),T.find(".edit").addClass("hidden")):(T.find(".readonly").addClass("hidden"),T.find(".edit").removeClass("hidden")),Q(),F.hide(),i=!1,r.show(T)}};